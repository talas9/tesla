<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Comprehensive security analysis of Tesla Model S/X/3/Y MCU2 and Gateway"><meta name=author content="Security Researcher"><link href=https://talas9.github.io/tesla-research/gateway/21-gateway-heartbeat-failsafe/ rel=canonical><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.7.1"><title>Gateway MCU Heartbeat and Failsafe Mechanisms - Tesla MCU2 Security Research</title><link rel=stylesheet href=../../assets/stylesheets/main.484c7ddc.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../stylesheets/extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=red data-md-color-accent=red> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#gateway-mcu-heartbeat-and-failsafe-mechanisms class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="Tesla MCU2 Security Research" class="md-header__button md-logo" aria-label="Tesla MCU2 Security Research" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Tesla MCU2 Security Research </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Gateway MCU Heartbeat and Failsafe Mechanisms </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=red data-md-color-accent=red aria-label="Switch to light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=red data-md-color-accent=red aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/talas9/tesla-research title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> talas9/tesla-research </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../INDEX/ class=md-tabs__link> Complete Index </a> </li> <li class=md-tabs__item> <a href=../../core/00-master-cross-reference/ class=md-tabs__link> Core Research </a> </li> <li class=md-tabs__item> <a href=../81-gateway-secure-configs-CRITICAL/ class=md-tabs__link> Gateway Security </a> </li> <li class=md-tabs__item> <a href=../../mcu/24-mcu-architecture.md class=md-tabs__link> MCU Research </a> </li> <li class=md-tabs__item> <a href=../../evidence/59-EVIDENCE-AUDIT/ class=md-tabs__link> Evidence & Audit </a> </li> <li class=md-tabs__item> <a href=../../tools/56-tools-gateway-database-query.md class=md-tabs__link> Tools & Scripts </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="Tesla MCU2 Security Research" class="md-nav__button md-logo" aria-label="Tesla MCU2 Security Research" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> Tesla MCU2 Security Research </label> <div class=md-nav__source> <a href=https://github.com/talas9/tesla-research title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> talas9/tesla-research </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../../INDEX/ class=md-nav__link> <span class=md-ellipsis> Complete Index </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Core Research </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Core Research </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../core/00-master-cross-reference/ class=md-nav__link> <span class=md-ellipsis> Master Cross-Reference </span> </a> </li> <li class=md-nav__item> <a href=../../core/02-gateway-can-flood-exploit/ class=md-nav__link> <span class=md-ellipsis> Gateway CAN Flood Exploit </span> </a> </li> <li class=md-nav__item> <a href=../../core/03-certificate-recovery-orphan-cars/ class=md-nav__link> <span class=md-ellipsis> Certificate Recovery </span> </a> </li> <li class=md-nav__item> <a href=../../core/04-network-ports-firewall/ class=md-nav__link> <span class=md-ellipsis> Network Topology </span> </a> </li> <li class=md-nav__item> <a href=../../core/06-usb-firmware-update/ class=md-nav__link> <span class=md-ellipsis> USB Firmware Update </span> </a> </li> <li class=md-nav__item> <a href=../../core/07-usb-map-installation/ class=md-nav__link> <span class=md-ellipsis> USB Map Installation </span> </a> </li> <li class=md-nav__item> <a href=../../core/08-key-programming-vcsec/ class=md-nav__link> <span class=md-ellipsis> Key Programming </span> </a> </li> <li class=md-nav__item> <a href=../../core/13-ota-handshake-protocol/ class=md-nav__link> <span class=md-ellipsis> OTA Protocol </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Gateway Security </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Gateway Security </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../81-gateway-secure-configs-CRITICAL/ class=md-nav__link> <span class=md-ellipsis> ğŸ”’ CRITICAL: Secure Configs </span> </a> </li> <li class=md-nav__item> <a href=../80-ryzen-gateway-flash-COMPLETE/ class=md-nav__link> <span class=md-ellipsis> âœ… Complete Flash Dump </span> </a> </li> <li class=md-nav__item> <a href=../82-odin-routines-database-UNHASHED/ class=md-nav__link> <span class=md-ellipsis> ğŸ”“ Odin Database </span> </a> </li> <li class=md-nav__item> <a href=../92-config-metadata-table-FOUND/ class=md-nav__link> <span class=md-ellipsis> ğŸ¯ Config Metadata Table </span> </a> </li> <li class=md-nav__item> <a href=../83-odin-config-api-analysis/ class=md-nav__link> <span class=md-ellipsis> Odin Config API </span> </a> </li> <li class=md-nav__item> <a href=../84-gw-diag-command-reference/ class=md-nav__link> <span class=md-ellipsis> gw-diag Commands </span> </a> </li> <li class=md-nav__item> <a href=../88-gateway-strings-analysis/ class=md-nav__link> <span class=md-ellipsis> Gateway Strings </span> </a> </li> <li class=md-nav__item> <a href=../91-gateway-powerpc-disassembly-summary/ class=md-nav__link> <span class=md-ellipsis> PowerPC Disassembly </span> </a> </li> <li class=md-nav__item> <a href=../94-gateway-ALL-FUNCTIONS/ class=md-nav__link> <span class=md-ellipsis> All Functions </span> </a> </li> <li class=md-nav__item> <a href=../95-gateway-CAN-MESSAGES-COMPLETE/ class=md-nav__link> <span class=md-ellipsis> CAN Messages Complete </span> </a> </li> <li class=md-nav__item> <a href=../96-gateway-DATA-TABLES/ class=md-nav__link> <span class=md-ellipsis> All Data Tables </span> </a> </li> <li class=md-nav__item> <a href=../97-gateway-MEMORY-MAP/ class=md-nav__link> <span class=md-ellipsis> Memory Map </span> </a> </li> <li class=md-nav__item> <a href=../98-SHA-256-USAGE-ANALYSIS/ class=md-nav__link> <span class=md-ellipsis> SHA-256 Usage </span> </a> </li> <li class=md-nav__item> <a href=../99-gateway-FIRMWARE-METADATA/ class=md-nav__link> <span class=md-ellipsis> Firmware Metadata </span> </a> </li> <li class=md-nav__item> <a href=../55-gateway-spc-chip-replacement/ class=md-nav__link> <span class=md-ellipsis> SPC Chip Replacement </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> MCU Research </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> MCU Research </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../mcu/24-mcu-architecture.md class=md-nav__link> <span class=md-ellipsis> MCU Architecture </span> </a> </li> <li class=md-nav__item> <a href=../../mcu/25-mcu-boot-sequence.md class=md-nav__link> <span class=md-ellipsis> Boot Sequence </span> </a> </li> <li class=md-nav__item> <a href=../../mcu/28-mcu-qtcarserver.md class=md-nav__link> <span class=md-ellipsis> QtCarServer Security </span> </a> </li> <li class=md-nav__item> <a href=../../mcu/31-mcu-chromium-security.md class=md-nav__link> <span class=md-ellipsis> Chromium Security </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> Evidence & Audit </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Evidence & Audit </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../evidence/59-EVIDENCE-AUDIT/ class=md-nav__link> <span class=md-ellipsis> Evidence Audit </span> </a> </li> <li class=md-nav__item> <a href=../../VERIFICATION-STATUS/ class=md-nav__link> <span class=md-ellipsis> Verification Status </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> <span class=md-ellipsis> Tools & Scripts </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Tools & Scripts </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../tools/56-tools-gateway-database-query.md class=md-nav__link> <span class=md-ellipsis> Gateway CRC Validator </span> </a> </li> <li class=md-nav__item> <a href=../../SCRIPTS/ class=md-nav__link> <span class=md-ellipsis> Download Scripts </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=gateway-mcu-heartbeat-and-failsafe-mechanisms>Gateway MCU Heartbeat and Failsafe Mechanisms</h1> <p><strong>Document:</strong> 21-gateway-heartbeat-failsafe.md<br> <strong>Created:</strong> 2026-02-03<br> <strong>Purpose:</strong> Document all Gateway heartbeat, watchdog, and failsafe mechanisms including timing constants and state transitions<br> <strong>Cross-References:</strong> 02-gateway-can-flood-exploit.md, 00-master-cross-reference.md, 05-gap-analysis-missing-pieces.md</p> <hr> <h2 id=table-of-contents>Table of Contents</h2> <ol> <li><a href=#1-overview>Overview</a></li> <li><a href=#2-kernel-watchdog-system>Kernel Watchdog System</a></li> <li><a href=#3-gateway-monitor-gwmon>Gateway Monitor (gwmon)</a></li> <li><a href=#4-chromium-adapter-heartbeat>Chromium Adapter Heartbeat</a></li> <li><a href=#5-vohico-heartbeat>Vohico Heartbeat</a></li> <li><a href=#6-parker-ape-heartbeat>Parker (APE) Heartbeat</a></li> <li><a href=#7-emergency-lane-keep-integration>Emergency Lane Keep Integration</a></li> <li><a href=#8-failsafe-state-machine>Failsafe State Machine</a></li> <li><a href=#9-sd-card-format--port-opening-sequence>SD Card Format â†’ Port Opening Sequence</a></li> <li><a href=#10-attack-vector-cross-reference>Attack Vector Cross-Reference</a></li> </ol> <hr> <h2 id=1-overview>1. Overview</h2> <p>Tesla's MCU implements multiple layers of watchdog and heartbeat systems to detect component failures and trigger failsafe/recovery procedures. The primary systems are:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>â”‚                  TESLA WATCHDOG HIERARCHY                        â”‚
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a>Layer 1: Hardware Watchdog (/dev/watchdog)
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a>  â”œâ”€â”€ Kernel threshold: 4 seconds (kernel.watchdog_thresh)
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a>  â”œâ”€â”€ Softlockup: 8 seconds (threshold Ã— 2)
<a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a>  â””â”€â”€ Userspace: 9 seconds (softlockup + 1)
<a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>
<a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a>Layer 2: Gateway Monitor (gwmon)
<a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a>  â”œâ”€â”€ Monitors Gateway ECU (192.168.90.102)
<a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a>  â”œâ”€â”€ Timeout triggers emergency_session
<a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a>  â””â”€â”€ Opens port 25956 for emergency updates
<a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a>
<a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a>Layer 3: Component Heartbeats (D-Bus)
<a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a>  â”œâ”€â”€ Chromium Adapter â†’ QtCarServer
<a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a>  â”œâ”€â”€ Vohico â†’ QtCarServer
<a id=__codelineno-0-18 name=__codelineno-0-18 href=#__codelineno-0-18></a>  â”œâ”€â”€ Parker (APE) â†’ QtCarServer
<a id=__codelineno-0-19 name=__codelineno-0-19 href=#__codelineno-0-19></a>  â””â”€â”€ Mobile App â†’ QtCarServer
<a id=__codelineno-0-20 name=__codelineno-0-20 href=#__codelineno-0-20></a>
<a id=__codelineno-0-21 name=__codelineno-0-21 href=#__codelineno-0-21></a>Layer 4: Emergency Failsafe
<a id=__codelineno-0-22 name=__codelineno-0-22 href=#__codelineno-0-22></a>  â”œâ”€â”€ ParkerHeartbeatMissing alert
<a id=__codelineno-0-23 name=__codelineno-0-23 href=#__codelineno-0-23></a>  â”œâ”€â”€ HeartbeatMissingStopped state
<a id=__codelineno-0-24 name=__codelineno-0-24 href=#__codelineno-0-24></a>  â”œâ”€â”€ LssEmergencyLaneKeep activation
<a id=__codelineno-0-25 name=__codelineno-0-25 href=#__codelineno-0-25></a>  â””â”€â”€ Vehicle immobilization
</code></pre></div> <p><strong>Key Finding:</strong> The Gateway heartbeat failure is the most exploitable, as it triggers port 25956 opening without requiring authentication.</p> <hr> <h2 id=2-kernel-watchdog-system>2. Kernel Watchdog System</h2> <h3 id=configuration>Configuration</h3> <p><strong>Source:</strong> <code>/firmware/mcu2-extracted/etc/sysctl.conf</code> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a>kernel.watchdog_thresh<span class=o>=</span><span class=m>4</span>
</code></pre></div></p> <p><strong>Source:</strong> <code>/firmware/mcu2-extracted/etc/sv/watchdog/run</code> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=nb>exec</span><span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>
<a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=nv>hardlockup_threshold</span><span class=o>=</span><span class=k>$(</span>sysctl<span class=w> </span>-n<span class=w> </span>kernel.watchdog_thresh<span class=k>)</span><span class=w>  </span><span class=c1># 4 seconds</span>
<a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a><span class=nv>softlockup_threshold</span><span class=o>=</span><span class=k>$((</span><span class=nv>hardlockup_threshold</span><span class=o>*</span><span class=m>2</span><span class=k>))</span><span class=w>          </span><span class=c1># 8 seconds</span>
<a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a><span class=nv>userspace_watchdog_threshold</span><span class=o>=</span><span class=k>$((</span><span class=nv>softlockup_threshold</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=m>1</span><span class=k>))</span><span class=w> </span><span class=c1># 9 seconds</span>
<a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a><span class=nv>ping_rate</span><span class=o>=</span><span class=m>1</span><span class=w>  </span><span class=c1># Pet watchdog every 1 second</span>
<a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a>
<a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a>mkdir<span class=w> </span>-p<span class=w> </span>/var/run/watchdog
<a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a><span class=nb>exec</span><span class=w> </span>/sbin/watchdog<span class=w> </span>--timeout<span class=w> </span><span class=s2>&quot;</span><span class=nv>$userspace_watchdog_threshold</span><span class=s2>&quot;</span><span class=w> </span>--rate<span class=w> </span><span class=s2>&quot;</span><span class=nv>$ping_rate</span><span class=s2>&quot;</span><span class=w> </span>--mem-check
</code></pre></div></p> <h3 id=timing-constants>Timing Constants</h3> <table> <thead> <tr> <th>Parameter</th> <th>Value</th> <th>Purpose</th> </tr> </thead> <tbody> <tr> <td><code>kernel.watchdog_thresh</code></td> <td><strong>4 seconds</strong></td> <td>Hardware watchdog threshold</td> </tr> <tr> <td>Softlockup threshold</td> <td><strong>8 seconds</strong></td> <td>CPU lockup detection (2Ã— kernel threshold)</td> </tr> <tr> <td>Userspace timeout</td> <td><strong>9 seconds</strong></td> <td>/sbin/watchdog daemon timeout</td> </tr> <tr> <td>Pet rate</td> <td><strong>1 second</strong></td> <td>Frequency of watchdog "petting"</td> </tr> </tbody> </table> <h3 id=behavior>Behavior</h3> <ol> <li><code>/sbin/watchdog</code> opens <code>/dev/watchdog</code> device</li> <li>Pings every 1 second to prevent timeout</li> <li>Also performs memory check (<code>--mem-check</code>)</li> <li>If userspace process fails to pet within 9 seconds â†’ <strong>system reboot</strong></li> </ol> <h3 id=gateway-watchdog-disable>Gateway Watchdog Disable</h3> <p><strong>Config ID 61:</strong> <code>bmpWatchdogDisabled</code></p> <p>From Gateway log analysis (_docx_1711.txt): <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a>Config bmpWatchdogDisabled id=61, value=0 len=1
</code></pre></div></p> <p><strong>Value interpretation:</strong> - <code>0</code> = Watchdog enabled (normal) - <code>1</code> = Watchdog disabled (dangerous - no reboot on hang)</p> <p><strong>sx-updater detection:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=c1>// Source: strings from /bin/sx-updater</span>
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=s>&quot;bmpwatchdogdisabled=1&quot;</span>
<a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=s>&quot;is_gw_watchdog_enabled&quot;</span>
</code></pre></div></p> <p>During firmware updates, the Gateway watchdog can be disabled to prevent premature reboots during long flash operations.</p> <hr> <h2 id=3-gateway-monitor-gwmon>3. Gateway Monitor (gwmon)</h2> <h3 id=overview>Overview</h3> <p>The <code>gwmon</code> (Gateway Monitor) process tracks Gateway ECU responsiveness and triggers emergency procedures on timeout.</p> <h3 id=string-evidence>String Evidence</h3> <p><strong>Source:</strong> <code>/firmware/mcu2-extracted/bin/sx-updater</code> strings <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a>read_gwmon
<a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a>GWMON
<a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a>gwmon_envoy_
<a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a>gwmon timeout
<a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a>stop_gwmon
<a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a>gwmon %s
<a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a>envoy_gwmon status=
<a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a>stop_envoy_gwmon
</code></pre></div></p> <h3 id=gateway-status-states>Gateway Status States</h3> <p><strong>Source:</strong> sx-updater status messages <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=s>&quot;gateway status=rebooting&quot;</span><span class=w>   </span><span class=c1>// Gateway is restarting</span>
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=s>&quot;gateway status=success&quot;</span><span class=w>     </span><span class=c1>// Gateway communication OK</span>
<a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=s>&quot;gateway status=failure&quot;</span><span class=w>     </span><span class=c1>// Gateway not responding</span>
<a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=s>&quot;gateway_needs_update = %s&quot;</span><span class=w>  </span><span class=c1>// Update flag set</span>
<a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a><span class=s>&quot;Gateway Version Info:&quot;</span><span class=w>      </span><span class=c1>// Version query response</span>
</code></pre></div></p> <h3 id=timeout-behavior>Timeout Behavior</h3> <p><strong>Critical String:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a>gwmon timeout
</code></pre></div></p> <p>When gwmon detects Gateway non-responsive:</p> <ol> <li><strong>Detection:</strong> No response to heartbeat request</li> <li><strong>Threshold:</strong> Exact timeout value <strong>NOT FOUND</strong> in strings (likely 5-30 seconds based on behavior)</li> <li><strong>Action:</strong> Marks <code>gateway_needs_update = true</code></li> <li><strong>Consequence:</strong> Triggers <code>emergency_session</code> in sx-updater</li> </ol> <h3 id=emergency-session-activation>Emergency Session Activation</h3> <p><strong>Source:</strong> sx-updater strings <div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=s>&quot;emergency_session&quot;</span>
<a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=s>&quot;get_emergency_session_atline status=BUG name=%s line=%d&quot;</span>
</code></pre></div></p> <p><strong>Related Functions:</strong> - <code>parse_gateway_update_log</code> - Read Gateway update logs - <code>flush_until_freed_timeout</code> - Wait for resource release - <code>disk_encryption_timeout</code> - Encryption operation timeout</p> <h3 id=port-25956-opening-mechanism>Port 25956 Opening Mechanism</h3> <p><strong>Firewall Rule:</strong> <code>/etc/firewall.d/qtcar.iptables</code> <div class=highlight><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a>-A<span class=w> </span>QTCAR<span class=w> </span>-o<span class=w> </span>lo<span class=w> </span>-p<span class=w> </span>tcp<span class=w> </span>-m<span class=w> </span>multiport<span class=w> </span>--dports<span class=w> </span><span class=m>7654</span>,9080,18466,20564,25956,28496<span class=w> </span>-j<span class=w> </span>ACCEPT
</code></pre></div></p> <p><strong>Port 25956 Purpose:</strong> Emergency updater shell access</p> <p><strong>Trigger Chain:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a>gwmon timeout â†’ emergency_session â†’ sx-updater opens 25956
</code></pre></div></p> <h3 id=related-ports>Related Ports</h3> <table> <thead> <tr> <th>Port</th> <th>Service</th> <th>Purpose</th> </tr> </thead> <tbody> <tr> <td>20564</td> <td>Syncterm trigger</td> <td><code>http://localhost:20564/syncterm</code></td> </tr> <tr> <td>25956</td> <td>Updater shell</td> <td>Emergency firmware access</td> </tr> <tr> <td>7654</td> <td>Monitor service</td> <td>System monitoring</td> </tr> </tbody> </table> <p><strong>Syncterm Session State:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=s>&quot;in-syncterm status=true&quot;</span><span class=w>   </span><span class=c1>// Syncterm active</span>
<a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=s>&quot;in-syncterm status=false&quot;</span><span class=w>  </span><span class=c1>// Syncterm inactive</span>
</code></pre></div></p> <h3 id=gateway-reboot-request>Gateway Reboot Request</h3> <p><strong>Source:</strong> sx-updater gateway reboot logic <div class=highlight><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=n>request_gateway_reboot_for_update</span><span class=w> </span><span class=n>sid</span><span class=o>=%</span><span class=n>llu</span><span class=w> </span><span class=n>status</span><span class=o>=</span><span class=n>internal_error</span>
<a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=n>request_gateway_reboot_for_update</span><span class=w> </span><span class=n>sid</span><span class=o>=%</span><span class=n>llu</span><span class=w> </span><span class=n>status</span><span class=o>=</span><span class=n>no_response</span>
<a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a><span class=n>request_gateway_reboot_for_update</span><span class=w> </span><span class=n>sid</span><span class=o>=%</span><span class=n>llu</span><span class=w> </span><span class=n>status</span><span class=o>=</span><span class=n>success</span>
<a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a><span class=n>request_gateway_reboot_for_update</span><span class=w> </span><span class=n>sid</span><span class=o>=%</span><span class=n>llu</span><span class=w> </span><span class=n>status</span><span class=o>=</span><span class=n>failure</span><span class=w> </span><span class=n>reason</span><span class=o>=%</span><span class=n>s</span>
</code></pre></div></p> <p><strong>Session ID (sid):</strong> 64-bit unsigned long long tracking update sessions</p> <hr> <h2 id=4-chromium-adapter-heartbeat>4. Chromium Adapter Heartbeat</h2> <h3 id=d-bus-interface>D-Bus Interface</h3> <p><strong>Source:</strong> <code>/firmware/mcu2-extracted/usr/tesla/UI/bin/QtCarServer</code> symbols</p> <p><strong>Methods:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=n>CenterDisplayDbusClient</span><span class=o>::</span><span class=n>chromiumAdapterHeartbeat</span><span class=p>()</span>
<a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a><span class=n>CenterDisplayDbusClient</span><span class=o>::</span><span class=n>chromiumAdapterHeartbeatFinished</span><span class=p>(</span><span class=n>QDBusError</span><span class=p>)</span>
<a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a><span class=n>CenterDisplayDbusClient</span><span class=o>::</span><span class=n>handleChromiumAdapterHeartbeat</span><span class=p>(</span><span class=n>QDBusError</span><span class=p>)</span>
<a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a><span class=n>CenterDisplayDbusClient</span><span class=o>::</span><span class=n>asyncChromiumAdapterHeartbeat</span><span class=p>()</span>
<a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a><span class=n>CenterDisplayDbusClient</span><span class=o>::</span><span class=n>handleChromiumAdapterHeartbeatReply</span><span class=p>(</span><span class=n>QDBusPendingCallWatcher</span><span class=o>*</span><span class=p>)</span>
</code></pre></div></p> <h3 id=purpose>Purpose</h3> <p>The Chromium Adapter runs the Tesla UI web application (built with Chromium/Electron). The heartbeat ensures the UI process is responsive.</p> <h3 id=timeout-detection>Timeout Detection</h3> <p><strong>String Evidence:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a>chromiumAdapterHeartbeat
<a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a>chromiumAdapterHeartbeatFinished(QDBusError)
<a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a>handleChromiumAdapterHeartbeat(QDBusError)
</code></pre></div></p> <p><strong>Timeout Constant:</strong> <strong>NOT EXTRACTED</strong> from binaries (requires disassembly)</p> <p><strong>Likely Value:</strong> 5-15 seconds based on typical UI watchdog patterns</p> <h3 id=failure-action>Failure Action</h3> <p>If Chromium Adapter fails to respond: 1. <code>QDBusError</code> passed to <code>chromiumAdapterHeartbeatFinished()</code> 2. Error handler logs failure 3. <strong>Likely:</strong> UI process restart via service manager 4. <strong>Possible:</strong> Fallback to simplified UI mode</p> <h3 id=websocket-heartbeat>WebSocket Heartbeat</h3> <p><strong>Additional strings found:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=n>ChromiumAdapterWebSocketImpl</span><span class=o>::</span><span class=n>heartbeatReceived</span><span class=p>()</span>
<a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a><span class=n>ChromiumAdapterWebSocketImpl</span><span class=o>::</span><span class=n>heartbeat</span><span class=p>()</span>
</code></pre></div></p> <p>The UI communicates with backend services via WebSocket with its own heartbeat layer.</p> <hr> <h2 id=5-vohico-heartbeat>5. Vohico Heartbeat</h2> <h3 id=d-bus-interface_1>D-Bus Interface</h3> <p><strong>Source:</strong> QtCarServer symbols</p> <p><strong>Methods:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=n>CenterDisplayDbusClient</span><span class=o>::</span><span class=n>vohicoHeartbeat</span><span class=p>(</span><span class=n>QDBusError</span><span class=p>)</span>
<a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a><span class=n>CenterDisplayDbusClient</span><span class=o>::</span><span class=n>vohicoHeartbeatFinished</span><span class=p>(</span><span class=n>QDBusError</span><span class=p>)</span>
<a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a><span class=n>CenterDisplayDbusClient</span><span class=o>::</span><span class=n>handleVohicoHeartbeat</span><span class=p>(</span><span class=n>QDBusError</span><span class=p>)</span>
<a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a><span class=n>CenterDisplayDbusClient</span><span class=o>::</span><span class=n>asyncVohicoHeartbeat</span><span class=p>()</span>
<a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a><span class=n>CenterDisplayDbusClient</span><span class=o>::</span><span class=n>handleVohicoHeartbeatReply</span><span class=p>(</span><span class=n>QDBusPendingCallWatcher</span><span class=o>*</span><span class=p>)</span>
</code></pre></div></p> <h3 id=purpose_1>Purpose</h3> <p><strong>Vohico</strong> (Vehicle Onboard Hierarchical Integration Controller) manages vehicle state integration across ECUs.</p> <p><strong>Role:</strong> - Aggregates CAN bus data - Manages vehicle state machine - Coordinates power modes - Handles key authentication</p> <h3 id=timeout-detection_1>Timeout Detection</h3> <p><strong>String Evidence:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a>vohicoHeartbeat
<a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a>vohicoHeartbeatFinished(QDBusError)
<a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a>handleVohicoHeartbeat(QDBusError)
</code></pre></div></p> <p><strong>Timeout Constant:</strong> <strong>NOT EXTRACTED</strong> (requires reverse engineering)</p> <p><strong>Estimated:</strong> 2-10 seconds (critical component requires tight monitoring)</p> <h3 id=failure-impact>Failure Impact</h3> <p>Vohico failure is <strong>CRITICAL</strong> as it manages core vehicle functions:</p> <ol> <li><strong>Detection:</strong> QDBusError on heartbeat timeout</li> <li><strong>Action:</strong> Likely triggers vehicle safe mode</li> <li><strong>Consequence:</strong> Limited driving functionality, alerts displayed</li> <li><strong>Recovery:</strong> Vohico process restart or MCU reboot</li> </ol> <hr> <h2 id=6-parker-ape-heartbeat>6. Parker (APE) Heartbeat</h2> <h3 id=alert-system>Alert System</h3> <p><strong>Source:</strong> QtCarServer strings</p> <p><strong>Alert Name:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a>ParkerHeartbeatMissing
</code></pre></div></p> <p><strong>Additional Alert:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a>HeartbeatMissingStopped
</code></pre></div></p> <p><strong>Context Strings:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a>PauseCycles
<a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a>AppMia        // Application Missing In Action
<a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a>ParkerHeartbeatMissing
<a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a>MaxReason
</code></pre></div></p> <h3 id=parker-ape-overview>Parker (APE) Overview</h3> <p><strong>Parker</strong> is Tesla's codename for the Autopilot ECU (AP2.5/AP3 hardware).</p> <p><strong>Network Address:</strong> - Primary: <code>192.168.90.103</code> (ape, ape-a) - Secondary: <code>192.168.90.105</code> (ape-b) - dual AP systems</p> <h3 id=heartbeat-mechanism>Heartbeat Mechanism</h3> <p><strong>Likely Protocol:</strong> UDP or TCP heartbeat messages sent from APE â†’ MCU</p> <p><strong>Expected:</strong> APE sends periodic "I'm alive" messages to MCU</p> <p><strong>Timeout â†’ ParkerHeartbeatMissing Alert</strong></p> <h3 id=timeout-constants>Timeout Constants</h3> <p><strong>NOT DIRECTLY EXTRACTED</strong> - Requires APE firmware analysis or MCU binary disassembly</p> <p><strong>Estimated Values:</strong> - Normal heartbeat interval: <strong>1-5 seconds</strong> - Timeout threshold: <strong>10-30 seconds</strong> - Alert threshold: <strong>3-5 missed heartbeats</strong></p> <h3 id=failure-actions>Failure Actions</h3> <div class=highlight><pre><span></span><code><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
<a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a>â”‚         PARKER HEARTBEAT MISSING FAILURE CASCADE                 â”‚
<a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
<a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a>
<a id=__codelineno-21-5 name=__codelineno-21-5 href=#__codelineno-21-5></a>Stage 1: Heartbeat Miss Detected
<a id=__codelineno-21-6 name=__codelineno-21-6 href=#__codelineno-21-6></a>  â””â”€â”€ QtCarServer detects no Parker heartbeat
<a id=__codelineno-21-7 name=__codelineno-21-7 href=#__codelineno-21-7></a>  â””â”€â”€ Internal retry/grace period (unknown duration)
<a id=__codelineno-21-8 name=__codelineno-21-8 href=#__codelineno-21-8></a>
<a id=__codelineno-21-9 name=__codelineno-21-9 href=#__codelineno-21-9></a>Stage 2: ParkerHeartbeatMissing Alert
<a id=__codelineno-21-10 name=__codelineno-21-10 href=#__codelineno-21-10></a>  â””â”€â”€ Alert triggered to driver
<a id=__codelineno-21-11 name=__codelineno-21-11 href=#__codelineno-21-11></a>  â””â”€â”€ Likely displayed on UI: &quot;Autopilot unavailable&quot;
<a id=__codelineno-21-12 name=__codelineno-21-12 href=#__codelineno-21-12></a>  â””â”€â”€ Autopilot features disabled
<a id=__codelineno-21-13 name=__codelineno-21-13 href=#__codelineno-21-13></a>
<a id=__codelineno-21-14 name=__codelineno-21-14 href=#__codelineno-21-14></a>Stage 3: HeartbeatMissingStopped State
<a id=__codelineno-21-15 name=__codelineno-21-15 href=#__codelineno-21-15></a>  â””â”€â”€ Transition to stopped/failed state
<a id=__codelineno-21-16 name=__codelineno-21-16 href=#__codelineno-21-16></a>  â””â”€â”€ Vehicle may limit speed or functionality
<a id=__codelineno-21-17 name=__codelineno-21-17 href=#__codelineno-21-17></a>  â””â”€â”€ Emergency Lane Keep MAY activate
<a id=__codelineno-21-18 name=__codelineno-21-18 href=#__codelineno-21-18></a>
<a id=__codelineno-21-19 name=__codelineno-21-19 href=#__codelineno-21-19></a>Stage 4: Emergency Procedures
<a id=__codelineno-21-20 name=__codelineno-21-20 href=#__codelineno-21-20></a>  â””â”€â”€ If in active Autopilot â†’ Emergency Lane Keep
<a id=__codelineno-21-21 name=__codelineno-21-21 href=#__codelineno-21-21></a>  â””â”€â”€ If parked â†’ No driving allowed until resolved
<a id=__codelineno-21-22 name=__codelineno-21-22 href=#__codelineno-21-22></a>  â””â”€â”€ Service required
</code></pre></div> <h3 id=ape-watchdog>APE Watchdog</h3> <p><strong>Source:</strong> sx-updater strings <div class=highlight><pre><span></span><code><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a>ape_watchdog_error
<a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a>ape-watchdog
<a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a>install status=shutting_down_ape_watchdog
</code></pre></div></p> <p><strong>During Updates:</strong> 1. sx-updater shuts down APE watchdog 2. Prevents premature reboot during autopilot firmware update 3. Watchdog restarted after successful install</p> <h3 id=parker-boot>Parker Boot</h3> <p><strong>Source:</strong> sx-updater strings <div class=highlight><pre><span></span><code><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a>parker-boot
<a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a>parker-boot argv[1] %d
<a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a>update_parker_recovery
</code></pre></div></p> <p><strong>Parker Recovery Mode:</strong> Used during firmware updates or failure recovery</p> <hr> <h2 id=7-emergency-lane-keep-integration>7. Emergency Lane Keep Integration</h2> <h3 id=data-value>Data Value</h3> <p><strong>Source:</strong> QtCarVehicle binary symbols</p> <p><strong>GUI Data Value:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a>GUI_lssEmergencyLaneKeepEnabled
</code></pre></div></p> <p><strong>C++ Class:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=n>LssEmergencyLaneKeepTypeDataValue</span>
<a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a><span class=n>LssEmergencyLaneKeepTypeNameMap</span>
</code></pre></div></p> <p><strong>Methods:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class=n>LssEmergencyLaneKeepTypeDataValue</span><span class=o>::</span><span class=n>broadcastChange</span><span class=p>()</span>
<a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a><span class=n>LssEmergencyLaneKeepTypeDataValue</span><span class=o>::</span><span class=n>toString</span><span class=p>()</span>
<a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a><span class=n>LssEmergencyLaneKeepTypeDataValue</span><span class=o>::</span><span class=n>metaObject</span><span class=p>()</span>
</code></pre></div></p> <h3 id=lss-system>LSS System</h3> <p><strong>LSS</strong> = Lane-keeping Support System</p> <p><strong>Purpose:</strong> Detect lane drift and apply corrective steering</p> <p><strong>Emergency Mode:</strong> Activated when Parker heartbeat is lost during active Autopilot</p> <h3 id=trigger-conditions>Trigger Conditions</h3> <div class=highlight><pre><span></span><code><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a>IF Parker heartbeat missing
<a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a>  AND Vehicle speed &gt; threshold (likely 30+ mph)
<a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a>  AND Autopilot was active
<a id=__codelineno-27-4 name=__codelineno-27-4 href=#__codelineno-27-4></a>  AND Lane lines detected
<a id=__codelineno-27-5 name=__codelineno-27-5 href=#__codelineno-27-5></a>THEN
<a id=__codelineno-27-6 name=__codelineno-27-6 href=#__codelineno-27-6></a>  Activate GUI_lssEmergencyLaneKeepEnabled = true
<a id=__codelineno-27-7 name=__codelineno-27-7 href=#__codelineno-27-7></a>  Apply emergency steering to keep in lane
<a id=__codelineno-27-8 name=__codelineno-27-8 href=#__codelineno-27-8></a>  Display alert to driver
<a id=__codelineno-27-9 name=__codelineno-27-9 href=#__codelineno-27-9></a>  Gradually reduce speed
</code></pre></div> <h3 id=safety-implications>Safety Implications</h3> <p><strong>Design Goal:</strong> Prevent crashes if Autopilot ECU fails during highway driving</p> <p><strong>Mechanism:</strong> 1. Camera/vision system still functional (separate from Parker) 2. MCU can process lane line detection independently 3. Emergency Lane Keep uses simpler control logic 4. Allows driver time to regain manual control 5. Does NOT provide full Autopilot functionality</p> <p><strong>Limitations:</strong> - No object detection - No adaptive cruise control - No lane change capability - Simple lane centering only</p> <hr> <h2 id=8-failsafe-state-machine>8. Failsafe State Machine</h2> <h3 id=state-transitions>State Transitions</h3> <div class=highlight><pre><span></span><code><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
<a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a>â”‚              GATEWAY HEARTBEAT FAILSAFE STATE MACHINE            â”‚
<a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
<a id=__codelineno-28-4 name=__codelineno-28-4 href=#__codelineno-28-4></a>
<a id=__codelineno-28-5 name=__codelineno-28-5 href=#__codelineno-28-5></a>[NORMAL_OPERATION]
<a id=__codelineno-28-6 name=__codelineno-28-6 href=#__codelineno-28-6></a>  â”‚
<a id=__codelineno-28-7 name=__codelineno-28-7 href=#__codelineno-28-7></a>  â”œâ”€ gwmon sends heartbeat â†’ Gateway
<a id=__codelineno-28-8 name=__codelineno-28-8 href=#__codelineno-28-8></a>  â”œâ”€ Gateway responds normally
<a id=__codelineno-28-9 name=__codelineno-28-9 href=#__codelineno-28-9></a>  â”œâ”€ gateway status=success
<a id=__codelineno-28-10 name=__codelineno-28-10 href=#__codelineno-28-10></a>  â””â”€ Loop every ~1-5 seconds
<a id=__codelineno-28-11 name=__codelineno-28-11 href=#__codelineno-28-11></a>      â”‚
<a id=__codelineno-28-12 name=__codelineno-28-12 href=#__codelineno-28-12></a>      â–¼
<a id=__codelineno-28-13 name=__codelineno-28-13 href=#__codelineno-28-13></a>  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
<a id=__codelineno-28-14 name=__codelineno-28-14 href=#__codelineno-28-14></a>  â”‚  Gateway stops responding           â”‚
<a id=__codelineno-28-15 name=__codelineno-28-15 href=#__codelineno-28-15></a>  â”‚  (CAN flood, crash, power loss)     â”‚
<a id=__codelineno-28-16 name=__codelineno-28-16 href=#__codelineno-28-16></a>  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
<a id=__codelineno-28-17 name=__codelineno-28-17 href=#__codelineno-28-17></a>      â”‚
<a id=__codelineno-28-18 name=__codelineno-28-18 href=#__codelineno-28-18></a>      â–¼
<a id=__codelineno-28-19 name=__codelineno-28-19 href=#__codelineno-28-19></a>[HEARTBEAT_TIMEOUT_PENDING]
<a id=__codelineno-28-20 name=__codelineno-28-20 href=#__codelineno-28-20></a>  â”‚
<a id=__codelineno-28-21 name=__codelineno-28-21 href=#__codelineno-28-21></a>  â”œâ”€ gwmon timeout counter increments
<a id=__codelineno-28-22 name=__codelineno-28-22 href=#__codelineno-28-22></a>  â”œâ”€ Retry heartbeat attempts (N times)
<a id=__codelineno-28-23 name=__codelineno-28-23 href=#__codelineno-28-23></a>  â””â”€ Threshold: ~10-30 seconds (estimated)
<a id=__codelineno-28-24 name=__codelineno-28-24 href=#__codelineno-28-24></a>      â”‚
<a id=__codelineno-28-25 name=__codelineno-28-25 href=#__codelineno-28-25></a>      â–¼
<a id=__codelineno-28-26 name=__codelineno-28-26 href=#__codelineno-28-26></a>[GATEWAY_FAILURE_DETECTED]
<a id=__codelineno-28-27 name=__codelineno-28-27 href=#__codelineno-28-27></a>  â”‚
<a id=__codelineno-28-28 name=__codelineno-28-28 href=#__codelineno-28-28></a>  â”œâ”€ gateway status=failure
<a id=__codelineno-28-29 name=__codelineno-28-29 href=#__codelineno-28-29></a>  â”œâ”€ gateway_needs_update = true
<a id=__codelineno-28-30 name=__codelineno-28-30 href=#__codelineno-28-30></a>  â””â”€ Trigger emergency_session
<a id=__codelineno-28-31 name=__codelineno-28-31 href=#__codelineno-28-31></a>      â”‚
<a id=__codelineno-28-32 name=__codelineno-28-32 href=#__codelineno-28-32></a>      â–¼
<a id=__codelineno-28-33 name=__codelineno-28-33 href=#__codelineno-28-33></a>[EMERGENCY_SESSION_ACTIVE]
<a id=__codelineno-28-34 name=__codelineno-28-34 href=#__codelineno-28-34></a>  â”‚
<a id=__codelineno-28-35 name=__codelineno-28-35 href=#__codelineno-28-35></a>  â”œâ”€ sx-updater enters emergency mode
<a id=__codelineno-28-36 name=__codelineno-28-36 href=#__codelineno-28-36></a>  â”œâ”€ Port 25956 opens on localhost + eth0
<a id=__codelineno-28-37 name=__codelineno-28-37 href=#__codelineno-28-37></a>  â”œâ”€ Syncterm becomes available
<a id=__codelineno-28-38 name=__codelineno-28-38 href=#__codelineno-28-38></a>  â””â”€ in-syncterm status=true
<a id=__codelineno-28-39 name=__codelineno-28-39 href=#__codelineno-28-39></a>      â”‚
<a id=__codelineno-28-40 name=__codelineno-28-40 href=#__codelineno-28-40></a>      â–¼
<a id=__codelineno-28-41 name=__codelineno-28-41 href=#__codelineno-28-41></a>[UPDATER_SHELL_ACCESSIBLE]
<a id=__codelineno-28-42 name=__codelineno-28-42 href=#__codelineno-28-42></a>  â”‚
<a id=__codelineno-28-43 name=__codelineno-28-43 href=#__codelineno-28-43></a>  â”œâ”€ Attacker can connect: nc 192.168.90.100:25956
<a id=__codelineno-28-44 name=__codelineno-28-44 href=#__codelineno-28-44></a>  â”œâ”€ Attacker can trigger: http://localhost:20564/syncterm
<a id=__codelineno-28-45 name=__codelineno-28-45 href=#__codelineno-28-45></a>  â”œâ”€ Firmware can be pushed
<a id=__codelineno-28-46 name=__codelineno-28-46 href=#__codelineno-28-46></a>  â””â”€ Config can be modified
<a id=__codelineno-28-47 name=__codelineno-28-47 href=#__codelineno-28-47></a>      â”‚
<a id=__codelineno-28-48 name=__codelineno-28-48 href=#__codelineno-28-48></a>      â–¼
<a id=__codelineno-28-49 name=__codelineno-28-49 href=#__codelineno-28-49></a>[RECOVERY_OR_EXPLOIT]
<a id=__codelineno-28-50 name=__codelineno-28-50 href=#__codelineno-28-50></a>  â”‚
<a id=__codelineno-28-51 name=__codelineno-28-51 href=#__codelineno-28-51></a>  â”œâ”€ Legitimate: Gateway firmware updated
<a id=__codelineno-28-52 name=__codelineno-28-52 href=#__codelineno-28-52></a>  â”œâ”€ Malicious: Backdoor installed
<a id=__codelineno-28-53 name=__codelineno-28-53 href=#__codelineno-28-53></a>  â””â”€ Return to NORMAL_OPERATION or PERSISTENT_COMPROMISE
</code></pre></div> <h3 id=mobile-app-heartbeat>Mobile App Heartbeat</h3> <p><strong>Source:</strong> QtCarServer strings <div class=highlight><pre><span></span><code><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a>mobile_app_heartbeat_timeout
<a id=__codelineno-29-2 name=__codelineno-29-2 href=#__codelineno-29-2></a>controller_heartbeat_timeout
</code></pre></div></p> <p><strong>Purpose:</strong> Detect if Tesla mobile app connection is lost</p> <p><strong>Likely Timeout:</strong> 30-120 seconds (allows for network hiccups)</p> <p><strong>Action on Timeout:</strong> - Revoke mobile app access tokens - Disable remote commands (Climate, Summon, etc.) - Require re-authentication</p> <hr> <h2 id=9-sd-card-format-port-opening-sequence>9. SD Card Format â†’ Port Opening Sequence</h2> <h3 id=overview_1>Overview</h3> <p>The SD card format attack exploits Gateway's update mechanism by triggering a "virgin" provisioning state, causing port opening for TFTP-based firmware delivery.</p> <h3 id=attack-trigger>Attack Trigger</h3> <p><strong>CAN Message Sequence:</strong></p> <table> <thead> <tr> <th>CAN ID</th> <th>Decimal</th> <th>Hex Data</th> <th>Purpose</th> <th>Rate</th> </tr> </thead> <tbody> <tr> <td>0x3C2</td> <td>962</td> <td><code>49 65 00 00 00 00 00 00</code></td> <td>Diagnostic trigger</td> <td><strong>10,000 msg/sec</strong> (0.1ms)</td> </tr> <tr> <td>0x622</td> <td>1570</td> <td><code>02 11 01 00 00 00 00 00</code></td> <td>UDS Tester Present</td> <td>~33 msg/sec (30ms)</td> </tr> </tbody> </table> <p><strong>Source:</strong> 02-gateway-can-flood-exploit.md</p> <h3 id=gateway-overwhelm-mechanism>Gateway Overwhelm Mechanism</h3> <p><strong>Effect of 10k msg/sec CAN flood:</strong></p> <ol> <li><strong>Gateway CPU Saturation:</strong></li> <li>Message processing consumes 100% CPU</li> <li>CAN ID 0x3C2 requires processing on every message</li> <li> <p>Gateway cannot service other requests</p> </li> <li> <p><strong>Heartbeat Failure:</strong></p> </li> <li>gwmon sends heartbeat request</li> <li>Gateway too busy to respond</li> <li> <p>gwmon timeout triggers after N seconds</p> </li> <li> <p><strong>Emergency Mode:</strong></p> </li> <li>gateway status=failure</li> <li>emergency_session activated</li> <li>Port 25956 opens</li> </ol> <h3 id=timing-analysis>Timing Analysis</h3> <p><strong>From Gateway SD-card log (_docx_1711.txt):</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a>Timeline of Gateway Update (from format trigger to reboot):
<a id=__codelineno-30-2 name=__codelineno-30-2 href=#__codelineno-30-2></a>
<a id=__codelineno-30-3 name=__codelineno-30-3 href=#__codelineno-30-3></a>11:15:45.046 - UpdT0 Spawn Update Task &quot;UpdT0&quot; (INITIAL TRIGGER)
<a id=__codelineno-30-4 name=__codelineno-30-4 href=#__codelineno-30-4></a>11:15:45.679 - Config values read (devSecurityLevel=3, autopilot=4, etc.)
<a id=__codelineno-30-5 name=__codelineno-30-5 href=#__codelineno-30-5></a>11:15:45.708 - First TFTP transfer begins (cbreaker.map)
<a id=__codelineno-30-6 name=__codelineno-30-6 href=#__codelineno-30-6></a>11:15:47.014 - Two-pass update, beginning HWIDAcq phase
<a id=__codelineno-30-7 name=__codelineno-30-7 href=#__codelineno-30-7></a>11:15:48.221 - VC/EPB Entered OTA state, 500 msec
<a id=__codelineno-30-8 name=__codelineno-30-8 href=#__codelineno-30-8></a>11:15:55.092 - Begin hwidacq for gtw3 [12], attempt #1
<a id=__codelineno-30-9 name=__codelineno-30-9 href=#__codelineno-30-9></a>11:17:02.462 - Queuing gtw3 [12] for update
<a id=__codelineno-30-10 name=__codelineno-30-10 href=#__codelineno-30-10></a>11:38:44.132 - Update completed [0000]
<a id=__codelineno-30-11 name=__codelineno-30-11 href=#__codelineno-30-11></a>11:38:44.142 - Rebooting ...
<a id=__codelineno-30-12 name=__codelineno-30-12 href=#__codelineno-30-12></a>
<a id=__codelineno-30-13 name=__codelineno-30-13 href=#__codelineno-30-13></a>TOTAL DURATION: ~23 minutes
<a id=__codelineno-30-14 name=__codelineno-30-14 href=#__codelineno-30-14></a>TFTP PHASE: First 5 minutes (21 files transferred)
<a id=__codelineno-30-15 name=__codelineno-30-15 href=#__codelineno-30-15></a>UPDATE INSTALL: ~21 minutes
</code></pre></div> <h3 id=port-opening-sequence-detail>Port Opening Sequence Detail</h3> <div class=highlight><pre><span></span><code><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
<a id=__codelineno-31-2 name=__codelineno-31-2 href=#__codelineno-31-2></a>â”‚           SD CARD FORMAT â†’ PORT OPENING SEQUENCE                 â”‚
<a id=__codelineno-31-3 name=__codelineno-31-3 href=#__codelineno-31-3></a>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
<a id=__codelineno-31-4 name=__codelineno-31-4 href=#__codelineno-31-4></a>
<a id=__codelineno-31-5 name=__codelineno-31-5 href=#__codelineno-31-5></a>T+0 seconds: CAN Flood Starts
<a id=__codelineno-31-6 name=__codelineno-31-6 href=#__codelineno-31-6></a>  â””â”€ 0x3C2 @ 10k msg/sec
<a id=__codelineno-31-7 name=__codelineno-31-7 href=#__codelineno-31-7></a>  â””â”€ 0x622 @ 33 msg/sec
<a id=__codelineno-31-8 name=__codelineno-31-8 href=#__codelineno-31-8></a>  â””â”€ Gateway CPU saturated
<a id=__codelineno-31-9 name=__codelineno-31-9 href=#__codelineno-31-9></a>
<a id=__codelineno-31-10 name=__codelineno-31-10 href=#__codelineno-31-10></a>T+10-30 seconds: gwmon Timeout
<a id=__codelineno-31-11 name=__codelineno-31-11 href=#__codelineno-31-11></a>  â””â”€ No heartbeat response
<a id=__codelineno-31-12 name=__codelineno-31-12 href=#__codelineno-31-12></a>  â””â”€ gateway status=failure
<a id=__codelineno-31-13 name=__codelineno-31-13 href=#__codelineno-31-13></a>  â””â”€ emergency_session triggered
<a id=__codelineno-31-14 name=__codelineno-31-14 href=#__codelineno-31-14></a>
<a id=__codelineno-31-15 name=__codelineno-31-15 href=#__codelineno-31-15></a>T+30-45 seconds: sx-updater Emergency Mode
<a id=__codelineno-31-16 name=__codelineno-31-16 href=#__codelineno-31-16></a>  â””â”€ emergency_session activates
<a id=__codelineno-31-17 name=__codelineno-31-17 href=#__codelineno-31-17></a>  â””â”€ Port 25956 opens
<a id=__codelineno-31-18 name=__codelineno-31-18 href=#__codelineno-31-18></a>  â””â”€ Syncterm available
<a id=__codelineno-31-19 name=__codelineno-31-19 href=#__codelineno-31-19></a>
<a id=__codelineno-31-20 name=__codelineno-31-20 href=#__codelineno-31-20></a>T+45-60 seconds: Attacker Connection Window
<a id=__codelineno-31-21 name=__codelineno-31-21 href=#__codelineno-31-21></a>  â””â”€ nc 192.168.90.100:25956
<a id=__codelineno-31-22 name=__codelineno-31-22 href=#__codelineno-31-22></a>  â””â”€ Updater shell accessible
<a id=__codelineno-31-23 name=__codelineno-31-23 href=#__codelineno-31-23></a>  â””â”€ Commands accepted
<a id=__codelineno-31-24 name=__codelineno-31-24 href=#__codelineno-31-24></a>
<a id=__codelineno-31-25 name=__codelineno-31-25 href=#__codelineno-31-25></a>T+60+ seconds: Exploitation
<a id=__codelineno-31-26 name=__codelineno-31-26 href=#__codelineno-31-26></a>  â””â”€ Firmware push
<a id=__codelineno-31-27 name=__codelineno-31-27 href=#__codelineno-31-27></a>  â””â”€ Certificate injection
<a id=__codelineno-31-28 name=__codelineno-31-28 href=#__codelineno-31-28></a>  â””â”€ Config modification
</code></pre></div> <h3 id=port-25956-shell-capabilities>Port 25956 Shell Capabilities</h3> <p><strong>From attack documentation:</strong></p> <p>Available Commands: - <code>help</code> - List available commands - <code>set_handshake &lt;host&gt; &lt;port&gt;</code> - Configure firmware server - <code>install &lt;url&gt;</code> - Install firmware from URL - <code>status</code> - Check current status - <strong>Unknown:</strong> Full command set not documented</p> <p><strong>Shell Privilege Level:</strong> - Runs as updater user (elevated, not root) - AppArmor profile restricts some operations - Has access to: - <code>/var/spool/</code> (staging firmware) - Firmware installation routines - <strong>Possibly:</strong> D-Bus for system commands</p> <h3 id=can-message-timing-requirements>CAN Message Timing Requirements</h3> <p><strong>Critical Timing Parameters:</strong></p> <table> <thead> <tr> <th>Parameter</th> <th>Value</th> <th>Tolerance</th> <th>Notes</th> </tr> </thead> <tbody> <tr> <td>0x3C2 interval</td> <td><strong>0.1 ms</strong></td> <td>Â±0.05 ms</td> <td>Too slow = ineffective</td> </tr> <tr> <td>0x3C2 rate</td> <td><strong>10,000/sec</strong></td> <td>Â±1000</td> <td>Must saturate Gateway</td> </tr> <tr> <td>0x622 interval</td> <td><strong>30 ms</strong></td> <td>Â±10 ms</td> <td>UDS keepalive</td> </tr> <tr> <td>Duration</td> <td><strong>10-30 sec</strong></td> <td>N/A</td> <td>Until port opens</td> </tr> <tr> <td>Simultaneous</td> <td><strong>REQUIRED</strong></td> <td>N/A</td> <td>Both messages together</td> </tr> </tbody> </table> <p><strong>Hardware Requirements:</strong> - PCAN USB or similar CAN adapter - Linux <code>python-can</code> library - Stable 0.1ms timing (requires dedicated CAN hardware)</p> <p><strong>Failure Modes:</strong> - Too slow â†’ Gateway keeps up, no crash - Single message only â†’ Gateway filters it - Interrupted flood â†’ Gateway recovers - Wrong CAN IDs â†’ No effect</p> <h3 id=tftp-server-requirement>TFTP Server Requirement</h3> <p><strong>Once Gateway enters update mode, it expects TFTP server:</strong></p> <p><strong>Source:</strong> Gateway log analysis</p> <p>TFTP Transfers: <div class=highlight><pre><span></span><code><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a>gtw3/192/cbreaker.map â†’ cbreaker.map
<a id=__codelineno-32-2 name=__codelineno-32-2 href=#__codelineno-32-2></a>signed_metadata_map.tsv â†’ map.tsv
<a id=__codelineno-32-3 name=__codelineno-32-3 href=#__codelineno-32-3></a>gtw3/191/gwapp.img â†’ 000c (Gateway application)
<a id=__codelineno-32-4 name=__codelineno-32-4 href=#__codelineno-32-4></a>vcleft/303/VCLEFT_*.bhx â†’ 0010
<a id=__codelineno-32-5 name=__codelineno-32-5 href=#__codelineno-32-5></a>vcright/302/VCRIGHT_*.bhx â†’ 001a
<a id=__codelineno-32-6 name=__codelineno-32-6 href=#__codelineno-32-6></a>... (21 total files)
</code></pre></div></p> <p><strong>TFTP Server IP:</strong> Likely <code>192.168.90.100</code> (MCU or external attacker laptop)</p> <p><strong>File Structure:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a>/tftpboot/
<a id=__codelineno-33-2 name=__codelineno-33-2 href=#__codelineno-33-2></a>â”œâ”€â”€ gtw3/
<a id=__codelineno-33-3 name=__codelineno-33-3 href=#__codelineno-33-3></a>â”‚   â”œâ”€â”€ 191/gwapp.img
<a id=__codelineno-33-4 name=__codelineno-33-4 href=#__codelineno-33-4></a>â”‚   â””â”€â”€ 192/cbreaker.map
<a id=__codelineno-33-5 name=__codelineno-33-5 href=#__codelineno-33-5></a>â”œâ”€â”€ vcleft/303/
<a id=__codelineno-33-6 name=__codelineno-33-6 href=#__codelineno-33-6></a>â”œâ”€â”€ vcright/302/
<a id=__codelineno-33-7 name=__codelineno-33-7 href=#__codelineno-33-7></a>â”œâ”€â”€ hvbms/7241/
<a id=__codelineno-33-8 name=__codelineno-33-8 href=#__codelineno-33-8></a>â””â”€â”€ signed_metadata_map.tsv
</code></pre></div></p> <p><strong>Security Note:</strong> TFTP has NO authentication. Anyone on network can serve files.</p> <h3 id=config-id-15-devsecuritylevel>Config ID 15 (devSecurityLevel)</h3> <p><strong>From Gateway log:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a>id=15 name=devSecurityLevel len=1 last_value=3
</code></pre></div></p> <p><strong>Values:</strong> - <code>1</code> = Factory (unsigned firmware allowed) - <code>2</code> = Development (partial signature checks) - <code>3</code> = Production (full signature verification)</p> <p><strong>Attack Implication:</strong> - If devSecurityLevel can be downgraded to <code>1</code> or <code>2</code> - Unsigned/modified firmware may be accepted - <strong>Method:</strong> Use UDPAPI to write config ID 15</p> <hr> <h2 id=10-attack-vector-cross-reference>10. Attack Vector Cross-Reference</h2> <h3 id=can-flood-port-25956-firmwarecerts>CAN Flood â†’ Port 25956 â†’ Firmware/Certs</h3> <p><strong>Full Chain (from 02-gateway-can-flood-exploit.md + this analysis):</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-35-1 name=__codelineno-35-1 href=#__codelineno-35-1></a>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
<a id=__codelineno-35-2 name=__codelineno-35-2 href=#__codelineno-35-2></a>â”‚     COMPLETE ATTACK CHAIN WITH TIMING                            â”‚
<a id=__codelineno-35-3 name=__codelineno-35-3 href=#__codelineno-35-3></a>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
<a id=__codelineno-35-4 name=__codelineno-35-4 href=#__codelineno-35-4></a>
<a id=__codelineno-35-5 name=__codelineno-35-5 href=#__codelineno-35-5></a>Prerequisites:
<a id=__codelineno-35-6 name=__codelineno-35-6 href=#__codelineno-35-6></a>  - Physical access to OBD-II port
<a id=__codelineno-35-7 name=__codelineno-35-7 href=#__codelineno-35-7></a>  - PCAN USB adapter or similar
<a id=__codelineno-35-8 name=__codelineno-35-8 href=#__codelineno-35-8></a>  - Ethernet connection to 192.168.90.x network
<a id=__codelineno-35-9 name=__codelineno-35-9 href=#__codelineno-35-9></a>  - CAN flooding script (openportlanpluscan.py)
<a id=__codelineno-35-10 name=__codelineno-35-10 href=#__codelineno-35-10></a>
<a id=__codelineno-35-11 name=__codelineno-35-11 href=#__codelineno-35-11></a>PHASE 1: CAN FLOODING (0-30 seconds)
<a id=__codelineno-35-12 name=__codelineno-35-12 href=#__codelineno-35-12></a>  T+0s   Connect PCAN to OBD-II
<a id=__codelineno-35-13 name=__codelineno-35-13 href=#__codelineno-35-13></a>  T+0s   Start CAN flood script
<a id=__codelineno-35-14 name=__codelineno-35-14 href=#__codelineno-35-14></a>  T+0s   â†’ 0x3C2 @ 10,000 msg/sec
<a id=__codelineno-35-15 name=__codelineno-35-15 href=#__codelineno-35-15></a>  T+0s   â†’ 0x622 @ 33 msg/sec
<a id=__codelineno-35-16 name=__codelineno-35-16 href=#__codelineno-35-16></a>  T+10s  Gateway CPU at 100%
<a id=__codelineno-35-17 name=__codelineno-35-17 href=#__codelineno-35-17></a>  T+15s  gwmon timeout begins
<a id=__codelineno-35-18 name=__codelineno-35-18 href=#__codelineno-35-18></a>  T+30s  gateway status=failure
<a id=__codelineno-35-19 name=__codelineno-35-19 href=#__codelineno-35-19></a>
<a id=__codelineno-35-20 name=__codelineno-35-20 href=#__codelineno-35-20></a>PHASE 2: EMERGENCY MODE (30-60 seconds)
<a id=__codelineno-35-21 name=__codelineno-35-21 href=#__codelineno-35-21></a>  T+30s  emergency_session activates
<a id=__codelineno-35-22 name=__codelineno-35-22 href=#__codelineno-35-22></a>  T+35s  Port 25956 opens
<a id=__codelineno-35-23 name=__codelineno-35-23 href=#__codelineno-35-23></a>  T+40s  Syncterm available
<a id=__codelineno-35-24 name=__codelineno-35-24 href=#__codelineno-35-24></a>  T+45s  Test: nc 192.168.90.100:25956
<a id=__codelineno-35-25 name=__codelineno-35-25 href=#__codelineno-35-25></a>  T+50s  Connection established
<a id=__codelineno-35-26 name=__codelineno-35-26 href=#__codelineno-35-26></a>
<a id=__codelineno-35-27 name=__codelineno-35-27 href=#__codelineno-35-27></a>PHASE 3: EXPLOITATION (60+ seconds)
<a id=__codelineno-35-28 name=__codelineno-35-28 href=#__codelineno-35-28></a>  T+60s  Option A: Firmware push via set_handshake
<a id=__codelineno-35-29 name=__codelineno-35-29 href=#__codelineno-35-29></a>  T+60s  Option B: Certificate injection to /var/lib/car_creds/
<a id=__codelineno-35-30 name=__codelineno-35-30 href=#__codelineno-35-30></a>  T+60s  Option C: Config modification via shell
<a id=__codelineno-35-31 name=__codelineno-35-31 href=#__codelineno-35-31></a>  T+300s Firmware staged, ready to install
<a id=__codelineno-35-32 name=__codelineno-35-32 href=#__codelineno-35-32></a>  T+600s Installation completes
<a id=__codelineno-35-33 name=__codelineno-35-33 href=#__codelineno-35-33></a>  T+650s Gateway reboots with backdoor
<a id=__codelineno-35-34 name=__codelineno-35-34 href=#__codelineno-35-34></a>
<a id=__codelineno-35-35 name=__codelineno-35-35 href=#__codelineno-35-35></a>PHASE 4: PERSISTENCE
<a id=__codelineno-35-36 name=__codelineno-35-36 href=#__codelineno-35-36></a>  â””â”€ Modified firmware survives reboots
<a id=__codelineno-35-37 name=__codelineno-35-37 href=#__codelineno-35-37></a>  â””â”€ Injected certificates enable cloud access
<a id=__codelineno-35-38 name=__codelineno-35-38 href=#__codelineno-35-38></a>  â””â”€ Backdoor accessible via network
</code></pre></div> <h3 id=heartbeat-attack-matrix>Heartbeat Attack Matrix</h3> <table> <thead> <tr> <th>Heartbeat System</th> <th>Timeout</th> <th>Trigger Method</th> <th>Consequence</th> <th>Difficulty</th> </tr> </thead> <tbody> <tr> <td><strong>Kernel Watchdog</strong></td> <td>9 sec</td> <td>CPU lockup</td> <td>System reboot</td> <td>Very Hard</td> </tr> <tr> <td><strong>Gateway (gwmon)</strong></td> <td>~15-30 sec</td> <td>CAN flood</td> <td>Port 25956 opens</td> <td><strong>MEDIUM</strong></td> </tr> <tr> <td><strong>Chromium Adapter</strong></td> <td>~5-15 sec</td> <td>Kill UI process</td> <td>UI restart</td> <td>Medium</td> </tr> <tr> <td><strong>Vohico</strong></td> <td>~2-10 sec</td> <td>ECU bus jam</td> <td>Vehicle safe mode</td> <td>Hard</td> </tr> <tr> <td><strong>Parker (APE)</strong></td> <td>~10-30 sec</td> <td>Network disconnect</td> <td>Autopilot disabled</td> <td>Medium</td> </tr> <tr> <td><strong>Mobile App</strong></td> <td>~60-120 sec</td> <td>Disconnect WiFi</td> <td>Remote access revoked</td> <td>Easy</td> </tr> </tbody> </table> <p><strong>Most Exploitable:</strong> Gateway (gwmon) heartbeat via CAN flood</p> <h3 id=emergency-lane-keep-attack-scenario>Emergency Lane Keep Attack Scenario</h3> <p><strong>Hypothetical Malicious Use:</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-36-1 name=__codelineno-36-1 href=#__codelineno-36-1></a>IF Attacker can trigger Parker heartbeat failure
<a id=__codelineno-36-2 name=__codelineno-36-2 href=#__codelineno-36-2></a>  AND Vehicle is on highway with Autopilot active
<a id=__codelineno-36-3 name=__codelineno-36-3 href=#__codelineno-36-3></a>THEN
<a id=__codelineno-36-4 name=__codelineno-36-4 href=#__codelineno-36-4></a>  Emergency Lane Keep activates
<a id=__codelineno-36-5 name=__codelineno-36-5 href=#__codelineno-36-5></a>  Vehicle attempts to stay in lane
<a id=__codelineno-36-6 name=__codelineno-36-6 href=#__codelineno-36-6></a>  Driver may not realize Autopilot failed
<a id=__codelineno-36-7 name=__codelineno-36-7 href=#__codelineno-36-7></a>  â†’ Potential for accident if driver not attentive
</code></pre></div> <p><strong>Countermeasures:</strong> - Visual/audible alerts when Emergency Lane Keep activates - Steering wheel torque requirement to confirm driver control - Automatic speed reduction - Event logging for later analysis</p> <h3 id=parkerheartbeatmissing-alert-exploitation>ParkerHeartbeatMissing Alert Exploitation</h3> <p><strong>Attack Goal:</strong> Disable Autopilot remotely</p> <p><strong>Method 1: Network Jamming</strong> 1. Jam 192.168.90.103 (APE IP) 2. Parker heartbeat cannot reach MCU 3. Timeout triggers ParkerHeartbeatMissing 4. Autopilot disabled</p> <p><strong>Method 2: APE Crash</strong> 1. Exploit vulnerability in APE firmware 2. Crash APE process 3. Heartbeat stops 4. Autopilot disabled</p> <p><strong>Impact:</strong> - Driver loses Autopilot mid-drive - May cause confusion/panic - Emergency Lane Keep may or may not activate - Service alert displayed</p> <h3 id=failsafe-bypass-techniques>Failsafe Bypass Techniques</h3> <p><strong>For Security Researchers:</strong></p> <ol> <li><strong>Kernel Watchdog Bypass:</strong></li> <li>Config ID 61: <code>bmpWatchdogDisabled=1</code></li> <li>Prevents reboot during long operations</li> <li> <p><strong>Risk:</strong> System may hang permanently</p> </li> <li> <p><strong>Gateway Heartbeat Bypass:</strong></p> </li> <li>Disable gwmon service: <code>sv down gwmon</code></li> <li> <p><strong>Risk:</strong> No recovery if Gateway actually fails</p> </li> <li> <p><strong>Component Heartbeat Bypass:</strong></p> </li> <li>Modify D-Bus permissions to block heartbeat messages</li> <li><strong>Risk:</strong> Component failures go undetected</li> </ol> <p><strong>WARNING:</strong> Disabling watchdogs/heartbeats removes critical safety mechanisms. For research only on isolated systems.</p> <hr> <h2 id=appendix-a-extracted-timeout-constants>Appendix A: Extracted Timeout Constants</h2> <h3 id=known-values>Known Values</h3> <table> <thead> <tr> <th>Constant</th> <th>Value</th> <th>Source</th> <th>Certainty</th> </tr> </thead> <tbody> <tr> <td>kernel.watchdog_thresh</td> <td><strong>4 sec</strong></td> <td>/etc/sysctl.conf</td> <td>âœ… Confirmed</td> </tr> <tr> <td>Softlockup threshold</td> <td><strong>8 sec</strong></td> <td>Calculated (4Ã—2)</td> <td>âœ… Confirmed</td> </tr> <tr> <td>Userspace watchdog</td> <td><strong>9 sec</strong></td> <td>/etc/sv/watchdog/run</td> <td>âœ… Confirmed</td> </tr> <tr> <td>Watchdog pet rate</td> <td><strong>1 sec</strong></td> <td>/etc/sv/watchdog/run</td> <td>âœ… Confirmed</td> </tr> <tr> <td>CAN 0x3C2 interval</td> <td><strong>0.1 ms</strong></td> <td>Attack script</td> <td>âœ… Confirmed</td> </tr> <tr> <td>CAN 0x622 interval</td> <td><strong>30 ms</strong></td> <td>Attack script</td> <td>âœ… Confirmed</td> </tr> </tbody> </table> <h3 id=estimated-values-require-further-analysis>Estimated Values (Require Further Analysis)</h3> <table> <thead> <tr> <th>Constant</th> <th>Estimated Value</th> <th>Confidence</th> <th>Analysis Method Needed</th> </tr> </thead> <tbody> <tr> <td>gwmon timeout</td> <td>15-30 sec</td> <td>Medium</td> <td>Disassemble sx-updater</td> </tr> <tr> <td>Chromium heartbeat</td> <td>5-15 sec</td> <td>Low</td> <td>Disassemble QtCarServer</td> </tr> <tr> <td>Vohico heartbeat</td> <td>2-10 sec</td> <td>Low</td> <td>Disassemble QtCarServer</td> </tr> <tr> <td>Parker heartbeat</td> <td>10-30 sec</td> <td>Medium</td> <td>Disassemble QtCarServer + APE firmware</td> </tr> <tr> <td>Mobile app heartbeat</td> <td>60-120 sec</td> <td>Low</td> <td>Network traffic analysis</td> </tr> </tbody> </table> <h3 id=binary-analysis-recommendations>Binary Analysis Recommendations</h3> <p><strong>To extract exact timeout values:</strong></p> <ol> <li><strong>sx-updater (<code>/bin/sx-updater</code>):</strong></li> <li>Load in Ghidra/Binary Ninja</li> <li>Search for <code>gwmon timeout</code> string reference</li> <li>Trace to comparison instruction</li> <li> <p>Extract constant value</p> </li> <li> <p><strong>QtCarServer (<code>/usr/tesla/UI/bin/QtCarServer</code>):</strong></p> </li> <li>Search for heartbeat method symbols</li> <li>Find <code>QTimer</code> or <code>setTimeout</code> calls</li> <li> <p>Extract millisecond values</p> </li> <li> <p><strong>APE Firmware:</strong></p> </li> <li>Requires Parker ECU firmware extraction</li> <li>Search for heartbeat transmission code</li> <li>Identify interval timers</li> </ol> <hr> <h2 id=appendix-b-related-files>Appendix B: Related Files</h2> <h3 id=source-binaries>Source Binaries</h3> <div class=highlight><pre><span></span><code><a id=__codelineno-37-1 name=__codelineno-37-1 href=#__codelineno-37-1></a>/firmware/mcu2-extracted/
<a id=__codelineno-37-2 name=__codelineno-37-2 href=#__codelineno-37-2></a>â”œâ”€â”€ bin/sx-updater                      # Main updater, gwmon logic
<a id=__codelineno-37-3 name=__codelineno-37-3 href=#__codelineno-37-3></a>â”œâ”€â”€ usr/tesla/UI/bin/QtCarServer        # Heartbeat coordination
<a id=__codelineno-37-4 name=__codelineno-37-4 href=#__codelineno-37-4></a>â”œâ”€â”€ usr/tesla/UI/bin/QtCarVehicle       # Emergency Lane Keep
<a id=__codelineno-37-5 name=__codelineno-37-5 href=#__codelineno-37-5></a>â”œâ”€â”€ sbin/watchdog                       # Kernel watchdog daemon
<a id=__codelineno-37-6 name=__codelineno-37-6 href=#__codelineno-37-6></a>â””â”€â”€ etc/sv/watchdog/run                 # Watchdog startup script
</code></pre></div> <h3 id=configuration-files>Configuration Files</h3> <div class=highlight><pre><span></span><code><a id=__codelineno-38-1 name=__codelineno-38-1 href=#__codelineno-38-1></a>/firmware/mcu2-extracted/
<a id=__codelineno-38-2 name=__codelineno-38-2 href=#__codelineno-38-2></a>â”œâ”€â”€ etc/sysctl.conf                     # kernel.watchdog_thresh=4
<a id=__codelineno-38-3 name=__codelineno-38-3 href=#__codelineno-38-3></a>â”œâ”€â”€ etc/firewall.d/qtcar.iptables       # Port 25956 rule
<a id=__codelineno-38-4 name=__codelineno-38-4 href=#__codelineno-38-4></a>â””â”€â”€ etc/sv/sx-updater/run               # Updater service config
</code></pre></div> <h3 id=research-documents>Research Documents</h3> <div class=highlight><pre><span></span><code><a id=__codelineno-39-1 name=__codelineno-39-1 href=#__codelineno-39-1></a>/research/
<a id=__codelineno-39-2 name=__codelineno-39-2 href=#__codelineno-39-2></a>â”œâ”€â”€ 02-gateway-can-flood-exploit.md     # CAN attack details
<a id=__codelineno-39-3 name=__codelineno-39-3 href=#__codelineno-39-3></a>â”œâ”€â”€ 00-master-cross-reference.md        # System overview
<a id=__codelineno-39-4 name=__codelineno-39-4 href=#__codelineno-39-4></a>â”œâ”€â”€ 05-gap-analysis-missing-pieces.md   # Heartbeat discovery
<a id=__codelineno-39-5 name=__codelineno-39-5 href=#__codelineno-39-5></a>â””â”€â”€ 21-gateway-heartbeat-failsafe.md    # This document
</code></pre></div> <h3 id=attack-scripts>Attack Scripts</h3> <div class=highlight><pre><span></span><code><a id=__codelineno-40-1 name=__codelineno-40-1 href=#__codelineno-40-1></a>/research/scripts/
<a id=__codelineno-40-2 name=__codelineno-40-2 href=#__codelineno-40-2></a>â”œâ”€â”€ openportlanpluscan.py               # CAN flooding
<a id=__codelineno-40-3 name=__codelineno-40-3 href=#__codelineno-40-3></a>â”œâ”€â”€ gw.sh                               # Gateway UDPAPI tool
<a id=__codelineno-40-4 name=__codelineno-40-4 href=#__codelineno-40-4></a>â””â”€â”€ handshake/server.js                 # Firmware handshake server
</code></pre></div> <hr> <h2 id=appendix-c-gaps-remaining>Appendix C: Gaps Remaining</h2> <h3 id=priority-1-critical-unknowns>Priority 1: Critical Unknowns</h3> <ol> <li><strong>Exact gwmon timeout value</strong></li> <li>Currently estimated 15-30 seconds</li> <li>Need to disassemble sx-updater</li> <li> <p>Look for timeout comparison in <code>gwmon timeout</code> code path</p> </li> <li> <p><strong>Parker heartbeat protocol</strong></p> </li> <li>Message format unknown</li> <li>Transmission interval unknown</li> <li>Timeout threshold unknown</li> <li> <p>Requires APE firmware analysis</p> </li> <li> <p><strong>Emergency Lane Keep activation logic</strong></p> </li> <li>Conditions for triggering unknown</li> <li>Speed threshold unknown</li> <li>Lane detection requirements unknown</li> <li> <p>Requires QtCarVehicle disassembly</p> </li> <li> <p><strong>Port 25956 command set</strong></p> </li> <li>Only 4 commands documented (help, set_handshake, install, status)</li> <li>Full command list unknown</li> <li>Authentication mechanism unknown</li> <li>Privilege level unknown</li> </ol> <h3 id=priority-2-validation-needed>Priority 2: Validation Needed</h3> <ol> <li><strong>CAN flood reliability</strong></li> <li>Success rate unknown</li> <li>Vehicle generation differences unknown</li> <li>Gateway firmware version sensitivity unknown</li> <li> <p>Requires real-world testing</p> </li> <li> <p><strong>Chromium/Vohico heartbeat timeouts</strong></p> </li> <li>Currently estimated</li> <li>May vary by MCU version</li> <li> <p>Requires binary disassembly or network monitoring</p> </li> <li> <p><strong>Emergency session triggers</strong></p> </li> <li>Only gwmon timeout confirmed</li> <li>Other triggers may exist</li> <li>Requires comprehensive testing</li> </ol> <hr> <h2 id=document-metadata>Document Metadata</h2> <p><strong>Created:</strong> 2026-02-03<br> <strong>Author:</strong> Tesla Security Research<br> <strong>Firmware Version:</strong> MCU2 (Model S/X 2021-2023 era)<br> <strong>Status:</strong> Research document - gaps remain<br> <strong>Classification:</strong> Technical analysis for security research</p> <p><strong>Cross-References:</strong> - 02-gateway-can-flood-exploit.md - CAN attack methodology - 00-master-cross-reference.md - System architecture - 05-gap-analysis-missing-pieces.md - Initial heartbeat discovery - 09-gateway-sdcard-log-analysis.md - TFTP timing data</p> <p><strong>Sources:</strong> - <code>/firmware/mcu2-extracted/</code> - MCU2 firmware extraction - <code>/research/_docx_1711.txt</code> - Gateway SD-card log - Binary strings analysis (sx-updater, QtCarServer, QtCarVehicle) - Attack script analysis (openportlanpluscan.py)</p> <hr> <p><em>End of Document</em></p> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> </div> <div class=md-social> <a href=https://github.com/talas9/tesla-research target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"annotate": null, "base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.top", "toc.follow", "toc.integrate", "search.suggest", "search.highlight", "search.share", "content.code.copy", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../../assets/javascripts/bundle.79ae519e.min.js></script> </body> </html>