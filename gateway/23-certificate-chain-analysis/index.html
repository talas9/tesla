<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Comprehensive security analysis of Tesla Model S/X/3/Y MCU2 and Gateway"><meta name=author content="Security Researcher"><link href=https://talas9.github.io/tesla-research/gateway/23-certificate-chain-analysis/ rel=canonical><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.7.1"><title>Tesla Certificate Chain & Renewal Mechanism Analysis - Tesla MCU2 Security Research</title><link rel=stylesheet href=../../assets/stylesheets/main.484c7ddc.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../stylesheets/extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=red data-md-color-accent=red> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#tesla-certificate-chain-renewal-mechanism-analysis class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="Tesla MCU2 Security Research" class="md-header__button md-logo" aria-label="Tesla MCU2 Security Research" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Tesla MCU2 Security Research </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Tesla Certificate Chain &amp; Renewal Mechanism Analysis </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=red data-md-color-accent=red aria-label="Switch to light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=red data-md-color-accent=red aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/talas9/tesla-research title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> talas9/tesla-research </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../INDEX/ class=md-tabs__link> Complete Index </a> </li> <li class=md-tabs__item> <a href=../../core/00-master-cross-reference/ class=md-tabs__link> Core Research </a> </li> <li class=md-tabs__item> <a href=../81-gateway-secure-configs-CRITICAL/ class=md-tabs__link> Gateway Security </a> </li> <li class=md-tabs__item> <a href=../../mcu/24-mcu-architecture.md class=md-tabs__link> MCU Research </a> </li> <li class=md-tabs__item> <a href=../../evidence/59-EVIDENCE-AUDIT/ class=md-tabs__link> Evidence & Audit </a> </li> <li class=md-tabs__item> <a href=../../tools/56-tools-gateway-database-query.md class=md-tabs__link> Tools & Scripts </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="Tesla MCU2 Security Research" class="md-nav__button md-logo" aria-label="Tesla MCU2 Security Research" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> Tesla MCU2 Security Research </label> <div class=md-nav__source> <a href=https://github.com/talas9/tesla-research title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> talas9/tesla-research </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../../INDEX/ class=md-nav__link> <span class=md-ellipsis> Complete Index </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Core Research </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Core Research </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../core/00-master-cross-reference/ class=md-nav__link> <span class=md-ellipsis> Master Cross-Reference </span> </a> </li> <li class=md-nav__item> <a href=../../core/02-gateway-can-flood-exploit/ class=md-nav__link> <span class=md-ellipsis> Gateway CAN Flood Exploit </span> </a> </li> <li class=md-nav__item> <a href=../../core/03-certificate-recovery-orphan-cars/ class=md-nav__link> <span class=md-ellipsis> Certificate Recovery </span> </a> </li> <li class=md-nav__item> <a href=../../core/04-network-ports-firewall/ class=md-nav__link> <span class=md-ellipsis> Network Topology </span> </a> </li> <li class=md-nav__item> <a href=../../core/06-usb-firmware-update/ class=md-nav__link> <span class=md-ellipsis> USB Firmware Update </span> </a> </li> <li class=md-nav__item> <a href=../../core/07-usb-map-installation/ class=md-nav__link> <span class=md-ellipsis> USB Map Installation </span> </a> </li> <li class=md-nav__item> <a href=../../core/08-key-programming-vcsec/ class=md-nav__link> <span class=md-ellipsis> Key Programming </span> </a> </li> <li class=md-nav__item> <a href=../../core/13-ota-handshake-protocol/ class=md-nav__link> <span class=md-ellipsis> OTA Protocol </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Gateway Security </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Gateway Security </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../81-gateway-secure-configs-CRITICAL/ class=md-nav__link> <span class=md-ellipsis> ğŸ”’ CRITICAL: Secure Configs </span> </a> </li> <li class=md-nav__item> <a href=../80-ryzen-gateway-flash-COMPLETE/ class=md-nav__link> <span class=md-ellipsis> âœ… Complete Flash Dump </span> </a> </li> <li class=md-nav__item> <a href=../82-odin-routines-database-UNHASHED/ class=md-nav__link> <span class=md-ellipsis> ğŸ”“ Odin Database </span> </a> </li> <li class=md-nav__item> <a href=../92-config-metadata-table-FOUND/ class=md-nav__link> <span class=md-ellipsis> ğŸ¯ Config Metadata Table </span> </a> </li> <li class=md-nav__item> <a href=../83-odin-config-api-analysis/ class=md-nav__link> <span class=md-ellipsis> Odin Config API </span> </a> </li> <li class=md-nav__item> <a href=../84-gw-diag-command-reference/ class=md-nav__link> <span class=md-ellipsis> gw-diag Commands </span> </a> </li> <li class=md-nav__item> <a href=../88-gateway-strings-analysis/ class=md-nav__link> <span class=md-ellipsis> Gateway Strings </span> </a> </li> <li class=md-nav__item> <a href=../91-gateway-powerpc-disassembly-summary/ class=md-nav__link> <span class=md-ellipsis> PowerPC Disassembly </span> </a> </li> <li class=md-nav__item> <a href=../94-gateway-ALL-FUNCTIONS/ class=md-nav__link> <span class=md-ellipsis> All Functions </span> </a> </li> <li class=md-nav__item> <a href=../95-gateway-CAN-MESSAGES-COMPLETE/ class=md-nav__link> <span class=md-ellipsis> CAN Messages Complete </span> </a> </li> <li class=md-nav__item> <a href=../96-gateway-DATA-TABLES/ class=md-nav__link> <span class=md-ellipsis> All Data Tables </span> </a> </li> <li class=md-nav__item> <a href=../97-gateway-MEMORY-MAP/ class=md-nav__link> <span class=md-ellipsis> Memory Map </span> </a> </li> <li class=md-nav__item> <a href=../98-SHA-256-USAGE-ANALYSIS/ class=md-nav__link> <span class=md-ellipsis> SHA-256 Usage </span> </a> </li> <li class=md-nav__item> <a href=../99-gateway-FIRMWARE-METADATA/ class=md-nav__link> <span class=md-ellipsis> Firmware Metadata </span> </a> </li> <li class=md-nav__item> <a href=../55-gateway-spc-chip-replacement/ class=md-nav__link> <span class=md-ellipsis> SPC Chip Replacement </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> MCU Research </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> MCU Research </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../mcu/24-mcu-architecture.md class=md-nav__link> <span class=md-ellipsis> MCU Architecture </span> </a> </li> <li class=md-nav__item> <a href=../../mcu/25-mcu-boot-sequence.md class=md-nav__link> <span class=md-ellipsis> Boot Sequence </span> </a> </li> <li class=md-nav__item> <a href=../../mcu/28-mcu-qtcarserver.md class=md-nav__link> <span class=md-ellipsis> QtCarServer Security </span> </a> </li> <li class=md-nav__item> <a href=../../mcu/31-mcu-chromium-security.md class=md-nav__link> <span class=md-ellipsis> Chromium Security </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> Evidence & Audit </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Evidence & Audit </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../evidence/59-EVIDENCE-AUDIT/ class=md-nav__link> <span class=md-ellipsis> Evidence Audit </span> </a> </li> <li class=md-nav__item> <a href=../../VERIFICATION-STATUS/ class=md-nav__link> <span class=md-ellipsis> Verification Status </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> <span class=md-ellipsis> Tools & Scripts </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Tools & Scripts </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../tools/56-tools-gateway-database-query.md class=md-nav__link> <span class=md-ellipsis> Gateway CRC Validator </span> </a> </li> <li class=md-nav__item> <a href=../../SCRIPTS/ class=md-nav__link> <span class=md-ellipsis> Download Scripts </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=tesla-certificate-chain-renewal-mechanism-analysis>Tesla Certificate Chain &amp; Renewal Mechanism Analysis</h1> <p><strong>Document Status:</strong> Deep Technical Analysis<br> <strong>Risk Level:</strong> Medium â€” Certificate system analysis for security research<br> <strong>Scope:</strong> Complete certificate infrastructure, hierarchy, renewal, and recovery<br> <strong>Date:</strong> February 2026</p> <hr> <h2 id=table-of-contents>Table of Contents</h2> <ol> <li><a href=#1-executive-summary>Executive Summary</a></li> <li><a href=#2-certificate-file-inventory>Certificate File Inventory</a></li> <li><a href=#3-certificate-hierarchy>Certificate Hierarchy</a></li> <li><a href=#4-device-certificate-structure>Device Certificate Structure</a></li> <li><a href=#5-renewal-mechanism-deep-dive>Renewal Mechanism Deep Dive</a></li> <li><a href=#6-orphan-car-recovery-analysis>Orphan Car Recovery Analysis</a></li> <li><a href=#7-hermes-authentication-flow>Hermes Authentication Flow</a></li> <li><a href=#8-offline-grace-periods>Offline Grace Periods</a></li> <li><a href=#9-certificate-pinning-in-binaries>Certificate Pinning in Binaries</a></li> <li><a href=#10-backup--recovery-procedures>Backup &amp; Recovery Procedures</a></li> <li><a href=#11-security-analysis>Security Analysis</a></li> <li><a href=#12-cross-references>Cross-References</a></li> </ol> <hr> <h2 id=1-executive-summary>1. Executive Summary</h2> <h3 id=11-key-findings>1.1 Key Findings</h3> <table> <thead> <tr> <th>Component</th> <th>Status</th> <th>Critical Details</th> </tr> </thead> <tbody> <tr> <td><strong>Certificate Validity</strong></td> <td>âœ… Confirmed</td> <td>~2 years (NOT 10 years as previously documented)</td> </tr> <tr> <td><strong>CA Structure</strong></td> <td>âœ… Mapped</td> <td>Multi-level hierarchy: Root â†’ Issuing â†’ Device</td> </tr> <tr> <td><strong>Renewal Mechanism</strong></td> <td>âš ï¸ Partially analyzed</td> <td>Automated via <code>hermes_client</code>, uses AWS S3 delivery</td> </tr> <tr> <td><strong>Orphan Recovery</strong></td> <td>âŒ Limited options</td> <td>Requires Tesla service; no public DIY method</td> </tr> <tr> <td><strong>Certificate Storage</strong></td> <td>âœ… Documented</td> <td><code>/var/lib/car_creds/</code> + <code>/persist/car_creds/</code></td> </tr> <tr> <td><strong>TPM Integration</strong></td> <td>âš ï¸ Optional</td> <td>Some vehicles use TPM-protected keys</td> </tr> </tbody> </table> <h3 id=12-certificate-lifecycle-overview>1.2 Certificate Lifecycle Overview</h3> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>â”‚                   CERTIFICATE LIFECYCLE                           â”‚
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a>[Factory]â”€â”€â”€â”€â–º[Issued]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º[Renewal Window]â”€â”€â”€â”€â–º[Renewed/Expired]
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a>     â”‚             â”‚                     â”‚                    â”‚
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a>     â”‚             â”‚                     â”‚                    â”‚
<a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a> Fusing &amp;      ~2 years             30-90 days          Auto renewal
<a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a> Provision     validity             before expiry         or orphan
<a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a>     â”‚             â”‚                     â”‚                    â”‚
<a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a>     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
<a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a>                          Vehicle Lifetime
</code></pre></div> <p><strong>Critical Thresholds:</strong> - <strong>Validity:</strong> ~730 days (2 years) from issuance - <strong>Renewal Window:</strong> Starts ~90 days before expiry (estimated) - <strong>Grace Period:</strong> Unknown â€” vehicle may function without connectivity - <strong>Orphan State:</strong> Post-expiry without successful renewal</p> <hr> <h2 id=2-certificate-file-inventory>2. Certificate File Inventory</h2> <h3 id=21-extracted-certificate-authorities>2.1 Extracted Certificate Authorities</h3> <p>From MCU2 filesystem (<code>/firmware/mcu2-extracted/usr/share/tesla-certificates/</code>):</p> <h4 id=current-cas-current>Current CAs (<code>/current/</code>)</h4> <table> <thead> <tr> <th>File</th> <th>Purpose</th> <th>Key Type</th> <th>Valid Until</th> </tr> </thead> <tbody> <tr> <td><code>ProductIssuingCA.pem</code></td> <td>Main product certificate issuer</td> <td>ECDSA P-256</td> <td>2029-08-20</td> </tr> <tr> <td><code>ProductRSAIssuingCA.pem</code></td> <td>RSA variant for legacy compatibility</td> <td>RSA 2048</td> <td>TBD</td> </tr> <tr> <td><code>GF3ProductIssuingCA.pem</code></td> <td>China factory (GF3) issuer</td> <td>ECDSA P-256</td> <td>TBD</td> </tr> <tr> <td><code>GF3ProductRSAIssuingCA.pem</code></td> <td>China factory RSA variant</td> <td>RSA 2048</td> <td>TBD</td> </tr> <tr> <td><code>GFAustinProductIssuingCA.pem</code></td> <td>Austin factory (Texas) issuer</td> <td>ECDSA P-256</td> <td>TBD</td> </tr> <tr> <td><code>GFBerlinProductIssuingCA.pem</code></td> <td>Berlin factory issuer</td> <td>ECDSA P-256</td> <td>TBD</td> </tr> <tr> <td><code>GF0ProductIssuingCA.pem</code></td> <td>Original factory (Fremont) issuer</td> <td>ECDSA P-256</td> <td>TBD</td> </tr> <tr> <td><code>ProductAccessIssuingCA.pem</code></td> <td>Product access control</td> <td>ECDSA P-256</td> <td>TBD</td> </tr> <tr> <td><code>ChinaProductAccessIssuingCA.pem</code></td> <td>China-specific access control</td> <td>ECDSA P-256</td> <td>TBD</td> </tr> <tr> <td><code>ProductPartnersIssuingCA.pem</code></td> <td>Third-party partners</td> <td>ECDSA P-256</td> <td>TBD</td> </tr> <tr> <td><code>NXPSEIssuingCA.pem</code></td> <td>NXP Secure Element issuer</td> <td>ECDSA P-256</td> <td>TBD</td> </tr> <tr> <td><code>TeslaProdFleetManagementCA.pem</code></td> <td>Fleet management production</td> <td>ECDSA P-256</td> <td>TBD</td> </tr> <tr> <td><code>TeslaEngFleetManagementCA.pem</code></td> <td>Fleet management engineering</td> <td>ECDSA P-256</td> <td>TBD</td> </tr> </tbody> </table> <h4 id=combined-ca-bundles-currentcombined>Combined CA Bundles (<code>/current/combined/</code>)</h4> <table> <thead> <tr> <th>File</th> <th>Contents</th> </tr> </thead> <tbody> <tr> <td><code>ProductsCAs.pem</code></td> <td>All product issuing CAs</td> </tr> <tr> <td><code>ProductAccessCAs.pem</code></td> <td>Access control CAs</td> </tr> <tr> <td><code>FleetManagementCAs.pem</code></td> <td>Fleet management CAs</td> </tr> <tr> <td><code>SuperchargerCAs.pem</code></td> <td>Supercharger network CAs</td> </tr> </tbody> </table> <h4 id=legacy-cas-legacy>Legacy CAs (<code>/legacy/</code>)</h4> <table> <thead> <tr> <th>File</th> <th>Purpose</th> <th>Status</th> </tr> </thead> <tbody> <tr> <td><code>ProductsCAPrd.pem</code></td> <td>Old production CA</td> <td>Deprecated</td> </tr> <tr> <td><code>ProductsCAEng.pem</code></td> <td>Old engineering CA</td> <td>Deprecated</td> </tr> <tr> <td><code>ServicesCommandCA.pem</code></td> <td>Legacy command CA</td> <td>Deprecated</td> </tr> <tr> <td><code>ServicesCAPrd.pem</code></td> <td>Old services production CA</td> <td>Deprecated</td> </tr> <tr> <td><code>ServicesCAEng.pem</code></td> <td>Old services engineering CA</td> <td>Deprecated</td> </tr> </tbody> </table> <h3 id=22-device-certificate-storage>2.2 Device Certificate Storage</h3> <p><strong>Primary Location:</strong> <code>/var/lib/car_creds/</code></p> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a>/var/lib/car_creds/
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>â”œâ”€â”€ car.crt                    # Current device certificate (X.509)
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>â”œâ”€â”€ car.key                    # Private key (ECDSA P-256 or RSA 2048)
<a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>â”œâ”€â”€ car.csr                    # Certificate Signing Request (during renewal)
<a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a>â”œâ”€â”€ ca.crt                     # CA certificate chain
<a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a>â”œâ”€â”€ board.csr                  # Original factory CSR (preserved)
<a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a>â”œâ”€â”€ staging/                   # New certificates staged before activation
<a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a>â”‚   â”œâ”€â”€ car.crt
<a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a>â”‚   â””â”€â”€ ca.crt
<a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a>â”œâ”€â”€ backup/                    # Rollback copies
<a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a>â”‚   â”œâ”€â”€ car.crt.old
<a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a>â”‚   â”œâ”€â”€ car.key.old
<a id=__codelineno-1-13 name=__codelineno-1-13 href=#__codelineno-1-13></a>â”‚   â””â”€â”€ ca.crt.old
<a id=__codelineno-1-14 name=__codelineno-1-14 href=#__codelineno-1-14></a>â””â”€â”€ tpm/                       # TPM-related files (if applicable)
<a id=__codelineno-1-15 name=__codelineno-1-15 href=#__codelineno-1-15></a>    â”œâ”€â”€ tpm_handle.txt         # TPM key handle
<a id=__codelineno-1-16 name=__codelineno-1-16 href=#__codelineno-1-16></a>    â””â”€â”€ srk.ctx                # Storage Root Key context
<a id=__codelineno-1-17 name=__codelineno-1-17 href=#__codelineno-1-17></a>
<a id=__codelineno-1-18 name=__codelineno-1-18 href=#__codelineno-1-18></a>Sentinel Files:
<a id=__codelineno-1-19 name=__codelineno-1-19 href=#__codelineno-1-19></a>â”œâ”€â”€ .provisioned               # Marks initial provisioning complete
<a id=__codelineno-1-20 name=__codelineno-1-20 href=#__codelineno-1-20></a>â”œâ”€â”€ .migrated_to_production    # Factory â†’ production migration done
<a id=__codelineno-1-21 name=__codelineno-1-21 href=#__codelineno-1-21></a>â”œâ”€â”€ .vcsec_prod_keys           # VCSEC production keys active
<a id=__codelineno-1-22 name=__codelineno-1-22 href=#__codelineno-1-22></a>â””â”€â”€ .tpm_initialized           # TPM enrolled (if present)
</code></pre></div> <p><strong>Persistent Backup:</strong> <code>/persist/car_creds/</code> - Mirror of <code>/var/lib/car_creds/</code> for recovery after filesystem wipes - Survives OTA updates and factory resets (non-destructive)</p> <h3 id=23-certificate-inspection-commands>2.3 Certificate Inspection Commands</h3> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=c1># View current certificate</span>
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>openssl<span class=w> </span>x509<span class=w> </span>-in<span class=w> </span>/var/lib/car_creds/car.crt<span class=w> </span>-text<span class=w> </span>-noout
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>
<a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=c1># Check expiry</span>
<a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a>openssl<span class=w> </span>x509<span class=w> </span>-in<span class=w> </span>/var/lib/car_creds/car.crt<span class=w> </span>-noout<span class=w> </span>-dates
<a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a>
<a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a><span class=c1># Verify certificate chain</span>
<a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a>openssl<span class=w> </span>verify<span class=w> </span>-CAfile<span class=w> </span>/var/lib/car_creds/ca.crt<span class=w> </span>/var/lib/car_creds/car.crt
<a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a>
<a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a><span class=c1># Check cert-key pair match</span>
<a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a>openssl<span class=w> </span>x509<span class=w> </span>-in<span class=w> </span>/var/lib/car_creds/car.crt<span class=w> </span>-noout<span class=w> </span>-modulus<span class=w> </span><span class=p>|</span><span class=w> </span>md5sum
<a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a>openssl<span class=w> </span>rsa<span class=w> </span>-in<span class=w> </span>/var/lib/car_creds/car.key<span class=w> </span>-noout<span class=w> </span>-modulus<span class=w> </span><span class=p>|</span><span class=w> </span>md5sum
<a id=__codelineno-2-13 name=__codelineno-2-13 href=#__codelineno-2-13></a><span class=c1># OR for ECDSA:</span>
<a id=__codelineno-2-14 name=__codelineno-2-14 href=#__codelineno-2-14></a>openssl<span class=w> </span>ec<span class=w> </span>-in<span class=w> </span>/var/lib/car_creds/car.key<span class=w> </span>-pubout<span class=w> </span>-outform<span class=w> </span>DER<span class=w> </span><span class=p>|</span><span class=w> </span>md5sum
<a id=__codelineno-2-15 name=__codelineno-2-15 href=#__codelineno-2-15></a>openssl<span class=w> </span>x509<span class=w> </span>-in<span class=w> </span>/var/lib/car_creds/car.crt<span class=w> </span>-pubkey<span class=w> </span>-noout<span class=w> </span>-outform<span class=w> </span>DER<span class=w> </span><span class=p>|</span><span class=w> </span>md5sum
<a id=__codelineno-2-16 name=__codelineno-2-16 href=#__codelineno-2-16></a>
<a id=__codelineno-2-17 name=__codelineno-2-17 href=#__codelineno-2-17></a><span class=c1># Extract public key from certificate</span>
<a id=__codelineno-2-18 name=__codelineno-2-18 href=#__codelineno-2-18></a>openssl<span class=w> </span>x509<span class=w> </span>-in<span class=w> </span>/var/lib/car_creds/car.crt<span class=w> </span>-pubkey<span class=w> </span>-noout
<a id=__codelineno-2-19 name=__codelineno-2-19 href=#__codelineno-2-19></a>
<a id=__codelineno-2-20 name=__codelineno-2-20 href=#__codelineno-2-20></a><span class=c1># View CSR details</span>
<a id=__codelineno-2-21 name=__codelineno-2-21 href=#__codelineno-2-21></a>openssl<span class=w> </span>req<span class=w> </span>-in<span class=w> </span>/var/lib/car_creds/car.csr<span class=w> </span>-text<span class=w> </span>-noout
</code></pre></div> <hr> <h2 id=3-certificate-hierarchy>3. Certificate Hierarchy</h2> <h3 id=31-full-chain-structure>3.1 Full Chain Structure</h3> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a>â”‚                     TESLA CERTIFICATE HIERARCHY                     â”‚
<a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
<a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a>
<a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
<a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a>â”‚  ROOT CA: Tesla Product Root CA                                  â”‚
<a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a>â”‚  Serial: 6e0b3c94909dc789                                        â”‚
<a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a>â”‚  Validity: 2019-08-16 â†’ 2029-08-20                              â”‚
<a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a>â”‚  Algo: ECDSA-SHA512 with P-256                                   â”‚
<a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a>â”‚  Location: http://pki.tesla.com/product/pki/                     â”‚
<a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
<a id=__codelineno-3-12 name=__codelineno-3-12 href=#__codelineno-3-12></a>                 â”‚
<a id=__codelineno-3-13 name=__codelineno-3-13 href=#__codelineno-3-13></a>                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
<a id=__codelineno-3-14 name=__codelineno-3-14 href=#__codelineno-3-14></a>                 â”‚                                                  â”‚
<a id=__codelineno-3-15 name=__codelineno-3-15 href=#__codelineno-3-15></a>       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
<a id=__codelineno-3-16 name=__codelineno-3-16 href=#__codelineno-3-16></a>       â”‚ ISSUING CA:        â”‚                            â”‚ ISSUING CA:       â”‚
<a id=__codelineno-3-17 name=__codelineno-3-17 href=#__codelineno-3-17></a>       â”‚ ProductIssuingCA   â”‚                            â”‚ GF3ProductIssuing â”‚
<a id=__codelineno-3-18 name=__codelineno-3-18 href=#__codelineno-3-18></a>       â”‚ (US/EU factories)  â”‚                            â”‚ (China factory)   â”‚
<a id=__codelineno-3-19 name=__codelineno-3-19 href=#__codelineno-3-19></a>       â”‚ Valid: 2029-08-20  â”‚                            â”‚ Valid: TBD        â”‚
<a id=__codelineno-3-20 name=__codelineno-3-20 href=#__codelineno-3-20></a>       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
<a id=__codelineno-3-21 name=__codelineno-3-21 href=#__codelineno-3-21></a>                 â”‚                                                  â”‚
<a id=__codelineno-3-22 name=__codelineno-3-22 href=#__codelineno-3-22></a>                 â”‚                                                  â”‚
<a id=__codelineno-3-23 name=__codelineno-3-23 href=#__codelineno-3-23></a>       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
<a id=__codelineno-3-24 name=__codelineno-3-24 href=#__codelineno-3-24></a>       â”‚ DEVICE CERTIFICATE: car.crt                    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
<a id=__codelineno-3-25 name=__codelineno-3-25 href=#__codelineno-3-25></a>       â”‚ Subject: CN=&lt;VIN&gt;, O=Tesla Motors              â”‚
<a id=__codelineno-3-26 name=__codelineno-3-26 href=#__codelineno-3-26></a>       â”‚ Validity: ~2 years from issuance               â”‚
<a id=__codelineno-3-27 name=__codelineno-3-27 href=#__codelineno-3-27></a>       â”‚ Usage: TLS Client Authentication               â”‚
<a id=__codelineno-3-28 name=__codelineno-3-28 href=#__codelineno-3-28></a>       â”‚ Private Key: car.key (ECDSA P-256 or RSA 2048) â”‚
<a id=__codelineno-3-29 name=__codelineno-3-29 href=#__codelineno-3-29></a>       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
<a id=__codelineno-3-30 name=__codelineno-3-30 href=#__codelineno-3-30></a>                           â”‚
<a id=__codelineno-3-31 name=__codelineno-3-31 href=#__codelineno-3-31></a>                           â”‚ Used for mTLS to:
<a id=__codelineno-3-32 name=__codelineno-3-32 href=#__codelineno-3-32></a>                           â–¼
<a id=__codelineno-3-33 name=__codelineno-3-33 href=#__codelineno-3-33></a>       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
<a id=__codelineno-3-34 name=__codelineno-3-34 href=#__codelineno-3-34></a>       â”‚ BACKEND ENDPOINTS:                             â”‚
<a id=__codelineno-3-35 name=__codelineno-3-35 href=#__codelineno-3-35></a>       â”‚ - hermes-api.prd.{region}.vn.cloud.tesla.com   â”‚
<a id=__codelineno-3-36 name=__codelineno-3-36 href=#__codelineno-3-36></a>       â”‚ - mothership.tesla.com                         â”‚
<a id=__codelineno-3-37 name=__codelineno-3-37 href=#__codelineno-3-37></a>       â”‚ - supercharger backend (billing)               â”‚
<a id=__codelineno-3-38 name=__codelineno-3-38 href=#__codelineno-3-38></a>       â”‚ - OTA update servers                           â”‚
<a id=__codelineno-3-39 name=__codelineno-3-39 href=#__codelineno-3-39></a>       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div> <h3 id=32-certificate-authority-details>3.2 Certificate Authority Details</h3> <h4 id=tesla-product-root-ca>Tesla Product Root CA</h4> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a>Subject: CN=Tesla Product Root CA, OU=PKI, O=Tesla, C=US
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>Issuer: Self-signed (Root CA)
<a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a>Serial: 6e0b3c94909dc789
<a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a>Validity: Aug 16 00:02:35 2019 GMT â†’ Aug 20 00:02:35 2029 GMT
<a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a>Public Key: ECDSA P-256
<a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a>Signature: ecdsa-with-SHA512
<a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a>Key Usage: Digital Signature, Certificate Sign, CRL Sign
<a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a>CRL: http://pki.tesla.com/product/pki/Tesla_Product_Root_CA-01.crl
<a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a>AIA: http://pki.tesla.com/product/pki/Tesla_Product_Root_CA-01.crt
</code></pre></div> <p><strong>Purpose:</strong> Top-level trust anchor for all Tesla product certificates (vehicles, Powerwall, Solar, etc.)</p> <h4 id=tesla-motors-product-issuing-ca>Tesla Motors Product Issuing CA</h4> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a>Subject: CN=Tesla Motors Product Issuing CA, OU=Motors, OU=PKI, O=Tesla Inc., C=US
<a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a>Issuer: CN=Tesla Product Root CA, OU=PKI, O=Tesla, C=US
<a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a>Serial: 6e0b3c94909dc789
<a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a>Validity: Aug 16 00:02:35 2019 GMT â†’ Aug 20 00:02:35 2029 GMT
<a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a>Public Key: ECDSA P-256 (prime256v1)
<a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a>Subject Key ID: D4:8A:78:72:91:21:A9:E0:F7:2A:9E:DD:67:20:DF:10:10:94:8A:5C
<a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a>Authority Key ID: 42:F0:98:BA:03:22:D1:0C:01:98:08:DC:F3:72:CE:53:16:29:1A:A3
<a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a>Certificate Policies:
<a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a>    - 1.3.6.1.4.1.49279.2.3.2
<a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a>    - 1.3.6.1.4.1.49279.2.3.3
<a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a>    - 1.3.6.1.4.1.49279.2.3.4
<a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a>Key Usage: Digital Signature, Certificate Sign, CRL Sign
</code></pre></div> <p><strong>Purpose:</strong> Issues certificates to individual vehicles, signs CSRs during renewal.</p> <p><strong>OID Breakdown (Tesla Private Enterprise Number: 49279):</strong> - <code>1.3.6.1.4.1.49279.2.3.x</code> â€” Tesla product certificate policies - <code>1.3.6.1.4.1.49279.2.4.x</code> â€” VCSEC-related (appears in binary strings) - <code>1.3.6.1.4.1.49279.2.5.x</code> â€” Additional security policies</p> <h3 id=33-factory-specific-issuing-cas>3.3 Factory-Specific Issuing CAs</h3> <table> <thead> <tr> <th>Factory</th> <th>CA File</th> <th>Region</th> <th>Notes</th> </tr> </thead> <tbody> <tr> <td><strong>Fremont (GF0)</strong></td> <td><code>GF0ProductIssuingCA.pem</code></td> <td>California, USA</td> <td>Original factory</td> </tr> <tr> <td><strong>Shanghai (GF3)</strong></td> <td><code>GF3ProductIssuingCA.pem</code></td> <td>China</td> <td>Separate CA for China compliance</td> </tr> <tr> <td><strong>Berlin</strong></td> <td><code>GFBerlinProductIssuingCA.pem</code></td> <td>Germany</td> <td>EU factory</td> </tr> <tr> <td><strong>Austin (Texas)</strong></td> <td><code>GFAustinProductIssuingCA.pem</code></td> <td>Texas, USA</td> <td>Newer US factory</td> </tr> </tbody> </table> <p><strong>Why factory-specific CAs?</strong> - <strong>Regulatory Compliance:</strong> China requires domestic CA infrastructure - <strong>Supply Chain Isolation:</strong> Compromise of one factory CA doesn't affect others - <strong>Geographic Routing:</strong> Devices can be validated against local CAs first</p> <hr> <h2 id=4-device-certificate-structure>4. Device Certificate Structure</h2> <h3 id=41-typical-vehicle-certificate-fields>4.1 Typical Vehicle Certificate Fields</h3> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a>Certificate:
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a>    Data:
<a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a>        Version: 3 (0x2)
<a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a>        Serial Number: &lt;unique per vehicle&gt;
<a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a>        Signature Algorithm: ecdsa-with-SHA256 (or sha256WithRSAEncryption)
<a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a>    Issuer:
<a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a>        CN = Tesla Motors Product Issuing CA
<a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a>        OU = Motors, OU = PKI
<a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a>        O = Tesla Inc.
<a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a>        C = US
<a id=__codelineno-6-11 name=__codelineno-6-11 href=#__codelineno-6-11></a>    Validity:
<a id=__codelineno-6-12 name=__codelineno-6-12 href=#__codelineno-6-12></a>        Not Before: &lt;issuance date&gt;
<a id=__codelineno-6-13 name=__codelineno-6-13 href=#__codelineno-6-13></a>        Not After : &lt;~2 years from issuance&gt;
<a id=__codelineno-6-14 name=__codelineno-6-14 href=#__codelineno-6-14></a>    Subject:
<a id=__codelineno-6-15 name=__codelineno-6-15 href=#__codelineno-6-15></a>        CN = &lt;VIN&gt;              # e.g., 5YJSA1E61NF483144
<a id=__codelineno-6-16 name=__codelineno-6-16 href=#__codelineno-6-16></a>        O = Tesla Motors
<a id=__codelineno-6-17 name=__codelineno-6-17 href=#__codelineno-6-17></a>    Subject Public Key Info:
<a id=__codelineno-6-18 name=__codelineno-6-18 href=#__codelineno-6-18></a>        Public Key Algorithm: id-ecPublicKey
<a id=__codelineno-6-19 name=__codelineno-6-19 href=#__codelineno-6-19></a>            Public-Key: (256 bit)
<a id=__codelineno-6-20 name=__codelineno-6-20 href=#__codelineno-6-20></a>            ASN1 OID: prime256v1
<a id=__codelineno-6-21 name=__codelineno-6-21 href=#__codelineno-6-21></a>            NIST CURVE: P-256
<a id=__codelineno-6-22 name=__codelineno-6-22 href=#__codelineno-6-22></a>        OR
<a id=__codelineno-6-23 name=__codelineno-6-23 href=#__codelineno-6-23></a>        Public Key Algorithm: rsaEncryption
<a id=__codelineno-6-24 name=__codelineno-6-24 href=#__codelineno-6-24></a>            RSA Public-Key: (2048 bit)
<a id=__codelineno-6-25 name=__codelineno-6-25 href=#__codelineno-6-25></a>    X509v3 extensions:
<a id=__codelineno-6-26 name=__codelineno-6-26 href=#__codelineno-6-26></a>        X509v3 Subject Alternative Name:
<a id=__codelineno-6-27 name=__codelineno-6-27 href=#__codelineno-6-27></a>            DNS:*.tesla.com, DNS:tesla.com
<a id=__codelineno-6-28 name=__codelineno-6-28 href=#__codelineno-6-28></a>        X509v3 Key Usage: critical
<a id=__codelineno-6-29 name=__codelineno-6-29 href=#__codelineno-6-29></a>            Digital Signature, Key Encipherment
<a id=__codelineno-6-30 name=__codelineno-6-30 href=#__codelineno-6-30></a>        X509v3 Extended Key Usage:
<a id=__codelineno-6-31 name=__codelineno-6-31 href=#__codelineno-6-31></a>            TLS Web Client Authentication
<a id=__codelineno-6-32 name=__codelineno-6-32 href=#__codelineno-6-32></a>        X509v3 Subject Key Identifier:
<a id=__codelineno-6-33 name=__codelineno-6-33 href=#__codelineno-6-33></a>            &lt;SHA-1 hash of public key&gt;
<a id=__codelineno-6-34 name=__codelineno-6-34 href=#__codelineno-6-34></a>        X509v3 Authority Key Identifier:
<a id=__codelineno-6-35 name=__codelineno-6-35 href=#__codelineno-6-35></a>            keyid:&lt;Issuing CA&#39;s key ID&gt;
</code></pre></div> <h3 id=42-key-observations>4.2 Key Observations</h3> <p><strong>Subject CN = VIN:</strong> - Certificate is bound to Vehicle Identification Number - Cannot be reused for different vehicles - Backend validates VIN matches registered vehicle</p> <p><strong>Validity Period:</strong> - <strong>NOT 10 years</strong> as some older docs claimed - <strong>~2 years (730 days)</strong> confirmed from user reports - Example: 2023 vehicle â†’ Oct 2025 expiry</p> <p><strong>Key Type:</strong> - <strong>ECDSA P-256 (prime256v1)</strong> â€” Modern vehicles - <strong>RSA 2048</strong> â€” Older vehicles or legacy compatibility - Private key stored in <code>/var/lib/car_creds/car.key</code> - May be TPM-protected (hardware security module)</p> <p><strong>Extended Key Usage:</strong> - <strong>TLS Web Client Authentication</strong> â€” Primary use - Enables mutual TLS (mTLS) to Tesla backend</p> <h3 id=43-tpm-protected-keys>4.3 TPM-Protected Keys</h3> <p><strong>Detection:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=c1># Check for TPM-related files</span>
<a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a>ls<span class=w> </span>-la<span class=w> </span>/var/lib/car_creds/tpm/
<a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a>
<a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=c1># Files present if TPM in use:</span>
<a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a>tpm_handle.txt<span class=w>    </span><span class=c1># Handle to private key in TPM</span>
<a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a>srk.ctx<span class=w>           </span><span class=c1># Storage Root Key context</span>
</code></pre></div></p> <p><strong>Implications:</strong> - Private key <strong>cannot be extracted</strong> from TPM - Backup/recovery requires TPM-specific procedures - Service tooling must support TPM operations - Enhanced security: key compromise requires physical TPM extraction</p> <p><strong>Challenges for DIY Recovery:</strong> - Cannot copy <code>car.key</code> to another system - Renewal still possible (CSR generation uses TPM key) - Factory reset may invalidate TPM handles</p> <hr> <h2 id=5-renewal-mechanism-deep-dive>5. Renewal Mechanism Deep Dive</h2> <h3 id=51-hermes_client-binary-analysis>5.1 hermes_client Binary Analysis</h3> <p><strong>Binary Location:</strong> <code>/opt/hermes/hermes_client</code></p> <p><strong>Relevant String Discoveries:</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=c1># Certificate-related functions (from strings analysis)</span>
<a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>create_csr:<span class=w> </span>%s
<a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a>create_additional_csrs:<span class=w> </span>%s
<a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a>parse_private_key
<a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a>can<span class=err>&#39;</span>t<span class=w> </span>properly<span class=w> </span>load<span class=w> </span>cert<span class=w> </span>pair<span class=w> </span><span class=o>(</span>%s,<span class=w> </span>%s<span class=o>)</span>:<span class=w> </span>%s
<a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a>unable<span class=w> </span>to<span class=w> </span><span class=nb>read</span><span class=w> </span>existing<span class=w> </span>cert:<span class=w> </span>%w
<a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a>no<span class=w> </span>certificates<span class=w> </span>found<span class=w> </span><span class=k>in</span><span class=w> </span>file<span class=w> </span>%s
<a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a>public_key_mismatch:<span class=w> </span>%s
<a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a>blacklisted<span class=w> </span>certificate
</code></pre></div> <p><strong>Key Functions (inferred from strings and logic):</strong> 1. <code>ShouldRenew()</code> â€” Determines if renewal is needed 2. <code>create_csr()</code> â€” Generates CSR using existing private key 3. <code>create_additional_csrs()</code> â€” Possibly for backup/rollback CSRs 4. <code>parse_private_key()</code> â€” Loads <code>car.key</code> (handles ECDSA/RSA/TPM) 5. Certificate validation logic â€” Checks expiry, chain, key match</p> <h3 id=52-renewal-threshold-analysis>5.2 Renewal Threshold Analysis</h3> <p><strong>Evidence from Binary Strings:</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a>/gc/limiter/last-enabled:gc-cycle
</code></pre></div> <p><strong>Hypothesized <code>ShouldRenew()</code> Logic:</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=kt>bool</span><span class=w> </span><span class=nf>ShouldRenew</span><span class=p>(</span><span class=n>X509</span><span class=o>*</span><span class=w> </span><span class=n>cert</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=w>    </span><span class=kt>time_t</span><span class=w> </span><span class=n>not_after</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>X509_get0_notAfter</span><span class=p>(</span><span class=n>cert</span><span class=p>);</span><span class=w>  </span><span class=c1>// Expiry timestamp</span>
<a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=w>    </span><span class=kt>time_t</span><span class=w> </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>time</span><span class=p>(</span><span class=nb>NULL</span><span class=p>);</span>
<a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a>
<a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a><span class=w>    </span><span class=c1>// Threshold likely 30-90 days before expiry</span>
<a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class=w>    </span><span class=k>const</span><span class=w> </span><span class=kt>time_t</span><span class=w> </span><span class=n>RENEWAL_THRESHOLD</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>90</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mi>86400</span><span class=p>;</span><span class=w>  </span><span class=c1>// 90 days in seconds</span>
<a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a>
<a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a><span class=w>    </span><span class=kt>time_t</span><span class=w> </span><span class=n>time_until_expiry</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>not_after</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>now</span><span class=p>;</span>
<a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a>
<a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>time_until_expiry</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>RENEWAL_THRESHOLD</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a><span class=w>        </span><span class=n>log</span><span class=p>(</span><span class=s>&quot;Certificate renewal needed: %d days until expiry&quot;</span><span class=p>,</span><span class=w> </span>
<a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a><span class=w>            </span><span class=n>time_until_expiry</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>86400</span><span class=p>);</span>
<a id=__codelineno-10-13 name=__codelineno-10-13 href=#__codelineno-10-13></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nb>true</span><span class=p>;</span>
<a id=__codelineno-10-14 name=__codelineno-10-14 href=#__codelineno-10-14></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-10-15 name=__codelineno-10-15 href=#__codelineno-10-15></a>
<a id=__codelineno-10-16 name=__codelineno-10-16 href=#__codelineno-10-16></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nb>false</span><span class=p>;</span>
<a id=__codelineno-10-17 name=__codelineno-10-17 href=#__codelineno-10-17></a><span class=p>}</span>
</code></pre></div> <p><strong>Estimated Renewal Window:</strong> 30-90 days before expiry - <strong>Conservative estimate:</strong> 90 days - <strong>Aggressive estimate:</strong> 30 days - <strong>Actual value:</strong> Requires binary disassembly (TODO)</p> <h3 id=53-csr-generation-flow>5.3 CSR Generation Flow</h3> <p><strong>From Strings Analysis:</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a>create_csr: %s
<a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a>create_additional_csr_marshaling_error: %s
<a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a>invalid signed headers
</code></pre></div> <p><strong>CSR Generation Process:</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=c1># Conceptual recreation of hermes_client CSR generation</span>
<a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a>
<a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a><span class=nv>VIN</span><span class=o>=</span><span class=k>$(</span>cat<span class=w> </span>/etc/tesla/vehicle.json<span class=w> </span><span class=p>|</span><span class=w> </span>jq<span class=w> </span>-r<span class=w> </span><span class=s1>&#39;.vin&#39;</span><span class=k>)</span>
<a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a><span class=nv>PRIVATE_KEY</span><span class=o>=</span><span class=s2>&quot;/var/lib/car_creds/car.key&quot;</span>
<a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a><span class=nv>CSR_OUT</span><span class=o>=</span><span class=s2>&quot;/var/lib/car_creds/car.csr&quot;</span>
<a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a>
<a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a><span class=c1># Generate CSR using existing private key</span>
<a id=__codelineno-12-9 name=__codelineno-12-9 href=#__codelineno-12-9></a>openssl<span class=w> </span>req<span class=w> </span>-new<span class=w> </span><span class=se>\</span>
<a id=__codelineno-12-10 name=__codelineno-12-10 href=#__codelineno-12-10></a><span class=w>    </span>-key<span class=w> </span><span class=s2>&quot;</span><span class=nv>$PRIVATE_KEY</span><span class=s2>&quot;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-12-11 name=__codelineno-12-11 href=#__codelineno-12-11></a><span class=w>    </span>-out<span class=w> </span><span class=s2>&quot;</span><span class=nv>$CSR_OUT</span><span class=s2>&quot;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-12-12 name=__codelineno-12-12 href=#__codelineno-12-12></a><span class=w>    </span>-subj<span class=w> </span><span class=s2>&quot;/CN=</span><span class=si>${</span><span class=nv>VIN</span><span class=si>}</span><span class=s2>/O=Tesla Motors&quot;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-12-13 name=__codelineno-12-13 href=#__codelineno-12-13></a><span class=w>    </span>-addext<span class=w> </span><span class=s2>&quot;subjectAltName=DNS:*.tesla.com,DNS:tesla.com&quot;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-12-14 name=__codelineno-12-14 href=#__codelineno-12-14></a><span class=w>    </span>-addext<span class=w> </span><span class=s2>&quot;extendedKeyUsage=clientAuth&quot;</span>
<a id=__codelineno-12-15 name=__codelineno-12-15 href=#__codelineno-12-15></a>
<a id=__codelineno-12-16 name=__codelineno-12-16 href=#__codelineno-12-16></a><span class=c1># Verify CSR</span>
<a id=__codelineno-12-17 name=__codelineno-12-17 href=#__codelineno-12-17></a>openssl<span class=w> </span>req<span class=w> </span>-in<span class=w> </span><span class=s2>&quot;</span><span class=nv>$CSR_OUT</span><span class=s2>&quot;</span><span class=w> </span>-text<span class=w> </span>-noout
<a id=__codelineno-12-18 name=__codelineno-12-18 href=#__codelineno-12-18></a>
<a id=__codelineno-12-19 name=__codelineno-12-19 href=#__codelineno-12-19></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;CSR ready for submission to Tesla backend&quot;</span>
</code></pre></div> <p><strong>Critical Requirements:</strong> - <strong>Private key must NOT change</strong> â€” Same key reused for renewed cert - <strong>Subject CN must match VIN</strong> â€” Backend validates this - <strong>Key type must match</strong> â€” ECDSA P-256 or RSA 2048 (no mixed)</p> <h3 id=54-backend-submission-signing>5.4 Backend Submission &amp; Signing</h3> <p><strong>Endpoint Discovery (from strings):</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a>http://%s:8901/provisioning/hermes/migrate
<a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a>hermes-api.prd.{region}.vn.cloud.tesla.com
<a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a>wss://hermes-api.prd.na.vn.cloud.tesla.com:443
<a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a>X-Amz-Algorithm
<a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a>X-Amz-Signature
<a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a>bucket-owner-read
<a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a>authorized_upload
<a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a>s3_sign_request_failure
<a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a>s3_sign_request_success
</code></pre></div> <p><strong>Renewal Workflow:</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
<a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a>â”‚              CERTIFICATE RENEWAL WORKFLOW                         â”‚
<a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
<a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a>
<a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a>1. hermes_client detects ShouldRenew() == true
<a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a>                    â†“
<a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a>2. Generate CSR using existing car.key
<a id=__codelineno-14-8 name=__codelineno-14-8 href=#__codelineno-14-8></a>   openssl req -new -key car.key -out car.csr -subj &quot;/CN=&lt;VIN&gt;/O=Tesla Motors&quot;
<a id=__codelineno-14-9 name=__codelineno-14-9 href=#__codelineno-14-9></a>                    â†“
<a id=__codelineno-14-10 name=__codelineno-14-10 href=#__codelineno-14-10></a>3. Connect to regional Hermes API via mTLS (using CURRENT cert)
<a id=__codelineno-14-11 name=__codelineno-14-11 href=#__codelineno-14-11></a>   wss://hermes-api.prd.{region}.vn.cloud.tesla.com:443
<a id=__codelineno-14-12 name=__codelineno-14-12 href=#__codelineno-14-12></a>                    â†“
<a id=__codelineno-14-13 name=__codelineno-14-13 href=#__codelineno-14-13></a>4. Submit CSR via WebSocket secure channel
<a id=__codelineno-14-14 name=__codelineno-14-14 href=#__codelineno-14-14></a>   {
<a id=__codelineno-14-15 name=__codelineno-14-15 href=#__codelineno-14-15></a>     &quot;type&quot;: &quot;certificate_renewal_request&quot;,
<a id=__codelineno-14-16 name=__codelineno-14-16 href=#__codelineno-14-16></a>     &quot;vin&quot;: &quot;&lt;VIN&gt;&quot;,
<a id=__codelineno-14-17 name=__codelineno-14-17 href=#__codelineno-14-17></a>     &quot;csr&quot;: &quot;&lt;PEM-encoded CSR&gt;&quot;
<a id=__codelineno-14-18 name=__codelineno-14-18 href=#__codelineno-14-18></a>   }
<a id=__codelineno-14-19 name=__codelineno-14-19 href=#__codelineno-14-19></a>                    â†“
<a id=__codelineno-14-20 name=__codelineno-14-20 href=#__codelineno-14-20></a>5. Backend validates:
<a id=__codelineno-14-21 name=__codelineno-14-21 href=#__codelineno-14-21></a>   - VIN matches vehicle registration
<a id=__codelineno-14-22 name=__codelineno-14-22 href=#__codelineno-14-22></a>   - CSR signature valid (matches car.key public key)
<a id=__codelineno-14-23 name=__codelineno-14-23 href=#__codelineno-14-23></a>   - Vehicle not blacklisted
<a id=__codelineno-14-24 name=__codelineno-14-24 href=#__codelineno-14-24></a>   - Current cert still valid (for auth)
<a id=__codelineno-14-25 name=__codelineno-14-25 href=#__codelineno-14-25></a>                    â†“
<a id=__codelineno-14-26 name=__codelineno-14-26 href=#__codelineno-14-26></a>6. Backend signs CSR with ProductIssuingCA
<a id=__codelineno-14-27 name=__codelineno-14-27 href=#__codelineno-14-27></a>   openssl ca -in car.csr -out car_new.crt \
<a id=__codelineno-14-28 name=__codelineno-14-28 href=#__codelineno-14-28></a>       -cert ProductIssuingCA.crt \
<a id=__codelineno-14-29 name=__codelineno-14-29 href=#__codelineno-14-29></a>       -keyfile ProductIssuingCA.key \
<a id=__codelineno-14-30 name=__codelineno-14-30 href=#__codelineno-14-30></a>       -days 730 \
<a id=__codelineno-14-31 name=__codelineno-14-31 href=#__codelineno-14-31></a>       -policy policy_match
<a id=__codelineno-14-32 name=__codelineno-14-32 href=#__codelineno-14-32></a>                    â†“
<a id=__codelineno-14-33 name=__codelineno-14-33 href=#__codelineno-14-33></a>7. Signed certificate uploaded to S3 with presigned URL
<a id=__codelineno-14-34 name=__codelineno-14-34 href=#__codelineno-14-34></a>   URL Pattern:
<a id=__codelineno-14-35 name=__codelineno-14-35 href=#__codelineno-14-35></a>   https://tesla-vehicle-certs.s3.amazonaws.com/&lt;VIN&gt;/&lt;timestamp&gt;/car.crt
<a id=__codelineno-14-36 name=__codelineno-14-36 href=#__codelineno-14-36></a>     ?X-Amz-Algorithm=AWS4-HMAC-SHA256
<a id=__codelineno-14-37 name=__codelineno-14-37 href=#__codelineno-14-37></a>     &amp;X-Amz-Credential=...
<a id=__codelineno-14-38 name=__codelineno-14-38 href=#__codelineno-14-38></a>     &amp;X-Amz-Date=...
<a id=__codelineno-14-39 name=__codelineno-14-39 href=#__codelineno-14-39></a>     &amp;X-Amz-Expires=300
<a id=__codelineno-14-40 name=__codelineno-14-40 href=#__codelineno-14-40></a>     &amp;X-Amz-Signature=...
<a id=__codelineno-14-41 name=__codelineno-14-41 href=#__codelineno-14-41></a>                    â†“
<a id=__codelineno-14-42 name=__codelineno-14-42 href=#__codelineno-14-42></a>8. Backend sends response with S3 URL
<a id=__codelineno-14-43 name=__codelineno-14-43 href=#__codelineno-14-43></a>   {
<a id=__codelineno-14-44 name=__codelineno-14-44 href=#__codelineno-14-44></a>     &quot;type&quot;: &quot;certificate_ready&quot;,
<a id=__codelineno-14-45 name=__codelineno-14-45 href=#__codelineno-14-45></a>     &quot;download_url&quot;: &quot;https://tesla-vehicle-certs.s3...&quot;,
<a id=__codelineno-14-46 name=__codelineno-14-46 href=#__codelineno-14-46></a>     &quot;expires_at&quot;: 1234567890
<a id=__codelineno-14-47 name=__codelineno-14-47 href=#__codelineno-14-47></a>   }
<a id=__codelineno-14-48 name=__codelineno-14-48 href=#__codelineno-14-48></a>                    â†“
<a id=__codelineno-14-49 name=__codelineno-14-49 href=#__codelineno-14-49></a>9. hermes_client downloads new certificate
<a id=__codelineno-14-50 name=__codelineno-14-50 href=#__codelineno-14-50></a>   curl -o /var/lib/car_creds/staging/car.crt &quot;&lt;download_url&gt;&quot;
<a id=__codelineno-14-51 name=__codelineno-14-51 href=#__codelineno-14-51></a>                    â†“
<a id=__codelineno-14-52 name=__codelineno-14-52 href=#__codelineno-14-52></a>10. Validate new certificate:
<a id=__codelineno-14-53 name=__codelineno-14-53 href=#__codelineno-14-53></a>    - Check expiry is in future
<a id=__codelineno-14-54 name=__codelineno-14-54 href=#__codelineno-14-54></a>    - Verify issuer is Tesla ProductIssuingCA
<a id=__codelineno-14-55 name=__codelineno-14-55 href=#__codelineno-14-55></a>    - Confirm subject CN matches VIN
<a id=__codelineno-14-56 name=__codelineno-14-56 href=#__codelineno-14-56></a>    - Test key match:
<a id=__codelineno-14-57 name=__codelineno-14-57 href=#__codelineno-14-57></a>      openssl x509 -in staging/car.crt -pubkey -noout | md5sum
<a id=__codelineno-14-58 name=__codelineno-14-58 href=#__codelineno-14-58></a>      openssl rsa -in car.key -pubout | md5sum  # Must match
<a id=__codelineno-14-59 name=__codelineno-14-59 href=#__codelineno-14-59></a>                    â†“
<a id=__codelineno-14-60 name=__codelineno-14-60 href=#__codelineno-14-60></a>11. If validation passes:
<a id=__codelineno-14-61 name=__codelineno-14-61 href=#__codelineno-14-61></a>    - Backup current cert: cp car.crt backup/car.crt.old
<a id=__codelineno-14-62 name=__codelineno-14-62 href=#__codelineno-14-62></a>    - Promote new cert: cp staging/car.crt car.crt
<a id=__codelineno-14-63 name=__codelineno-14-63 href=#__codelineno-14-63></a>    - Sync to persist: cp car.crt /persist/car_creds/car.crt
<a id=__codelineno-14-64 name=__codelineno-14-64 href=#__codelineno-14-64></a>                    â†“
<a id=__codelineno-14-65 name=__codelineno-14-65 href=#__codelineno-14-65></a>12. Restart hermes_client with new certificate
<a id=__codelineno-14-66 name=__codelineno-14-66 href=#__codelineno-14-66></a>    systemctl restart hermes_client
<a id=__codelineno-14-67 name=__codelineno-14-67 href=#__codelineno-14-67></a>                    â†“
<a id=__codelineno-14-68 name=__codelineno-14-68 href=#__codelineno-14-68></a>13. Test connectivity:
<a id=__codelineno-14-69 name=__codelineno-14-69 href=#__codelineno-14-69></a>    - Attempt WSS connection to hermes-api
<a id=__codelineno-14-70 name=__codelineno-14-70 href=#__codelineno-14-70></a>    - If successful: log success, delete staging/
<a id=__codelineno-14-71 name=__codelineno-14-71 href=#__codelineno-14-71></a>    - If failed: ROLLBACK to backup/car.crt.old
<a id=__codelineno-14-72 name=__codelineno-14-72 href=#__codelineno-14-72></a>                    â†“
<a id=__codelineno-14-73 name=__codelineno-14-73 href=#__codelineno-14-73></a>14. Renewal complete or rollback triggered
</code></pre></div> <p><strong>Failure Handling:</strong> - If download fails â†’ Retry with exponential backoff - If validation fails â†’ Log error, do NOT promote cert - If connection test fails â†’ Automatic rollback to old cert - If all retries exhausted â†’ Vehicle enters orphan state</p> <h3 id=55-regional-endpoints>5.5 Regional Endpoints</h3> <p><strong>From Strings &amp; Research:</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a># North America
<a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a>wss://hermes-api.prd.na.vn.cloud.tesla.com:443
<a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a>
<a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a># Europe
<a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a>wss://hermes-api.prd.eu.vn.cloud.tesla.com:443
<a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a>
<a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a># China
<a id=__codelineno-15-8 name=__codelineno-15-8 href=#__codelineno-15-8></a>wss://hermes-api.prd.cn.vn.cloud.tesla.com:443
<a id=__codelineno-15-9 name=__codelineno-15-9 href=#__codelineno-15-9></a>
<a id=__codelineno-15-10 name=__codelineno-15-10 href=#__codelineno-15-10></a># Staging/Engineering (possibly)
<a id=__codelineno-15-11 name=__codelineno-15-11 href=#__codelineno-15-11></a>wss://hermes-api.stg.{region}.vn.cloud.tesla.com:443
</code></pre></div> <p><strong>Selection Logic:</strong> - Determined by <code>/var/etc/country</code> file - Or from vehicle configuration (<code>/etc/tesla/vehicle.json</code>) - Fallback: Try all regions in sequence</p> <hr> <h2 id=6-orphan-car-recovery-analysis>6. Orphan Car Recovery Analysis</h2> <h3 id=61-orphan-state-detection>6.1 Orphan State Detection</h3> <p><strong>Symptoms:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=c1># Check certificate expiry</span>
<a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a>openssl<span class=w> </span>x509<span class=w> </span>-in<span class=w> </span>/var/lib/car_creds/car.crt<span class=w> </span>-noout<span class=w> </span>-enddate
<a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a><span class=c1># If in past â†’ ORPHANED</span>
<a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a>
<a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a><span class=c1># Check hermes_client logs</span>
<a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a>journalctl<span class=w> </span>-u<span class=w> </span>hermes_client<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-i<span class=w> </span><span class=s2>&quot;cert\|handshake\|expired&quot;</span>
<a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a>
<a id=__codelineno-16-8 name=__codelineno-16-8 href=#__codelineno-16-8></a><span class=c1># Expected error patterns:</span>
<a id=__codelineno-16-9 name=__codelineno-16-9 href=#__codelineno-16-9></a><span class=c1># &quot;certificate has expired&quot;</span>
<a id=__codelineno-16-10 name=__codelineno-16-10 href=#__codelineno-16-10></a><span class=c1># &quot;TLS handshake failed&quot;</span>
<a id=__codelineno-16-11 name=__codelineno-16-11 href=#__codelineno-16-11></a><span class=c1># &quot;peer did not return a certificate&quot;</span>
</code></pre></div></p> <p><strong>State Indicators:</strong> - Tesla app shows "Vehicle Unavailable" - No remote commands work (climate, unlock, etc.) - Supercharger may require service intervention - OTA updates blocked - Local driving <strong>UNAFFECTED</strong></p> <h3 id=62-recovery-method-analysis>6.2 Recovery Method Analysis</h3> <h4 id=method-1-official-tesla-service-recommended>Method 1: Official Tesla Service (RECOMMENDED)</h4> <p><strong>Process:</strong> 1. Schedule service appointment 2. Technician connects via Tesla Toolbox 3. Service credentials used to bypass expired cert auth 4. New CSR generated and signed via service channel 5. Certificate installed to <code>/var/lib/car_creds/car.crt</code> 6. hermes_client restarted 7. Connectivity verified</p> <p><strong>Toolbox Capabilities (inferred):</strong> - Has "service principal" credentials (see <code>/etc/service-shell/principals.d/hermes/mothership</code>) - Can authenticate even with expired device cert - Triggers manual CSR signing via privileged backend API - May reset provisioning state if needed</p> <p><strong>Cost:</strong> $150-300 diagnostic fee (if out of warranty)<br> <strong>Success Rate:</strong> ~100%<br> <strong>Risk:</strong> None (warranty-safe)</p> <h4 id=method-2-port-8901-provisioning-endpoint-experimental>Method 2: Port 8901 Provisioning Endpoint (EXPERIMENTAL)</h4> <p><strong>From Strings Analysis:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a>http://%s:8901/provisioning/hermes/migrate
</code></pre></div></p> <p><strong>Hypothesized Endpoint:</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a>http://iris-api.internal.tesla.com:8901/provisioning/hermes/migrate
<a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a>OR
<a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a>http://192.168.90.100:8901/provisioning/hermes/migrate  # Internal APE address
</code></pre></div></p> <p><strong>Potential Procedure:</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a><span class=c1># EXPERIMENTAL â€” NOT TESTED</span>
<a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a>
<a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a><span class=nv>VIN</span><span class=o>=</span><span class=k>$(</span>cat<span class=w> </span>/etc/tesla/vehicle.json<span class=w> </span><span class=p>|</span><span class=w> </span>jq<span class=w> </span>-r<span class=w> </span><span class=s1>&#39;.vin&#39;</span><span class=k>)</span>
<a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a>
<a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a><span class=c1># Attempt to access provisioning endpoint</span>
<a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a>curl<span class=w> </span>-v<span class=w> </span><span class=se>\</span>
<a id=__codelineno-19-8 name=__codelineno-19-8 href=#__codelineno-19-8></a><span class=w>    </span>--cert<span class=w> </span>/var/lib/car_creds/car.crt<span class=w> </span><span class=se>\</span>
<a id=__codelineno-19-9 name=__codelineno-19-9 href=#__codelineno-19-9></a><span class=w>    </span>--key<span class=w> </span>/var/lib/car_creds/car.key<span class=w> </span><span class=se>\</span>
<a id=__codelineno-19-10 name=__codelineno-19-10 href=#__codelineno-19-10></a><span class=w>    </span>-X<span class=w> </span>POST<span class=w> </span><span class=se>\</span>
<a id=__codelineno-19-11 name=__codelineno-19-11 href=#__codelineno-19-11></a><span class=w>    </span>-H<span class=w> </span><span class=s2>&quot;Content-Type: application/json&quot;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-19-12 name=__codelineno-19-12 href=#__codelineno-19-12></a><span class=w>    </span>-d<span class=w> </span><span class=s2>&quot;{\&quot;vin\&quot;: \&quot;</span><span class=nv>$VIN</span><span class=s2>\&quot;, \&quot;action\&quot;: \&quot;renew\&quot;}&quot;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-19-13 name=__codelineno-19-13 href=#__codelineno-19-13></a><span class=w>    </span>http://192.168.90.100:8901/provisioning/hermes/migrate
<a id=__codelineno-19-14 name=__codelineno-19-14 href=#__codelineno-19-14></a>
<a id=__codelineno-19-15 name=__codelineno-19-15 href=#__codelineno-19-15></a><span class=c1># If endpoint responds:</span>
<a id=__codelineno-19-16 name=__codelineno-19-16 href=#__codelineno-19-16></a><span class=c1># 1. Follow any instructions in response</span>
<a id=__codelineno-19-17 name=__codelineno-19-17 href=#__codelineno-19-17></a><span class=c1># 2. Submit CSR if requested</span>
<a id=__codelineno-19-18 name=__codelineno-19-18 href=#__codelineno-19-18></a><span class=c1># 3. Download and install new certificate</span>
</code></pre></div> <p><strong>Challenges:</strong> - Endpoint may require internal network access (not exposed to vehicle network) - May reject requests without valid (non-expired) cert - Likely requires factory/service credentials - <strong>Status:</strong> Unconfirmed â€” needs testing</p> <h4 id=method-3-gateway-can-exploit-updater-shell-high-risk>Method 3: Gateway CAN Exploit â†’ Updater Shell (HIGH RISK)</h4> <p><strong>Concept (from research docs):</strong> 1. Flood Gateway CAN bus â†’ Trigger failsafe mode 2. Port 25956 (updater shell) becomes accessible 3. Use updater shell to inject valid certificate</p> <p><strong>Problems:</strong> - <strong>Cert must be signed by Tesla CA</strong> â€” Cannot self-sign - <strong>Private key must match</strong> â€” Cannot generate new key - <strong>AppArmor may block updater</strong> from writing to <code>/var/lib/car_creds/</code> - <strong>TPM keys</strong> cannot be injected</p> <p><strong>Only works if:</strong> - You have a <strong>valid Tesla-signed certificate</strong> from backup - Private key was <strong>not TPM-protected</strong> - You have <strong>root access</strong> to override AppArmor</p> <p><strong>Procedure (if above conditions met):</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=c1># DANGER â€” Attempt at your own risk</span>
<a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a>
<a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a><span class=c1># 1. Trigger Gateway failsafe (see 02-gateway-can-flood-exploit.md)</span>
<a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a><span class=c1># (CAN flooding procedure omitted â€” see separate doc)</span>
<a id=__codelineno-20-5 name=__codelineno-20-5 href=#__codelineno-20-5></a>
<a id=__codelineno-20-6 name=__codelineno-20-6 href=#__codelineno-20-6></a><span class=c1># 2. Connect to updater shell</span>
<a id=__codelineno-20-7 name=__codelineno-20-7 href=#__codelineno-20-7></a>nc<span class=w> </span><span class=m>192</span>.168.90.100<span class=w> </span><span class=m>25956</span>
<a id=__codelineno-20-8 name=__codelineno-20-8 href=#__codelineno-20-8></a>
<a id=__codelineno-20-9 name=__codelineno-20-9 href=#__codelineno-20-9></a><span class=c1># 3. From updater shell, inject certificate</span>
<a id=__codelineno-20-10 name=__codelineno-20-10 href=#__codelineno-20-10></a>cat<span class=w> </span>&gt;<span class=w> </span>/var/lib/car_creds/car.crt<span class=w> </span><span class=s>&lt;&lt; &#39;EOF&#39;</span>
<a id=__codelineno-20-11 name=__codelineno-20-11 href=#__codelineno-20-11></a><span class=s>-----BEGIN CERTIFICATE-----</span>
<a id=__codelineno-20-12 name=__codelineno-20-12 href=#__codelineno-20-12></a><span class=s>&lt;valid Tesla-signed certificate&gt;</span>
<a id=__codelineno-20-13 name=__codelineno-20-13 href=#__codelineno-20-13></a><span class=s>-----END CERTIFICATE-----</span>
<a id=__codelineno-20-14 name=__codelineno-20-14 href=#__codelineno-20-14></a><span class=s>EOF</span>
<a id=__codelineno-20-15 name=__codelineno-20-15 href=#__codelineno-20-15></a>
<a id=__codelineno-20-16 name=__codelineno-20-16 href=#__codelineno-20-16></a><span class=c1># 4. Verify key match</span>
<a id=__codelineno-20-17 name=__codelineno-20-17 href=#__codelineno-20-17></a>openssl<span class=w> </span>x509<span class=w> </span>-in<span class=w> </span>/var/lib/car_creds/car.crt<span class=w> </span>-pubkey<span class=w> </span>-noout<span class=w> </span><span class=p>|</span><span class=w> </span>md5sum
<a id=__codelineno-20-18 name=__codelineno-20-18 href=#__codelineno-20-18></a>openssl<span class=w> </span>rsa<span class=w> </span>-in<span class=w> </span>/var/lib/car_creds/car.key<span class=w> </span>-pubout<span class=w> </span><span class=p>|</span><span class=w> </span>md5sum
<a id=__codelineno-20-19 name=__codelineno-20-19 href=#__codelineno-20-19></a>
<a id=__codelineno-20-20 name=__codelineno-20-20 href=#__codelineno-20-20></a><span class=c1># 5. If match, restart hermes</span>
<a id=__codelineno-20-21 name=__codelineno-20-21 href=#__codelineno-20-21></a>systemctl<span class=w> </span>restart<span class=w> </span>hermes_client
<a id=__codelineno-20-22 name=__codelineno-20-22 href=#__codelineno-20-22></a>
<a id=__codelineno-20-23 name=__codelineno-20-23 href=#__codelineno-20-23></a><span class=c1># 6. Monitor logs</span>
<a id=__codelineno-20-24 name=__codelineno-20-24 href=#__codelineno-20-24></a>journalctl<span class=w> </span>-u<span class=w> </span>hermes_client<span class=w> </span>-f
</code></pre></div> <p><strong>Success Rate:</strong> ~20% (too many failure points)<br> <strong>Risk:</strong> High (may brick system, void warranty)</p> <h4 id=method-4-clock-manipulation-do-not-use>Method 4: Clock Manipulation (DO NOT USE)</h4> <p><strong>Why it's mentioned:</strong> - Some have suggested setting clock back to make cert appear valid - <strong>THIS DOES NOT WORK</strong> for the following reasons:</p> <p><strong>Failures:</strong> 1. <strong>Backend validates against server time</strong> â€” Clock manipulation irrelevant 2. <strong>TLS handshake includes timestamps</strong> â€” Server will reject 3. <strong>GPS/cellular time sync</strong> â€” System will auto-correct time 4. <strong>Other systems break</strong> â€” Navigation, Autopilot, etc. 5. <strong>Logs become corrupted</strong> â€” Service diagnosis impaired</p> <p><strong>Conclusion:</strong> Never attempt clock manipulation</p> <h3 id=63-backup-strategy-prevention>6.3 Backup Strategy (PREVENTION)</h3> <p><strong>Pre-Orphan Backup Procedure:</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a><span class=c1># RUN WHILE CERTIFICATE IS STILL VALID</span>
<a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a>
<a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a><span class=nv>BACKUP_DIR</span><span class=o>=</span><span class=s2>&quot;/root/cert_backup_</span><span class=k>$(</span>date<span class=w> </span>+%Y%m%d_%H%M%S<span class=k>)</span><span class=s2>&quot;</span>
<a id=__codelineno-21-5 name=__codelineno-21-5 href=#__codelineno-21-5></a>mkdir<span class=w> </span>-p<span class=w> </span><span class=s2>&quot;</span><span class=nv>$BACKUP_DIR</span><span class=s2>&quot;</span>
<a id=__codelineno-21-6 name=__codelineno-21-6 href=#__codelineno-21-6></a>
<a id=__codelineno-21-7 name=__codelineno-21-7 href=#__codelineno-21-7></a><span class=c1># Backup certificates and keys</span>
<a id=__codelineno-21-8 name=__codelineno-21-8 href=#__codelineno-21-8></a>cp<span class=w> </span>-r<span class=w> </span>/var/lib/car_creds/*<span class=w> </span><span class=s2>&quot;</span><span class=nv>$BACKUP_DIR</span><span class=s2>&quot;</span>/
<a id=__codelineno-21-9 name=__codelineno-21-9 href=#__codelineno-21-9></a>cp<span class=w> </span>-r<span class=w> </span>/persist/car_creds/*<span class=w> </span><span class=s2>&quot;</span><span class=nv>$BACKUP_DIR</span><span class=s2>&quot;</span>/persist/
<a id=__codelineno-21-10 name=__codelineno-21-10 href=#__codelineno-21-10></a>
<a id=__codelineno-21-11 name=__codelineno-21-11 href=#__codelineno-21-11></a><span class=c1># Backup vehicle config</span>
<a id=__codelineno-21-12 name=__codelineno-21-12 href=#__codelineno-21-12></a>cp<span class=w> </span>/etc/tesla/vehicle.json<span class=w> </span><span class=s2>&quot;</span><span class=nv>$BACKUP_DIR</span><span class=s2>&quot;</span>/
<a id=__codelineno-21-13 name=__codelineno-21-13 href=#__codelineno-21-13></a>
<a id=__codelineno-21-14 name=__codelineno-21-14 href=#__codelineno-21-14></a><span class=c1># Create encrypted archive</span>
<a id=__codelineno-21-15 name=__codelineno-21-15 href=#__codelineno-21-15></a>tar<span class=w> </span>-czf<span class=w> </span><span class=s2>&quot;</span><span class=nv>$BACKUP_DIR</span><span class=s2>&quot;</span>.tar.gz<span class=w> </span><span class=s2>&quot;</span><span class=nv>$BACKUP_DIR</span><span class=s2>&quot;</span>/
<a id=__codelineno-21-16 name=__codelineno-21-16 href=#__codelineno-21-16></a>openssl<span class=w> </span>enc<span class=w> </span>-aes-256-cbc<span class=w> </span>-salt<span class=w> </span><span class=se>\</span>
<a id=__codelineno-21-17 name=__codelineno-21-17 href=#__codelineno-21-17></a><span class=w>    </span>-in<span class=w> </span><span class=s2>&quot;</span><span class=nv>$BACKUP_DIR</span><span class=s2>&quot;</span>.tar.gz<span class=w> </span><span class=se>\</span>
<a id=__codelineno-21-18 name=__codelineno-21-18 href=#__codelineno-21-18></a><span class=w>    </span>-out<span class=w> </span><span class=s2>&quot;</span><span class=nv>$BACKUP_DIR</span><span class=s2>&quot;</span>.tar.gz.enc<span class=w> </span><span class=se>\</span>
<a id=__codelineno-21-19 name=__codelineno-21-19 href=#__codelineno-21-19></a><span class=w>    </span>-k<span class=w> </span><span class=s2>&quot;</span><span class=k>$(</span>cat<span class=w> </span>/proc/sys/kernel/random/uuid<span class=k>)</span><span class=s2>&quot;</span><span class=w>  </span><span class=c1># Use strong password!</span>
<a id=__codelineno-21-20 name=__codelineno-21-20 href=#__codelineno-21-20></a>
<a id=__codelineno-21-21 name=__codelineno-21-21 href=#__codelineno-21-21></a><span class=c1># Store password safely!</span>
<a id=__codelineno-21-22 name=__codelineno-21-22 href=#__codelineno-21-22></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Backup created: </span><span class=nv>$BACKUP_DIR</span><span class=s2>.tar.gz.enc&quot;</span>
<a id=__codelineno-21-23 name=__codelineno-21-23 href=#__codelineno-21-23></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Password: &lt;store this securely&gt;&quot;</span>
</code></pre></div> <p><strong>When to Backup:</strong> - After each successful renewal - Before long-term storage - Before any experimental modifications - At least once per year</p> <hr> <h2 id=7-hermes-authentication-flow>7. Hermes Authentication Flow</h2> <h3 id=71-mtls-handshake-sequence>7.1 mTLS Handshake Sequence</h3> <div class=highlight><pre><span></span><code><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
<a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a>â”‚            HERMES MUTUAL TLS (mTLS) HANDSHAKE                     â”‚
<a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
<a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a>
<a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a>[Vehicle]                                     [hermes-api Backend]
<a id=__codelineno-22-6 name=__codelineno-22-6 href=#__codelineno-22-6></a>    â”‚                                                    â”‚
<a id=__codelineno-22-7 name=__codelineno-22-7 href=#__codelineno-22-7></a>    â”œâ”€â”€â”€ ClientHello â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  â”‚
<a id=__codelineno-22-8 name=__codelineno-22-8 href=#__codelineno-22-8></a>    â”‚    - TLS 1.2/1.3                                  â”‚
<a id=__codelineno-22-9 name=__codelineno-22-9 href=#__codelineno-22-9></a>    â”‚    - Cipher suites (ECDHE-ECDSA-AES256-GCM-SHA384)â”‚
<a id=__codelineno-22-10 name=__codelineno-22-10 href=#__codelineno-22-10></a>    â”‚    - SNI: hermes-api.prd.{region}.vn.cloud.tesla.com
<a id=__codelineno-22-11 name=__codelineno-22-11 href=#__codelineno-22-11></a>    â”‚                                                    â”‚
<a id=__codelineno-22-12 name=__codelineno-22-12 href=#__codelineno-22-12></a>    â”‚  â—„â”€â”€â”€ ServerHello â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
<a id=__codelineno-22-13 name=__codelineno-22-13 href=#__codelineno-22-13></a>    â”‚    - Selected cipher                              â”‚
<a id=__codelineno-22-14 name=__codelineno-22-14 href=#__codelineno-22-14></a>    â”‚    - Server certificate chain:                    â”‚
<a id=__codelineno-22-15 name=__codelineno-22-15 href=#__codelineno-22-15></a>    â”‚        [hermes-api cert] â† [Tesla Services CA]    â”‚
<a id=__codelineno-22-16 name=__codelineno-22-16 href=#__codelineno-22-16></a>    â”‚                                                    â”‚
<a id=__codelineno-22-17 name=__codelineno-22-17 href=#__codelineno-22-17></a>    â”œâ”€â”€â”€ Verify server cert â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚
<a id=__codelineno-22-18 name=__codelineno-22-18 href=#__codelineno-22-18></a>    â”‚    - Check against ServicesCAsPrd.pem             â”‚
<a id=__codelineno-22-19 name=__codelineno-22-19 href=#__codelineno-22-19></a>    â”‚    - Validate hostname matches SNI                â”‚
<a id=__codelineno-22-20 name=__codelineno-22-20 href=#__codelineno-22-20></a>    â”‚    - Confirm not expired                          â”‚
<a id=__codelineno-22-21 name=__codelineno-22-21 href=#__codelineno-22-21></a>    â”‚                                                    â”‚
<a id=__codelineno-22-22 name=__codelineno-22-22 href=#__codelineno-22-22></a>    â”‚  â—„â”€â”€â”€ CertificateRequest â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
<a id=__codelineno-22-23 name=__codelineno-22-23 href=#__codelineno-22-23></a>    â”‚    - Backend requests client certificate          â”‚
<a id=__codelineno-22-24 name=__codelineno-22-24 href=#__codelineno-22-24></a>    â”‚                                                    â”‚
<a id=__codelineno-22-25 name=__codelineno-22-25 href=#__codelineno-22-25></a>    â”œâ”€â”€â”€ Client Certificate â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚
<a id=__codelineno-22-26 name=__codelineno-22-26 href=#__codelineno-22-26></a>    â”‚    - Send /var/lib/car_creds/car.crt              â”‚
<a id=__codelineno-22-27 name=__codelineno-22-27 href=#__codelineno-22-27></a>    â”‚    - Send CA chain: ca.crt                        â”‚
<a id=__codelineno-22-28 name=__codelineno-22-28 href=#__codelineno-22-28></a>    â”‚                                                    â”‚
<a id=__codelineno-22-29 name=__codelineno-22-29 href=#__codelineno-22-29></a>    â”œâ”€â”€â”€ CertificateVerify â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚
<a id=__codelineno-22-30 name=__codelineno-22-30 href=#__codelineno-22-30></a>    â”‚    - Signature proving key ownership:             â”‚
<a id=__codelineno-22-31 name=__codelineno-22-31 href=#__codelineno-22-31></a>    â”‚      sign(handshake_hash, car.key)                â”‚
<a id=__codelineno-22-32 name=__codelineno-22-32 href=#__codelineno-22-32></a>    â”‚                                                    â”‚
<a id=__codelineno-22-33 name=__codelineno-22-33 href=#__codelineno-22-33></a>    â”‚                      â—„â”€â”€â”€ Backend validates â”€â”€â”€â”€â”€â”€â”¤
<a id=__codelineno-22-34 name=__codelineno-22-34 href=#__codelineno-22-34></a>    â”‚                           - Cert signed by ProductIssuingCA
<a id=__codelineno-22-35 name=__codelineno-22-35 href=#__codelineno-22-35></a>    â”‚                           - Subject CN matches registered VIN
<a id=__codelineno-22-36 name=__codelineno-22-36 href=#__codelineno-22-36></a>    â”‚                           - Cert not expired
<a id=__codelineno-22-37 name=__codelineno-22-37 href=#__codelineno-22-37></a>    â”‚                           - Cert not revoked (CRL check)
<a id=__codelineno-22-38 name=__codelineno-22-38 href=#__codelineno-22-38></a>    â”‚                           - Signature valid (proves key ownership)
<a id=__codelineno-22-39 name=__codelineno-22-39 href=#__codelineno-22-39></a>    â”‚                                                    â”‚
<a id=__codelineno-22-40 name=__codelineno-22-40 href=#__codelineno-22-40></a>    â”‚  â—„â”€â”€â”€ Finished (encrypted) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
<a id=__codelineno-22-41 name=__codelineno-22-41 href=#__codelineno-22-41></a>    â”‚    - Handshake complete                           â”‚
<a id=__codelineno-22-42 name=__codelineno-22-42 href=#__codelineno-22-42></a>    â”‚                                                    â”‚
<a id=__codelineno-22-43 name=__codelineno-22-43 href=#__codelineno-22-43></a>    â”œâ”€â”€â”€ Finished (encrypted) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚
<a id=__codelineno-22-44 name=__codelineno-22-44 href=#__codelineno-22-44></a>    â”‚                                                    â”‚
<a id=__codelineno-22-45 name=__codelineno-22-45 href=#__codelineno-22-45></a>    â”‚â•â•â• Secure WebSocket Connection Established â•â•â•â•â•â•â–ºâ”‚
<a id=__codelineno-22-46 name=__codelineno-22-46 href=#__codelineno-22-46></a>    â”‚                                                    â”‚
<a id=__codelineno-22-47 name=__codelineno-22-47 href=#__codelineno-22-47></a>    â”œâ”€â”€â”€ Application data (JSON/Protobuf messages) â”€â”€â”€â–º â”‚
<a id=__codelineno-22-48 name=__codelineno-22-48 href=#__codelineno-22-48></a>    â”‚  â—„â”€â”€â”€ Application responses â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
<a id=__codelineno-22-49 name=__codelineno-22-49 href=#__codelineno-22-49></a>    â”‚                                                    â”‚
</code></pre></div> <h3 id=72-certificate-validation-logic-backend>7.2 Certificate Validation Logic (Backend)</h3> <p><strong>Pseudocode (inferred):</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=k>def</span><span class=w> </span><span class=nf>validate_client_certificate</span><span class=p>(</span><span class=n>cert</span><span class=p>,</span> <span class=n>vin_from_db</span><span class=p>):</span>
<a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a>    <span class=c1># 1. Check certificate chain</span>
<a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a>    <span class=k>if</span> <span class=ow>not</span> <span class=n>verify_chain</span><span class=p>(</span><span class=n>cert</span><span class=p>,</span> <span class=n>ProductIssuingCA</span><span class=p>):</span>
<a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a>        <span class=k>return</span> <span class=n>AuthError</span><span class=p>(</span><span class=s2>&quot;Invalid certificate chain&quot;</span><span class=p>)</span>
<a id=__codelineno-23-5 name=__codelineno-23-5 href=#__codelineno-23-5></a>
<a id=__codelineno-23-6 name=__codelineno-23-6 href=#__codelineno-23-6></a>    <span class=c1># 2. Check expiry</span>
<a id=__codelineno-23-7 name=__codelineno-23-7 href=#__codelineno-23-7></a>    <span class=k>if</span> <span class=n>cert</span><span class=o>.</span><span class=n>not_after</span> <span class=o>&lt;</span> <span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>():</span>
<a id=__codelineno-23-8 name=__codelineno-23-8 href=#__codelineno-23-8></a>        <span class=k>return</span> <span class=n>AuthError</span><span class=p>(</span><span class=s2>&quot;Certificate expired&quot;</span><span class=p>)</span>
<a id=__codelineno-23-9 name=__codelineno-23-9 href=#__codelineno-23-9></a>
<a id=__codelineno-23-10 name=__codelineno-23-10 href=#__codelineno-23-10></a>    <span class=c1># 3. Check VIN match</span>
<a id=__codelineno-23-11 name=__codelineno-23-11 href=#__codelineno-23-11></a>    <span class=n>cert_vin</span> <span class=o>=</span> <span class=n>cert</span><span class=o>.</span><span class=n>subject</span><span class=o>.</span><span class=n>CN</span>
<a id=__codelineno-23-12 name=__codelineno-23-12 href=#__codelineno-23-12></a>    <span class=k>if</span> <span class=n>cert_vin</span> <span class=o>!=</span> <span class=n>vin_from_db</span><span class=p>:</span>
<a id=__codelineno-23-13 name=__codelineno-23-13 href=#__codelineno-23-13></a>        <span class=k>return</span> <span class=n>AuthError</span><span class=p>(</span><span class=s2>&quot;VIN mismatch&quot;</span><span class=p>)</span>
<a id=__codelineno-23-14 name=__codelineno-23-14 href=#__codelineno-23-14></a>
<a id=__codelineno-23-15 name=__codelineno-23-15 href=#__codelineno-23-15></a>    <span class=c1># 4. Check CRL (Certificate Revocation List)</span>
<a id=__codelineno-23-16 name=__codelineno-23-16 href=#__codelineno-23-16></a>    <span class=k>if</span> <span class=n>is_revoked</span><span class=p>(</span><span class=n>cert</span><span class=o>.</span><span class=n>serial_number</span><span class=p>):</span>
<a id=__codelineno-23-17 name=__codelineno-23-17 href=#__codelineno-23-17></a>        <span class=k>return</span> <span class=n>AuthError</span><span class=p>(</span><span class=s2>&quot;Certificate revoked&quot;</span><span class=p>)</span>
<a id=__codelineno-23-18 name=__codelineno-23-18 href=#__codelineno-23-18></a>
<a id=__codelineno-23-19 name=__codelineno-23-19 href=#__codelineno-23-19></a>    <span class=c1># 5. Check blacklist (from string: &quot;blacklisted certificate&quot;)</span>
<a id=__codelineno-23-20 name=__codelineno-23-20 href=#__codelineno-23-20></a>    <span class=k>if</span> <span class=n>cert</span><span class=o>.</span><span class=n>serial_number</span> <span class=ow>in</span> <span class=n>blacklisted_serials</span><span class=p>:</span>
<a id=__codelineno-23-21 name=__codelineno-23-21 href=#__codelineno-23-21></a>        <span class=k>return</span> <span class=n>AuthError</span><span class=p>(</span><span class=s2>&quot;Certificate blacklisted&quot;</span><span class=p>)</span>
<a id=__codelineno-23-22 name=__codelineno-23-22 href=#__codelineno-23-22></a>
<a id=__codelineno-23-23 name=__codelineno-23-23 href=#__codelineno-23-23></a>    <span class=c1># 6. Verify signature (proves key ownership)</span>
<a id=__codelineno-23-24 name=__codelineno-23-24 href=#__codelineno-23-24></a>    <span class=c1># This is handled by TLS layer automatically</span>
<a id=__codelineno-23-25 name=__codelineno-23-25 href=#__codelineno-23-25></a>
<a id=__codelineno-23-26 name=__codelineno-23-26 href=#__codelineno-23-26></a>    <span class=k>return</span> <span class=n>AuthSuccess</span><span class=p>(</span><span class=n>vin</span><span class=o>=</span><span class=n>cert_vin</span><span class=p>)</span>
</code></pre></div> <h3 id=73-service-principal-override>7.3 Service Principal Override</h3> <p><strong>From <code>/etc/service-shell/principals.d/hermes/mothership</code>:</strong></p> <p>Service technicians use special credentials that bypass normal device cert expiry checks:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a># Service principal allows:
<a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a>- Authentication even with expired device certificate
<a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a>- Manual CSR signing via privileged API
<a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a>- Certificate reprovisioning
<a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a>- Factory reset override
</code></pre></div> <p><strong>Service Flow:</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a>[Technician Laptop] â”€â”€â”€â”€â”€â”€â–º [Service Tunnel] â”€â”€â”€â”€â”€â”€â–º [Vehicle]
<a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a>    â”‚                            â”‚                        â”‚
<a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a>    â”‚ (Uses service principal    â”‚                        â”‚
<a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a>    â”‚  certificate)              â”‚                        â”‚
<a id=__codelineno-25-5 name=__codelineno-25-5 href=#__codelineno-25-5></a>    â”‚                            â”‚                        â”‚
<a id=__codelineno-25-6 name=__codelineno-25-6 href=#__codelineno-25-6></a>    â”œâ”€â”€â”€â”€ Authenticate to â”€â”€â”€â”€â”€â”€â”€â”´â”€â–º Tesla Backend        â”‚
<a id=__codelineno-25-7 name=__codelineno-25-7 href=#__codelineno-25-7></a>    â”‚     service endpoint                                â”‚
<a id=__codelineno-25-8 name=__codelineno-25-8 href=#__codelineno-25-8></a>    â”‚                                                      â”‚
<a id=__codelineno-25-9 name=__codelineno-25-9 href=#__codelineno-25-9></a>    â”œâ”€â”€â”€â”€ Request vehicle access â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚
<a id=__codelineno-25-10 name=__codelineno-25-10 href=#__codelineno-25-10></a>    â”‚     (VIN + service token)                           â”‚
<a id=__codelineno-25-11 name=__codelineno-25-11 href=#__codelineno-25-11></a>    â”‚                                                      â”‚
<a id=__codelineno-25-12 name=__codelineno-25-12 href=#__codelineno-25-12></a>    â”‚  â—„â”€â”€â”€â”€ Backend opens tunnel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
<a id=__codelineno-25-13 name=__codelineno-25-13 href=#__codelineno-25-13></a>    â”‚        (via LTE/WiFi)                               â”‚
<a id=__codelineno-25-14 name=__codelineno-25-14 href=#__codelineno-25-14></a>    â”‚                                                      â”‚
<a id=__codelineno-25-15 name=__codelineno-25-15 href=#__codelineno-25-15></a>    â”œâ”€â”€â”€â”€ Send CSR via tunnel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚
<a id=__codelineno-25-16 name=__codelineno-25-16 href=#__codelineno-25-16></a>    â”‚                                                      â”‚
<a id=__codelineno-25-17 name=__codelineno-25-17 href=#__codelineno-25-17></a>    â”‚  â—„â”€â”€â”€â”€ Signed cert returned â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
<a id=__codelineno-25-18 name=__codelineno-25-18 href=#__codelineno-25-18></a>    â”‚        (via service channel)                        â”‚
<a id=__codelineno-25-19 name=__codelineno-25-19 href=#__codelineno-25-19></a>    â”‚                                                      â”‚
<a id=__codelineno-25-20 name=__codelineno-25-20 href=#__codelineno-25-20></a>    â””â”€â”€â”€â”€ Install cert â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚
<a id=__codelineno-25-21 name=__codelineno-25-21 href=#__codelineno-25-21></a>          systemctl restart hermes_client
</code></pre></div> <hr> <h2 id=8-offline-grace-periods>8. Offline Grace Periods</h2> <h3 id=81-connectivity-requirements>8.1 Connectivity Requirements</h3> <p><strong>Normal Operation:</strong> - Vehicle needs connectivity <strong>during renewal window</strong> (30-90 days before expiry) - If offline during this period â†’ Orphan risk increases</p> <p><strong>Post-Expiry:</strong> - Local functions (driving, climate, navigation) <strong>continue working</strong> - Remote functions (Tesla app, OTA) <strong>cease working</strong></p> <p><strong>Unknown Variables:</strong> - Is there a grace period after expiry? - Does backend allow late renewal after expiry? - How long can vehicle stay orphaned before service required?</p> <h3 id=82-connectivity-test-procedure>8.2 Connectivity Test Procedure</h3> <p><strong>Check if vehicle can reach renewal servers:</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a><span class=c1># Test Hermes connectivity</span>
<a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a>
<a id=__codelineno-26-4 name=__codelineno-26-4 href=#__codelineno-26-4></a><span class=nv>REGION</span><span class=o>=</span><span class=k>$(</span>cat<span class=w> </span>/var/etc/country<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-oP<span class=w> </span><span class=s1>&#39;region=\K\w+&#39;</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;na&quot;</span><span class=k>)</span>
<a id=__codelineno-26-5 name=__codelineno-26-5 href=#__codelineno-26-5></a><span class=nv>ENDPOINT</span><span class=o>=</span><span class=s2>&quot;hermes-api.prd.</span><span class=si>${</span><span class=nv>REGION</span><span class=si>}</span><span class=s2>.vn.cloud.tesla.com&quot;</span>
<a id=__codelineno-26-6 name=__codelineno-26-6 href=#__codelineno-26-6></a>
<a id=__codelineno-26-7 name=__codelineno-26-7 href=#__codelineno-26-7></a><span class=c1># Test DNS resolution</span>
<a id=__codelineno-26-8 name=__codelineno-26-8 href=#__codelineno-26-8></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Testing DNS resolution...&quot;</span>
<a id=__codelineno-26-9 name=__codelineno-26-9 href=#__codelineno-26-9></a>nslookup<span class=w> </span><span class=s2>&quot;</span><span class=nv>$ENDPOINT</span><span class=s2>&quot;</span>
<a id=__codelineno-26-10 name=__codelineno-26-10 href=#__codelineno-26-10></a>
<a id=__codelineno-26-11 name=__codelineno-26-11 href=#__codelineno-26-11></a><span class=c1># Test HTTPS connectivity</span>
<a id=__codelineno-26-12 name=__codelineno-26-12 href=#__codelineno-26-12></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Testing HTTPS connection...&quot;</span>
<a id=__codelineno-26-13 name=__codelineno-26-13 href=#__codelineno-26-13></a>curl<span class=w> </span>-v<span class=w> </span>--cert<span class=w> </span>/var/lib/car_creds/car.crt<span class=w> </span><span class=se>\</span>
<a id=__codelineno-26-14 name=__codelineno-26-14 href=#__codelineno-26-14></a><span class=w>        </span>--key<span class=w> </span>/var/lib/car_creds/car.key<span class=w> </span><span class=se>\</span>
<a id=__codelineno-26-15 name=__codelineno-26-15 href=#__codelineno-26-15></a><span class=w>        </span>--cacert<span class=w> </span>/var/lib/car_creds/ca.crt<span class=w> </span><span class=se>\</span>
<a id=__codelineno-26-16 name=__codelineno-26-16 href=#__codelineno-26-16></a><span class=w>        </span><span class=s2>&quot;https://</span><span class=nv>$ENDPOINT</span><span class=s2>:443&quot;</span><span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span><span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-i<span class=w> </span><span class=s2>&quot;handshake\|connected&quot;</span>
<a id=__codelineno-26-17 name=__codelineno-26-17 href=#__codelineno-26-17></a>
<a id=__codelineno-26-18 name=__codelineno-26-18 href=#__codelineno-26-18></a><span class=c1># Expected success output:</span>
<a id=__codelineno-26-19 name=__codelineno-26-19 href=#__codelineno-26-19></a><span class=c1># &quot;TLS handshake&quot;</span>
<a id=__codelineno-26-20 name=__codelineno-26-20 href=#__codelineno-26-20></a><span class=c1># &quot;Connected to hermes-api...&quot;</span>
<a id=__codelineno-26-21 name=__codelineno-26-21 href=#__codelineno-26-21></a>
<a id=__codelineno-26-22 name=__codelineno-26-22 href=#__codelineno-26-22></a><span class=c1># Expected orphan failure:</span>
<a id=__codelineno-26-23 name=__codelineno-26-23 href=#__codelineno-26-23></a><span class=c1># &quot;certificate verify failed&quot;</span>
<a id=__codelineno-26-24 name=__codelineno-26-24 href=#__codelineno-26-24></a><span class=c1># &quot;certificate has expired&quot;</span>
</code></pre></div> <h3 id=83-pre-storage-checklist>8.3 Pre-Storage Checklist</h3> <p><strong>Before storing vehicle long-term (&gt;60 days):</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a><span class=c1># 1. Check certificate expiry</span>
<a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a><span class=nv>EXPIRY</span><span class=o>=</span><span class=k>$(</span>openssl<span class=w> </span>x509<span class=w> </span>-in<span class=w> </span>/var/lib/car_creds/car.crt<span class=w> </span>-noout<span class=w> </span>-enddate<span class=w> </span><span class=p>|</span><span class=w> </span>cut<span class=w> </span>-d<span class=o>=</span><span class=w> </span>-f2<span class=k>)</span>
<a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a><span class=nv>EXPIRY_TS</span><span class=o>=</span><span class=k>$(</span>date<span class=w> </span>-d<span class=w> </span><span class=s2>&quot;</span><span class=nv>$EXPIRY</span><span class=s2>&quot;</span><span class=w> </span>+%s<span class=k>)</span>
<a id=__codelineno-27-4 name=__codelineno-27-4 href=#__codelineno-27-4></a><span class=nv>NOW_TS</span><span class=o>=</span><span class=k>$(</span>date<span class=w> </span>+%s<span class=k>)</span>
<a id=__codelineno-27-5 name=__codelineno-27-5 href=#__codelineno-27-5></a><span class=nv>DAYS_LEFT</span><span class=o>=</span><span class=k>$((</span><span class=w> </span><span class=o>(</span><span class=nv>$EXPIRY_TS</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=nv>$NOW_TS</span><span class=o>)</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=m>86400</span><span class=w> </span><span class=k>))</span>
<a id=__codelineno-27-6 name=__codelineno-27-6 href=#__codelineno-27-6></a>
<a id=__codelineno-27-7 name=__codelineno-27-7 href=#__codelineno-27-7></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Certificate expires in </span><span class=nv>$DAYS_LEFT</span><span class=s2> days&quot;</span>
<a id=__codelineno-27-8 name=__codelineno-27-8 href=#__codelineno-27-8></a>
<a id=__codelineno-27-9 name=__codelineno-27-9 href=#__codelineno-27-9></a><span class=c1># 2. If less than 180 days, ensure renewal before storage</span>
<a id=__codelineno-27-10 name=__codelineno-27-10 href=#__codelineno-27-10></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$DAYS_LEFT</span><span class=w> </span>-lt<span class=w> </span><span class=m>180</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-27-11 name=__codelineno-27-11 href=#__codelineno-27-11></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;WARNING: Certificate may expire during storage&quot;</span>
<a id=__codelineno-27-12 name=__codelineno-27-12 href=#__codelineno-27-12></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Connect to WiFi/LTE for renewal before parking&quot;</span>
<a id=__codelineno-27-13 name=__codelineno-27-13 href=#__codelineno-27-13></a><span class=k>fi</span>
<a id=__codelineno-27-14 name=__codelineno-27-14 href=#__codelineno-27-14></a>
<a id=__codelineno-27-15 name=__codelineno-27-15 href=#__codelineno-27-15></a><span class=c1># 3. Connect to WiFi (if available)</span>
<a id=__codelineno-27-16 name=__codelineno-27-16 href=#__codelineno-27-16></a><span class=c1># Navigate to: Settings â†’ WiFi â†’ Connect</span>
<a id=__codelineno-27-17 name=__codelineno-27-17 href=#__codelineno-27-17></a>
<a id=__codelineno-27-18 name=__codelineno-27-18 href=#__codelineno-27-18></a><span class=c1># 4. Force renewal check (if possible)</span>
<a id=__codelineno-27-19 name=__codelineno-27-19 href=#__codelineno-27-19></a><span class=c1># No known user-accessible command; may require service access</span>
<a id=__codelineno-27-20 name=__codelineno-27-20 href=#__codelineno-27-20></a>
<a id=__codelineno-27-21 name=__codelineno-27-21 href=#__codelineno-27-21></a><span class=c1># 5. Verify renewal occurred</span>
<a id=__codelineno-27-22 name=__codelineno-27-22 href=#__codelineno-27-22></a>sleep<span class=w> </span><span class=m>300</span><span class=w>  </span><span class=c1># Wait 5 minutes</span>
<a id=__codelineno-27-23 name=__codelineno-27-23 href=#__codelineno-27-23></a><span class=nv>NEW_EXPIRY</span><span class=o>=</span><span class=k>$(</span>openssl<span class=w> </span>x509<span class=w> </span>-in<span class=w> </span>/var/lib/car_creds/car.crt<span class=w> </span>-noout<span class=w> </span>-enddate<span class=w> </span><span class=p>|</span><span class=w> </span>cut<span class=w> </span>-d<span class=o>=</span><span class=w> </span>-f2<span class=k>)</span>
<a id=__codelineno-27-24 name=__codelineno-27-24 href=#__codelineno-27-24></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$NEW_EXPIRY</span><span class=s2>&quot;</span><span class=w> </span>!<span class=o>=</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$EXPIRY</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-27-25 name=__codelineno-27-25 href=#__codelineno-27-25></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;âœ… Certificate renewed successfully&quot;</span>
<a id=__codelineno-27-26 name=__codelineno-27-26 href=#__codelineno-27-26></a><span class=k>else</span>
<a id=__codelineno-27-27 name=__codelineno-27-27 href=#__codelineno-27-27></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;âš ï¸  No renewal detected â€” storage at risk&quot;</span>
<a id=__codelineno-27-28 name=__codelineno-27-28 href=#__codelineno-27-28></a><span class=k>fi</span>
</code></pre></div> <hr> <h2 id=9-certificate-pinning-in-binaries>9. Certificate Pinning in Binaries</h2> <h3 id=91-pinning-discovery>9.1 Pinning Discovery</h3> <p><strong>From <code>hermes_client</code> strings analysis:</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a>Tesla Issuing CA
<a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a>Tesla Product Partners Issuing CA
<a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a>Tesla Motors DAS Server Clients CA
<a id=__codelineno-28-4 name=__codelineno-28-4 href=#__codelineno-28-4></a>/usr/share/tesla-certificates/current/ProductIssuingCA.pem
<a id=__codelineno-28-5 name=__codelineno-28-5 href=#__codelineno-28-5></a>/usr/share/tesla-certificates/current/GF3ProductIssuingCA.pem
<a id=__codelineno-28-6 name=__codelineno-28-6 href=#__codelineno-28-6></a>/usr/share/tesla-certificates/current/GFAustinProductIssuingCA.pem
<a id=__codelineno-28-7 name=__codelineno-28-7 href=#__codelineno-28-7></a>/usr/share/tesla-certificates/current/GFBerlinProductIssuingCA.pem
<a id=__codelineno-28-8 name=__codelineno-28-8 href=#__codelineno-28-8></a>/usr/share/tesla-certificates/combined/ProductsCAs.pem
<a id=__codelineno-28-9 name=__codelineno-28-9 href=#__codelineno-28-9></a>/usr/share/tesla-certificates/combined/ServicesCAs.pem
</code></pre></div> <p><strong>Pinning Method:</strong> - hermes_client <strong>embeds paths to CA certificates</strong> - During TLS handshake, verifies server cert against pinned CAs - Prevents man-in-the-middle with rogue CA</p> <h3 id=92-validation-flow>9.2 Validation Flow</h3> <div class=highlight><pre><span></span><code><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a><span class=c1>// Pseudocode reconstruction from binary analysis</span>
<a id=__codelineno-29-2 name=__codelineno-29-2 href=#__codelineno-29-2></a>
<a id=__codelineno-29-3 name=__codelineno-29-3 href=#__codelineno-29-3></a><span class=kt>bool</span><span class=w> </span><span class=nf>verify_hermes_server_cert</span><span class=p>(</span><span class=n>X509</span><span class=o>*</span><span class=w> </span><span class=n>server_cert</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-29-4 name=__codelineno-29-4 href=#__codelineno-29-4></a><span class=w>    </span><span class=c1>// Load pinned CA bundle</span>
<a id=__codelineno-29-5 name=__codelineno-29-5 href=#__codelineno-29-5></a><span class=w>    </span><span class=n>X509_STORE</span><span class=o>*</span><span class=w> </span><span class=n>ca_store</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>X509_STORE_new</span><span class=p>();</span>
<a id=__codelineno-29-6 name=__codelineno-29-6 href=#__codelineno-29-6></a>
<a id=__codelineno-29-7 name=__codelineno-29-7 href=#__codelineno-29-7></a><span class=w>    </span><span class=c1>// Add each pinned CA</span>
<a id=__codelineno-29-8 name=__codelineno-29-8 href=#__codelineno-29-8></a><span class=w>    </span><span class=n>load_ca_cert</span><span class=p>(</span><span class=n>ca_store</span><span class=p>,</span><span class=w> </span><span class=s>&quot;/usr/share/tesla-certificates/current/ProductIssuingCA.pem&quot;</span><span class=p>);</span>
<a id=__codelineno-29-9 name=__codelineno-29-9 href=#__codelineno-29-9></a><span class=w>    </span><span class=n>load_ca_cert</span><span class=p>(</span><span class=n>ca_store</span><span class=p>,</span><span class=w> </span><span class=s>&quot;/usr/share/tesla-certificates/combined/ServicesCAs.pem&quot;</span><span class=p>);</span>
<a id=__codelineno-29-10 name=__codelineno-29-10 href=#__codelineno-29-10></a>
<a id=__codelineno-29-11 name=__codelineno-29-11 href=#__codelineno-29-11></a><span class=w>    </span><span class=c1>// Verify server cert against pinned CAs</span>
<a id=__codelineno-29-12 name=__codelineno-29-12 href=#__codelineno-29-12></a><span class=w>    </span><span class=n>X509_STORE_CTX</span><span class=o>*</span><span class=w> </span><span class=n>ctx</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>X509_STORE_CTX_new</span><span class=p>();</span>
<a id=__codelineno-29-13 name=__codelineno-29-13 href=#__codelineno-29-13></a><span class=w>    </span><span class=n>X509_STORE_CTX_init</span><span class=p>(</span><span class=n>ctx</span><span class=p>,</span><span class=w> </span><span class=n>ca_store</span><span class=p>,</span><span class=w> </span><span class=n>server_cert</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>);</span>
<a id=__codelineno-29-14 name=__codelineno-29-14 href=#__codelineno-29-14></a>
<a id=__codelineno-29-15 name=__codelineno-29-15 href=#__codelineno-29-15></a><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>X509_verify_cert</span><span class=p>(</span><span class=n>ctx</span><span class=p>);</span>
<a id=__codelineno-29-16 name=__codelineno-29-16 href=#__codelineno-29-16></a>
<a id=__codelineno-29-17 name=__codelineno-29-17 href=#__codelineno-29-17></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>result</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-29-18 name=__codelineno-29-18 href=#__codelineno-29-18></a><span class=w>        </span><span class=n>log_error</span><span class=p>(</span><span class=s>&quot;Server certificate verification failed: %s&quot;</span><span class=p>,</span>
<a id=__codelineno-29-19 name=__codelineno-29-19 href=#__codelineno-29-19></a><span class=w>                  </span><span class=n>X509_verify_cert_error_string</span><span class=p>(</span><span class=n>X509_STORE_CTX_get_error</span><span class=p>(</span><span class=n>ctx</span><span class=p>)));</span>
<a id=__codelineno-29-20 name=__codelineno-29-20 href=#__codelineno-29-20></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nb>false</span><span class=p>;</span>
<a id=__codelineno-29-21 name=__codelineno-29-21 href=#__codelineno-29-21></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-29-22 name=__codelineno-29-22 href=#__codelineno-29-22></a>
<a id=__codelineno-29-23 name=__codelineno-29-23 href=#__codelineno-29-23></a><span class=w>    </span><span class=c1>// Additional check: hostname validation</span>
<a id=__codelineno-29-24 name=__codelineno-29-24 href=#__codelineno-29-24></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>X509_check_host</span><span class=p>(</span><span class=n>server_cert</span><span class=p>,</span><span class=w> </span><span class=s>&quot;hermes-api.prd.*.vn.cloud.tesla.com&quot;</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=nb>NULL</span><span class=p>))</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-29-25 name=__codelineno-29-25 href=#__codelineno-29-25></a><span class=w>        </span><span class=n>log_error</span><span class=p>(</span><span class=s>&quot;Hostname mismatch&quot;</span><span class=p>);</span>
<a id=__codelineno-29-26 name=__codelineno-29-26 href=#__codelineno-29-26></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nb>false</span><span class=p>;</span>
<a id=__codelineno-29-27 name=__codelineno-29-27 href=#__codelineno-29-27></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-29-28 name=__codelineno-29-28 href=#__codelineno-29-28></a>
<a id=__codelineno-29-29 name=__codelineno-29-29 href=#__codelineno-29-29></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nb>true</span><span class=p>;</span>
<a id=__codelineno-29-30 name=__codelineno-29-30 href=#__codelineno-29-30></a><span class=p>}</span>
</code></pre></div> <h3 id=93-pinning-implications>9.3 Pinning Implications</h3> <p><strong>Security Benefits:</strong> - Prevents MITM with fake CA (e.g., corporate proxy) - Even if OS trust store compromised, Tesla CAs are separate - Protects against certificate misissuance</p> <p><strong>Operational Challenges:</strong> - Corporate networks with SSL inspection may break connectivity - Requires network to allow direct TLS to Tesla backend - Firewall exceptions needed for hermes-api endpoints</p> <hr> <h2 id=10-backup-recovery-procedures>10. Backup &amp; Recovery Procedures</h2> <h3 id=101-automated-backup-script>10.1 Automated Backup Script</h3> <div class=highlight><pre><span></span><code><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-30-2 name=__codelineno-30-2 href=#__codelineno-30-2></a><span class=c1># /opt/scripts/cert_backup.sh</span>
<a id=__codelineno-30-3 name=__codelineno-30-3 href=#__codelineno-30-3></a><span class=c1># Tesla Certificate Backup Utility</span>
<a id=__codelineno-30-4 name=__codelineno-30-4 href=#__codelineno-30-4></a>
<a id=__codelineno-30-5 name=__codelineno-30-5 href=#__codelineno-30-5></a><span class=nb>set</span><span class=w> </span>-euo<span class=w> </span>pipefail
<a id=__codelineno-30-6 name=__codelineno-30-6 href=#__codelineno-30-6></a>
<a id=__codelineno-30-7 name=__codelineno-30-7 href=#__codelineno-30-7></a><span class=nv>BACKUP_ROOT</span><span class=o>=</span><span class=s2>&quot;/persist/cert_backups&quot;</span>
<a id=__codelineno-30-8 name=__codelineno-30-8 href=#__codelineno-30-8></a><span class=nv>TIMESTAMP</span><span class=o>=</span><span class=k>$(</span>date<span class=w> </span>+%Y%m%d_%H%M%S<span class=k>)</span>
<a id=__codelineno-30-9 name=__codelineno-30-9 href=#__codelineno-30-9></a><span class=nv>BACKUP_DIR</span><span class=o>=</span><span class=s2>&quot;</span><span class=nv>$BACKUP_ROOT</span><span class=s2>/backup_</span><span class=nv>$TIMESTAMP</span><span class=s2>&quot;</span>
<a id=__codelineno-30-10 name=__codelineno-30-10 href=#__codelineno-30-10></a>
<a id=__codelineno-30-11 name=__codelineno-30-11 href=#__codelineno-30-11></a><span class=c1># Create backup directory</span>
<a id=__codelineno-30-12 name=__codelineno-30-12 href=#__codelineno-30-12></a>mkdir<span class=w> </span>-p<span class=w> </span><span class=s2>&quot;</span><span class=nv>$BACKUP_DIR</span><span class=s2>&quot;</span>
<a id=__codelineno-30-13 name=__codelineno-30-13 href=#__codelineno-30-13></a>
<a id=__codelineno-30-14 name=__codelineno-30-14 href=#__codelineno-30-14></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;=== Tesla Certificate Backup Started ===&quot;</span>
<a id=__codelineno-30-15 name=__codelineno-30-15 href=#__codelineno-30-15></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Timestamp: </span><span class=nv>$TIMESTAMP</span><span class=s2>&quot;</span>
<a id=__codelineno-30-16 name=__codelineno-30-16 href=#__codelineno-30-16></a>
<a id=__codelineno-30-17 name=__codelineno-30-17 href=#__codelineno-30-17></a><span class=c1># Backup certificate files</span>
<a id=__codelineno-30-18 name=__codelineno-30-18 href=#__codelineno-30-18></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Backing up /var/lib/car_creds/...&quot;</span>
<a id=__codelineno-30-19 name=__codelineno-30-19 href=#__codelineno-30-19></a>cp<span class=w> </span>-r<span class=w> </span>/var/lib/car_creds/*<span class=w> </span><span class=s2>&quot;</span><span class=nv>$BACKUP_DIR</span><span class=s2>&quot;</span>/
<a id=__codelineno-30-20 name=__codelineno-30-20 href=#__codelineno-30-20></a>
<a id=__codelineno-30-21 name=__codelineno-30-21 href=#__codelineno-30-21></a><span class=c1># Backup persistent copy</span>
<a id=__codelineno-30-22 name=__codelineno-30-22 href=#__codelineno-30-22></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Backing up /persist/car_creds/...&quot;</span>
<a id=__codelineno-30-23 name=__codelineno-30-23 href=#__codelineno-30-23></a>mkdir<span class=w> </span>-p<span class=w> </span><span class=s2>&quot;</span><span class=nv>$BACKUP_DIR</span><span class=s2>&quot;</span>/persist
<a id=__codelineno-30-24 name=__codelineno-30-24 href=#__codelineno-30-24></a>cp<span class=w> </span>-r<span class=w> </span>/persist/car_creds/*<span class=w> </span><span class=s2>&quot;</span><span class=nv>$BACKUP_DIR</span><span class=s2>&quot;</span>/persist/
<a id=__codelineno-30-25 name=__codelineno-30-25 href=#__codelineno-30-25></a>
<a id=__codelineno-30-26 name=__codelineno-30-26 href=#__codelineno-30-26></a><span class=c1># Backup vehicle config</span>
<a id=__codelineno-30-27 name=__codelineno-30-27 href=#__codelineno-30-27></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Backing up vehicle configuration...&quot;</span>
<a id=__codelineno-30-28 name=__codelineno-30-28 href=#__codelineno-30-28></a>cp<span class=w> </span>/etc/tesla/vehicle.json<span class=w> </span><span class=s2>&quot;</span><span class=nv>$BACKUP_DIR</span><span class=s2>&quot;</span>/vehicle.json
<a id=__codelineno-30-29 name=__codelineno-30-29 href=#__codelineno-30-29></a>
<a id=__codelineno-30-30 name=__codelineno-30-30 href=#__codelineno-30-30></a><span class=c1># Record certificate details</span>
<a id=__codelineno-30-31 name=__codelineno-30-31 href=#__codelineno-30-31></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Recording certificate metadata...&quot;</span>
<a id=__codelineno-30-32 name=__codelineno-30-32 href=#__codelineno-30-32></a>openssl<span class=w> </span>x509<span class=w> </span>-in<span class=w> </span>/var/lib/car_creds/car.crt<span class=w> </span>-text<span class=w> </span>-noout<span class=w> </span>&gt;<span class=w> </span><span class=s2>&quot;</span><span class=nv>$BACKUP_DIR</span><span class=s2>&quot;</span>/cert_details.txt
<a id=__codelineno-30-33 name=__codelineno-30-33 href=#__codelineno-30-33></a>openssl<span class=w> </span>x509<span class=w> </span>-in<span class=w> </span>/var/lib/car_creds/car.crt<span class=w> </span>-noout<span class=w> </span>-dates<span class=w> </span>&gt;<span class=w> </span><span class=s2>&quot;</span><span class=nv>$BACKUP_DIR</span><span class=s2>&quot;</span>/cert_dates.txt
<a id=__codelineno-30-34 name=__codelineno-30-34 href=#__codelineno-30-34></a>
<a id=__codelineno-30-35 name=__codelineno-30-35 href=#__codelineno-30-35></a><span class=c1># Create manifest</span>
<a id=__codelineno-30-36 name=__codelineno-30-36 href=#__codelineno-30-36></a>cat<span class=w> </span>&gt;<span class=w> </span><span class=s2>&quot;</span><span class=nv>$BACKUP_DIR</span><span class=s2>&quot;</span>/MANIFEST.txt<span class=w> </span><span class=s>&lt;&lt; EOF</span>
<a id=__codelineno-30-37 name=__codelineno-30-37 href=#__codelineno-30-37></a><span class=s>Tesla Certificate Backup</span>
<a id=__codelineno-30-38 name=__codelineno-30-38 href=#__codelineno-30-38></a><span class=s>========================</span>
<a id=__codelineno-30-39 name=__codelineno-30-39 href=#__codelineno-30-39></a><span class=s>Date: $(date)</span>
<a id=__codelineno-30-40 name=__codelineno-30-40 href=#__codelineno-30-40></a><span class=s>VIN: $(cat /etc/tesla/vehicle.json | jq -r &#39;.vin&#39;)</span>
<a id=__codelineno-30-41 name=__codelineno-30-41 href=#__codelineno-30-41></a><span class=s>Certificate Expiry: $(openssl x509 -in /var/lib/car_creds/car.crt -noout -enddate)</span>
<a id=__codelineno-30-42 name=__codelineno-30-42 href=#__codelineno-30-42></a><span class=s>Backup Location: $BACKUP_DIR</span>
<a id=__codelineno-30-43 name=__codelineno-30-43 href=#__codelineno-30-43></a>
<a id=__codelineno-30-44 name=__codelineno-30-44 href=#__codelineno-30-44></a><span class=s>Files Backed Up:</span>
<a id=__codelineno-30-45 name=__codelineno-30-45 href=#__codelineno-30-45></a><span class=s>$(ls -lah &quot;$BACKUP_DIR&quot;)</span>
<a id=__codelineno-30-46 name=__codelineno-30-46 href=#__codelineno-30-46></a><span class=s>EOF</span>
<a id=__codelineno-30-47 name=__codelineno-30-47 href=#__codelineno-30-47></a>
<a id=__codelineno-30-48 name=__codelineno-30-48 href=#__codelineno-30-48></a><span class=c1># Create compressed archive</span>
<a id=__codelineno-30-49 name=__codelineno-30-49 href=#__codelineno-30-49></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Creating compressed archive...&quot;</span>
<a id=__codelineno-30-50 name=__codelineno-30-50 href=#__codelineno-30-50></a>tar<span class=w> </span>-czf<span class=w> </span><span class=s2>&quot;</span><span class=nv>$BACKUP_DIR</span><span class=s2>&quot;</span>.tar.gz<span class=w> </span>-C<span class=w> </span><span class=s2>&quot;</span><span class=nv>$BACKUP_ROOT</span><span class=s2>&quot;</span><span class=w> </span><span class=s2>&quot;backup_</span><span class=nv>$TIMESTAMP</span><span class=s2>&quot;</span>
<a id=__codelineno-30-51 name=__codelineno-30-51 href=#__codelineno-30-51></a>
<a id=__codelineno-30-52 name=__codelineno-30-52 href=#__codelineno-30-52></a><span class=c1># Calculate checksum</span>
<a id=__codelineno-30-53 name=__codelineno-30-53 href=#__codelineno-30-53></a>sha256sum<span class=w> </span><span class=s2>&quot;</span><span class=nv>$BACKUP_DIR</span><span class=s2>&quot;</span>.tar.gz<span class=w> </span>&gt;<span class=w> </span><span class=s2>&quot;</span><span class=nv>$BACKUP_DIR</span><span class=s2>&quot;</span>.tar.gz.sha256
<a id=__codelineno-30-54 name=__codelineno-30-54 href=#__codelineno-30-54></a>
<a id=__codelineno-30-55 name=__codelineno-30-55 href=#__codelineno-30-55></a><span class=c1># Cleanup old backups (keep last 10)</span>
<a id=__codelineno-30-56 name=__codelineno-30-56 href=#__codelineno-30-56></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Cleaning up old backups...&quot;</span>
<a id=__codelineno-30-57 name=__codelineno-30-57 href=#__codelineno-30-57></a><span class=nb>cd</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BACKUP_ROOT</span><span class=s2>&quot;</span>
<a id=__codelineno-30-58 name=__codelineno-30-58 href=#__codelineno-30-58></a>ls<span class=w> </span>-t<span class=w> </span>backup_*.tar.gz<span class=w> </span><span class=p>|</span><span class=w> </span>tail<span class=w> </span>-n<span class=w> </span>+11<span class=w> </span><span class=p>|</span><span class=w> </span>xargs<span class=w> </span>-r<span class=w> </span>rm<span class=w> </span>-f
<a id=__codelineno-30-59 name=__codelineno-30-59 href=#__codelineno-30-59></a>ls<span class=w> </span>-t<span class=w> </span>backup_*.tar.gz.sha256<span class=w> </span><span class=p>|</span><span class=w> </span>tail<span class=w> </span>-n<span class=w> </span>+11<span class=w> </span><span class=p>|</span><span class=w> </span>xargs<span class=w> </span>-r<span class=w> </span>rm<span class=w> </span>-f
<a id=__codelineno-30-60 name=__codelineno-30-60 href=#__codelineno-30-60></a>rm<span class=w> </span>-rf<span class=w> </span>backup_*<span class=w> </span><span class=m>2</span>&gt;/dev/null<span class=w> </span><span class=o>||</span><span class=w> </span><span class=nb>true</span><span class=w>  </span><span class=c1># Remove extracted dirs</span>
<a id=__codelineno-30-61 name=__codelineno-30-61 href=#__codelineno-30-61></a>
<a id=__codelineno-30-62 name=__codelineno-30-62 href=#__codelineno-30-62></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;=== Backup Complete ===&quot;</span>
<a id=__codelineno-30-63 name=__codelineno-30-63 href=#__codelineno-30-63></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Archive: </span><span class=nv>$BACKUP_DIR</span><span class=s2>.tar.gz&quot;</span>
<a id=__codelineno-30-64 name=__codelineno-30-64 href=#__codelineno-30-64></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;SHA256: </span><span class=k>$(</span>cat<span class=w> </span><span class=s2>&quot;</span><span class=nv>$BACKUP_DIR</span><span class=s2>&quot;</span>.tar.gz.sha256<span class=k>)</span><span class=s2>&quot;</span>
<a id=__codelineno-30-65 name=__codelineno-30-65 href=#__codelineno-30-65></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Size: </span><span class=k>$(</span>du<span class=w> </span>-h<span class=w> </span><span class=s2>&quot;</span><span class=nv>$BACKUP_DIR</span><span class=s2>&quot;</span>.tar.gz<span class=w> </span><span class=p>|</span><span class=w> </span>cut<span class=w> </span>-f1<span class=k>)</span><span class=s2>&quot;</span>
</code></pre></div> <p><strong>Install as systemd timer:</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a><span class=c1># /etc/systemd/system/cert-backup.service</span>
<a id=__codelineno-31-2 name=__codelineno-31-2 href=#__codelineno-31-2></a><span class=o>[</span>Unit<span class=o>]</span>
<a id=__codelineno-31-3 name=__codelineno-31-3 href=#__codelineno-31-3></a><span class=nv>Description</span><span class=o>=</span>Tesla<span class=w> </span>Certificate<span class=w> </span>Backup
<a id=__codelineno-31-4 name=__codelineno-31-4 href=#__codelineno-31-4></a><span class=nv>After</span><span class=o>=</span>network.target
<a id=__codelineno-31-5 name=__codelineno-31-5 href=#__codelineno-31-5></a>
<a id=__codelineno-31-6 name=__codelineno-31-6 href=#__codelineno-31-6></a><span class=o>[</span>Service<span class=o>]</span>
<a id=__codelineno-31-7 name=__codelineno-31-7 href=#__codelineno-31-7></a><span class=nv>Type</span><span class=o>=</span>oneshot
<a id=__codelineno-31-8 name=__codelineno-31-8 href=#__codelineno-31-8></a><span class=nv>ExecStart</span><span class=o>=</span>/opt/scripts/cert_backup.sh
<a id=__codelineno-31-9 name=__codelineno-31-9 href=#__codelineno-31-9></a><span class=nv>User</span><span class=o>=</span>root
<a id=__codelineno-31-10 name=__codelineno-31-10 href=#__codelineno-31-10></a>
<a id=__codelineno-31-11 name=__codelineno-31-11 href=#__codelineno-31-11></a><span class=c1># /etc/systemd/system/cert-backup.timer</span>
<a id=__codelineno-31-12 name=__codelineno-31-12 href=#__codelineno-31-12></a><span class=o>[</span>Unit<span class=o>]</span>
<a id=__codelineno-31-13 name=__codelineno-31-13 href=#__codelineno-31-13></a><span class=nv>Description</span><span class=o>=</span>Run<span class=w> </span>cert<span class=w> </span>backup<span class=w> </span>weekly
<a id=__codelineno-31-14 name=__codelineno-31-14 href=#__codelineno-31-14></a>
<a id=__codelineno-31-15 name=__codelineno-31-15 href=#__codelineno-31-15></a><span class=o>[</span>Timer<span class=o>]</span>
<a id=__codelineno-31-16 name=__codelineno-31-16 href=#__codelineno-31-16></a><span class=nv>OnCalendar</span><span class=o>=</span>weekly
<a id=__codelineno-31-17 name=__codelineno-31-17 href=#__codelineno-31-17></a><span class=nv>Persistent</span><span class=o>=</span><span class=nb>true</span>
<a id=__codelineno-31-18 name=__codelineno-31-18 href=#__codelineno-31-18></a>
<a id=__codelineno-31-19 name=__codelineno-31-19 href=#__codelineno-31-19></a><span class=o>[</span>Install<span class=o>]</span>
<a id=__codelineno-31-20 name=__codelineno-31-20 href=#__codelineno-31-20></a><span class=nv>WantedBy</span><span class=o>=</span>timers.target
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a>systemctl<span class=w> </span><span class=nb>enable</span><span class=w> </span>cert-backup.timer
<a id=__codelineno-32-2 name=__codelineno-32-2 href=#__codelineno-32-2></a>systemctl<span class=w> </span>start<span class=w> </span>cert-backup.timer
</code></pre></div> <h3 id=102-restore-procedure>10.2 Restore Procedure</h3> <div class=highlight><pre><span></span><code><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-33-2 name=__codelineno-33-2 href=#__codelineno-33-2></a><span class=c1># /opt/scripts/cert_restore.sh</span>
<a id=__codelineno-33-3 name=__codelineno-33-3 href=#__codelineno-33-3></a><span class=c1># Tesla Certificate Restore Utility</span>
<a id=__codelineno-33-4 name=__codelineno-33-4 href=#__codelineno-33-4></a>
<a id=__codelineno-33-5 name=__codelineno-33-5 href=#__codelineno-33-5></a><span class=nb>set</span><span class=w> </span>-euo<span class=w> </span>pipefail
<a id=__codelineno-33-6 name=__codelineno-33-6 href=#__codelineno-33-6></a>
<a id=__codelineno-33-7 name=__codelineno-33-7 href=#__codelineno-33-7></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$#</span><span class=w> </span>-lt<span class=w> </span><span class=m>1</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-33-8 name=__codelineno-33-8 href=#__codelineno-33-8></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Usage: </span><span class=nv>$0</span><span class=s2> &lt;backup_archive.tar.gz&gt;&quot;</span>
<a id=__codelineno-33-9 name=__codelineno-33-9 href=#__codelineno-33-9></a><span class=w>    </span><span class=nb>exit</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-33-10 name=__codelineno-33-10 href=#__codelineno-33-10></a><span class=k>fi</span>
<a id=__codelineno-33-11 name=__codelineno-33-11 href=#__codelineno-33-11></a>
<a id=__codelineno-33-12 name=__codelineno-33-12 href=#__codelineno-33-12></a><span class=nv>BACKUP_ARCHIVE</span><span class=o>=</span><span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span>
<a id=__codelineno-33-13 name=__codelineno-33-13 href=#__codelineno-33-13></a><span class=nv>RESTORE_TEMP</span><span class=o>=</span><span class=s2>&quot;/tmp/cert_restore_</span><span class=nv>$$</span><span class=s2>&quot;</span>
<a id=__codelineno-33-14 name=__codelineno-33-14 href=#__codelineno-33-14></a>
<a id=__codelineno-33-15 name=__codelineno-33-15 href=#__codelineno-33-15></a><span class=c1># Verify checksum</span>
<a id=__codelineno-33-16 name=__codelineno-33-16 href=#__codelineno-33-16></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Verifying backup integrity...&quot;</span>
<a id=__codelineno-33-17 name=__codelineno-33-17 href=#__codelineno-33-17></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-f<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>BACKUP_ARCHIVE</span><span class=si>}</span><span class=s2>.sha256&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-33-18 name=__codelineno-33-18 href=#__codelineno-33-18></a><span class=w>    </span>sha256sum<span class=w> </span>-c<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>BACKUP_ARCHIVE</span><span class=si>}</span><span class=s2>.sha256&quot;</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-33-19 name=__codelineno-33-19 href=#__codelineno-33-19></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;ERROR: Checksum mismatch â€” backup may be corrupted&quot;</span>
<a id=__codelineno-33-20 name=__codelineno-33-20 href=#__codelineno-33-20></a><span class=w>        </span><span class=nb>exit</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-33-21 name=__codelineno-33-21 href=#__codelineno-33-21></a><span class=w>    </span><span class=o>}</span>
<a id=__codelineno-33-22 name=__codelineno-33-22 href=#__codelineno-33-22></a><span class=k>fi</span>
<a id=__codelineno-33-23 name=__codelineno-33-23 href=#__codelineno-33-23></a>
<a id=__codelineno-33-24 name=__codelineno-33-24 href=#__codelineno-33-24></a><span class=c1># Extract backup</span>
<a id=__codelineno-33-25 name=__codelineno-33-25 href=#__codelineno-33-25></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Extracting backup...&quot;</span>
<a id=__codelineno-33-26 name=__codelineno-33-26 href=#__codelineno-33-26></a>mkdir<span class=w> </span>-p<span class=w> </span><span class=s2>&quot;</span><span class=nv>$RESTORE_TEMP</span><span class=s2>&quot;</span>
<a id=__codelineno-33-27 name=__codelineno-33-27 href=#__codelineno-33-27></a>tar<span class=w> </span>-xzf<span class=w> </span><span class=s2>&quot;</span><span class=nv>$BACKUP_ARCHIVE</span><span class=s2>&quot;</span><span class=w> </span>-C<span class=w> </span><span class=s2>&quot;</span><span class=nv>$RESTORE_TEMP</span><span class=s2>&quot;</span>
<a id=__codelineno-33-28 name=__codelineno-33-28 href=#__codelineno-33-28></a>
<a id=__codelineno-33-29 name=__codelineno-33-29 href=#__codelineno-33-29></a><span class=nv>BACKUP_DIR</span><span class=o>=</span><span class=k>$(</span>ls<span class=w> </span>-d<span class=w> </span><span class=s2>&quot;</span><span class=nv>$RESTORE_TEMP</span><span class=s2>&quot;</span>/backup_*<span class=w> </span><span class=p>|</span><span class=w> </span>head<span class=w> </span>-1<span class=k>)</span>
<a id=__codelineno-33-30 name=__codelineno-33-30 href=#__codelineno-33-30></a>
<a id=__codelineno-33-31 name=__codelineno-33-31 href=#__codelineno-33-31></a><span class=c1># Verify backup contains required files</span>
<a id=__codelineno-33-32 name=__codelineno-33-32 href=#__codelineno-33-32></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Verifying backup contents...&quot;</span>
<a id=__codelineno-33-33 name=__codelineno-33-33 href=#__codelineno-33-33></a><span class=nv>required_files</span><span class=o>=(</span>
<a id=__codelineno-33-34 name=__codelineno-33-34 href=#__codelineno-33-34></a><span class=w>    </span><span class=s2>&quot;</span><span class=nv>$BACKUP_DIR</span><span class=s2>/car.crt&quot;</span>
<a id=__codelineno-33-35 name=__codelineno-33-35 href=#__codelineno-33-35></a><span class=w>    </span><span class=s2>&quot;</span><span class=nv>$BACKUP_DIR</span><span class=s2>/car.key&quot;</span>
<a id=__codelineno-33-36 name=__codelineno-33-36 href=#__codelineno-33-36></a><span class=w>    </span><span class=s2>&quot;</span><span class=nv>$BACKUP_DIR</span><span class=s2>/ca.crt&quot;</span>
<a id=__codelineno-33-37 name=__codelineno-33-37 href=#__codelineno-33-37></a><span class=o>)</span>
<a id=__codelineno-33-38 name=__codelineno-33-38 href=#__codelineno-33-38></a>
<a id=__codelineno-33-39 name=__codelineno-33-39 href=#__codelineno-33-39></a><span class=k>for</span><span class=w> </span>file<span class=w> </span><span class=k>in</span><span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>required_files</span><span class=p>[@]</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-33-40 name=__codelineno-33-40 href=#__codelineno-33-40></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>!<span class=w> </span>-f<span class=w> </span><span class=s2>&quot;</span><span class=nv>$file</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-33-41 name=__codelineno-33-41 href=#__codelineno-33-41></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;ERROR: Missing required file: </span><span class=nv>$file</span><span class=s2>&quot;</span>
<a id=__codelineno-33-42 name=__codelineno-33-42 href=#__codelineno-33-42></a><span class=w>        </span><span class=nb>exit</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-33-43 name=__codelineno-33-43 href=#__codelineno-33-43></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-33-44 name=__codelineno-33-44 href=#__codelineno-33-44></a><span class=k>done</span>
<a id=__codelineno-33-45 name=__codelineno-33-45 href=#__codelineno-33-45></a>
<a id=__codelineno-33-46 name=__codelineno-33-46 href=#__codelineno-33-46></a><span class=c1># Create safety backup of current state</span>
<a id=__codelineno-33-47 name=__codelineno-33-47 href=#__codelineno-33-47></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Creating safety backup of current certificates...&quot;</span>
<a id=__codelineno-33-48 name=__codelineno-33-48 href=#__codelineno-33-48></a><span class=nv>SAFETY_BACKUP</span><span class=o>=</span><span class=s2>&quot;/var/lib/car_creds_pre_restore_</span><span class=k>$(</span>date<span class=w> </span>+%s<span class=k>)</span><span class=s2>&quot;</span>
<a id=__codelineno-33-49 name=__codelineno-33-49 href=#__codelineno-33-49></a>cp<span class=w> </span>-r<span class=w> </span>/var/lib/car_creds<span class=w> </span><span class=s2>&quot;</span><span class=nv>$SAFETY_BACKUP</span><span class=s2>&quot;</span>
<a id=__codelineno-33-50 name=__codelineno-33-50 href=#__codelineno-33-50></a>
<a id=__codelineno-33-51 name=__codelineno-33-51 href=#__codelineno-33-51></a><span class=c1># Stop hermes_client</span>
<a id=__codelineno-33-52 name=__codelineno-33-52 href=#__codelineno-33-52></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Stopping hermes_client...&quot;</span>
<a id=__codelineno-33-53 name=__codelineno-33-53 href=#__codelineno-33-53></a>systemctl<span class=w> </span>stop<span class=w> </span>hermes_client
<a id=__codelineno-33-54 name=__codelineno-33-54 href=#__codelineno-33-54></a>
<a id=__codelineno-33-55 name=__codelineno-33-55 href=#__codelineno-33-55></a><span class=c1># Restore certificates</span>
<a id=__codelineno-33-56 name=__codelineno-33-56 href=#__codelineno-33-56></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Restoring certificates...&quot;</span>
<a id=__codelineno-33-57 name=__codelineno-33-57 href=#__codelineno-33-57></a>cp<span class=w> </span><span class=s2>&quot;</span><span class=nv>$BACKUP_DIR</span><span class=s2>&quot;</span>/car.crt<span class=w> </span>/var/lib/car_creds/car.crt
<a id=__codelineno-33-58 name=__codelineno-33-58 href=#__codelineno-33-58></a>cp<span class=w> </span><span class=s2>&quot;</span><span class=nv>$BACKUP_DIR</span><span class=s2>&quot;</span>/car.key<span class=w> </span>/var/lib/car_creds/car.key
<a id=__codelineno-33-59 name=__codelineno-33-59 href=#__codelineno-33-59></a>cp<span class=w> </span><span class=s2>&quot;</span><span class=nv>$BACKUP_DIR</span><span class=s2>&quot;</span>/ca.crt<span class=w> </span>/var/lib/car_creds/ca.crt
<a id=__codelineno-33-60 name=__codelineno-33-60 href=#__codelineno-33-60></a>
<a id=__codelineno-33-61 name=__codelineno-33-61 href=#__codelineno-33-61></a><span class=c1># Restore to persist</span>
<a id=__codelineno-33-62 name=__codelineno-33-62 href=#__codelineno-33-62></a>cp<span class=w> </span><span class=s2>&quot;</span><span class=nv>$BACKUP_DIR</span><span class=s2>&quot;</span>/car.crt<span class=w> </span>/persist/car_creds/car.crt
<a id=__codelineno-33-63 name=__codelineno-33-63 href=#__codelineno-33-63></a>cp<span class=w> </span><span class=s2>&quot;</span><span class=nv>$BACKUP_DIR</span><span class=s2>&quot;</span>/car.key<span class=w> </span>/persist/car_creds/car.key
<a id=__codelineno-33-64 name=__codelineno-33-64 href=#__codelineno-33-64></a>cp<span class=w> </span><span class=s2>&quot;</span><span class=nv>$BACKUP_DIR</span><span class=s2>&quot;</span>/ca.crt<span class=w> </span>/persist/car_creds/ca.crt
<a id=__codelineno-33-65 name=__codelineno-33-65 href=#__codelineno-33-65></a>
<a id=__codelineno-33-66 name=__codelineno-33-66 href=#__codelineno-33-66></a><span class=c1># Verify certificate</span>
<a id=__codelineno-33-67 name=__codelineno-33-67 href=#__codelineno-33-67></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Verifying restored certificate...&quot;</span>
<a id=__codelineno-33-68 name=__codelineno-33-68 href=#__codelineno-33-68></a>openssl<span class=w> </span>x509<span class=w> </span>-in<span class=w> </span>/var/lib/car_creds/car.crt<span class=w> </span>-noout<span class=w> </span>-dates
<a id=__codelineno-33-69 name=__codelineno-33-69 href=#__codelineno-33-69></a>
<a id=__codelineno-33-70 name=__codelineno-33-70 href=#__codelineno-33-70></a><span class=c1># Verify key match</span>
<a id=__codelineno-33-71 name=__codelineno-33-71 href=#__codelineno-33-71></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Verifying key matches certificate...&quot;</span>
<a id=__codelineno-33-72 name=__codelineno-33-72 href=#__codelineno-33-72></a><span class=nv>CERT_PUBKEY</span><span class=o>=</span><span class=k>$(</span>openssl<span class=w> </span>x509<span class=w> </span>-in<span class=w> </span>/var/lib/car_creds/car.crt<span class=w> </span>-pubkey<span class=w> </span>-noout<span class=w> </span>-outform<span class=w> </span>DER<span class=w> </span><span class=p>|</span><span class=w> </span>md5sum<span class=k>)</span>
<a id=__codelineno-33-73 name=__codelineno-33-73 href=#__codelineno-33-73></a><span class=nv>KEY_PUBKEY</span><span class=o>=</span><span class=k>$(</span>openssl<span class=w> </span>pkey<span class=w> </span>-in<span class=w> </span>/var/lib/car_creds/car.key<span class=w> </span>-pubout<span class=w> </span>-outform<span class=w> </span>DER<span class=w> </span><span class=p>|</span><span class=w> </span>md5sum<span class=k>)</span>
<a id=__codelineno-33-74 name=__codelineno-33-74 href=#__codelineno-33-74></a>
<a id=__codelineno-33-75 name=__codelineno-33-75 href=#__codelineno-33-75></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$CERT_PUBKEY</span><span class=s2>&quot;</span><span class=w> </span>!<span class=o>=</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$KEY_PUBKEY</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-33-76 name=__codelineno-33-76 href=#__codelineno-33-76></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;ERROR: Certificate and key do not match!&quot;</span>
<a id=__codelineno-33-77 name=__codelineno-33-77 href=#__codelineno-33-77></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Rolling back...&quot;</span>
<a id=__codelineno-33-78 name=__codelineno-33-78 href=#__codelineno-33-78></a><span class=w>    </span>cp<span class=w> </span>-r<span class=w> </span><span class=s2>&quot;</span><span class=nv>$SAFETY_BACKUP</span><span class=s2>&quot;</span>/*<span class=w> </span>/var/lib/car_creds/
<a id=__codelineno-33-79 name=__codelineno-33-79 href=#__codelineno-33-79></a><span class=w>    </span>systemctl<span class=w> </span>start<span class=w> </span>hermes_client
<a id=__codelineno-33-80 name=__codelineno-33-80 href=#__codelineno-33-80></a><span class=w>    </span><span class=nb>exit</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-33-81 name=__codelineno-33-81 href=#__codelineno-33-81></a><span class=k>fi</span>
<a id=__codelineno-33-82 name=__codelineno-33-82 href=#__codelineno-33-82></a>
<a id=__codelineno-33-83 name=__codelineno-33-83 href=#__codelineno-33-83></a><span class=c1># Restart hermes_client</span>
<a id=__codelineno-33-84 name=__codelineno-33-84 href=#__codelineno-33-84></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Restarting hermes_client...&quot;</span>
<a id=__codelineno-33-85 name=__codelineno-33-85 href=#__codelineno-33-85></a>systemctl<span class=w> </span>start<span class=w> </span>hermes_client
<a id=__codelineno-33-86 name=__codelineno-33-86 href=#__codelineno-33-86></a>
<a id=__codelineno-33-87 name=__codelineno-33-87 href=#__codelineno-33-87></a><span class=c1># Wait for startup</span>
<a id=__codelineno-33-88 name=__codelineno-33-88 href=#__codelineno-33-88></a>sleep<span class=w> </span><span class=m>5</span>
<a id=__codelineno-33-89 name=__codelineno-33-89 href=#__codelineno-33-89></a>
<a id=__codelineno-33-90 name=__codelineno-33-90 href=#__codelineno-33-90></a><span class=c1># Check if hermes connected</span>
<a id=__codelineno-33-91 name=__codelineno-33-91 href=#__codelineno-33-91></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Checking connectivity...&quot;</span>
<a id=__codelineno-33-92 name=__codelineno-33-92 href=#__codelineno-33-92></a>journalctl<span class=w> </span>-u<span class=w> </span>hermes_client<span class=w> </span>--since<span class=w> </span><span class=s2>&quot;1 minute ago&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-i<span class=w> </span><span class=s2>&quot;connected&quot;</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-33-93 name=__codelineno-33-93 href=#__codelineno-33-93></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;âœ… Restore successful â€” hermes_client connected&quot;</span>
<a id=__codelineno-33-94 name=__codelineno-33-94 href=#__codelineno-33-94></a><span class=w>    </span>rm<span class=w> </span>-rf<span class=w> </span><span class=s2>&quot;</span><span class=nv>$RESTORE_TEMP</span><span class=s2>&quot;</span>
<a id=__codelineno-33-95 name=__codelineno-33-95 href=#__codelineno-33-95></a><span class=w>    </span>rm<span class=w> </span>-rf<span class=w> </span><span class=s2>&quot;</span><span class=nv>$SAFETY_BACKUP</span><span class=s2>&quot;</span>
<a id=__codelineno-33-96 name=__codelineno-33-96 href=#__codelineno-33-96></a><span class=w>    </span><span class=nb>exit</span><span class=w> </span><span class=m>0</span>
<a id=__codelineno-33-97 name=__codelineno-33-97 href=#__codelineno-33-97></a><span class=o>}</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-33-98 name=__codelineno-33-98 href=#__codelineno-33-98></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;âš ï¸  hermes_client may not be connected â€” check logs&quot;</span>
<a id=__codelineno-33-99 name=__codelineno-33-99 href=#__codelineno-33-99></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;journalctl -u hermes_client -f&quot;</span>
<a id=__codelineno-33-100 name=__codelineno-33-100 href=#__codelineno-33-100></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Safety backup preserved at: </span><span class=nv>$SAFETY_BACKUP</span><span class=s2>&quot;</span>
<a id=__codelineno-33-101 name=__codelineno-33-101 href=#__codelineno-33-101></a><span class=w>    </span><span class=nb>exit</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-33-102 name=__codelineno-33-102 href=#__codelineno-33-102></a><span class=o>}</span>
</code></pre></div> <hr> <h2 id=11-security-analysis>11. Security Analysis</h2> <h3 id=111-threat-model>11.1 Threat Model</h3> <table> <thead> <tr> <th>Threat</th> <th>Impact</th> <th>Mitigation</th> </tr> </thead> <tbody> <tr> <td><strong>Certificate theft</strong></td> <td>High â€” Attacker can impersonate vehicle</td> <td>TPM protection, mTLS, VIN validation</td> </tr> <tr> <td><strong>Private key extraction</strong></td> <td>Critical â€” Full vehicle compromise</td> <td>TPM (if present), file permissions (600)</td> </tr> <tr> <td><strong>CA compromise</strong></td> <td>Critical â€” All vehicles affected</td> <td>Hardware Security Module (HSM) for CA signing</td> </tr> <tr> <td><strong>MITM attack</strong></td> <td>Medium â€” Requires CA compromise or pinning bypass</td> <td>Certificate pinning in binaries</td> </tr> <tr> <td><strong>Replay attack</strong></td> <td>Low â€” TLS prevents replay</td> <td>TLS nonce, timestamps</td> </tr> <tr> <td><strong>Orphan exploitation</strong></td> <td>Medium â€” No remote access during orphan</td> <td>Local driving unaffected</td> </tr> </tbody> </table> <h3 id=112-certificate-revocation>11.2 Certificate Revocation</h3> <p><strong>CRL (Certificate Revocation List):</strong> <div class=highlight><pre><span></span><code><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a>http://pki.tesla.com/product/pki/Tesla_Product_Root_CA-01.crl
</code></pre></div></p> <p><strong>When Tesla revokes certificates:</strong> - Stolen vehicles - Security compromise - Factory defects - Legal/regulatory requirements</p> <p><strong>Backend checks CRL during mTLS handshake</strong> - Revoked cert â†’ Connection refused - Vehicle orphaned even if cert not expired</p> <h3 id=113-best-practices>11.3 Best Practices</h3> <p><strong>For Vehicle Owners:</strong> 1. <strong>Never share certificates</strong> â€” Keep <code>/var/lib/car_creds/</code> private 2. <strong>Backup regularly</strong> â€” Encrypted, offline storage 3. <strong>Monitor expiry</strong> â€” Set reminders 6 months before expiry 4. <strong>Maintain connectivity</strong> â€” Especially during renewal window 5. <strong>Secure storage</strong> â€” If parking long-term, connect to WiFi monthly</p> <p><strong>For Researchers:</strong> 1. <strong>Respect privacy</strong> â€” Don't publish VINs or serial numbers 2. <strong>Responsible disclosure</strong> â€” Report vulnerabilities to Tesla security 3. <strong>Test safely</strong> â€” Use test vehicles, not customer cars 4. <strong>Document changes</strong> â€” Track modifications for reversibility 5. <strong>Isolate experiments</strong> â€” Sandbox environment for binary analysis</p> <hr> <h2 id=12-cross-references>12. Cross-References</h2> <h3 id=121-related-documents>12.1 Related Documents</h3> <table> <thead> <tr> <th>Document</th> <th>Relevance</th> </tr> </thead> <tbody> <tr> <td><code>00-master-cross-reference.md</code></td> <td>Certificate renewal chain overview</td> </tr> <tr> <td><code>03-certificate-recovery-orphan-cars.md</code></td> <td>Orphan car recovery procedures</td> </tr> <tr> <td><code>04-network-ports-firewall.md</code></td> <td>Hermes connectivity ports (443, 8901)</td> </tr> <tr> <td><code>02-gateway-can-flood-exploit.md</code></td> <td>Alternative recovery via Gateway exploit</td> </tr> <tr> <td><code>/workspace/workspace/tesla-hermes-research.md</code></td> <td>Original Hermes research compilation</td> </tr> </tbody> </table> <h3 id=122-external-references>12.2 External References</h3> <p><strong>Tesla PKI Infrastructure:</strong> - Root CA CRL: <code>http://pki.tesla.com/product/pki/Tesla_Product_Root_CA-01.crl</code> - Issuing CA: <code>http://pki.tesla.com/product/pki/Tesla_Product_Root_CA-01.crt</code></p> <p><strong>OID Registry:</strong> - Tesla Enterprise Number: <code>1.3.6.1.4.1.49279</code> - Product Policies: <code>1.3.6.1.4.1.49279.2.3.x</code> - VCSEC Policies: <code>1.3.6.1.4.1.49279.2.4.x</code> / <code>1.3.6.1.4.1.49279.2.5.x</code></p> <p><strong>Hermes Endpoints:</strong> - North America: <code>wss://hermes-api.prd.na.vn.cloud.tesla.com:443</code> - Europe: <code>wss://hermes-api.prd.eu.vn.cloud.tesla.com:443</code> - China: <code>wss://hermes-api.prd.cn.vn.cloud.tesla.com:443</code></p> <h3 id=123-binary-paths-mcu2-filesystem>12.3 Binary Paths (MCU2 Filesystem)</h3> <p><strong>hermes_client:</strong> <code>/opt/hermes/hermes_client</code><br> <strong>Certificates:</strong> <code>/usr/share/tesla-certificates/current/</code><br> <strong>Device Creds:</strong> <code>/var/lib/car_creds/</code> + <code>/persist/car_creds/</code><br> <strong>Service Principals:</strong> <code>/etc/service-shell/principals.d/hermes/</code><br> <strong>AppArmor Profiles:</strong> <code>/etc/apparmor.d/abstractions/hermes_client</code></p> <hr> <h2 id=appendix-a-quick-reference-commands>Appendix A: Quick Reference Commands</h2> <h3 id=certificate-inspection>Certificate Inspection</h3> <div class=highlight><pre><span></span><code><a id=__codelineno-35-1 name=__codelineno-35-1 href=#__codelineno-35-1></a><span class=c1># View certificate details</span>
<a id=__codelineno-35-2 name=__codelineno-35-2 href=#__codelineno-35-2></a>openssl<span class=w> </span>x509<span class=w> </span>-in<span class=w> </span>/var/lib/car_creds/car.crt<span class=w> </span>-text<span class=w> </span>-noout
<a id=__codelineno-35-3 name=__codelineno-35-3 href=#__codelineno-35-3></a>
<a id=__codelineno-35-4 name=__codelineno-35-4 href=#__codelineno-35-4></a><span class=c1># Check expiry</span>
<a id=__codelineno-35-5 name=__codelineno-35-5 href=#__codelineno-35-5></a>openssl<span class=w> </span>x509<span class=w> </span>-in<span class=w> </span>/var/lib/car_creds/car.crt<span class=w> </span>-noout<span class=w> </span>-dates
<a id=__codelineno-35-6 name=__codelineno-35-6 href=#__codelineno-35-6></a>
<a id=__codelineno-35-7 name=__codelineno-35-7 href=#__codelineno-35-7></a><span class=c1># Extract subject VIN</span>
<a id=__codelineno-35-8 name=__codelineno-35-8 href=#__codelineno-35-8></a>openssl<span class=w> </span>x509<span class=w> </span>-in<span class=w> </span>/var/lib/car_creds/car.crt<span class=w> </span>-noout<span class=w> </span>-subject<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-oP<span class=w> </span><span class=s1>&#39;CN=\K[A-Z0-9]+&#39;</span>
<a id=__codelineno-35-9 name=__codelineno-35-9 href=#__codelineno-35-9></a>
<a id=__codelineno-35-10 name=__codelineno-35-10 href=#__codelineno-35-10></a><span class=c1># Verify chain</span>
<a id=__codelineno-35-11 name=__codelineno-35-11 href=#__codelineno-35-11></a>openssl<span class=w> </span>verify<span class=w> </span>-CAfile<span class=w> </span>/var/lib/car_creds/ca.crt<span class=w> </span>/var/lib/car_creds/car.crt
<a id=__codelineno-35-12 name=__codelineno-35-12 href=#__codelineno-35-12></a>
<a id=__codelineno-35-13 name=__codelineno-35-13 href=#__codelineno-35-13></a><span class=c1># Check key match (ECDSA)</span>
<a id=__codelineno-35-14 name=__codelineno-35-14 href=#__codelineno-35-14></a>openssl<span class=w> </span>x509<span class=w> </span>-in<span class=w> </span>/var/lib/car_creds/car.crt<span class=w> </span>-pubkey<span class=w> </span>-noout<span class=w> </span>-outform<span class=w> </span>DER<span class=w> </span><span class=p>|</span><span class=w> </span>md5sum
<a id=__codelineno-35-15 name=__codelineno-35-15 href=#__codelineno-35-15></a>openssl<span class=w> </span>ec<span class=w> </span>-in<span class=w> </span>/var/lib/car_creds/car.key<span class=w> </span>-pubout<span class=w> </span>-outform<span class=w> </span>DER<span class=w> </span><span class=p>|</span><span class=w> </span>md5sum
<a id=__codelineno-35-16 name=__codelineno-35-16 href=#__codelineno-35-16></a>
<a id=__codelineno-35-17 name=__codelineno-35-17 href=#__codelineno-35-17></a><span class=c1># Check key match (RSA)</span>
<a id=__codelineno-35-18 name=__codelineno-35-18 href=#__codelineno-35-18></a>openssl<span class=w> </span>x509<span class=w> </span>-in<span class=w> </span>/var/lib/car_creds/car.crt<span class=w> </span>-noout<span class=w> </span>-modulus<span class=w> </span><span class=p>|</span><span class=w> </span>md5sum
<a id=__codelineno-35-19 name=__codelineno-35-19 href=#__codelineno-35-19></a>openssl<span class=w> </span>rsa<span class=w> </span>-in<span class=w> </span>/var/lib/car_creds/car.key<span class=w> </span>-noout<span class=w> </span>-modulus<span class=w> </span><span class=p>|</span><span class=w> </span>md5sum
</code></pre></div> <h3 id=service-management>Service Management</h3> <div class=highlight><pre><span></span><code><a id=__codelineno-36-1 name=__codelineno-36-1 href=#__codelineno-36-1></a><span class=c1># Check hermes_client status</span>
<a id=__codelineno-36-2 name=__codelineno-36-2 href=#__codelineno-36-2></a>systemctl<span class=w> </span>status<span class=w> </span>hermes_client
<a id=__codelineno-36-3 name=__codelineno-36-3 href=#__codelineno-36-3></a>
<a id=__codelineno-36-4 name=__codelineno-36-4 href=#__codelineno-36-4></a><span class=c1># View logs</span>
<a id=__codelineno-36-5 name=__codelineno-36-5 href=#__codelineno-36-5></a>journalctl<span class=w> </span>-u<span class=w> </span>hermes_client<span class=w> </span>-f
<a id=__codelineno-36-6 name=__codelineno-36-6 href=#__codelineno-36-6></a>
<a id=__codelineno-36-7 name=__codelineno-36-7 href=#__codelineno-36-7></a><span class=c1># Restart hermes</span>
<a id=__codelineno-36-8 name=__codelineno-36-8 href=#__codelineno-36-8></a>systemctl<span class=w> </span>restart<span class=w> </span>hermes_client
<a id=__codelineno-36-9 name=__codelineno-36-9 href=#__codelineno-36-9></a>
<a id=__codelineno-36-10 name=__codelineno-36-10 href=#__codelineno-36-10></a><span class=c1># Test connectivity</span>
<a id=__codelineno-36-11 name=__codelineno-36-11 href=#__codelineno-36-11></a>curl<span class=w> </span>-v<span class=w> </span>--cert<span class=w> </span>/var/lib/car_creds/car.crt<span class=w> </span><span class=se>\</span>
<a id=__codelineno-36-12 name=__codelineno-36-12 href=#__codelineno-36-12></a><span class=w>        </span>--key<span class=w> </span>/var/lib/car_creds/car.key<span class=w> </span><span class=se>\</span>
<a id=__codelineno-36-13 name=__codelineno-36-13 href=#__codelineno-36-13></a><span class=w>        </span>--cacert<span class=w> </span>/usr/share/tesla-certificates/combined/ServicesCAs.pem<span class=w> </span><span class=se>\</span>
<a id=__codelineno-36-14 name=__codelineno-36-14 href=#__codelineno-36-14></a><span class=w>        </span>https://hermes-api.prd.na.vn.cloud.tesla.com:443
</code></pre></div> <h3 id=certificate-lifecycle>Certificate Lifecycle</h3> <div class=highlight><pre><span></span><code><a id=__codelineno-37-1 name=__codelineno-37-1 href=#__codelineno-37-1></a><span class=c1># Calculate days until expiry</span>
<a id=__codelineno-37-2 name=__codelineno-37-2 href=#__codelineno-37-2></a><span class=nv>EXPIRY</span><span class=o>=</span><span class=k>$(</span>openssl<span class=w> </span>x509<span class=w> </span>-in<span class=w> </span>/var/lib/car_creds/car.crt<span class=w> </span>-noout<span class=w> </span>-enddate<span class=w> </span><span class=p>|</span><span class=w> </span>cut<span class=w> </span>-d<span class=o>=</span><span class=w> </span>-f2<span class=k>)</span>
<a id=__codelineno-37-3 name=__codelineno-37-3 href=#__codelineno-37-3></a><span class=nv>EXPIRY_TS</span><span class=o>=</span><span class=k>$(</span>date<span class=w> </span>-d<span class=w> </span><span class=s2>&quot;</span><span class=nv>$EXPIRY</span><span class=s2>&quot;</span><span class=w> </span>+%s<span class=k>)</span>
<a id=__codelineno-37-4 name=__codelineno-37-4 href=#__codelineno-37-4></a><span class=nv>NOW_TS</span><span class=o>=</span><span class=k>$(</span>date<span class=w> </span>+%s<span class=k>)</span>
<a id=__codelineno-37-5 name=__codelineno-37-5 href=#__codelineno-37-5></a><span class=nv>DAYS_LEFT</span><span class=o>=</span><span class=k>$((</span><span class=w> </span><span class=o>(</span><span class=nv>$EXPIRY_TS</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=nv>$NOW_TS</span><span class=o>)</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=m>86400</span><span class=w> </span><span class=k>))</span>
<a id=__codelineno-37-6 name=__codelineno-37-6 href=#__codelineno-37-6></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Certificate expires in </span><span class=nv>$DAYS_LEFT</span><span class=s2> days&quot;</span>
<a id=__codelineno-37-7 name=__codelineno-37-7 href=#__codelineno-37-7></a>
<a id=__codelineno-37-8 name=__codelineno-37-8 href=#__codelineno-37-8></a><span class=c1># Check if in renewal window (assuming 90-day threshold)</span>
<a id=__codelineno-37-9 name=__codelineno-37-9 href=#__codelineno-37-9></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$DAYS_LEFT</span><span class=w> </span>-lt<span class=w> </span><span class=m>90</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-37-10 name=__codelineno-37-10 href=#__codelineno-37-10></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;âš ï¸  In renewal window â€” ensure connectivity&quot;</span>
<a id=__codelineno-37-11 name=__codelineno-37-11 href=#__codelineno-37-11></a><span class=k>fi</span>
<a id=__codelineno-37-12 name=__codelineno-37-12 href=#__codelineno-37-12></a>
<a id=__codelineno-37-13 name=__codelineno-37-13 href=#__codelineno-37-13></a><span class=c1># Monitor for renewal</span>
<a id=__codelineno-37-14 name=__codelineno-37-14 href=#__codelineno-37-14></a>watch<span class=w> </span>-n<span class=w> </span><span class=m>300</span><span class=w> </span><span class=s1>&#39;openssl x509 -in /var/lib/car_creds/car.crt -noout -enddate&#39;</span>
</code></pre></div> <hr> <h2 id=appendix-b-certificate-timeline-calculator>Appendix B: Certificate Timeline Calculator</h2> <div class=highlight><pre><span></span><code><a id=__codelineno-38-1 name=__codelineno-38-1 href=#__codelineno-38-1></a><span class=ch>#!/bin/bash</span>
<a id=__codelineno-38-2 name=__codelineno-38-2 href=#__codelineno-38-2></a><span class=c1># cert_timeline_detailed.sh</span>
<a id=__codelineno-38-3 name=__codelineno-38-3 href=#__codelineno-38-3></a>
<a id=__codelineno-38-4 name=__codelineno-38-4 href=#__codelineno-38-4></a><span class=nv>CERT</span><span class=o>=</span><span class=s2>&quot;/var/lib/car_creds/car.crt&quot;</span>
<a id=__codelineno-38-5 name=__codelineno-38-5 href=#__codelineno-38-5></a>
<a id=__codelineno-38-6 name=__codelineno-38-6 href=#__codelineno-38-6></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>!<span class=w> </span>-f<span class=w> </span><span class=s2>&quot;</span><span class=nv>$CERT</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-38-7 name=__codelineno-38-7 href=#__codelineno-38-7></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Certificate not found at </span><span class=nv>$CERT</span><span class=s2>&quot;</span>
<a id=__codelineno-38-8 name=__codelineno-38-8 href=#__codelineno-38-8></a><span class=w>    </span><span class=nb>exit</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-38-9 name=__codelineno-38-9 href=#__codelineno-38-9></a><span class=k>fi</span>
<a id=__codelineno-38-10 name=__codelineno-38-10 href=#__codelineno-38-10></a>
<a id=__codelineno-38-11 name=__codelineno-38-11 href=#__codelineno-38-11></a><span class=c1># Extract dates</span>
<a id=__codelineno-38-12 name=__codelineno-38-12 href=#__codelineno-38-12></a><span class=nv>NOT_BEFORE</span><span class=o>=</span><span class=k>$(</span>openssl<span class=w> </span>x509<span class=w> </span>-in<span class=w> </span><span class=s2>&quot;</span><span class=nv>$CERT</span><span class=s2>&quot;</span><span class=w> </span>-noout<span class=w> </span>-startdate<span class=w> </span><span class=p>|</span><span class=w> </span>cut<span class=w> </span>-d<span class=o>=</span><span class=w> </span>-f2<span class=k>)</span>
<a id=__codelineno-38-13 name=__codelineno-38-13 href=#__codelineno-38-13></a><span class=nv>NOT_AFTER</span><span class=o>=</span><span class=k>$(</span>openssl<span class=w> </span>x509<span class=w> </span>-in<span class=w> </span><span class=s2>&quot;</span><span class=nv>$CERT</span><span class=s2>&quot;</span><span class=w> </span>-noout<span class=w> </span>-enddate<span class=w> </span><span class=p>|</span><span class=w> </span>cut<span class=w> </span>-d<span class=o>=</span><span class=w> </span>-f2<span class=k>)</span>
<a id=__codelineno-38-14 name=__codelineno-38-14 href=#__codelineno-38-14></a>
<a id=__codelineno-38-15 name=__codelineno-38-15 href=#__codelineno-38-15></a><span class=c1># Convert to timestamps</span>
<a id=__codelineno-38-16 name=__codelineno-38-16 href=#__codelineno-38-16></a><span class=nv>ISSUED_TS</span><span class=o>=</span><span class=k>$(</span>date<span class=w> </span>-d<span class=w> </span><span class=s2>&quot;</span><span class=nv>$NOT_BEFORE</span><span class=s2>&quot;</span><span class=w> </span>+%s<span class=k>)</span>
<a id=__codelineno-38-17 name=__codelineno-38-17 href=#__codelineno-38-17></a><span class=nv>EXPIRY_TS</span><span class=o>=</span><span class=k>$(</span>date<span class=w> </span>-d<span class=w> </span><span class=s2>&quot;</span><span class=nv>$NOT_AFTER</span><span class=s2>&quot;</span><span class=w> </span>+%s<span class=k>)</span>
<a id=__codelineno-38-18 name=__codelineno-38-18 href=#__codelineno-38-18></a><span class=nv>NOW_TS</span><span class=o>=</span><span class=k>$(</span>date<span class=w> </span>+%s<span class=k>)</span>
<a id=__codelineno-38-19 name=__codelineno-38-19 href=#__codelineno-38-19></a>
<a id=__codelineno-38-20 name=__codelineno-38-20 href=#__codelineno-38-20></a><span class=c1># Calculate durations</span>
<a id=__codelineno-38-21 name=__codelineno-38-21 href=#__codelineno-38-21></a><span class=nv>TOTAL_VALIDITY</span><span class=o>=</span><span class=k>$((</span><span class=w> </span><span class=o>(</span><span class=nv>$EXPIRY_TS</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=nv>$ISSUED_TS</span><span class=o>)</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=m>86400</span><span class=w> </span><span class=k>))</span>
<a id=__codelineno-38-22 name=__codelineno-38-22 href=#__codelineno-38-22></a><span class=nv>DAYS_ELAPSED</span><span class=o>=</span><span class=k>$((</span><span class=w> </span><span class=o>(</span><span class=nv>$NOW_TS</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=nv>$ISSUED_TS</span><span class=o>)</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=m>86400</span><span class=w> </span><span class=k>))</span>
<a id=__codelineno-38-23 name=__codelineno-38-23 href=#__codelineno-38-23></a><span class=nv>DAYS_LEFT</span><span class=o>=</span><span class=k>$((</span><span class=w> </span><span class=o>(</span><span class=nv>$EXPIRY_TS</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=nv>$NOW_TS</span><span class=o>)</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=m>86400</span><span class=w> </span><span class=k>))</span>
<a id=__codelineno-38-24 name=__codelineno-38-24 href=#__codelineno-38-24></a><span class=nv>PERCENT_ELAPSED</span><span class=o>=</span><span class=k>$((</span><span class=w> </span><span class=m>100</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=nv>$DAYS_ELAPSED</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=nv>$TOTAL_VALIDITY</span><span class=w> </span><span class=k>))</span>
<a id=__codelineno-38-25 name=__codelineno-38-25 href=#__codelineno-38-25></a>
<a id=__codelineno-38-26 name=__codelineno-38-26 href=#__codelineno-38-26></a><span class=c1># Estimate renewal window (90 days before expiry)</span>
<a id=__codelineno-38-27 name=__codelineno-38-27 href=#__codelineno-38-27></a><span class=nv>RENEWAL_START_TS</span><span class=o>=</span><span class=k>$((</span><span class=w> </span><span class=nv>$EXPIRY_TS</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=o>(</span><span class=m>90</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=m>86400</span><span class=o>)</span><span class=w> </span><span class=k>))</span>
<a id=__codelineno-38-28 name=__codelineno-38-28 href=#__codelineno-38-28></a><span class=nv>RENEWAL_START</span><span class=o>=</span><span class=k>$(</span>date<span class=w> </span>-d<span class=w> </span>@<span class=nv>$RENEWAL_START_TS</span><span class=w> </span><span class=s2>&quot;+%Y-%m-%d %H:%M:%S&quot;</span><span class=k>)</span>
<a id=__codelineno-38-29 name=__codelineno-38-29 href=#__codelineno-38-29></a><span class=nv>DAYS_TO_RENEWAL</span><span class=o>=</span><span class=k>$((</span><span class=w> </span><span class=o>(</span><span class=nv>$RENEWAL_START_TS</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=nv>$NOW_TS</span><span class=o>)</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=m>86400</span><span class=w> </span><span class=k>))</span>
<a id=__codelineno-38-30 name=__codelineno-38-30 href=#__codelineno-38-30></a>
<a id=__codelineno-38-31 name=__codelineno-38-31 href=#__codelineno-38-31></a><span class=c1># Display</span>
<a id=__codelineno-38-32 name=__codelineno-38-32 href=#__codelineno-38-32></a>cat<span class=w> </span><span class=s>&lt;&lt; EOF</span>
<a id=__codelineno-38-33 name=__codelineno-38-33 href=#__codelineno-38-33></a><span class=s>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<a id=__codelineno-38-34 name=__codelineno-38-34 href=#__codelineno-38-34></a><span class=s>â”‚          Tesla Certificate Lifecycle Timeline               â”‚</span>
<a id=__codelineno-38-35 name=__codelineno-38-35 href=#__codelineno-38-35></a><span class=s>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
<a id=__codelineno-38-36 name=__codelineno-38-36 href=#__codelineno-38-36></a>
<a id=__codelineno-38-37 name=__codelineno-38-37 href=#__codelineno-38-37></a><span class=s>Issued:         $(date -d &quot;$NOT_BEFORE&quot; &quot;+%Y-%m-%d %H:%M:%S %Z&quot;)</span>
<a id=__codelineno-38-38 name=__codelineno-38-38 href=#__codelineno-38-38></a><span class=s>Expires:        $(date -d &quot;$NOT_AFTER&quot; &quot;+%Y-%m-%d %H:%M:%S %Z&quot;)</span>
<a id=__codelineno-38-39 name=__codelineno-38-39 href=#__codelineno-38-39></a><span class=s>Total Validity: $TOTAL_VALIDITY days</span>
<a id=__codelineno-38-40 name=__codelineno-38-40 href=#__codelineno-38-40></a>
<a id=__codelineno-38-41 name=__codelineno-38-41 href=#__codelineno-38-41></a><span class=s>Current Status:</span>
<a id=__codelineno-38-42 name=__codelineno-38-42 href=#__codelineno-38-42></a><span class=s>  Days Elapsed:   $DAYS_ELAPSED / $TOTAL_VALIDITY ($PERCENT_ELAPSED%)</span>
<a id=__codelineno-38-43 name=__codelineno-38-43 href=#__codelineno-38-43></a><span class=s>  Days Remaining: $DAYS_LEFT</span>
<a id=__codelineno-38-44 name=__codelineno-38-44 href=#__codelineno-38-44></a>
<a id=__codelineno-38-45 name=__codelineno-38-45 href=#__codelineno-38-45></a><span class=s>Renewal Window (estimated):</span>
<a id=__codelineno-38-46 name=__codelineno-38-46 href=#__codelineno-38-46></a><span class=s>  Starts:         $RENEWAL_START (90 days before expiry)</span>
<a id=__codelineno-38-47 name=__codelineno-38-47 href=#__codelineno-38-47></a><span class=s>  Days to Window: $DAYS_TO_RENEWAL</span>
<a id=__codelineno-38-48 name=__codelineno-38-48 href=#__codelineno-38-48></a>
<a id=__codelineno-38-49 name=__codelineno-38-49 href=#__codelineno-38-49></a><span class=s>EOF</span>
<a id=__codelineno-38-50 name=__codelineno-38-50 href=#__codelineno-38-50></a>
<a id=__codelineno-38-51 name=__codelineno-38-51 href=#__codelineno-38-51></a><span class=c1># Status assessment</span>
<a id=__codelineno-38-52 name=__codelineno-38-52 href=#__codelineno-38-52></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$DAYS_LEFT</span><span class=w> </span>-lt<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-38-53 name=__codelineno-38-53 href=#__codelineno-38-53></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;â›” STATUS: EXPIRED </span><span class=k>$((</span><span class=o>-</span><span class=nv>$DAYS_LEFT</span><span class=k>))</span><span class=s2> days ago&quot;</span>
<a id=__codelineno-38-54 name=__codelineno-38-54 href=#__codelineno-38-54></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;   Action: URGENT â€” Contact Tesla service for reprovisioning&quot;</span>
<a id=__codelineno-38-55 name=__codelineno-38-55 href=#__codelineno-38-55></a><span class=k>elif</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$DAYS_LEFT</span><span class=w> </span>-lt<span class=w> </span><span class=m>30</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-38-56 name=__codelineno-38-56 href=#__codelineno-38-56></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;ğŸ”´ STATUS: CRITICAL â€” Expires in </span><span class=nv>$DAYS_LEFT</span><span class=s2> days&quot;</span>
<a id=__codelineno-38-57 name=__codelineno-38-57 href=#__codelineno-38-57></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;   Action: Ensure connectivity IMMEDIATELY for renewal&quot;</span>
<a id=__codelineno-38-58 name=__codelineno-38-58 href=#__codelineno-38-58></a><span class=k>elif</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$DAYS_LEFT</span><span class=w> </span>-lt<span class=w> </span><span class=m>90</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-38-59 name=__codelineno-38-59 href=#__codelineno-38-59></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;ğŸŸ¡ STATUS: RENEWAL WINDOW â€” Expires in </span><span class=nv>$DAYS_LEFT</span><span class=s2> days&quot;</span>
<a id=__codelineno-38-60 name=__codelineno-38-60 href=#__codelineno-38-60></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;   Action: Vehicle should auto-renew if connected&quot;</span>
<a id=__codelineno-38-61 name=__codelineno-38-61 href=#__codelineno-38-61></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;   Verify connectivity to hermes-api endpoints&quot;</span>
<a id=__codelineno-38-62 name=__codelineno-38-62 href=#__codelineno-38-62></a><span class=k>elif</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$DAYS_LEFT</span><span class=w> </span>-lt<span class=w> </span><span class=m>180</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-38-63 name=__codelineno-38-63 href=#__codelineno-38-63></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;ğŸŸ¢ STATUS: APPROACHING RENEWAL â€” Expires in </span><span class=nv>$DAYS_LEFT</span><span class=s2> days&quot;</span>
<a id=__codelineno-38-64 name=__codelineno-38-64 href=#__codelineno-38-64></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;   Action: Monitor for auto-renewal in coming weeks&quot;</span>
<a id=__codelineno-38-65 name=__codelineno-38-65 href=#__codelineno-38-65></a><span class=k>else</span>
<a id=__codelineno-38-66 name=__codelineno-38-66 href=#__codelineno-38-66></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;âœ… STATUS: VALID â€” Expires in </span><span class=nv>$DAYS_LEFT</span><span class=s2> days&quot;</span>
<a id=__codelineno-38-67 name=__codelineno-38-67 href=#__codelineno-38-67></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;   Action: No immediate action needed&quot;</span>
<a id=__codelineno-38-68 name=__codelineno-38-68 href=#__codelineno-38-68></a><span class=k>fi</span>
<a id=__codelineno-38-69 name=__codelineno-38-69 href=#__codelineno-38-69></a>
<a id=__codelineno-38-70 name=__codelineno-38-70 href=#__codelineno-38-70></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;&quot;</span>
<a id=__codelineno-38-71 name=__codelineno-38-71 href=#__codelineno-38-71></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Current Time:   </span><span class=k>$(</span>date<span class=w> </span><span class=s2>&quot;+%Y-%m-%d %H:%M:%S %Z&quot;</span><span class=k>)</span><span class=s2>&quot;</span>
</code></pre></div> <hr> <h2 id=document-revision-history>Document Revision History</h2> <table> <thead> <tr> <th>Version</th> <th>Date</th> <th>Changes</th> </tr> </thead> <tbody> <tr> <td>1.0</td> <td>2026-02-03</td> <td>Initial comprehensive analysis</td> </tr> </tbody> </table> <p><strong>Compiled from:</strong> - MCU2 filesystem extraction (<code>/firmware/mcu2-extracted/</code>) - Binary analysis (<code>/opt/hermes/hermes_client</code>) - Previous research documents (<code>/research/*.md</code>) - User reports and field observations</p> <p><strong>Author:</strong> Security Research Subagent<br> <strong>Classification:</strong> Educational/Research Use Only<br> <strong>Disclaimer:</strong> No warranty expressed or implied. For Tesla service procedures, consult official Tesla service documentation.</p> <hr> <p><strong>END OF DOCUMENT</strong></p> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> </div> <div class=md-social> <a href=https://github.com/talas9/tesla-research target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"annotate": null, "base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.top", "toc.follow", "toc.integrate", "search.suggest", "search.highlight", "search.share", "content.code.copy", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../../assets/javascripts/bundle.79ae519e.min.js></script> </body> </html>